import{z as C,u as w,A as b,B as x,D as E,E as q,c as v,G as k,a as D,s as M,H as T,J as A}from"./index-CTt6COyb.js";const u=()=>({overlay:document.getElementById("quick-view-overlay"),modal:document.getElementById("quick-view-modal"),content:document.getElementById("quick-view-content"),template:document.getElementById("movie-card-template")?.content,prevBtn:document.getElementById("modal-prev-btn"),nextBtn:document.getElementById("modal-next-btn")}),n={startY:0,startX:0,currentY:0,isDragging:!1,isHorizontalSwipe:!1};function L(e){const{modal:t}=u(),s=e.target.closest(".movie-card");t.classList.contains("is-visible")&&!t.contains(e.target)&&!s&&y()}function B(e){const t=e.target.closest(".front-director-info a[data-director-name]"),s=e.target.closest('[data-template="actors"] a[data-actor-name]');if(t||s){e.preventDefault(),y();const a=t?"director":"actor",i=t?t.dataset.directorName:s.dataset.actorName;document.dispatchEvent(new CustomEvent("filtersReset",{detail:{keepSort:!0,newFilter:{type:a,value:i}}}))}}function I(e){const{modal:t}=u();n.startY=e.touches[0].clientY,n.startX=e.touches[0].clientX,n.isDragging=!1,n.isHorizontalSwipe=!1,t.classList.remove("is-dragging")}function N(e){if(!n.isDragging&&!n.isHorizontalSwipe&&e.defaultPrevented)return;const{modal:t,content:s}=u(),a=e.touches[0].clientY,i=e.touches[0].clientX,o=a-n.startY,r=i-n.startX;if(!n.isDragging&&!n.isHorizontalSwipe){if(Math.abs(r)<5&&Math.abs(o)<5)return;Math.abs(o)>Math.abs(r)&&o>0&&s.scrollTop<=0?window.innerWidth<=700&&(n.isDragging=!0,t.classList.add("is-dragging")):Math.abs(r)>Math.abs(o)&&(n.isHorizontalSwipe=!0)}n.isDragging?(e.cancelable&&e.preventDefault(),t.style.transform=`translate(-50%, ${o}px)`,n.currentY=o):n.isHorizontalSwipe&&e.cancelable&&e.preventDefault()}function _(e){const{modal:t}=u();if(n.isHorizontalSwipe){const s=e.changedTouches[0].clientX-n.startX;Math.abs(s)>80&&g(s<0?1:-1),n.isHorizontalSwipe=!1;return}n.isDragging&&(t.classList.remove("is-dragging"),n.currentY>120?y():t.style.transform="",n.currentY=0,n.isDragging=!1)}function g(e){const{content:t}=u(),s=t.dataset.movieId;if(!s)return;const a=document.querySelector(`.movie-card[data-movie-id="${s}"]`);if(!a)return;const i=e===1?a.nextElementSibling:a.previousElementSibling;i&&i.classList.contains("movie-card")&&X(i)}function $(e){const{prevBtn:t,nextBtn:s}=u(),a=document.querySelector(`.movie-card[data-movie-id="${e}"]`);if(!a)return;const i=a.previousElementSibling,o=a.nextElementSibling,r=i&&i.classList.contains("movie-card"),c=o&&o.classList.contains("movie-card");t&&(t.disabled=!r,t.style.opacity=r?"1":"0",t.style.pointerEvents=r?"auto":"none"),s&&(s.disabled=!c,s.style.opacity=c?"1":"0",s.style.pointerEvents=c?"auto":"none")}const S=(e,t)=>v("a",{textContent:e,href:"#",dataset:{[t==="director"?"directorName":"actorName"]:e}});function H(e,t){const s=e.querySelector("img");s&&(s.src=t.image_hq||t.image,s.alt=`PÃ³ster de ${t.title}`);const a=e.querySelector('[data-template="title"]');a.textContent=t.title,a.className="",t.title.length>45?a.classList.add("title-xl-long"):t.title.length>25&&a.classList.add("title-long");const i=e.querySelector('[data-template="director"]');i.textContent="",t.directors&&t.directors.split(", ").forEach((r,c,l)=>{i.appendChild(S(r.trim(),"director")),c<l.length-1&&i.append(", ")}),e.querySelector('[data-template="year"]').textContent=t.year||"",k(e.querySelector('[data-template="country-container"]'),e.querySelector('[data-template="country-flag"]'),t.country_code,t.country);const o=e.querySelector(".card-icons-line");o&&(o.innerHTML="",[...t.studios_list?.split(",")||[],...t.selections_list?.split(",")||[]].forEach(c=>{const l=D[c];l&&o.appendChild(v("span",{className:`platform-icon ${l.class||""}`,title:l.title,innerHTML:`<svg width="${l.w||24}" height="${l.h||24}" fill="currentColor" viewBox="${l.vb||"0 0 24 24"}"><use href="${M}#${l.id}"></use></svg>`}))}))}function Y(e,t){const s=e.querySelector(".back-original-title-wrapper");if(t.original_title&&t.original_title.trim()&&t.original_title.toLowerCase()!==t.title.toLowerCase()){const p=s.querySelector("span");p.textContent=t.original_title,p.className="",t.original_title.length>40?p.classList.add("title-xl-long"):t.original_title.length>20&&p.classList.add("title-long"),s.style.display="flex"}else s.style.display="none";const i=t.type?.toUpperCase().startsWith("S.");e.querySelector('[data-template="duration"]').textContent=T(t.minutes,i);const o=e.querySelector('[data-template="episodes"]'),r=i&&t.episodes?`${t.episodes} x`:"";o.textContent=r,o.style.display=r?"inline":"none";const c=(p,m)=>{const d=e.querySelector(`[data-template="${p}-link"]`);m?(d.href=m,d.classList.remove("disabled"),d.setAttribute("aria-label",`Ver en ${p}`),d.style.display="flex"):(d.removeAttribute("href"),d.classList.add("disabled"),d.removeAttribute("aria-label"),d.style.display="flex")};c("justwatch",t.justwatch),c("wikipedia",t.wikipedia),e.querySelector('[data-template="genre"]').textContent=t.genres||"N/A",e.querySelector('[data-template="synopsis"]').textContent=t.synopsis||"N/A";const l=e.querySelector('[data-template="critic-container"]');t.critic?.trim()?(l.querySelector('[data-template="critic"]').textContent=t.critic,l.style.display="block"):l.style.display="none";const f=e.querySelector('[data-template="actors"]');f.textContent="",t.actors?t.actors.split(",").forEach((p,m,d)=>{const h=p.trim();A.includes(h.toLowerCase())?f.append(h):f.appendChild(S(h,"actor")),m<d.length-1&&f.append(", ")}):f.textContent="N/A"}function z(e){const{template:t,content:s,modal:a}=u();if(!t)return;const i=e.movieData,o=e.querySelector("img");i.image_hq=o?o.dataset.src||o.src:null;const r=t.cloneNode(!0);r.querySelector(".movie-card").classList.add("is-quick-view"),a.classList.contains("is-visible")||a.classList.remove("hide-arrows"),s.movieData=i,s.dataset.movieId=i.id;const l=r.querySelector(".flip-card-front"),f=r.querySelector(".flip-card-back");H(l,i),Y(f,i),x(f,i),s.textContent="",s.appendChild(r),E(s),q(s),$(i.id)}function y(){const{modal:e,overlay:t}=u();e.classList.contains("is-visible")&&(e.classList.remove("is-visible"),t.classList.remove("is-visible"),document.body.classList.remove("modal-open"),setTimeout(()=>e.style.transform="",300),C(e,t),document.removeEventListener("click",L))}function X(e){if(!e)return;const{modal:t,overlay:s,content:a}=u();w(),z(e),document.body.classList.add("modal-open"),requestAnimationFrame(()=>{t.classList.add("is-visible"),s.classList.add("is-visible"),b(t,s,!0),a&&(a.scrollTop=0),setTimeout(()=>document.addEventListener("click",L),50)})}function O(){const{modal:e,content:t,prevBtn:s,nextBtn:a}=u();e&&(t&&t.addEventListener("click",i=>{B(i),window.innerWidth<=700&&i.target.closest(".poster-container")&&e.classList.toggle("hide-arrows")}),window.addEventListener("keydown",i=>{e.classList.contains("is-visible")&&(i.key==="Escape"?(i.stopPropagation(),y()):i.key==="ArrowLeft"?g(-1):i.key==="ArrowRight"&&g(1))},{capture:!0}),s?.addEventListener("click",i=>{i.stopPropagation(),g(-1)}),a?.addEventListener("click",i=>{i.stopPropagation(),g(1)}),navigator.maxTouchPoints>0&&(e.addEventListener("touchstart",I,{passive:!0}),e.addEventListener("touchmove",N,{passive:!1}),e.addEventListener("touchend",_,{passive:!0})))}export{y as closeModal,O as initQuickView,X as openModal};
