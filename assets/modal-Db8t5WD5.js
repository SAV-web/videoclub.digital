import{z as w,u as E,A as b,B as x,D as q,E as k,c as L,G as D,a as T,s as M,H as _,J as I}from"./index-BOjaacA-.js";const p=()=>({overlay:document.getElementById("quick-view-overlay"),modal:document.getElementById("quick-view-modal"),content:document.getElementById("quick-view-content"),template:document.getElementById("movie-card-template")?.content,prevBtn:document.getElementById("modal-prev-btn"),nextBtn:document.getElementById("modal-next-btn")}),n={startY:0,startX:0,currentY:0,isDragging:!1,isHorizontalSwipe:!1},A=80,H=120;function S(e){const{modal:t}=p(),s=e.target.closest(".movie-card");t.classList.contains("is-visible")&&!t.contains(e.target)&&!s&&y()}function B(e){const t=e.target.closest(".front-director-info a[data-director-name]"),s=e.target.closest('[data-template="actors"] a[data-actor-name]');if(t||s){e.preventDefault(),y();const a=t?"director":"actor",i=t?t.dataset.directorName:s.dataset.actorName;document.dispatchEvent(new CustomEvent("filtersReset",{detail:{keepSort:!0,newFilter:{type:a,value:i}}}))}}function N(e){const{modal:t}=p();n.startY=e.touches[0].clientY,n.startX=e.touches[0].clientX,n.isDragging=!1,n.isHorizontalSwipe=!1,t.classList.remove("is-dragging")}function $(e){if(!n.isDragging&&!n.isHorizontalSwipe&&e.defaultPrevented)return;const{modal:t,content:s}=p(),a=e.touches[0].clientY,i=e.touches[0].clientX,r=a-n.startY,o=i-n.startX;if(!n.isDragging&&!n.isHorizontalSwipe){if(Math.abs(o)<5&&Math.abs(r)<5)return;Math.abs(r)>Math.abs(o)&&r>0&&s.scrollTop<=0?window.innerWidth<=700&&(n.isDragging=!0,t.classList.add("is-dragging")):Math.abs(o)>Math.abs(r)&&(n.isHorizontalSwipe=!0)}n.isDragging?(e.cancelable&&e.preventDefault(),t.style.transform=`translate(-50%, ${r}px)`,n.currentY=r):n.isHorizontalSwipe&&e.cancelable&&e.preventDefault()}function v(e){const{modal:t}=p();if(n.isHorizontalSwipe){const s=e.changedTouches[0].clientX-n.startX;Math.abs(s)>A&&g(s<0?1:-1),n.isHorizontalSwipe=!1;return}n.isDragging&&(t.classList.remove("is-dragging"),n.currentY>H?y():t.style.transform="",n.currentY=0,n.isDragging=!1)}function g(e){const{content:t}=p(),s=t.dataset.movieId;if(!s)return;const a=document.querySelector(`.movie-card[data-movie-id="${s}"]`);if(!a)return;const i=e===1?a.nextElementSibling:a.previousElementSibling;i&&i.classList.contains("movie-card")&&P(i)}function Y(e){const{prevBtn:t,nextBtn:s}=p(),a=document.querySelector(`.movie-card[data-movie-id="${e}"]`);if(!a)return;const i=a.previousElementSibling,r=a.nextElementSibling,o=i&&i.classList.contains("movie-card"),l=r&&r.classList.contains("movie-card");t&&(t.disabled=!o,t.style.opacity=o?"1":"0",t.style.pointerEvents=o?"auto":"none"),s&&(s.disabled=!l,s.style.opacity=l?"1":"0",s.style.pointerEvents=l?"auto":"none")}const C=(e,t)=>L("a",{textContent:e,href:"#",dataset:{[t==="director"?"directorName":"actorName"]:e}});function X(e,t){const s=e.querySelector("img");s&&(s.src=t.image_hq||t.image,s.alt=`PÃ³ster de ${t.title}`);const a=e.querySelector('[data-template="title"]');a.textContent=t.title,a.className="",t.title.length>45?a.classList.add("title-xl-long"):t.title.length>25&&a.classList.add("title-long");const i=e.querySelector('[data-template="director"]');i.textContent="",t.directors&&t.directors.split(", ").forEach((o,l,c)=>{i.appendChild(C(o.trim(),"director")),l<c.length-1&&i.append(", ")}),e.querySelector('[data-template="year"]').textContent=t.year||"",D(e.querySelector('[data-template="country-container"]'),e.querySelector('[data-template="country-flag"]'),t.country_code,t.country);const r=e.querySelector(".card-icons-line");r&&(r.innerHTML="",[...t.studios_list?.split(",")||[],...t.selections_list?.split(",")||[]].forEach(l=>{const c=T[l];c&&r.appendChild(L("span",{className:`platform-icon ${c.class||""}`,title:c.title,innerHTML:`<svg width="${c.w||24}" height="${c.h||24}" fill="currentColor" viewBox="${c.vb||"0 0 24 24"}"><use href="${M}#${c.id}"></use></svg>`}))}))}function z(e,t){const s=e.querySelector(".back-original-title-wrapper");if(t.original_title&&t.original_title.trim()&&t.original_title.toLowerCase()!==t.title.toLowerCase()){const d=s.querySelector("span");d.textContent=t.original_title,d.className="",t.original_title.length>40?d.classList.add("title-xl-long"):t.original_title.length>20&&d.classList.add("title-long"),s.style.display="flex"}else s.style.display="none";const i=t.type?.toUpperCase().startsWith("S.");e.querySelector('[data-template="duration"]').textContent=_(t.minutes,i);const r=e.querySelector('[data-template="episodes"]'),o=i&&t.episodes?`${t.episodes} x`:"";r.textContent=o,r.style.display=o?"inline":"none";const l=(d,m)=>{const u=e.querySelector(`[data-template="${d}-link"]`);m?(u.href=m,u.classList.remove("disabled"),u.setAttribute("aria-label",`Ver en ${d}`),u.style.display="flex"):(u.removeAttribute("href"),u.classList.add("disabled"),u.removeAttribute("aria-label"),u.style.display="flex")};l("justwatch",t.justwatch),l("wikipedia",t.wikipedia),e.querySelector('[data-template="genre"]').textContent=t.genres||"N/A",e.querySelector('[data-template="synopsis"]').textContent=t.synopsis||"N/A";const c=e.querySelector('[data-template="critic-container"]');t.critic?.trim()?(c.querySelector('[data-template="critic"]').textContent=t.critic,c.style.display="block"):c.style.display="none";const f=e.querySelector('[data-template="actors"]');f.textContent="",t.actors?t.actors.split(",").forEach((d,m,u)=>{const h=d.trim();I.includes(h.toLowerCase())?f.append(h):f.appendChild(C(h,"actor")),m<u.length-1&&f.append(", ")}):f.textContent="N/A"}function O(e){const{template:t,content:s,modal:a}=p();if(!t)return;const i=e.querySelector("img"),r=i?i.dataset.src||i.src:null,o={...e.movieData,image_hq:r},l=t.cloneNode(!0);l.querySelector(".movie-card").classList.add("is-quick-view"),a.classList.contains("is-visible")||a.classList.remove("hide-arrows"),s.movieData=o,s.dataset.movieId=o.id;const f=l.querySelector(".flip-card-front"),d=l.querySelector(".flip-card-back");X(f,o),z(d,o),x(d,o),s.textContent="",s.appendChild(l),q(s),k(s),Y(o.id)}function y(){const{modal:e,overlay:t}=p();e.classList.contains("is-visible")&&(e.classList.remove("is-visible"),t.classList.remove("is-visible"),document.body.classList.remove("modal-open"),setTimeout(()=>e.style.transform="",300),w(e,t),document.removeEventListener("click",S))}function P(e){if(!e)return;const{modal:t,overlay:s,content:a}=p();E(),O(e),document.body.classList.add("modal-open"),requestAnimationFrame(()=>{t.classList.add("is-visible"),s.classList.add("is-visible"),b(t,s,!0),a&&(a.scrollTop=0),setTimeout(()=>document.addEventListener("click",S),50)})}function W(){const{modal:e,content:t,prevBtn:s,nextBtn:a}=p();e&&(t&&t.addEventListener("click",i=>{B(i),window.innerWidth<=700&&i.target.closest(".poster-container")&&e.classList.toggle("hide-arrows")}),window.addEventListener("keydown",i=>{e.classList.contains("is-visible")&&(i.key==="Escape"?(i.stopPropagation(),y()):i.key==="ArrowLeft"?g(-1):i.key==="ArrowRight"&&g(1))},{capture:!0}),s?.addEventListener("click",i=>{i.stopPropagation(),g(-1)}),a?.addEventListener("click",i=>{i.stopPropagation(),g(1)}),navigator.maxTouchPoints>0&&(e.addEventListener("touchstart",N,{passive:!0}),e.addEventListener("touchmove",$,{passive:!1}),e.addEventListener("touchend",v,{passive:!0}),e.addEventListener("touchcancel",v,{passive:!0})))}export{y as closeModal,W as initQuickView,P as openModal};
