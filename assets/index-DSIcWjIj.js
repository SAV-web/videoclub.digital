const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./sidebar-CDbI5kb0.js","./modal-D9ZXnSza.js","./sidebar-DxSIxjtm.css"])))=>i.map(i=>d[i]);
function yn(s,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const n in r)if(n!=="default"&&!(n in s)){const i=Object.getOwnPropertyDescriptor(r,n);i&&Object.defineProperty(s,n,i.get?i:{enumerable:!0,get:()=>r[n]})}}}return Object.freeze(Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();const _n="modulepreload",mn=function(s,e){return new URL(s,e).href},yr={},at=function(e,t,r){let n=Promise.resolve();if(t&&t.length>0){let c=function(u){return Promise.all(u.map(h=>Promise.resolve(h).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};const o=document.getElementsByTagName("link"),a=document.querySelector("meta[property=csp-nonce]"),l=a?.nonce||a?.getAttribute("nonce");n=c(t.map(u=>{if(u=mn(u,r),u in yr)return;yr[u]=!0;const h=u.endsWith(".css"),d=h?'[rel="stylesheet"]':"";if(r)for(let g=o.length-1;g>=0;g--){const p=o[g];if(p.href===u&&(!h||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${u}"]${d}`))return;const f=document.createElement("link");if(f.rel=h?"stylesheet":_n,h||(f.as="script"),f.crossOrigin="",f.href=u,l&&f.setAttribute("nonce",l),document.head.appendChild(f),h)return new Promise((g,p)=>{f.addEventListener("load",g),f.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${u}`)))})}))}function i(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return n.then(o=>{for(const a of o||[])a.status==="rejected"&&i(a.reason);return e().catch(i)})},wn=`https://wibygecgfczcvaqewleq.supabase.co
`,vn="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndpYnlnZWNnZmN6Y3ZhcWV3bGVxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQyNTQzOTYsImV4cCI6MjA2OTgzMDM5Nn0.rmTThnjKCQDbwY-_3Xa2ravmUyChgiXNE9tLq2upkOc",bn=wn,En=vn,I=Object.freeze({SUPABASE_URL:bn,SUPABASE_ANON_KEY:En,POSTER_BASE_URL:"https://wibygecgfczcvaqewleq.supabase.co/storage/v1/object/public/posters/",ITEMS_PER_PAGE:42,DYNAMIC_PAGE_SIZE_LIMIT:56,MAX_ACTIVE_FILTERS:20,MAX_EXCLUDED_FILTERS:20,SEARCH_DEBOUNCE_DELAY:400,YEAR_MIN:1926,YEAR_MAX:new Date().getFullYear(),STORAGE_VERSION:1}),lt=Object.freeze(["(a)","animación","animacion","documental"]),ee=Object.freeze({SORT:"relevance,asc",MEDIA_TYPE:"all"}),te=Object.freeze({ACTIVE:"active",DISABLED:"disabled",IS_FLIPPED:"is-flipped",IS_SCROLLED:"is-scrolled",SHOW:"show",SIDEBAR_OPEN:"sidebar-is-open",MOVIE_CARD:"movie-card",FILTER_PILL_REMOVE_BTN:"remove-filter-btn",SIDEBAR_AUTOCOMPLETE_ITEM:"sidebar-autocomplete-item",AUTOCOMPLETE_ITEM:"autocomplete-item",TYPE_FILTER_MOVIES:"type-filter--movies",TYPE_FILTER_SERIES:"type-filter--series",LAZY_LQIP:"lazy-lqip",LOADED:"loaded"}),P=Object.freeze({GRID_CONTAINER:"#grid-container",PAGINATION_CONTAINER:"#pagination-container",SEARCH_FORM:"#search-form",SEARCH_INPUT:"#search-input",SORT_SELECT:"#sort-select",THEME_TOGGLE:"#theme-toggle",SIDEBAR_TOGGLE_BTN:"#sidebar-toggle-btn",SIDEBAR_OVERLAY:"#sidebar-overlay",TYPE_FILTER_TOGGLE:"#type-filter-toggle",HEADER_PREV_BTN:"#header-prev-btn",HEADER_NEXT_BTN:"#header-next-btn",AUTOCOMPLETE_RESULTS:"#autocomplete-results",CLEAR_FILTERS_BTN:"#clear-filters-btn",ACTIVE_FILTERS_CONTAINER:"#active-filters-container",YEAR_SLIDER:"#year-slider",YEAR_START_INPUT:"#year-start-input",YEAR_END_INPUT:"#year-end-input",TOAST_CONTAINER:"#toast-container",MOVIE_CARD_TEMPLATE:"#movie-card-template",TITLE:'[data-template="title"]',DIRECTOR:'[data-template="director"]',YEAR:'[data-template="year"]',COUNTRY_CONTAINER:'[data-template="country-container"]',COUNTRY_FLAG:'[data-template="country-flag"]',DURATION:'[data-template="duration"]',FA_LINK:'[data-template="fa-link"]',FA_RATING:'[data-template="fa-rating"]',FA_VOTES:'[data-template="fa-votes"]',IMDB_LINK:'[data-template="imdb-link"]',IMDB_RATING:'[data-template="imdb-rating"]',IMDB_VOTES:'[data-template="imdb-votes"]',GENRE:'[data-template="genre"]',ACTORS:'[data-template="actors"]',SYNOPSIS:'[data-template="synopsis"]',SIDEBAR_FILTER_FORM:".sidebar-filter-form",SIDEBAR_AUTOCOMPLETE_RESULTS:".sidebar-autocomplete-results",SIDEBAR_FILTER_INPUT:".sidebar-filter-input"}),Et=Object.freeze({PAUSE:'<svg class="sidebar-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>',SQUARE_STOP:'<svg class="sidebar-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect></svg>',REWIND:'<svg class="sidebar-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 19 2 12 11 5 11 19"></polygon><polygon points="22 19 13 12 22 5 22 19"></polygon></svg>',FORWARD:'<svg class="sidebar-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 19 22 12 13 5 13 19"></polygon><polygon points="2 19 11 12 2 5 2 19"></polygon></svg>',PLAY:'<svg class="sidebar-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"></polyline><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path></svg>',PAUSE_SMALL:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 11v6"/><path d="M14 11v6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/><path d="M3 6h18"/><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>',CHEVRON_RIGHT:'<svg class="chevron-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>',POPCORN:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 7 3 5m6 1V3m4 4 2-2"/><circle cx="9" cy="13" r="3"/><path d="M11.83 12H20a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h2.17M16 16h2"/></svg>',CLAPPERBOARD:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.2 6 3 11l-.9-2.4c-.3-1.1.3-2.2 1.3-2.5l13.5-4c1.1-.3 2.2.3 2.5 1.3Zm-14-.7 3.1 3.9m3.1-5.8 3.1 4M3 11h18v8a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2Z"/></svg>',TV:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m17 2-5 5-5-5"/><rect width="20" height="15" x="2" y="7" rx="2"/></svg>'}),is=Object.freeze({N:{id:"icon-netflix",class:"netflix-icon",title:"Netflix"},D:{id:"icon-disney",class:"disney-icon",title:"Disney"},W:{id:"icon-wb",class:"wb-icon",title:"Warner Bros."},U:{id:"icon-universal",class:"universal-icon",title:"Universal"},S:{id:"icon-sony",class:"sony-icon",title:"Sony-Columbia"},P:{id:"icon-paramount",class:"paramount-icon",title:"Paramount"},L:{id:"icon-lionsgate",class:"lionsgate-icon",title:"Lionsgate"},Z:{id:"icon-amazon",class:"amazon-icon",title:"Amazon MGM"},F:{id:"icon-twenty",class:"twenty-icon",title:"20th Century Fox"},2:{id:"icon-a24",class:"a24-icon",title:"A24"},O:{id:"icon-movistar",class:"movistar-icon",title:"Movistar"},X:{id:"icon-miramax",class:"miramax-icon",title:"Miramax"}}),Sn={selection:{label:"Selección",items:{C:"Criterion",M:"1001 Movies",A:"Arrow",K:"Kino Lorber",E:"Eureka",H:"Series HBO",T:"A Contra+"},titles:{C:"Colección Criterion",M:"1001 Películas que ver",A:"Arrow Video",H:"Series de HBO",T:"A Contracorriente"}},studio:{label:"Estudios",items:{D:"Disney",W:"Warner Bros.",P:"Paramount",U:"Universal",S:"Sony",N:"Netflix",Z:"Amazon",L:"Lionsgate",F:"20th Century",2:"A24",O:"Movistar",X:"Miramax"}},genre:{label:"Géneros",items:{Drama:"Drama",Comedia:"Comedia",Thriller:"Thriller",Acción:"Acción",Animación:"Animación",Documental:"Documental"},excludable:["Animación","Documental"]},country:{label:"Países",items:{EEUU:"EEUU",España:"España",UK:"UK",Francia:"Francia",Japón:"Japón",Italia:"Italia"},excludable:["EEUU"]},director:{label:"Directores",items:{"Woody Allen":"Woody Allen","Alfred Hitchcock":"Hitchcock","Steven Spielberg":"Spielberg","Martin Scorsese":"Scorsese","Pedro Almodóvar":"Almodóvar"}},actor:{label:"Actores",items:{"Tom Cruise":"Tom Cruise","Robert De Niro":"De Niro","Brad Pitt":"Brad Pitt","Helen Mirren":"Helen Mirren","Javier Bardem":"Javier Bardem"}}},Tn=""+new URL("flags-CqS_mVee.svg",import.meta.url).href,An=new Intl.NumberFormat("es-ES",{notation:"compact",maximumFractionDigits:1}),He=new Intl.NumberFormat("de-DE"),On=(s,e)=>{const t=typeof s=="number"?s:parseInt(String(s).replace(/\D/g,""),10);if(!t||isNaN(t))return"";if(t>=1e6)return An.format(t).replace("M"," M");if(t>=1e5)return`${Math.floor(t/1e3)} k`;if(t<3e3){const r=Math.ceil(t/100)*100;return He.format(r)}if(e==="imdb"){const r=Math.ceil(t/1e3)*1e3;return He.format(r)}if(e==="fa"){const r=Math.ceil(t/100)*100;return He.format(r)}return He.format(t)},Rn=(s,e=!1)=>{const t=+s;if(!t)return"";if(e)return`${t} min`;const r=t/60|0,n=t%60;return r>0&&n===0?`${r}h`:r>0?`${r}h ${n}min`:`${n}min`},_r=s=>s?s.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""):"",rl=(s,e)=>{if(!s)return document.createTextNode("");if(!e)return document.createTextNode(s);const t=_r(s),r=_r(e),n=t.indexOf(r);if(n===-1)return document.createTextNode(s);const i=document.createDocumentFragment();i.textContent=s.substring(0,n);const o=document.createElement("strong");return o.textContent=s.substring(n,n+e.length),i.appendChild(o),i.appendChild(document.createTextNode(s.substring(n+e.length))),i},kn=(s,e)=>{let t;const r=function(...n){const i=this;clearTimeout(t),t=setTimeout(()=>s.apply(i,n),e)};return r.cancel=()=>clearTimeout(t),r};function Cn(s){return s instanceof TypeError&&s.message.includes("Failed to fetch")?"Error de conexión. Comprueba tu internet.":s.name==="AbortError"?null:"Ha ocurrido un error inesperado. Inténtalo más tarde."}const St=new Map;function os(s){const e=St.get(s);e&&(e.abort(),St.delete(s));const t=new AbortController;return St.set(s,t),t}function In(s,e,t,r=""){if(!(!s||!e))if(t){const n=t.toLowerCase();s.style.display="flex",e.className="country-flag-icon",e.title=r||"",e.textContent="";const i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("width","16"),i.setAttribute("height","16");const o=document.createElementNS("http://www.w3.org/2000/svg","use");o.setAttribute("href",`${Tn}#flag-${n}`),i.appendChild(o),e.appendChild(i)}else s.style.display="none"}function N(s,e={}){const t=document.createElement(s);if(e.className&&(t.className=e.className),e.textContent&&(t.textContent=e.textContent),e.innerHTML&&(t.innerHTML=e.innerHTML),e.dataset){const r=Object.keys(e.dataset);for(let n=0;n<r.length;n++)t.dataset[r[n]]=e.dataset[r[n]]}if(e.attributes){const r=Object.keys(e.attributes);for(let n=0;n<r.length;n++)t.setAttribute(r[n],e.attributes[r[n]])}return e.id&&(t.id=e.id),e.type&&(t.type=e.type),e.href&&(t.href=e.href),e.src&&(t.src=e.src),t}const Se=s=>{s&&(s.classList.contains("pop-animation")&&(s.classList.remove("pop-animation"),s.offsetWidth),s.classList.add("pop-animation"),s.addEventListener("animationend",()=>s.classList.remove("pop-animation"),{once:!0}))};function Pn(s){if(!s?.image||s.image===".")return;const e=s.last_synced_at?new Date(s.last_synced_at).getTime():"1",t=`${I.POSTER_BASE_URL}${s.image}.webp?v=${e}`;if(document.querySelector(`link[rel="preload"][href="${t}"]`))return;const r=document.createElement("link");r.rel="preload",r.as="image",r.href=t,r.setAttribute("fetchpriority","high"),document.head.appendChild(r)}const jn="vibrate"in navigator;function Ne(s="light"){if(jn&&!window.matchMedia("(prefers-reduced-motion: reduce)").matches)try{switch(s){case"light":navigator.vibrate(10);break;case"medium":navigator.vibrate(20);break;case"success":navigator.vibrate([10,30,10]);break}}catch{}}const Ln={get(s){try{const e=localStorage.getItem(s);if(!e)return null;const t=JSON.parse(e);return t&&typeof t=="object"&&t.v===I.STORAGE_VERSION&&"d"in t?t.d:null}catch{return null}},set(s,e){try{const t={v:I.STORAGE_VERSION,d:e};localStorage.setItem(s,JSON.stringify(t))}catch(t){console.warn("Storage full or disabled",t)}}};var Nt=function(s,e){return Nt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},Nt(s,e)};function as(s,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Nt(s,e);function t(){this.constructor=s}s.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var ct=function(){return ct=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},ct.apply(this,arguments)};function Oe(s,e){var t={};for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&e.indexOf(r)<0&&(t[r]=s[r]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(s);n<r.length;n++)e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(s,r[n])&&(t[r[n]]=s[r[n]]);return t}function ls(s,e,t,r){var n=arguments.length,i=n<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(s,e,t,r);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(i=(n<3?o(i):n>3?o(e,t,i):o(e,t))||i);return n>3&&i&&Object.defineProperty(e,t,i),i}function cs(s,e){return function(t,r){e(t,r,s)}}function us(s,e,t,r,n,i){function o(_){if(_!==void 0&&typeof _!="function")throw new TypeError("Function expected");return _}for(var a=r.kind,l=a==="getter"?"get":a==="setter"?"set":"value",c=!e&&s?r.static?s:s.prototype:null,u=e||(c?Object.getOwnPropertyDescriptor(c,r.name):{}),h,d=!1,f=t.length-1;f>=0;f--){var g={};for(var p in r)g[p]=p==="access"?{}:r[p];for(var p in r.access)g.access[p]=r.access[p];g.addInitializer=function(_){if(d)throw new TypeError("Cannot add initializers after decoration has completed");i.push(o(_||null))};var y=(0,t[f])(a==="accessor"?{get:u.get,set:u.set}:u[l],g);if(a==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(h=o(y.get))&&(u.get=h),(h=o(y.set))&&(u.set=h),(h=o(y.init))&&n.unshift(h)}else(h=o(y))&&(a==="field"?n.unshift(h):u[l]=h)}c&&Object.defineProperty(c,r.name,u),d=!0}function hs(s,e,t){for(var r=arguments.length>2,n=0;n<e.length;n++)t=r?e[n].call(s,t):e[n].call(s);return r?t:void 0}function ds(s){return typeof s=="symbol"?s:"".concat(s)}function fs(s,e,t){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(s,"name",{configurable:!0,value:t?"".concat(t," ",e):e})}function gs(s,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,e)}function b(s,e,t,r){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(u){try{c(r.next(u))}catch(h){o(h)}}function l(u){try{c(r.throw(u))}catch(h){o(h)}}function c(u){u.done?i(u.value):n(u.value).then(a,l)}c((r=r.apply(s,e||[])).next())})}function ps(s,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,n,i,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(u){return l([c,u])}}function l(c){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(t=0)),t;)try{if(r=1,n&&(i=c[0]&2?n.return:c[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,c[1])).done)return i;switch(n=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,n=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(s,t)}catch(u){c=[6,u],n=0}finally{r=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}var _t=Object.create?(function(s,e,t,r){r===void 0&&(r=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(s,r,n)}):(function(s,e,t,r){r===void 0&&(r=t),s[r]=e[t]});function ys(s,e){for(var t in s)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&_t(e,s,t)}function ut(s){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&s[e],r=0;if(t)return t.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&r>=s.length&&(s=void 0),{value:s&&s[r++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ir(s,e){var t=typeof Symbol=="function"&&s[Symbol.iterator];if(!t)return s;var r=t.call(s),n,i=[],o;try{for(;(e===void 0||e-- >0)&&!(n=r.next()).done;)i.push(n.value)}catch(a){o={error:a}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return i}function _s(){for(var s=[],e=0;e<arguments.length;e++)s=s.concat(ir(arguments[e]));return s}function ms(){for(var s=0,e=0,t=arguments.length;e<t;e++)s+=arguments[e].length;for(var r=Array(s),n=0,e=0;e<t;e++)for(var i=arguments[e],o=0,a=i.length;o<a;o++,n++)r[n]=i[o];return r}function ws(s,e,t){if(t||arguments.length===2)for(var r=0,n=e.length,i;r<n;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return s.concat(i||Array.prototype.slice.call(e))}function Te(s){return this instanceof Te?(this.v=s,this):new Te(s)}function vs(s,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(s,e||[]),n,i=[];return n=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),n[Symbol.asyncIterator]=function(){return this},n;function o(f){return function(g){return Promise.resolve(g).then(f,h)}}function a(f,g){r[f]&&(n[f]=function(p){return new Promise(function(y,_){i.push([f,p,y,_])>1||l(f,p)})},g&&(n[f]=g(n[f])))}function l(f,g){try{c(r[f](g))}catch(p){d(i[0][3],p)}}function c(f){f.value instanceof Te?Promise.resolve(f.value.v).then(u,h):d(i[0][2],f)}function u(f){l("next",f)}function h(f){l("throw",f)}function d(f,g){f(g),i.shift(),i.length&&l(i[0][0],i[0][1])}}function bs(s){var e,t;return e={},r("next"),r("throw",function(n){throw n}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(n,i){e[n]=s[n]?function(o){return(t=!t)?{value:Te(s[n](o)),done:!1}:i?i(o):o}:i}}function Es(s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=s[Symbol.asyncIterator],t;return e?e.call(s):(s=typeof ut=="function"?ut(s):s[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(i){t[i]=s[i]&&function(o){return new Promise(function(a,l){o=s[i](o),n(a,l,o.done,o.value)})}}function n(i,o,a,l){Promise.resolve(l).then(function(c){i({value:c,done:a})},o)}}function Ss(s,e){return Object.defineProperty?Object.defineProperty(s,"raw",{value:e}):s.raw=e,s}var xn=Object.create?(function(s,e){Object.defineProperty(s,"default",{enumerable:!0,value:e})}):function(s,e){s.default=e},Dt=function(s){return Dt=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},Dt(s)};function Ts(s){if(s&&s.__esModule)return s;var e={};if(s!=null)for(var t=Dt(s),r=0;r<t.length;r++)t[r]!=="default"&&_t(e,s,t[r]);return xn(e,s),e}function As(s){return s&&s.__esModule?s:{default:s}}function Os(s,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(s):r?r.value:e.get(s)}function Rs(s,e,t,r,n){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?n.call(s,t):n?n.value=t:e.set(s,t),t}function ks(s,e){if(e===null||typeof e!="object"&&typeof e!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof s=="function"?e===s:s.has(e)}function Cs(s,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,n;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(n=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");n&&(r=function(){try{n.call(this)}catch(i){return Promise.reject(i)}}),s.stack.push({value:e,dispose:r,async:t})}else t&&s.stack.push({async:!0});return e}var $n=typeof SuppressedError=="function"?SuppressedError:function(s,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=s,r.suppressed=e,r};function Is(s){function e(i){s.error=s.hasError?new $n(i,s.error,"An error was suppressed during disposal."):i,s.hasError=!0}var t,r=0;function n(){for(;t=s.stack.pop();)try{if(!t.async&&r===1)return r=0,s.stack.push(t),Promise.resolve().then(n);if(t.dispose){var i=t.dispose.call(t.value);if(t.async)return r|=2,Promise.resolve(i).then(n,function(o){return e(o),n()})}else r|=1}catch(o){e(o)}if(r===1)return s.hasError?Promise.reject(s.error):Promise.resolve();if(s.hasError)throw s.error}return n()}function Ps(s,e){return typeof s=="string"&&/^\.\.?\//.test(s)?s.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(t,r,n,i,o){return r?e?".jsx":".js":n&&(!i||!o)?t:n+i+"."+o.toLowerCase()+"js"}):s}const Un={__extends:as,__assign:ct,__rest:Oe,__decorate:ls,__param:cs,__esDecorate:us,__runInitializers:hs,__propKey:ds,__setFunctionName:fs,__metadata:gs,__awaiter:b,__generator:ps,__createBinding:_t,__exportStar:ys,__values:ut,__read:ir,__spread:_s,__spreadArrays:ms,__spreadArray:ws,__await:Te,__asyncGenerator:vs,__asyncDelegator:bs,__asyncValues:Es,__makeTemplateObject:Ss,__importStar:Ts,__importDefault:As,__classPrivateFieldGet:Os,__classPrivateFieldSet:Rs,__classPrivateFieldIn:ks,__addDisposableResource:Cs,__disposeResources:Is,__rewriteRelativeImportExtension:Ps},Nn=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:Cs,get __assign(){return ct},__asyncDelegator:bs,__asyncGenerator:vs,__asyncValues:Es,__await:Te,__awaiter:b,__classPrivateFieldGet:Os,__classPrivateFieldIn:ks,__classPrivateFieldSet:Rs,__createBinding:_t,__decorate:ls,__disposeResources:Is,__esDecorate:us,__exportStar:ys,__extends:as,__generator:ps,__importDefault:As,__importStar:Ts,__makeTemplateObject:Ss,__metadata:gs,__param:cs,__propKey:ds,__read:ir,__rest:Oe,__rewriteRelativeImportExtension:Ps,__runInitializers:hs,__setFunctionName:fs,__spread:_s,__spreadArray:ws,__spreadArrays:ms,__values:ut,default:Un},Symbol.toStringTag,{value:"Module"})),Dn=s=>s?(...e)=>s(...e):(...e)=>fetch(...e);class or extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class Mn extends or{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class mr extends or{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class wr extends or{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Mt;(function(s){s.Any="any",s.ApNortheast1="ap-northeast-1",s.ApNortheast2="ap-northeast-2",s.ApSouth1="ap-south-1",s.ApSoutheast1="ap-southeast-1",s.ApSoutheast2="ap-southeast-2",s.CaCentral1="ca-central-1",s.EuCentral1="eu-central-1",s.EuWest1="eu-west-1",s.EuWest2="eu-west-2",s.EuWest3="eu-west-3",s.SaEast1="sa-east-1",s.UsEast1="us-east-1",s.UsWest1="us-west-1",s.UsWest2="us-west-2"})(Mt||(Mt={}));class Bn{constructor(e,{headers:t={},customFetch:r,region:n=Mt.Any}={}){this.url=e,this.headers=t,this.region=n,this.fetch=Dn(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return b(this,arguments,void 0,function*(t,r={}){var n;let i,o;try{const{headers:a,method:l,body:c,signal:u,timeout:h}=r;let d={},{region:f}=r;f||(f=this.region);const g=new URL(`${this.url}/${t}`);f&&f!=="any"&&(d["x-region"]=f,g.searchParams.set("forceFunctionRegion",f));let p;c&&(a&&!Object.prototype.hasOwnProperty.call(a,"Content-Type")||!a)?typeof Blob<"u"&&c instanceof Blob||c instanceof ArrayBuffer?(d["Content-Type"]="application/octet-stream",p=c):typeof c=="string"?(d["Content-Type"]="text/plain",p=c):typeof FormData<"u"&&c instanceof FormData?p=c:(d["Content-Type"]="application/json",p=JSON.stringify(c)):p=c;let y=u;h&&(o=new AbortController,i=setTimeout(()=>o.abort(),h),u?(y=o.signal,u.addEventListener("abort",()=>o.abort())):y=o.signal);const _=yield this.fetch(g.toString(),{method:l||"POST",headers:Object.assign(Object.assign(Object.assign({},d),this.headers),a),body:p,signal:y}).catch(O=>{throw new Mn(O)}),w=_.headers.get("x-relay-error");if(w&&w==="true")throw new mr(_);if(!_.ok)throw new wr(_);let m=((n=_.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),v;return m==="application/json"?v=yield _.json():m==="application/octet-stream"||m==="application/pdf"?v=yield _.blob():m==="text/event-stream"?v=_:m==="multipart/form-data"?v=yield _.formData():v=yield _.text(),{data:v,error:null,response:_}}catch(a){return{data:null,error:a,response:a instanceof wr||a instanceof mr?a.context:void 0}}finally{i&&clearTimeout(i)}})}}function Fn(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}function qn(s){if(Object.prototype.hasOwnProperty.call(s,"__esModule"))return s;var e=s.default;if(typeof e=="function"){var t=function r(){var n=!1;try{n=this instanceof r}catch{}return n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(s).forEach(function(r){var n=Object.getOwnPropertyDescriptor(s,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return s[r]}})}),t}var M={};const Re=qn(Nn);var Ge={},Ke={},Je={},Ye={},Xe={},Qe={},vr;function js(){if(vr)return Qe;vr=1,Object.defineProperty(Qe,"__esModule",{value:!0});class s extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return Qe.default=s,Qe}var br;function Ls(){if(br)return Xe;br=1,Object.defineProperty(Xe,"__esModule",{value:!0});const e=Re.__importDefault(js());class t{constructor(n){var i,o;this.shouldThrowOnError=!1,this.method=n.method,this.url=n.url,this.headers=new Headers(n.headers),this.schema=n.schema,this.body=n.body,this.shouldThrowOnError=(i=n.shouldThrowOnError)!==null&&i!==void 0?i:!1,this.signal=n.signal,this.isMaybeSingle=(o=n.isMaybeSingle)!==null&&o!==void 0?o:!1,n.fetch?this.fetch=n.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(n,i){return this.headers=new Headers(this.headers),this.headers.set(n,i),this}then(n,i){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const o=this.fetch;let a=o(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async l=>{var c,u,h,d;let f=null,g=null,p=null,y=l.status,_=l.statusText;if(l.ok){if(this.method!=="HEAD"){const O=await l.text();O===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((c=this.headers.get("Accept"))===null||c===void 0)&&c.includes("application/vnd.pgrst.plan+text"))?g=O:g=JSON.parse(O))}const m=(u=this.headers.get("Prefer"))===null||u===void 0?void 0:u.match(/count=(exact|planned|estimated)/),v=(h=l.headers.get("content-range"))===null||h===void 0?void 0:h.split("/");m&&v&&v.length>1&&(p=parseInt(v[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(g)&&(g.length>1?(f={code:"PGRST116",details:`Results contain ${g.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},g=null,p=null,y=406,_="Not Acceptable"):g.length===1?g=g[0]:g=null)}else{const m=await l.text();try{f=JSON.parse(m),Array.isArray(f)&&l.status===404&&(g=[],f=null,y=200,_="OK")}catch{l.status===404&&m===""?(y=204,_="No Content"):f={message:m}}if(f&&this.isMaybeSingle&&(!((d=f?.details)===null||d===void 0)&&d.includes("0 rows"))&&(f=null,y=200,_="OK"),f&&this.shouldThrowOnError)throw new e.default(f)}return{error:f,data:g,count:p,status:y,statusText:_}});return this.shouldThrowOnError||(a=a.catch(l=>{var c,u,h;return{error:{message:`${(c=l?.name)!==null&&c!==void 0?c:"FetchError"}: ${l?.message}`,details:`${(u=l?.stack)!==null&&u!==void 0?u:""}`,hint:"",code:`${(h=l?.code)!==null&&h!==void 0?h:""}`},data:null,count:null,status:0,statusText:""}})),a.then(n,i)}returns(){return this}overrideTypes(){return this}}return Xe.default=t,Xe}var Er;function xs(){if(Er)return Ye;Er=1,Object.defineProperty(Ye,"__esModule",{value:!0});const e=Re.__importDefault(Ls());class t extends e.default{select(n){let i=!1;const o=(n??"*").split("").map(a=>/\s/.test(a)&&!i?"":(a==='"'&&(i=!i),a)).join("");return this.url.searchParams.set("select",o),this.headers.append("Prefer","return=representation"),this}order(n,{ascending:i=!0,nullsFirst:o,foreignTable:a,referencedTable:l=a}={}){const c=l?`${l}.order`:"order",u=this.url.searchParams.get(c);return this.url.searchParams.set(c,`${u?`${u},`:""}${n}.${i?"asc":"desc"}${o===void 0?"":o?".nullsfirst":".nullslast"}`),this}limit(n,{foreignTable:i,referencedTable:o=i}={}){const a=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(a,`${n}`),this}range(n,i,{foreignTable:o,referencedTable:a=o}={}){const l=typeof a>"u"?"offset":`${a}.offset`,c=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(l,`${n}`),this.url.searchParams.set(c,`${i-n+1}`),this}abortSignal(n){return this.signal=n,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:n=!1,verbose:i=!1,settings:o=!1,buffers:a=!1,wal:l=!1,format:c="text"}={}){var u;const h=[n?"analyze":null,i?"verbose":null,o?"settings":null,a?"buffers":null,l?"wal":null].filter(Boolean).join("|"),d=(u=this.headers.get("Accept"))!==null&&u!==void 0?u:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${c}; for="${d}"; options=${h};`),c==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(n){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${n}`),this}}return Ye.default=t,Ye}var Sr;function ar(){if(Sr)return Je;Sr=1,Object.defineProperty(Je,"__esModule",{value:!0});const e=Re.__importDefault(xs()),t=new RegExp("[,()]");class r extends e.default{eq(i,o){return this.url.searchParams.append(i,`eq.${o}`),this}neq(i,o){return this.url.searchParams.append(i,`neq.${o}`),this}gt(i,o){return this.url.searchParams.append(i,`gt.${o}`),this}gte(i,o){return this.url.searchParams.append(i,`gte.${o}`),this}lt(i,o){return this.url.searchParams.append(i,`lt.${o}`),this}lte(i,o){return this.url.searchParams.append(i,`lte.${o}`),this}like(i,o){return this.url.searchParams.append(i,`like.${o}`),this}likeAllOf(i,o){return this.url.searchParams.append(i,`like(all).{${o.join(",")}}`),this}likeAnyOf(i,o){return this.url.searchParams.append(i,`like(any).{${o.join(",")}}`),this}ilike(i,o){return this.url.searchParams.append(i,`ilike.${o}`),this}ilikeAllOf(i,o){return this.url.searchParams.append(i,`ilike(all).{${o.join(",")}}`),this}ilikeAnyOf(i,o){return this.url.searchParams.append(i,`ilike(any).{${o.join(",")}}`),this}is(i,o){return this.url.searchParams.append(i,`is.${o}`),this}in(i,o){const a=Array.from(new Set(o)).map(l=>typeof l=="string"&&t.test(l)?`"${l}"`:`${l}`).join(",");return this.url.searchParams.append(i,`in.(${a})`),this}contains(i,o){return typeof o=="string"?this.url.searchParams.append(i,`cs.${o}`):Array.isArray(o)?this.url.searchParams.append(i,`cs.{${o.join(",")}}`):this.url.searchParams.append(i,`cs.${JSON.stringify(o)}`),this}containedBy(i,o){return typeof o=="string"?this.url.searchParams.append(i,`cd.${o}`):Array.isArray(o)?this.url.searchParams.append(i,`cd.{${o.join(",")}}`):this.url.searchParams.append(i,`cd.${JSON.stringify(o)}`),this}rangeGt(i,o){return this.url.searchParams.append(i,`sr.${o}`),this}rangeGte(i,o){return this.url.searchParams.append(i,`nxl.${o}`),this}rangeLt(i,o){return this.url.searchParams.append(i,`sl.${o}`),this}rangeLte(i,o){return this.url.searchParams.append(i,`nxr.${o}`),this}rangeAdjacent(i,o){return this.url.searchParams.append(i,`adj.${o}`),this}overlaps(i,o){return typeof o=="string"?this.url.searchParams.append(i,`ov.${o}`):this.url.searchParams.append(i,`ov.{${o.join(",")}}`),this}textSearch(i,o,{config:a,type:l}={}){let c="";l==="plain"?c="pl":l==="phrase"?c="ph":l==="websearch"&&(c="w");const u=a===void 0?"":`(${a})`;return this.url.searchParams.append(i,`${c}fts${u}.${o}`),this}match(i){return Object.entries(i).forEach(([o,a])=>{this.url.searchParams.append(o,`eq.${a}`)}),this}not(i,o,a){return this.url.searchParams.append(i,`not.${o}.${a}`),this}or(i,{foreignTable:o,referencedTable:a=o}={}){const l=a?`${a}.or`:"or";return this.url.searchParams.append(l,`(${i})`),this}filter(i,o,a){return this.url.searchParams.append(i,`${o}.${a}`),this}}return Je.default=r,Je}var Tr;function $s(){if(Tr)return Ke;Tr=1,Object.defineProperty(Ke,"__esModule",{value:!0});const e=Re.__importDefault(ar());class t{constructor(n,{headers:i={},schema:o,fetch:a}){this.url=n,this.headers=new Headers(i),this.schema=o,this.fetch=a}select(n,i){const{head:o=!1,count:a}=i??{},l=o?"HEAD":"GET";let c=!1;const u=(n??"*").split("").map(h=>/\s/.test(h)&&!c?"":(h==='"'&&(c=!c),h)).join("");return this.url.searchParams.set("select",u),a&&this.headers.append("Prefer",`count=${a}`),new e.default({method:l,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(n,{count:i,defaultToNull:o=!0}={}){var a;const l="POST";if(i&&this.headers.append("Prefer",`count=${i}`),o||this.headers.append("Prefer","missing=default"),Array.isArray(n)){const c=n.reduce((u,h)=>u.concat(Object.keys(h)),[]);if(c.length>0){const u=[...new Set(c)].map(h=>`"${h}"`);this.url.searchParams.set("columns",u.join(","))}}return new e.default({method:l,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch})}upsert(n,{onConflict:i,ignoreDuplicates:o=!1,count:a,defaultToNull:l=!0}={}){var c;const u="POST";if(this.headers.append("Prefer",`resolution=${o?"ignore":"merge"}-duplicates`),i!==void 0&&this.url.searchParams.set("on_conflict",i),a&&this.headers.append("Prefer",`count=${a}`),l||this.headers.append("Prefer","missing=default"),Array.isArray(n)){const h=n.reduce((d,f)=>d.concat(Object.keys(f)),[]);if(h.length>0){const d=[...new Set(h)].map(f=>`"${f}"`);this.url.searchParams.set("columns",d.join(","))}}return new e.default({method:u,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(c=this.fetch)!==null&&c!==void 0?c:fetch})}update(n,{count:i}={}){var o;const a="PATCH";return i&&this.headers.append("Prefer",`count=${i}`),new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}delete({count:n}={}){var i;const o="DELETE";return n&&this.headers.append("Prefer",`count=${n}`),new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}}return Ke.default=t,Ke}var Ar;function Wn(){if(Ar)return Ge;Ar=1,Object.defineProperty(Ge,"__esModule",{value:!0});const s=Re,e=s.__importDefault($s()),t=s.__importDefault(ar());class r{constructor(i,{headers:o={},schema:a,fetch:l}={}){this.url=i,this.headers=new Headers(o),this.schemaName=a,this.fetch=l}from(i){const o=new URL(`${this.url}/${i}`);return new e.default(o,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(i){return new r(this.url,{headers:this.headers,schema:i,fetch:this.fetch})}rpc(i,o={},{head:a=!1,get:l=!1,count:c}={}){var u;let h;const d=new URL(`${this.url}/rpc/${i}`);let f;a||l?(h=a?"HEAD":"GET",Object.entries(o).filter(([p,y])=>y!==void 0).map(([p,y])=>[p,Array.isArray(y)?`{${y.join(",")}}`:`${y}`]).forEach(([p,y])=>{d.searchParams.append(p,y)})):(h="POST",f=o);const g=new Headers(this.headers);return c&&g.set("Prefer",`count=${c}`),new t.default({method:h,url:d,headers:g,schema:this.schemaName,body:f,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch})}}return Ge.default=r,Ge}var Or;function Vn(){if(Or)return M;Or=1,Object.defineProperty(M,"__esModule",{value:!0}),M.PostgrestError=M.PostgrestBuilder=M.PostgrestTransformBuilder=M.PostgrestFilterBuilder=M.PostgrestQueryBuilder=M.PostgrestClient=void 0;const s=Re,e=s.__importDefault(Wn());M.PostgrestClient=e.default;const t=s.__importDefault($s());M.PostgrestQueryBuilder=t.default;const r=s.__importDefault(ar());M.PostgrestFilterBuilder=r.default;const n=s.__importDefault(xs());M.PostgrestTransformBuilder=n.default;const i=s.__importDefault(Ls());M.PostgrestBuilder=i.default;const o=s.__importDefault(js());return M.PostgrestError=o.default,M.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:r.default,PostgrestTransformBuilder:n.default,PostgrestBuilder:i.default,PostgrestError:o.default},M}var Us=Vn();const Ns=Fn(Us),zn=yn({__proto__:null,default:Ns},[Us]),{PostgrestClient:Hn,PostgrestQueryBuilder:sl,PostgrestFilterBuilder:nl,PostgrestTransformBuilder:il,PostgrestBuilder:ol,PostgrestError:al}=Ns||zn;class Gn{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const t=process.versions;if(t&&t.node){const r=t.node,n=parseInt(r.replace(/^v/,"").split(".")[0]);return n>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${n} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${n} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const r=this.getWebSocketConstructor();return new r(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const Kn="2.81.1",Jn=`realtime-js/${Kn}`,Ds="1.0.0",Yn="2.0.0",Rr=Ds,Bt=1e4,Xn=1e3,Qn=100;var ae;(function(s){s[s.connecting=0]="connecting",s[s.open=1]="open",s[s.closing=2]="closing",s[s.closed=3]="closed"})(ae||(ae={}));var $;(function(s){s.closed="closed",s.errored="errored",s.joined="joined",s.joining="joining",s.leaving="leaving"})($||($={}));var q;(function(s){s.close="phx_close",s.error="phx_error",s.join="phx_join",s.reply="phx_reply",s.leave="phx_leave",s.access_token="access_token"})(q||(q={}));var Ft;(function(s){s.websocket="websocket"})(Ft||(Ft={}));var le;(function(s){s.Connecting="connecting",s.Open="open",s.Closing="closing",s.Closed="closed"})(le||(le={}));class Zn{constructor(){this.HEADER_LENGTH=1,this.META_LENGTH=4,this.USER_BROADCAST_PUSH_META_LENGTH=5,this.KINDS={push:0,reply:1,broadcast:2,userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST="broadcast"}encode(e,t){if(this._isArrayBuffer(e.payload))return t(this._binaryEncodePush(e));if(e.event===this.BROADCAST&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return t(this._binaryEncodeUserBroadcastPush(e));let r=[e.join_ref,e.ref,e.topic,e.event,e.payload];return t(JSON.stringify(r))}_binaryEncodePush(e){const{join_ref:t,ref:r,event:n,topic:i,payload:o}=e,a=this.META_LENGTH+t.length+r.length+i.length+n.length,l=new ArrayBuffer(this.HEADER_LENGTH+a);let c=new DataView(l),u=0;c.setUint8(u++,this.KINDS.push),c.setUint8(u++,t.length),c.setUint8(u++,r.length),c.setUint8(u++,i.length),c.setUint8(u++,n.length),Array.from(t,d=>c.setUint8(u++,d.charCodeAt(0))),Array.from(r,d=>c.setUint8(u++,d.charCodeAt(0))),Array.from(i,d=>c.setUint8(u++,d.charCodeAt(0))),Array.from(n,d=>c.setUint8(u++,d.charCodeAt(0)));var h=new Uint8Array(l.byteLength+o.byteLength);return h.set(new Uint8Array(l),0),h.set(new Uint8Array(o),l.byteLength),h.buffer}_binaryEncodeUserBroadcastPush(e){var t;return this._isArrayBuffer((t=e.payload)===null||t===void 0?void 0:t.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var t,r;const{join_ref:n,ref:i,topic:o}=e,a=e.payload.event,l=(r=(t=e.payload)===null||t===void 0?void 0:t.payload)!==null&&r!==void 0?r:new ArrayBuffer(0),c=this.USER_BROADCAST_PUSH_META_LENGTH+n.length+i.length+o.length+a.length,u=new ArrayBuffer(this.HEADER_LENGTH+c);let h=new DataView(u),d=0;h.setUint8(d++,this.KINDS.userBroadcastPush),h.setUint8(d++,n.length),h.setUint8(d++,i.length),h.setUint8(d++,o.length),h.setUint8(d++,a.length),h.setUint8(d++,this.BINARY_ENCODING),Array.from(n,g=>h.setUint8(d++,g.charCodeAt(0))),Array.from(i,g=>h.setUint8(d++,g.charCodeAt(0))),Array.from(o,g=>h.setUint8(d++,g.charCodeAt(0))),Array.from(a,g=>h.setUint8(d++,g.charCodeAt(0)));var f=new Uint8Array(u.byteLength+l.byteLength);return f.set(new Uint8Array(u),0),f.set(new Uint8Array(l),u.byteLength),f.buffer}_encodeJsonUserBroadcastPush(e){var t,r;const{join_ref:n,ref:i,topic:o}=e,a=e.payload.event,l=(r=(t=e.payload)===null||t===void 0?void 0:t.payload)!==null&&r!==void 0?r:{},u=new TextEncoder().encode(JSON.stringify(l)).buffer,h=this.USER_BROADCAST_PUSH_META_LENGTH+n.length+i.length+o.length+a.length,d=new ArrayBuffer(this.HEADER_LENGTH+h);let f=new DataView(d),g=0;f.setUint8(g++,this.KINDS.userBroadcastPush),f.setUint8(g++,n.length),f.setUint8(g++,i.length),f.setUint8(g++,o.length),f.setUint8(g++,a.length),f.setUint8(g++,this.JSON_ENCODING),Array.from(n,y=>f.setUint8(g++,y.charCodeAt(0))),Array.from(i,y=>f.setUint8(g++,y.charCodeAt(0))),Array.from(o,y=>f.setUint8(g++,y.charCodeAt(0))),Array.from(a,y=>f.setUint8(g++,y.charCodeAt(0)));var p=new Uint8Array(d.byteLength+u.byteLength);return p.set(new Uint8Array(d),0),p.set(new Uint8Array(u),d.byteLength),p.buffer}decode(e,t){if(this._isArrayBuffer(e)){let r=this._binaryDecode(e);return t(r)}if(typeof e=="string"){const r=JSON.parse(e),[n,i,o,a,l]=r;return t({join_ref:n,ref:i,topic:o,event:a,payload:l})}return t({})}_binaryDecode(e){const t=new DataView(e),r=t.getUint8(0),n=new TextDecoder;switch(r){case this.KINDS.push:return this._decodePush(e,t,n);case this.KINDS.reply:return this._decodeReply(e,t,n);case this.KINDS.broadcast:return this._decodeBroadcast(e,t,n);case this.KINDS.userBroadcast:return this._decodeUserBroadcast(e,t,n)}}_decodePush(e,t,r){const n=t.getUint8(1),i=t.getUint8(2),o=t.getUint8(3);let a=this.HEADER_LENGTH+this.META_LENGTH-1;const l=r.decode(e.slice(a,a+n));a=a+n;const c=r.decode(e.slice(a,a+i));a=a+i;const u=r.decode(e.slice(a,a+o));a=a+o;const h=JSON.parse(r.decode(e.slice(a,e.byteLength)));return{join_ref:l,ref:null,topic:c,event:u,payload:h}}_decodeReply(e,t,r){const n=t.getUint8(1),i=t.getUint8(2),o=t.getUint8(3),a=t.getUint8(4);let l=this.HEADER_LENGTH+this.META_LENGTH;const c=r.decode(e.slice(l,l+n));l=l+n;const u=r.decode(e.slice(l,l+i));l=l+i;const h=r.decode(e.slice(l,l+o));l=l+o;const d=r.decode(e.slice(l,l+a));l=l+a;const f=JSON.parse(r.decode(e.slice(l,e.byteLength))),g={status:d,response:f};return{join_ref:c,ref:u,topic:h,event:q.reply,payload:g}}_decodeBroadcast(e,t,r){const n=t.getUint8(1),i=t.getUint8(2);let o=this.HEADER_LENGTH+2;const a=r.decode(e.slice(o,o+n));o=o+n;const l=r.decode(e.slice(o,o+i));o=o+i;const c=JSON.parse(r.decode(e.slice(o,e.byteLength)));return{join_ref:null,ref:null,topic:a,event:l,payload:c}}_decodeUserBroadcast(e,t,r){const n=t.getUint8(1),i=t.getUint8(2),o=t.getUint8(3),a=t.getUint8(4);let l=this.HEADER_LENGTH+4;const c=r.decode(e.slice(l,l+n));l=l+n;const u=r.decode(e.slice(l,l+i));l=l+i;const h=r.decode(e.slice(l,l+o));l=l+o;const d=e.slice(l,e.byteLength),f=a===this.JSON_ENCODING?JSON.parse(r.decode(d)):d,g={type:this.BROADCAST,event:u,payload:f};return o>0&&(g.meta=JSON.parse(h)),{join_ref:null,ref:null,topic:c,event:this.BROADCAST,payload:g}}_isArrayBuffer(e){var t;return e instanceof ArrayBuffer||((t=e?.constructor)===null||t===void 0?void 0:t.name)==="ArrayBuffer"}}class Ms{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var j;(function(s){s.abstime="abstime",s.bool="bool",s.date="date",s.daterange="daterange",s.float4="float4",s.float8="float8",s.int2="int2",s.int4="int4",s.int4range="int4range",s.int8="int8",s.int8range="int8range",s.json="json",s.jsonb="jsonb",s.money="money",s.numeric="numeric",s.oid="oid",s.reltime="reltime",s.text="text",s.time="time",s.timestamp="timestamp",s.timestamptz="timestamptz",s.timetz="timetz",s.tsrange="tsrange",s.tstzrange="tstzrange"})(j||(j={}));const kr=(s,e,t={})=>{var r;const n=(r=t.skipTypes)!==null&&r!==void 0?r:[];return e?Object.keys(e).reduce((i,o)=>(i[o]=ei(o,s,e,n),i),{}):{}},ei=(s,e,t,r)=>{const n=e.find(a=>a.name===s),i=n?.type,o=t[s];return i&&!r.includes(i)?Bs(i,o):qt(o)},Bs=(s,e)=>{if(s.charAt(0)==="_"){const t=s.slice(1,s.length);return ni(e,t)}switch(s){case j.bool:return ti(e);case j.float4:case j.float8:case j.int2:case j.int4:case j.int8:case j.numeric:case j.oid:return ri(e);case j.json:case j.jsonb:return si(e);case j.timestamp:return ii(e);case j.abstime:case j.date:case j.daterange:case j.int4range:case j.int8range:case j.money:case j.reltime:case j.text:case j.time:case j.timestamptz:case j.timetz:case j.tsrange:case j.tstzrange:return qt(e);default:return qt(e)}},qt=s=>s,ti=s=>{switch(s){case"t":return!0;case"f":return!1;default:return s}},ri=s=>{if(typeof s=="string"){const e=parseFloat(s);if(!Number.isNaN(e))return e}return s},si=s=>{if(typeof s=="string")try{return JSON.parse(s)}catch(e){return console.log(`JSON parse error: ${e}`),s}return s},ni=(s,e)=>{if(typeof s!="string")return s;const t=s.length-1,r=s[t];if(s[0]==="{"&&r==="}"){let i;const o=s.slice(1,t);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(a=>Bs(e,a))}return s},ii=s=>typeof s=="string"?s.replace(" ","T"):s,Fs=s=>{const e=new URL(s);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class Tt{constructor(e,t,r={},n=Bt){this.channel=e,this.event=t,this.payload=r,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Cr;(function(s){s.SYNC="sync",s.JOIN="join",s.LEAVE="leave"})(Cr||(Cr={}));class Le{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},n=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Le.syncState(this.state,n,i,o),this.pendingDiffs.forEach(l=>{this.state=Le.syncDiff(this.state,l,i,o)}),this.pendingDiffs=[],a()}),this.channel._on(r.diff,{},n=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=Le.syncDiff(this.state,n,i,o),a())}),this.onJoin((n,i,o)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:i,newPresences:o})}),this.onLeave((n,i,o)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,n){const i=this.cloneDeep(e),o=this.transformState(t),a={},l={};return this.map(i,(c,u)=>{o[c]||(l[c]=u)}),this.map(o,(c,u)=>{const h=i[c];if(h){const d=u.map(y=>y.presence_ref),f=h.map(y=>y.presence_ref),g=u.filter(y=>f.indexOf(y.presence_ref)<0),p=h.filter(y=>d.indexOf(y.presence_ref)<0);g.length>0&&(a[c]=g),p.length>0&&(l[c]=p)}else a[c]=u}),this.syncDiff(i,{joins:a,leaves:l},r,n)}static syncDiff(e,t,r,n){const{joins:i,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),n||(n=()=>{}),this.map(i,(a,l)=>{var c;const u=(c=e[a])!==null&&c!==void 0?c:[];if(e[a]=this.cloneDeep(l),u.length>0){const h=e[a].map(f=>f.presence_ref),d=u.filter(f=>h.indexOf(f.presence_ref)<0);e[a].unshift(...d)}r(a,u,l)}),this.map(o,(a,l)=>{let c=e[a];if(!c)return;const u=l.map(h=>h.presence_ref);c=c.filter(h=>u.indexOf(h.presence_ref)<0),e[a]=c,n(a,c,l),c.length===0&&delete e[a]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const n=e[r];return"metas"in n?t[r]=n.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[r]=n,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Ir;(function(s){s.ALL="*",s.INSERT="INSERT",s.UPDATE="UPDATE",s.DELETE="DELETE"})(Ir||(Ir={}));var xe;(function(s){s.BROADCAST="broadcast",s.PRESENCE="presence",s.POSTGRES_CHANGES="postgres_changes",s.SYSTEM="system"})(xe||(xe={}));var K;(function(s){s.SUBSCRIBED="SUBSCRIBED",s.TIMED_OUT="TIMED_OUT",s.CLOSED="CLOSED",s.CHANNEL_ERROR="CHANNEL_ERROR"})(K||(K={}));class lr{constructor(e,t={config:{}},r){var n,i;if(this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=$.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Tt(this,q.join,this.params,this.timeout),this.rejoinTimer=new Ms(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=$.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=$.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=$.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=$.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=$.errored,this.rejoinTimer.scheduleTimeout())}),this._on(q.reply,{},(o,a)=>{this._trigger(this._replyEventName(a),o)}),this.presence=new Le(this),this.broadcastEndpointURL=Fs(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((i=(n=this.params.config)===null||n===void 0?void 0:n.broadcast)===null||i===void 0)&&i.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var r,n,i;if(this.socket.isConnected()||this.socket.connect(),this.state==$.closed){const{config:{broadcast:o,presence:a,private:l}}=this.params,c=(n=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(f=>f.filter))!==null&&n!==void 0?n:[],u=!!this.bindings[xe.PRESENCE]&&this.bindings[xe.PRESENCE].length>0||((i=this.params.config.presence)===null||i===void 0?void 0:i.enabled)===!0,h={},d={broadcast:o,presence:Object.assign(Object.assign({},a),{enabled:u}),postgres_changes:c,private:l};this.socket.accessTokenValue&&(h.access_token=this.socket.accessTokenValue),this._onError(f=>e?.(K.CHANNEL_ERROR,f)),this._onClose(()=>e?.(K.CLOSED)),this.updateJoinPayload(Object.assign({config:d},h)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:f})=>{var g;if(this.socket.setAuth(),f===void 0){e?.(K.SUBSCRIBED);return}else{const p=this.bindings.postgres_changes,y=(g=p?.length)!==null&&g!==void 0?g:0,_=[];for(let w=0;w<y;w++){const m=p[w],{filter:{event:v,schema:O,table:A,filter:k}}=m,R=f&&f[w];if(R&&R.event===v&&R.schema===O&&R.table===A&&R.filter===k)_.push(Object.assign(Object.assign({},m),{id:R.id}));else{this.unsubscribe(),this.state=$.errored,e?.(K.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=_,e&&e(K.SUBSCRIBED);return}}).receive("error",f=>{this.state=$.errored,e?.(K.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(f).join(", ")||"error")))}).receive("timeout",()=>{e?.(K.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this.state===$.joined&&e===xe.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,r)}async httpSend(e,t,r={}){var n;const i=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(t==null)return Promise.reject("Payload is required for httpSend()");const o={method:"POST",headers:{Authorization:i,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:t,private:this.private}]})},a=await this._fetchWithTimeout(this.broadcastEndpointURL,o,(n=r.timeout)!==null&&n!==void 0?n:this.timeout);if(a.status===202)return{success:!0};let l=a.statusText;try{const c=await a.json();l=c.error||c.message||l}catch{}return Promise.reject(new Error(l))}async send(e,t={}){var r,n;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:i,payload:o}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(r=t.timeout)!==null&&r!==void 0?r:this.timeout);return await((n=c.body)===null||n===void 0?void 0:n.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,a,l;const c=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&i("ok"),c.receive("ok",()=>i("ok")),c.receive("error",()=>i("error")),c.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=$.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(q.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(n=>{r=new Tt(this,q.leave,{},e),r.receive("ok",()=>{t(),n("ok")}).receive("timeout",()=>{t(),n("timed out")}).receive("error",()=>{n("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=$.closed,this.bindings={}}async _fetchWithTimeout(e,t,r){const n=new AbortController,i=setTimeout(()=>n.abort(),r),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:n.signal}));return clearTimeout(i),o}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new Tt(this,e,t,r);return this._canPush()?n.send():this._addToPushBuffer(n),n}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>Qn){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var n,i;const o=e.toLocaleLowerCase(),{close:a,error:l,leave:c,join:u}=q;if(r&&[a,l,c,u].indexOf(o)>=0&&r!==this._joinRef())return;let d=this._onMessage(o,t,r);if(t&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(f=>{var g,p,y;return((g=f.filter)===null||g===void 0?void 0:g.event)==="*"||((y=(p=f.filter)===null||p===void 0?void 0:p.event)===null||y===void 0?void 0:y.toLocaleLowerCase())===o}).map(f=>f.callback(d,r)):(i=this.bindings[o])===null||i===void 0||i.filter(f=>{var g,p,y,_,w,m;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in f){const v=f.id,O=(g=f.filter)===null||g===void 0?void 0:g.event;return v&&((p=t.ids)===null||p===void 0?void 0:p.includes(v))&&(O==="*"||O?.toLocaleLowerCase()===((y=t.data)===null||y===void 0?void 0:y.type.toLocaleLowerCase()))}else{const v=(w=(_=f?.filter)===null||_===void 0?void 0:_.event)===null||w===void 0?void 0:w.toLocaleLowerCase();return v==="*"||v===((m=t?.event)===null||m===void 0?void 0:m.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===o}).map(f=>{if(typeof d=="object"&&"ids"in d){const g=d.data,{schema:p,table:y,commit_timestamp:_,type:w,errors:m}=g;d=Object.assign(Object.assign({},{schema:p,table:y,commit_timestamp:_,eventType:w,new:{},old:{},errors:m}),this._getPayloadRecords(g))}f.callback(d,r)})}_isClosed(){return this.state===$.closed}_isJoined(){return this.state===$.joined}_isJoining(){return this.state===$.joining}_isLeaving(){return this.state===$.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const n=e.toLocaleLowerCase(),i={type:n,filter:t,callback:r};return this.bindings[n]?this.bindings[n].push(i):this.bindings[n]=[i],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(n=>{var i;return!(((i=n.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&lr.isEqual(n.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(q.close,{},e)}_onError(e){this._on(q.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=$.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=kr(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=kr(e.columns,e.old_record)),t}}const At=()=>{},Ze={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},oi=[1e3,2e3,5e3,1e4],ai=1e4,li=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class ci{constructor(e,t){var r;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Bt,this.transport=null,this.heartbeatIntervalMs=Ze.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=At,this.ref=0,this.reconnectTimer=null,this.vsn=Rr,this.logger=At,this.conn=null,this.sendBuffer=[],this.serializer=new Zn,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=n=>n?(...i)=>n(...i):(...i)=>fetch(...i),!(!((r=t?.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${Ft.websocket}`,this.httpEndpoint=Fs(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Gn.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,t??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case ae.connecting:return le.Connecting;case ae.open:return le.Open;case ae.closing:return le.Closing;default:return le.Closed}}isConnected(){return this.connectionState()===le.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const r=`realtime:${e}`,n=this.getChannels().find(i=>i.topic===r);if(n)return n;{const i=new lr(`realtime:${e}`,t,this);return this.channels.push(i),i}}push(e){const{topic:t,event:r,payload:n,ref:i}=e,o=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${t} ${r} (${i})`,n),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(Xn,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},Ze.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{if(t.topic==="phoenix"&&t.event==="phx_reply")try{this.heartbeatCallback(t.payload.status==="ok"?"ok":"error")}catch(c){this.log("error","error in heartbeat callback",c)}t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:r,event:n,payload:i,ref:o}=t,a=o?`(${o})`:"",l=i.status||"";this.log("receive",`${l} ${r} ${n} ${a}`.trim(),i),this.channels.filter(c=>c._isMember(r)).forEach(c=>c._trigger(n,i,o)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){if(this.conn){if(this.conn.readyState===ae.open||this.conn.readyState===ae.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(t=>{this.log("error","error waiting for auth on connect",t),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(q.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",n=new URLSearchParams(t);return`${e}${r}${n}`}_workerObjectUrl(e){let t;if(e)t=e;else{const r=new Blob([li],{type:"application/javascript"});t=URL.createObjectURL(r)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;e?t=e:this.accessToken?t=await this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(r=>{const n={access_token:t,version:Jn};t&&r.updateJoinPayload(n),r.joinedOnce&&r._isJoined()&&r._push(q.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(t)}catch(n){this.log("error",`error in ${e} callback`,n)}})}catch(r){this.log("error",`error triggering ${e} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new Ms(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Ze.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,r,n,i,o,a,l,c,u,h,d,f;switch(this.transport=(t=e?.transport)!==null&&t!==void 0?t:null,this.timeout=(r=e?.timeout)!==null&&r!==void 0?r:Bt,this.heartbeatIntervalMs=(n=e?.heartbeatIntervalMs)!==null&&n!==void 0?n:Ze.HEARTBEAT_INTERVAL,this.worker=(i=e?.worker)!==null&&i!==void 0?i:!1,this.accessToken=(o=e?.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(a=e?.heartbeatCallback)!==null&&a!==void 0?a:At,this.vsn=(l=e?.vsn)!==null&&l!==void 0?l:Rr,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(c=e?.reconnectAfterMs)!==null&&c!==void 0?c:(g=>oi[g-1]||ai),this.vsn){case Ds:this.encode=(u=e?.encode)!==null&&u!==void 0?u:((g,p)=>p(JSON.stringify(g))),this.decode=(h=e?.decode)!==null&&h!==void 0?h:((g,p)=>p(JSON.parse(g)));break;case Yn:this.encode=(d=e?.encode)!==null&&d!==void 0?d:this.serializer.encode.bind(this.serializer),this.decode=(f=e?.decode)!==null&&f!==void 0?f:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}}class cr extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function L(s){return typeof s=="object"&&s!==null&&"__isStorageError"in s}class ui extends cr{constructor(e,t,r){super(e),this.name="StorageApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Wt extends cr{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}const ur=s=>s?(...e)=>s(...e):(...e)=>fetch(...e),hi=()=>Response,Vt=s=>{if(Array.isArray(s))return s.map(t=>Vt(t));if(typeof s=="function"||s!==Object(s))return s;const e={};return Object.entries(s).forEach(([t,r])=>{const n=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[n]=Vt(r)}),e},di=s=>{if(typeof s!="object"||s===null)return!1;const e=Object.getPrototypeOf(s);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in s)&&!(Symbol.iterator in s)},Ot=s=>{var e;return s.msg||s.message||s.error_description||(typeof s.error=="string"?s.error:(e=s.error)===null||e===void 0?void 0:e.message)||JSON.stringify(s)},fi=(s,e,t)=>b(void 0,void 0,void 0,function*(){const r=yield hi();s instanceof r&&!t?.noResolveJson?s.json().then(n=>{const i=s.status||500,o=n?.statusCode||i+"";e(new ui(Ot(n),i,o))}).catch(n=>{e(new Wt(Ot(n),n))}):e(new Wt(Ot(s),s))}),gi=(s,e,t,r)=>{const n={method:s,headers:e?.headers||{}};return s==="GET"||!r?n:(di(r)?(n.headers=Object.assign({"Content-Type":"application/json"},e?.headers),n.body=JSON.stringify(r)):n.body=r,e?.duplex&&(n.duplex=e.duplex),Object.assign(Object.assign({},n),t))};function ze(s,e,t,r,n,i){return b(this,void 0,void 0,function*(){return new Promise((o,a)=>{s(t,gi(e,r,n,i)).then(l=>{if(!l.ok)throw l;return r?.noResolveJson?l:l.json()}).then(l=>o(l)).catch(l=>fi(l,a,r))})})}function De(s,e,t,r){return b(this,void 0,void 0,function*(){return ze(s,"GET",e,t,r)})}function H(s,e,t,r,n){return b(this,void 0,void 0,function*(){return ze(s,"POST",e,r,n,t)})}function zt(s,e,t,r,n){return b(this,void 0,void 0,function*(){return ze(s,"PUT",e,r,n,t)})}function pi(s,e,t,r){return b(this,void 0,void 0,function*(){return ze(s,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),r)})}function hr(s,e,t,r,n){return b(this,void 0,void 0,function*(){return ze(s,"DELETE",e,r,n,t)})}class yi{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}execute(){return b(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(L(e))return{data:null,error:e};throw e}})}}var qs;class _i{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t,this[qs]="BlobDownloadBuilder",this.promise=null}asStream(){return new yi(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.getPromise().then(e,t)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return b(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(L(e))return{data:null,error:e};throw e}})}}qs=Symbol.toStringTag;const mi={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Pr={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class wi{constructor(e,t={},r,n){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=r,this.fetch=ur(n)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,t,r,n){return b(this,void 0,void 0,function*(){try{let i;const o=Object.assign(Object.assign({},Pr),n);let a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const l=o.metadata;typeof Blob<"u"&&r instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),l&&i.append("metadata",this.encodeMetadata(l)),i.append("",r)):typeof FormData<"u"&&r instanceof FormData?(i=r,i.has("cacheControl")||i.append("cacheControl",o.cacheControl),l&&!i.has("metadata")&&i.append("metadata",this.encodeMetadata(l))):(i=r,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,l&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(l))),(typeof ReadableStream<"u"&&i instanceof ReadableStream||i&&typeof i=="object"&&"pipe"in i&&typeof i.pipe=="function")&&!o.duplex&&(o.duplex="half")),n?.headers&&(a=Object.assign(Object.assign({},a),n.headers));const c=this._removeEmptyFolders(t),u=this._getFinalPath(c),h=yield(e=="PUT"?zt:H)(this.fetch,`${this.url}/object/${u}`,i,Object.assign({headers:a},o?.duplex?{duplex:o.duplex}:{}));return{data:{path:c,id:h.Id,fullPath:h.Key},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(L(i))return{data:null,error:i};throw i}})}upload(e,t,r){return b(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,n){return b(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),o=this._getFinalPath(i),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",t);try{let l;const c=Object.assign({upsert:Pr.upsert},n),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&r instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",r)):typeof FormData<"u"&&r instanceof FormData?(l=r,l.append("cacheControl",c.cacheControl)):(l=r,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType);const h=yield zt(this.fetch,a.toString(),l,{headers:u});return{data:{path:i,fullPath:h.Key},error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(L(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,t){return b(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const n=Object.assign({},this.headers);t?.upsert&&(n["x-upsert"]="true");const i=yield H(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:n}),o=new URL(this.url+i.url),a=o.searchParams.get("token");if(!a)throw new cr("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:a},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(L(r))return{data:null,error:r};throw r}})}update(e,t,r){return b(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return b(this,void 0,void 0,function*(){try{return{data:yield H(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r?.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(L(n))return{data:null,error:n};throw n}})}copy(e,t,r){return b(this,void 0,void 0,function*(){try{return{data:{path:(yield H(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(L(n))return{data:null,error:n};throw n}})}createSignedUrl(e,t,r){return b(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e),i=yield H(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:t},r?.transform?{transform:r.transform}:{}),{headers:this.headers});const o=r?.download?`&download=${r.download===!0?"":r.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(L(n))return{data:null,error:n};throw n}})}createSignedUrls(e,t,r){return b(this,void 0,void 0,function*(){try{const n=yield H(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=r?.download?`&download=${r.download===!0?"":r.download}`:"";return{data:n.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${i}`):null})),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(L(n))return{data:null,error:n};throw n}})}download(e,t){const n=typeof t?.transform<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString(t?.transform||{}),o=i?`?${i}`:"",a=this._getFinalPath(e),l=()=>De(this.fetch,`${this.url}/${n}/${a}${o}`,{headers:this.headers,noResolveJson:!0});return new _i(l,this.shouldThrowOnError)}info(e){return b(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const r=yield De(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Vt(r),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(L(r))return{data:null,error:r};throw r}})}exists(e){return b(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield pi(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(L(r)&&r instanceof Wt){const n=r.originalError;if([400,404].includes(n?.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),n=[],i=t?.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&n.push(i);const a=typeof t?.transform<"u"?"render/image":"object",l=this.transformOptsToQueryString(t?.transform||{});l!==""&&n.push(l);let c=n.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${r}${c}`)}}}remove(e){return b(this,void 0,void 0,function*(){try{return{data:yield hr(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(L(t))return{data:null,error:t};throw t}})}list(e,t,r){return b(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},mi),t),{prefix:e||""});return{data:yield H(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},r),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(L(n))return{data:null,error:n};throw n}})}listV2(e,t){return b(this,void 0,void 0,function*(){try{const r=Object.assign({},e);return{data:yield H(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,r,{headers:this.headers},t),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(L(r))return{data:null,error:r};throw r}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Ws="2.81.1",Vs={"X-Client-Info":`storage-js/${Ws}`};class vi{constructor(e,t={},r,n){this.shouldThrowOnError=!1;const i=new URL(e);n?.useNewHostname&&/supabase\.(co|in|red)$/.test(i.hostname)&&!i.hostname.includes("storage.supabase.")&&(i.hostname=i.hostname.replace("supabase.","storage.supabase.")),this.url=i.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Vs),t),this.fetch=ur(r)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(e){return b(this,void 0,void 0,function*(){try{const t=this.listBucketOptionsToQueryString(e);return{data:yield De(this.fetch,`${this.url}/bucket${t}`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(L(t))return{data:null,error:t};throw t}})}getBucket(e){return b(this,void 0,void 0,function*(){try{return{data:yield De(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(L(t))return{data:null,error:t};throw t}})}createBucket(e){return b(this,arguments,void 0,function*(t,r={public:!1}){try{return{data:yield H(this.fetch,`${this.url}/bucket`,{id:t,name:t,type:r.type,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(L(n))return{data:null,error:n};throw n}})}updateBucket(e,t){return b(this,void 0,void 0,function*(){try{return{data:yield zt(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(L(r))return{data:null,error:r};throw r}})}emptyBucket(e){return b(this,void 0,void 0,function*(){try{return{data:yield H(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(L(t))return{data:null,error:t};throw t}})}deleteBucket(e){return b(this,void 0,void 0,function*(){try{return{data:yield hr(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(L(t))return{data:null,error:t};throw t}})}listBucketOptionsToQueryString(e){const t={};return e&&("limit"in e&&(t.limit=String(e.limit)),"offset"in e&&(t.offset=String(e.offset)),e.search&&(t.search=e.search),e.sortColumn&&(t.sortColumn=e.sortColumn),e.sortOrder&&(t.sortOrder=e.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}}class bi{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Vs),t),this.fetch=ur(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return b(this,void 0,void 0,function*(){try{return{data:yield H(this.fetch,`${this.url}/bucket`,{name:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(L(t))return{data:null,error:t};throw t}})}listBuckets(e){return b(this,void 0,void 0,function*(){try{const t=new URLSearchParams;e?.limit!==void 0&&t.set("limit",e.limit.toString()),e?.offset!==void 0&&t.set("offset",e.offset.toString()),e?.sortColumn&&t.set("sortColumn",e.sortColumn),e?.sortOrder&&t.set("sortOrder",e.sortOrder),e?.search&&t.set("search",e.search);const r=t.toString(),n=r?`${this.url}/bucket?${r}`:`${this.url}/bucket`;return{data:yield De(this.fetch,n,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(L(t))return{data:null,error:t};throw t}})}deleteBucket(e){return b(this,void 0,void 0,function*(){try{return{data:yield hr(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(L(t))return{data:null,error:t};throw t}})}}const dr={"X-Client-Info":`storage-js/${Ws}`,"Content-Type":"application/json"};class zs extends Error{constructor(e){super(e),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function B(s){return typeof s=="object"&&s!==null&&"__isStorageVectorsError"in s}class Rt extends zs{constructor(e,t,r){super(e),this.name="StorageVectorsApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Ei extends zs{constructor(e,t){super(e),this.name="StorageVectorsUnknownError",this.originalError=t}}var jr;(function(s){s.InternalError="InternalError",s.S3VectorConflictException="S3VectorConflictException",s.S3VectorNotFoundException="S3VectorNotFoundException",s.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",s.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",s.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded"})(jr||(jr={}));const fr=s=>s?(...e)=>s(...e):(...e)=>fetch(...e),Si=s=>{if(typeof s!="object"||s===null)return!1;const e=Object.getPrototypeOf(s);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in s)&&!(Symbol.iterator in s)},Lr=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),Ti=(s,e,t)=>b(void 0,void 0,void 0,function*(){if(s&&typeof s=="object"&&"status"in s&&"ok"in s&&typeof s.status=="number"&&!t?.noResolveJson){const n=s.status||500,i=s;if(typeof i.json=="function")i.json().then(o=>{const a=o?.statusCode||o?.code||n+"";e(new Rt(Lr(o),n,a))}).catch(()=>{const o=n+"",a=i.statusText||`HTTP ${n} error`;e(new Rt(a,n,o))});else{const o=n+"",a=i.statusText||`HTTP ${n} error`;e(new Rt(a,n,o))}}else e(new Ei(Lr(s),s))}),Ai=(s,e,t,r)=>{const n={method:s,headers:e?.headers||{}};return r?(Si(r)?(n.headers=Object.assign({"Content-Type":"application/json"},e?.headers),n.body=JSON.stringify(r)):n.body=r,Object.assign(Object.assign({},n),t)):n};function Oi(s,e,t,r,n,i){return b(this,void 0,void 0,function*(){return new Promise((o,a)=>{s(t,Ai(e,r,n,i)).then(l=>{if(!l.ok)throw l;if(r?.noResolveJson)return l;const c=l.headers.get("content-type");return!c||!c.includes("application/json")?{}:l.json()}).then(l=>o(l)).catch(l=>Ti(l,a,r))})})}function F(s,e,t,r,n){return b(this,void 0,void 0,function*(){return Oi(s,"POST",e,r,n,t)})}class Ri{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},dr),t),this.fetch=fr(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(e){return b(this,void 0,void 0,function*(){try{return{data:(yield F(this.fetch,`${this.url}/CreateIndex`,e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(B(t))return{data:null,error:t};throw t}})}getIndex(e,t){return b(this,void 0,void 0,function*(){try{return{data:yield F(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:e,indexName:t},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(B(r))return{data:null,error:r};throw r}})}listIndexes(e){return b(this,void 0,void 0,function*(){try{return{data:yield F(this.fetch,`${this.url}/ListIndexes`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(B(t))return{data:null,error:t};throw t}})}deleteIndex(e,t){return b(this,void 0,void 0,function*(){try{return{data:(yield F(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:e,indexName:t},{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(B(r))return{data:null,error:r};throw r}})}}class ki{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},dr),t),this.fetch=fr(r)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(e){return b(this,void 0,void 0,function*(){try{if(e.vectors.length<1||e.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield F(this.fetch,`${this.url}/PutVectors`,e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(B(t))return{data:null,error:t};throw t}})}getVectors(e){return b(this,void 0,void 0,function*(){try{return{data:yield F(this.fetch,`${this.url}/GetVectors`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(B(t))return{data:null,error:t};throw t}})}listVectors(e){return b(this,void 0,void 0,function*(){try{if(e.segmentCount!==void 0){if(e.segmentCount<1||e.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(e.segmentIndex!==void 0&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw new Error(`segmentIndex must be between 0 and ${e.segmentCount-1}`)}return{data:yield F(this.fetch,`${this.url}/ListVectors`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(B(t))return{data:null,error:t};throw t}})}queryVectors(e){return b(this,void 0,void 0,function*(){try{return{data:yield F(this.fetch,`${this.url}/QueryVectors`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(B(t))return{data:null,error:t};throw t}})}deleteVectors(e){return b(this,void 0,void 0,function*(){try{if(e.keys.length<1||e.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield F(this.fetch,`${this.url}/DeleteVectors`,e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(B(t))return{data:null,error:t};throw t}})}}class Ci{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},dr),t),this.fetch=fr(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return b(this,void 0,void 0,function*(){try{return{data:(yield F(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(B(t))return{data:null,error:t};throw t}})}getBucket(e){return b(this,void 0,void 0,function*(){try{return{data:yield F(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(B(t))return{data:null,error:t};throw t}})}listBuckets(){return b(this,arguments,void 0,function*(e={}){try{return{data:yield F(this.fetch,`${this.url}/ListVectorBuckets`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(B(t))return{data:null,error:t};throw t}})}deleteBucket(e){return b(this,void 0,void 0,function*(){try{return{data:(yield F(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(B(t))return{data:null,error:t};throw t}})}}class Ii extends Ci{constructor(e,t={}){super(e,t.headers||{},t.fetch)}from(e){return new Pi(this.url,this.headers,e,this.fetch)}}class Pi extends Ri{constructor(e,t,r,n){super(e,t,n),this.vectorBucketName=r}createIndex(e){const t=Object.create(null,{createIndex:{get:()=>super.createIndex}});return b(this,void 0,void 0,function*(){return t.createIndex.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){const e=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return b(this,arguments,void 0,function*(t={}){return e.listIndexes.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName}))})}getIndex(e){const t=Object.create(null,{getIndex:{get:()=>super.getIndex}});return b(this,void 0,void 0,function*(){return t.getIndex.call(this,this.vectorBucketName,e)})}deleteIndex(e){const t=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return b(this,void 0,void 0,function*(){return t.deleteIndex.call(this,this.vectorBucketName,e)})}index(e){return new ji(this.url,this.headers,this.vectorBucketName,e,this.fetch)}}class ji extends ki{constructor(e,t,r,n,i){super(e,t,i),this.vectorBucketName=r,this.indexName=n}putVectors(e){const t=Object.create(null,{putVectors:{get:()=>super.putVectors}});return b(this,void 0,void 0,function*(){return t.putVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(e){const t=Object.create(null,{getVectors:{get:()=>super.getVectors}});return b(this,void 0,void 0,function*(){return t.getVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){const e=Object.create(null,{listVectors:{get:()=>super.listVectors}});return b(this,arguments,void 0,function*(t={}){return e.listVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(e){const t=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return b(this,void 0,void 0,function*(){return t.queryVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(e){const t=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return b(this,void 0,void 0,function*(){return t.deleteVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class Li extends vi{constructor(e,t={},r,n){super(e,t,r,n)}from(e){return new wi(this.url,this.headers,e,this.fetch)}get vectors(){return new Ii(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new bi(this.url+"/iceberg",this.headers,this.fetch)}}const xi="2.81.1";let je="";typeof Deno<"u"?je="deno":typeof document<"u"?je="web":typeof navigator<"u"&&navigator.product==="ReactNative"?je="react-native":je="node";const $i={"X-Client-Info":`supabase-js-${je}/${xi}`},Ui={headers:$i},Ni={schema:"public"},Di={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Mi={},Bi=s=>s?(...e)=>s(...e):(...e)=>fetch(...e),Fi=()=>Headers,qi=(s,e,t)=>{const r=Bi(t),n=Fi();return async(i,o)=>{var a;const l=(a=await e())!==null&&a!==void 0?a:s;let c=new n(o?.headers);return c.has("apikey")||c.set("apikey",s),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),r(i,Object.assign(Object.assign({},o),{headers:c}))}};function Wi(s){return s.endsWith("/")?s:s+"/"}function Vi(s,e){var t,r;const{db:n,auth:i,realtime:o,global:a}=s,{db:l,auth:c,realtime:u,global:h}=e,d={db:Object.assign(Object.assign({},l),n),auth:Object.assign(Object.assign({},c),i),realtime:Object.assign(Object.assign({},u),o),storage:{},global:Object.assign(Object.assign(Object.assign({},h),a),{headers:Object.assign(Object.assign({},(t=h?.headers)!==null&&t!==void 0?t:{}),(r=a?.headers)!==null&&r!==void 0?r:{})}),accessToken:async()=>""};return s.accessToken?d.accessToken=s.accessToken:delete d.accessToken,d}function zi(s){const e=s?.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(Wi(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const Hs="2.81.1",we=30*1e3,Ht=3,kt=Ht*we,Hi="http://localhost:9999",Gi="supabase.auth.token",Ki={"X-Client-Info":`gotrue-js/${Hs}`},Gt="X-Supabase-Api-Version",Gs={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Ji=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Yi=600*1e3;class Me extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function E(s){return typeof s=="object"&&s!==null&&"__isAuthError"in s}class Xi extends Me{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}function Qi(s){return E(s)&&s.name==="AuthApiError"}class ce extends Me{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class se extends Me{constructor(e,t,r,n){super(e,r,n),this.name=t,this.status=r}}class W extends se{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Zi(s){return E(s)&&s.name==="AuthSessionMissingError"}class ge extends se{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class et extends se{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class tt extends se{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function eo(s){return E(s)&&s.name==="AuthImplicitGrantRedirectError"}class xr extends se{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Kt extends se{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Ct(s){return E(s)&&s.name==="AuthRetryableFetchError"}class $r extends se{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class Jt extends se{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const ht="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Ur=` 	
\r=`.split(""),to=(()=>{const s=new Array(128);for(let e=0;e<s.length;e+=1)s[e]=-1;for(let e=0;e<Ur.length;e+=1)s[Ur[e].charCodeAt(0)]=-2;for(let e=0;e<ht.length;e+=1)s[ht[e].charCodeAt(0)]=e;return s})();function Nr(s,e,t){if(s!==null)for(e.queue=e.queue<<8|s,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(ht[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(ht[r]),e.queuedBits-=6}}function Ks(s,e,t){const r=to[s];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(s)}"`)}}function Dr(s){const e=[],t=o=>{e.push(String.fromCodePoint(o))},r={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},i=o=>{no(o,r,t)};for(let o=0;o<s.length;o+=1)Ks(s.charCodeAt(o),n,i);return e.join("")}function ro(s,e){if(s<=127){e(s);return}else if(s<=2047){e(192|s>>6),e(128|s&63);return}else if(s<=65535){e(224|s>>12),e(128|s>>6&63),e(128|s&63);return}else if(s<=1114111){e(240|s>>18),e(128|s>>12&63),e(128|s>>6&63),e(128|s&63);return}throw new Error(`Unrecognized Unicode codepoint: ${s.toString(16)}`)}function so(s,e){for(let t=0;t<s.length;t+=1){let r=s.charCodeAt(t);if(r>55295&&r<=56319){const n=(r-55296)*1024&65535;r=(s.charCodeAt(t+1)-56320&65535|n)+65536,t+=1}ro(r,e)}}function no(s,e,t){if(e.utf8seq===0){if(s<=127){t(s);return}for(let r=1;r<6;r+=1)if((s>>7-r&1)===0){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=s&31;else if(e.utf8seq===3)e.codepoint=s&15;else if(e.utf8seq===4)e.codepoint=s&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(s<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|s&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function Ee(s){const e=[],t={queue:0,queuedBits:0},r=n=>{e.push(n)};for(let n=0;n<s.length;n+=1)Ks(s.charCodeAt(n),t,r);return new Uint8Array(e)}function io(s){const e=[];return so(s,t=>e.push(t)),new Uint8Array(e)}function ue(s){const e=[],t={queue:0,queuedBits:0},r=n=>{e.push(n)};return s.forEach(n=>Nr(n,t,r)),Nr(null,t,r),e.join("")}function oo(s){return Math.round(Date.now()/1e3)+s}function ao(){return Symbol("auth-callback")}const D=()=>typeof window<"u"&&typeof document<"u",ne={tested:!1,writable:!1},Js=()=>{if(!D())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(ne.tested)return ne.writable;const s=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(s,s),globalThis.localStorage.removeItem(s),ne.tested=!0,ne.writable=!0}catch{ne.tested=!0,ne.writable=!1}return ne.writable};function lo(s){const e={},t=new URL(s);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((n,i)=>{e[i]=n})}catch{}return t.searchParams.forEach((r,n)=>{e[n]=r}),e}const Ys=s=>s?(...e)=>s(...e):(...e)=>fetch(...e),co=s=>typeof s=="object"&&s!==null&&"status"in s&&"ok"in s&&"json"in s&&typeof s.json=="function",ve=async(s,e,t)=>{await s.setItem(e,JSON.stringify(t))},ie=async(s,e)=>{const t=await s.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},X=async(s,e)=>{await s.removeItem(e)};class mt{constructor(){this.promise=new mt.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}mt.promiseConstructor=Promise;function It(s){const e=s.split(".");if(e.length!==3)throw new Jt("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!Ji.test(e[r]))throw new Jt("JWT not in base64url format");return{header:JSON.parse(Dr(e[0])),payload:JSON.parse(Dr(e[1])),signature:Ee(e[2]),raw:{header:e[0],payload:e[1]}}}async function uo(s){return await new Promise(e=>{setTimeout(()=>e(null),s)})}function ho(s,e){return new Promise((r,n)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await s(i);if(!e(i,null,o)){r(o);return}}catch(o){if(!e(i,o)){n(o);return}}})()})}function fo(s){return("0"+s.toString(16)).substr(-2)}function go(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let n="";for(let i=0;i<56;i++)n+=t.charAt(Math.floor(Math.random()*r));return n}return crypto.getRandomValues(e),Array.from(e,fo).join("")}async function po(s){const t=new TextEncoder().encode(s),r=await crypto.subtle.digest("SHA-256",t),n=new Uint8Array(r);return Array.from(n).map(i=>String.fromCharCode(i)).join("")}async function yo(s){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),s;const t=await po(s);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function pe(s,e,t=!1){const r=go();let n=r;t&&(n+="/PASSWORD_RECOVERY"),await ve(s,`${e}-code-verifier`,n);const i=await yo(r);return[i,r===i?"plain":"s256"]}const _o=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function mo(s){const e=s.headers.get(Gt);if(!e||!e.match(_o))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function wo(s){if(!s)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(s<=e)throw new Error("JWT has expired")}function vo(s){switch(s){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const bo=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function ye(s){if(!bo.test(s))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Pt(){const s={};return new Proxy(s,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const r=t.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Eo(s,e){return new Proxy(s,{get:(t,r,n)=>{if(r==="__isInsecureUserWarningProxy")return!0;if(typeof r=="symbol"){const i=r.toString();if(i==="Symbol(Symbol.toPrimitive)"||i==="Symbol(Symbol.toStringTag)"||i==="Symbol(util.inspect.custom)"||i==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(t,r,n)}return!e.value&&typeof r=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(t,r,n)}})}function Mr(s){return JSON.parse(JSON.stringify(s))}const oe=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),So=[502,503,504];async function Br(s){var e;if(!co(s))throw new Kt(oe(s),0);if(So.includes(s.status))throw new Kt(oe(s),s.status);let t;try{t=await s.json()}catch(i){throw new ce(oe(i),i)}let r;const n=mo(s);if(n&&n.getTime()>=Gs["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new $r(oe(t),s.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new W}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new $r(oe(t),s.status,t.weak_password.reasons);throw new Xi(oe(t),s.status||500,r)}const To=(s,e,t,r)=>{const n={method:s,headers:e?.headers||{}};return s==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),n.body=JSON.stringify(r),Object.assign(Object.assign({},n),t))};async function T(s,e,t,r){var n;const i=Object.assign({},r?.headers);i[Gt]||(i[Gt]=Gs["2024-01-01"].name),r?.jwt&&(i.Authorization=`Bearer ${r.jwt}`);const o=(n=r?.query)!==null&&n!==void 0?n:{};r?.redirectTo&&(o.redirect_to=r.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await Ao(s,e,t+a,{headers:i,noResolveJson:r?.noResolveJson},{},r?.body);return r?.xform?r?.xform(l):{data:Object.assign({},l),error:null}}async function Ao(s,e,t,r,n,i){const o=To(e,r,n,i);let a;try{a=await s(t,Object.assign({},o))}catch(l){throw console.error(l),new Kt(oe(l),0)}if(a.ok||await Br(a),r?.noResolveJson)return a;try{return await a.json()}catch(l){await Br(l)}}function V(s){var e;let t=null;ko(s)&&(t=Object.assign({},s),s.expires_at||(t.expires_at=oo(s.expires_in)));const r=(e=s.user)!==null&&e!==void 0?e:s;return{data:{session:t,user:r},error:null}}function Fr(s){const e=V(s);return!e.error&&s.weak_password&&typeof s.weak_password=="object"&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.message&&typeof s.weak_password.message=="string"&&s.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=s.weak_password),e}function Z(s){var e;return{data:{user:(e=s.user)!==null&&e!==void 0?e:s},error:null}}function Oo(s){return{data:s,error:null}}function Ro(s){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:n,verification_type:i}=s,o=Oe(s,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:t,hashed_token:r,redirect_to:n,verification_type:i},l=Object.assign({},o);return{data:{properties:a,user:l},error:null}}function qr(s){return s}function ko(s){return s.access_token&&s.refresh_token&&s.expires_in}const jt=["global","local","others"];class Co{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=Ys(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,t=jt[0]){if(jt.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${jt.join(", ")}`);try{return await T(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(E(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await T(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Z})}catch(r){if(E(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=Oe(e,["options"]),n=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(n.new_email=r?.newEmail,delete n.newEmail),await T(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:Ro,redirectTo:t?.redirectTo})}catch(t){if(E(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await T(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Z})}catch(t){if(E(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,n,i,o,a,l;try{const c={nextPage:null,lastPage:0,total:0},u=await T(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(i=(n=e?.perPage)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""},xform:qr});if(u.error)throw u.error;const h=await u.json(),d=(o=u.headers.get("x-total-count"))!==null&&o!==void 0?o:0,f=(l=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(g=>{const p=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),y=JSON.parse(g.split(";")[1].split("=")[1]);c[`${y}Page`]=p}),c.total=parseInt(d)),{data:Object.assign(Object.assign({},h),c),error:null}}catch(c){if(E(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){ye(e);try{return await T(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Z})}catch(t){if(E(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){ye(e);try{return await T(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Z})}catch(r){if(E(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){ye(e);try{return await T(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Z})}catch(r){if(E(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){ye(e.userId);try{const{data:t,error:r}=await T(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:t,error:r}}catch(t){if(E(t))return{data:null,error:t};throw t}}async _deleteFactor(e){ye(e.userId),ye(e.id);try{return{data:await T(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(E(t))return{data:null,error:t};throw t}}async _listOAuthClients(e){var t,r,n,i,o,a,l;try{const c={nextPage:null,lastPage:0,total:0},u=await T(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(i=(n=e?.perPage)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""},xform:qr});if(u.error)throw u.error;const h=await u.json(),d=(o=u.headers.get("x-total-count"))!==null&&o!==void 0?o:0,f=(l=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(g=>{const p=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),y=JSON.parse(g.split(";")[1].split("=")[1]);c[`${y}Page`]=p}),c.total=parseInt(d)),{data:Object.assign(Object.assign({},h),c),error:null}}catch(c){if(E(c))return{data:{clients:[]},error:c};throw c}}async _createOAuthClient(e){try{return await T(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(E(t))return{data:null,error:t};throw t}}async _getOAuthClient(e){try{return await T(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(E(t))return{data:null,error:t};throw t}}async _updateOAuthClient(e,t){try{return await T(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:t,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(E(r))return{data:null,error:r};throw r}}async _deleteOAuthClient(e){try{return await T(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(t){if(E(t))return{data:null,error:t};throw t}}async _regenerateOAuthClientSecret(e){try{return await T(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(E(t))return{data:null,error:t};throw t}}}function Wr(s={}){return{getItem:e=>s[e]||null,setItem:(e,t)=>{s[e]=t},removeItem:e=>{delete s[e]}}}const _e={debug:!!(globalThis&&Js()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Xs extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Io extends Xs{}async function Po(s,e,t){_e.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",s,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),_e.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",s)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(s,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async n=>{if(n){_e.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",s,n.name);try{return await t()}finally{_e.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",s,n.name)}}else{if(e===0)throw _e.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",s),new Io(`Acquiring an exclusive Navigator LockManager lock "${s}" immediately failed`);if(_e.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}function jo(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function Qs(s){if(!/^0x[a-fA-F0-9]{40}$/.test(s))throw new Error(`@supabase/auth-js: Address "${s}" is invalid.`);return s.toLowerCase()}function Lo(s){return parseInt(s,16)}function xo(s){const e=new TextEncoder().encode(s);return"0x"+Array.from(e,r=>r.toString(16).padStart(2,"0")).join("")}function $o(s){var e;const{chainId:t,domain:r,expirationTime:n,issuedAt:i=new Date,nonce:o,notBefore:a,requestId:l,resources:c,scheme:u,uri:h,version:d}=s;{if(!Number.isInteger(t))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${t}`);if(!r)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!h)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(d!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${d}`);if(!((e=s.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${s.statement}`)}const f=Qs(s.address),g=u?`${u}://${r}`:r,p=s.statement?`${s.statement}
`:"",y=`${g} wants you to sign in with your Ethereum account:
${f}

${p}`;let _=`URI: ${h}
Version: ${d}
Chain ID: ${t}${o?`
Nonce: ${o}`:""}
Issued At: ${i.toISOString()}`;if(n&&(_+=`
Expiration Time: ${n.toISOString()}`),a&&(_+=`
Not Before: ${a.toISOString()}`),l&&(_+=`
Request ID: ${l}`),c){let w=`
Resources:`;for(const m of c){if(!m||typeof m!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${m}`);w+=`
- ${m}`}_+=w}return`${y}
${_}`}class x extends Error{constructor({message:e,code:t,cause:r,name:n}){var i;super(e,{cause:r}),this.__isWebAuthnError=!0,this.name=(i=n??(r instanceof Error?r.name:void 0))!==null&&i!==void 0?i:"Unknown Error",this.code=t}}class dt extends x{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}}function Uo({error:s,options:e}){var t,r,n;const{publicKey:i}=e;if(!i)throw Error("options was missing required publicKey property");if(s.name==="AbortError"){if(e.signal instanceof AbortSignal)return new x({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:s})}else if(s.name==="ConstraintError"){if(((t=i.authenticatorSelection)===null||t===void 0?void 0:t.requireResidentKey)===!0)return new x({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:s});if(e.mediation==="conditional"&&((r=i.authenticatorSelection)===null||r===void 0?void 0:r.userVerification)==="required")return new x({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:s});if(((n=i.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new x({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:s})}else{if(s.name==="InvalidStateError")return new x({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:s});if(s.name==="NotAllowedError")return new x({message:s.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:s});if(s.name==="NotSupportedError")return i.pubKeyCredParams.filter(a=>a.type==="public-key").length===0?new x({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:s}):new x({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:s});if(s.name==="SecurityError"){const o=window.location.hostname;if(Zs(o)){if(i.rp.id!==o)return new x({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:s})}else return new x({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:s})}else if(s.name==="TypeError"){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new x({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:s})}else if(s.name==="UnknownError")return new x({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:s})}return new x({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:s})}function No({error:s,options:e}){const{publicKey:t}=e;if(!t)throw Error("options was missing required publicKey property");if(s.name==="AbortError"){if(e.signal instanceof AbortSignal)return new x({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:s})}else{if(s.name==="NotAllowedError")return new x({message:s.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:s});if(s.name==="SecurityError"){const r=window.location.hostname;if(Zs(r)){if(t.rpId!==r)return new x({message:`The RP ID "${t.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:s})}else return new x({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:s})}else if(s.name==="UnknownError")return new x({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:s})}return new x({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:s})}class Do{createNewAbortSignal(){if(this.controller){const t=new Error("Cancelling existing WebAuthn API call for new one");t.name="AbortError",this.controller.abort(t)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const Mo=new Do;function Bo(s){if(!s)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(s);const{challenge:e,user:t,excludeCredentials:r}=s,n=Oe(s,["challenge","user","excludeCredentials"]),i=Ee(e).buffer,o=Object.assign(Object.assign({},t),{id:Ee(t.id).buffer}),a=Object.assign(Object.assign({},n),{challenge:i,user:o});if(r&&r.length>0){a.excludeCredentials=new Array(r.length);for(let l=0;l<r.length;l++){const c=r[l];a.excludeCredentials[l]=Object.assign(Object.assign({},c),{id:Ee(c.id).buffer,type:c.type||"public-key",transports:c.transports})}}return a}function Fo(s){if(!s)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(s);const{challenge:e,allowCredentials:t}=s,r=Oe(s,["challenge","allowCredentials"]),n=Ee(e).buffer,i=Object.assign(Object.assign({},r),{challenge:n});if(t&&t.length>0){i.allowCredentials=new Array(t.length);for(let o=0;o<t.length;o++){const a=t[o];i.allowCredentials[o]=Object.assign(Object.assign({},a),{id:Ee(a.id).buffer,type:a.type||"public-key",transports:a.transports})}}return i}function qo(s){var e;if("toJSON"in s&&typeof s.toJSON=="function")return s.toJSON();const t=s;return{id:s.id,rawId:s.id,response:{attestationObject:ue(new Uint8Array(s.response.attestationObject)),clientDataJSON:ue(new Uint8Array(s.response.clientDataJSON))},type:"public-key",clientExtensionResults:s.getClientExtensionResults(),authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function Wo(s){var e;if("toJSON"in s&&typeof s.toJSON=="function")return s.toJSON();const t=s,r=s.getClientExtensionResults(),n=s.response;return{id:s.id,rawId:s.id,response:{authenticatorData:ue(new Uint8Array(n.authenticatorData)),clientDataJSON:ue(new Uint8Array(n.clientDataJSON)),signature:ue(new Uint8Array(n.signature)),userHandle:n.userHandle?ue(new Uint8Array(n.userHandle)):void 0},type:"public-key",clientExtensionResults:r,authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function Zs(s){return s==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(s)}function Vr(){var s,e;return!!(D()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((s=navigator?.credentials)===null||s===void 0?void 0:s.create)=="function"&&typeof((e=navigator?.credentials)===null||e===void 0?void 0:e.get)=="function")}async function Vo(s){try{const e=await navigator.credentials.create(s);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new dt("Browser returned unexpected credential type",e)}:{data:null,error:new dt("Empty credential response",e)}}catch(e){return{data:null,error:Uo({error:e,options:s})}}}async function zo(s){try{const e=await navigator.credentials.get(s);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new dt("Browser returned unexpected credential type",e)}:{data:null,error:new dt("Empty credential response",e)}}catch(e){return{data:null,error:No({error:e,options:s})}}}const Ho={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},Go={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function ft(...s){const e=n=>n!==null&&typeof n=="object"&&!Array.isArray(n),t=n=>n instanceof ArrayBuffer||ArrayBuffer.isView(n),r={};for(const n of s)if(n)for(const i in n){const o=n[i];if(o!==void 0)if(Array.isArray(o))r[i]=o;else if(t(o))r[i]=o;else if(e(o)){const a=r[i];e(a)?r[i]=ft(a,o):r[i]=ft(o)}else r[i]=o}return r}function Ko(s,e){return ft(Ho,s,e||{})}function Jo(s,e){return ft(Go,s,e||{})}class Yo{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:t,friendlyName:r,signal:n},i){try{const{data:o,error:a}=await this.client.mfa.challenge({factorId:e,webauthn:t});if(!o)return{data:null,error:a};const l=n??Mo.createNewAbortSignal();if(o.webauthn.type==="create"){const{user:c}=o.webauthn.credential_options.publicKey;c.name||(c.name=`${c.id}:${r}`),c.displayName||(c.displayName=c.name)}switch(o.webauthn.type){case"create":{const c=Ko(o.webauthn.credential_options.publicKey,i?.create),{data:u,error:h}=await Vo({publicKey:c,signal:l});return u?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:u}},error:null}:{data:null,error:h}}case"request":{const c=Jo(o.webauthn.credential_options.publicKey,i?.request),{data:u,error:h}=await zo(Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:c,signal:l}));return u?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:u}},error:null}:{data:null,error:h}}}}catch(o){return E(o)?{data:null,error:o}:{data:null,error:new ce("Unexpected error in challenge",o)}}}async _verify({challengeId:e,factorId:t,webauthn:r}){return this.client.mfa.verify({factorId:t,challengeId:e,webauthn:r})}async _authenticate({factorId:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:n}={}},i){if(!t)return{data:null,error:new Me("rpId is required for WebAuthn authentication")};try{if(!Vr())return{data:null,error:new ce("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this.challenge({factorId:e,webauthn:{rpId:t,rpOrigins:r},signal:n},{request:i});if(!o)return{data:null,error:a};const{webauthn:l}=o;return this._verify({factorId:e,challengeId:o.challengeId,webauthn:{type:l.type,rpId:t,rpOrigins:r,credential_response:l.credential_response}})}catch(o){return E(o)?{data:null,error:o}:{data:null,error:new ce("Unexpected error in authenticate",o)}}}async _register({friendlyName:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:n}={}},i){if(!t)return{data:null,error:new Me("rpId is required for WebAuthn registration")};try{if(!Vr())return{data:null,error:new ce("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this._enroll({friendlyName:e});if(!o)return await this.client.mfa.listFactors().then(u=>{var h;return(h=u.data)===null||h===void 0?void 0:h.all.find(d=>d.factor_type==="webauthn"&&d.friendly_name===e&&d.status!=="unverified")}).then(u=>u?this.client.mfa.unenroll({factorId:u?.id}):void 0),{data:null,error:a};const{data:l,error:c}=await this._challenge({factorId:o.id,friendlyName:o.friendly_name,webauthn:{rpId:t,rpOrigins:r},signal:n},{create:i});return l?this._verify({factorId:o.id,challengeId:l.challengeId,webauthn:{rpId:t,rpOrigins:r,type:l.webauthn.type,credential_response:l.webauthn.credential_response}}):{data:null,error:c}}catch(o){return E(o)?{data:null,error:o}:{data:null,error:new ce("Unexpected error in register",o)}}}}jo();const Xo={url:Hi,storageKey:Gi,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Ki,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function zr(s,e,t){return await t()}const me={};class Be{get jwks(){var e,t;return(t=(e=me[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){me[this.storageKey]=Object.assign(Object.assign({},me[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=me[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){me[this.storageKey]=Object.assign(Object.assign({},me[this.storageKey]),{cachedAt:e})}constructor(e){var t,r,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const i=Object.assign(Object.assign({},Xo),e);if(this.storageKey=i.storageKey,this.instanceID=(t=Be.nextInstanceID[this.storageKey])!==null&&t!==void 0?t:0,Be.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.instanceID>0&&D()){const o=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(o),this.logDebugMessages&&console.trace(o)}if(this.persistSession=i.persistSession,this.autoRefreshToken=i.autoRefreshToken,this.admin=new Co({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=Ys(i.fetch),this.lock=i.lock||zr,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,this.throwOnError=i.throwOnError,i.lock?this.lock=i.lock:D()&&(!((r=globalThis?.navigator)===null||r===void 0)&&r.locks)?this.lock=Po:this.lock=zr,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new Yo(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this)},this.persistSession?(i.storage?this.storage=i.storage:Js()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Wr(this.memoryStorage)),i.userStorage&&(this.userStorage=i.userStorage)):(this.memoryStorage={},this.storage=Wr(this.memoryStorage)),D()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o),await this._notifyAllSubscribers(o.data.event,o.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${Hs}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let t={},r="none";if(D()&&(t=lo(window.location.href),this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce")),D()&&this.detectSessionInUrl&&r!=="none"){const{data:n,error:i}=await this._getSessionFromURL(t,r);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),eo(i)){const l=(e=i.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:o,redirectType:a}=n;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),await this._saveSession(o),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return E(t)?this._returnResult({error:t}):this._returnResult({error:new ce("Unexpected error during initialization",t)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,n;try{const i=await T(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(n=e?.options)===null||n===void 0?void 0:n.captchaToken}},xform:V}),{data:o,error:a}=i;if(a||!o)return this._returnResult({data:{user:null,session:null},error:a});const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(i){if(E(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signUp(e){var t,r,n;try{let i;if("email"in e){const{email:u,password:h,options:d}=e;let f=null,g=null;this.flowType==="pkce"&&([f,g]=await pe(this.storage,this.storageKey)),i=await T(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:d?.emailRedirectTo,body:{email:u,password:h,data:(t=d?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:d?.captchaToken},code_challenge:f,code_challenge_method:g},xform:V})}else if("phone"in e){const{phone:u,password:h,options:d}=e;i=await T(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:h,data:(r=d?.data)!==null&&r!==void 0?r:{},channel:(n=d?.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:d?.captchaToken}},xform:V})}else throw new et("You must provide either an email or phone number and a password");const{data:o,error:a}=i;if(a||!o)return this._returnResult({data:{user:null,session:null},error:a});const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(i){if(E(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:o,options:a}=e;t=await T(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:Fr})}else if("phone"in e){const{phone:i,password:o,options:a}=e;t=await T(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:Fr})}else throw new et("You must provide either an email or phone number and a password");const{data:r,error:n}=t;if(n)return this._returnResult({data:{user:null,session:null},error:n});if(!r||!r.session||!r.user){const i=new ge;return this._returnResult({data:{user:null,session:null},error:i})}return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),this._returnResult({data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:n})}catch(t){if(E(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOAuth(e){var t,r,n,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(n=e.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;switch(t){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}}async signInWithEthereum(e){var t,r,n,i,o,a,l,c,u,h,d;let f,g;if("message"in e)f=e.message,g=e.signature;else{const{chain:p,wallet:y,statement:_,options:w}=e;let m;if(D())if(typeof y=="object")m=y;else{const U=window;if("ethereum"in U&&typeof U.ethereum=="object"&&"request"in U.ethereum&&typeof U.ethereum.request=="function")m=U.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof y!="object"||!w?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");m=y}const v=new URL((t=w?.url)!==null&&t!==void 0?t:window.location.href),O=await m.request({method:"eth_requestAccounts"}).then(U=>U).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!O||O.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const A=Qs(O[0]);let k=(r=w?.signInWithEthereum)===null||r===void 0?void 0:r.chainId;if(!k){const U=await m.request({method:"eth_chainId"});k=Lo(U)}const R={domain:v.host,address:A,statement:_,uri:v.href,version:"1",chainId:k,nonce:(n=w?.signInWithEthereum)===null||n===void 0?void 0:n.nonce,issuedAt:(o=(i=w?.signInWithEthereum)===null||i===void 0?void 0:i.issuedAt)!==null&&o!==void 0?o:new Date,expirationTime:(a=w?.signInWithEthereum)===null||a===void 0?void 0:a.expirationTime,notBefore:(l=w?.signInWithEthereum)===null||l===void 0?void 0:l.notBefore,requestId:(c=w?.signInWithEthereum)===null||c===void 0?void 0:c.requestId,resources:(u=w?.signInWithEthereum)===null||u===void 0?void 0:u.resources};f=$o(R),g=await m.request({method:"personal_sign",params:[xo(f),A]})}try{const{data:p,error:y}=await T(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:f,signature:g},!((h=e.options)===null||h===void 0)&&h.captchaToken?{gotrue_meta_security:{captcha_token:(d=e.options)===null||d===void 0?void 0:d.captchaToken}}:null),xform:V});if(y)throw y;if(!p||!p.session||!p.user){const _=new ge;return this._returnResult({data:{user:null,session:null},error:_})}return p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("SIGNED_IN",p.session)),this._returnResult({data:Object.assign({},p),error:y})}catch(p){if(E(p))return this._returnResult({data:{user:null,session:null},error:p});throw p}}async signInWithSolana(e){var t,r,n,i,o,a,l,c,u,h,d,f;let g,p;if("message"in e)g=e.message,p=e.signature;else{const{chain:y,wallet:_,statement:w,options:m}=e;let v;if(D())if(typeof _=="object")v=_;else{const A=window;if("solana"in A&&typeof A.solana=="object"&&("signIn"in A.solana&&typeof A.solana.signIn=="function"||"signMessage"in A.solana&&typeof A.solana.signMessage=="function"))v=A.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof _!="object"||!m?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");v=_}const O=new URL((t=m?.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in v&&v.signIn){const A=await v.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},m?.signInWithSolana),{version:"1",domain:O.host,uri:O.href}),w?{statement:w}:null));let k;if(Array.isArray(A)&&A[0]&&typeof A[0]=="object")k=A[0];else if(A&&typeof A=="object"&&"signedMessage"in A&&"signature"in A)k=A;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in k&&"signature"in k&&(typeof k.signedMessage=="string"||k.signedMessage instanceof Uint8Array)&&k.signature instanceof Uint8Array)g=typeof k.signedMessage=="string"?k.signedMessage:new TextDecoder().decode(k.signedMessage),p=k.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in v)||typeof v.signMessage!="function"||!("publicKey"in v)||typeof v!="object"||!v.publicKey||!("toBase58"in v.publicKey)||typeof v.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");g=[`${O.host} wants you to sign in with your Solana account:`,v.publicKey.toBase58(),...w?["",w,""]:[""],"Version: 1",`URI: ${O.href}`,`Issued At: ${(n=(r=m?.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&n!==void 0?n:new Date().toISOString()}`,...!((i=m?.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${m.signInWithSolana.notBefore}`]:[],...!((o=m?.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${m.signInWithSolana.expirationTime}`]:[],...!((a=m?.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${m.signInWithSolana.chainId}`]:[],...!((l=m?.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${m.signInWithSolana.nonce}`]:[],...!((c=m?.signInWithSolana)===null||c===void 0)&&c.requestId?[`Request ID: ${m.signInWithSolana.requestId}`]:[],...!((h=(u=m?.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||h===void 0)&&h.length?["Resources",...m.signInWithSolana.resources.map(k=>`- ${k}`)]:[]].join(`
`);const A=await v.signMessage(new TextEncoder().encode(g),"utf8");if(!A||!(A instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");p=A}}try{const{data:y,error:_}=await T(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:g,signature:ue(p)},!((d=e.options)===null||d===void 0)&&d.captchaToken?{gotrue_meta_security:{captcha_token:(f=e.options)===null||f===void 0?void 0:f.captchaToken}}:null),xform:V});if(_)throw _;if(!y||!y.session||!y.user){const w=new ge;return this._returnResult({data:{user:null,session:null},error:w})}return y.session&&(await this._saveSession(y.session),await this._notifyAllSubscribers("SIGNED_IN",y.session)),this._returnResult({data:Object.assign({},y),error:_})}catch(y){if(E(y))return this._returnResult({data:{user:null,session:null},error:y});throw y}}async _exchangeCodeForSession(e){const t=await ie(this.storage,`${this.storageKey}-code-verifier`),[r,n]=(t??"").split("/");try{const{data:i,error:o}=await T(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:V});if(await X(this.storage,`${this.storageKey}-code-verifier`),o)throw o;if(!i||!i.session||!i.user){const a=new ge;return this._returnResult({data:{user:null,session:null,redirectType:null},error:a})}return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),this._returnResult({data:Object.assign(Object.assign({},i),{redirectType:n??null}),error:o})}catch(i){if(E(i))return this._returnResult({data:{user:null,session:null,redirectType:null},error:i});throw i}}async signInWithIdToken(e){try{const{options:t,provider:r,token:n,access_token:i,nonce:o}=e,a=await T(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:n,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:V}),{data:l,error:c}=a;if(c)return this._returnResult({data:{user:null,session:null},error:c});if(!l||!l.session||!l.user){const u=new ge;return this._returnResult({data:{user:null,session:null},error:u})}return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),this._returnResult({data:l,error:c})}catch(t){if(E(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOtp(e){var t,r,n,i,o;try{if("email"in e){const{email:a,options:l}=e;let c=null,u=null;this.flowType==="pkce"&&([c,u]=await pe(this.storage,this.storageKey));const{error:h}=await T(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(t=l?.data)!==null&&t!==void 0?t:{},create_user:(r=l?.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},code_challenge:c,code_challenge_method:u},redirectTo:l?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:h})}if("phone"in e){const{phone:a,options:l}=e,{data:c,error:u}=await T(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(n=l?.data)!==null&&n!==void 0?n:{},create_user:(i=l?.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},channel:(o=l?.channel)!==null&&o!==void 0?o:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:c?.message_id},error:u})}throw new et("You must provide either an email or phone number.")}catch(a){if(E(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async verifyOtp(e){var t,r;try{let n,i;"options"in e&&(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:o,error:a}=await T(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:n,xform:V});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const l=o.session,c=o.user;return l?.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(n){if(E(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithSSO(e){var t,r,n,i,o;try{let a=null,l=null;this.flowType==="pkce"&&([a,l]=await pe(this.storage,this.storageKey));const c=await T(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((n=e?.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:a,code_challenge_method:l}),headers:this.headers,xform:Oo});return!((i=c.data)===null||i===void 0)&&i.url&&D()&&!(!((o=e.options)===null||o===void 0)&&o.skipBrowserRedirect)&&window.location.assign(c.data.url),this._returnResult(c)}catch(a){if(E(a))return this._returnResult({data:null,error:a});throw a}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new W;const{error:n}=await T(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return this._returnResult({data:{user:null,session:null},error:n})})}catch(e){if(E(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:n,options:i}=e,{error:o}=await T(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:n,gotrue_meta_security:{captcha_token:i?.captchaToken}},redirectTo:i?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}else if("phone"in e){const{phone:r,type:n,options:i}=e,{data:o,error:a}=await T(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:n,gotrue_meta_security:{captcha_token:i?.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:o?.message_id},error:a})}throw new et("You must provide either an email or phone number and a type")}catch(t){if(E(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await r,await t()))();return this.pendingInLock.push((async()=>{try{await n}catch{}})()),n}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const n=[...this.pendingInLock];await Promise.all(n),this.pendingInLock.splice(0,n.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await ie(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<kt:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const o=await ie(this.userStorage,this.storageKey+"-user");o?.user?e.user=o.user:e.user=Pt()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const o={value:this.suppressGetSessionWarning};e.user=Eo(e.user,o),o.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{session:null},error:i}):this._returnResult({data:{session:n},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await T(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Z}):await this._useSession(async t=>{var r,n,i;const{data:o,error:a}=t;if(a)throw a;return!(!((r=o.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new W}:await T(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(n=o.session)===null||n===void 0?void 0:n.access_token)!==null&&i!==void 0?i:void 0,xform:Z})})}catch(t){if(E(t))return Zi(t)&&(await this._removeSession(),await X(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:t});throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:n,error:i}=r;if(i)throw i;if(!n.session)throw new W;const o=n.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await pe(this.storage,this.storageKey));const{data:c,error:u}=await T(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:o.access_token,xform:Z});if(u)throw u;return o.user=c.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),this._returnResult({data:{user:o.user},error:null})})}catch(r){if(E(r))return this._returnResult({data:{user:null},error:r});throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new W;const t=Date.now()/1e3;let r=t,n=!0,i=null;const{payload:o}=It(e.access_token);if(o.exp&&(r=o.exp,n=r<=t),n){const{data:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!a)return{data:{user:null,session:null},error:null};i=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)throw l;i={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return this._returnResult({data:{user:i.user,session:i},error:null})}catch(t){if(E(t))return this._returnResult({data:{session:null,user:null},error:t});throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:o,error:a}=t;if(a)throw a;e=(r=o.session)!==null&&r!==void 0?r:void 0}if(!e?.refresh_token)throw new W;const{data:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{user:null,session:null},error:i}):n?this._returnResult({data:{user:n.user,session:n},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(t){if(E(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async _getSessionFromURL(e,t){try{if(!D())throw new tt("No browser detected.");if(e.error||e.error_description||e.error_code)throw new tt(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new xr("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new tt("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new xr("No code detected.");const{data:w,error:m}=await this._exchangeCodeForSession(e.code);if(m)throw m;const v=new URL(window.location.href);return v.searchParams.delete("code"),window.history.replaceState(window.history.state,"",v.toString()),{data:{session:w.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:n,access_token:i,refresh_token:o,expires_in:a,expires_at:l,token_type:c}=e;if(!i||!a||!o||!c)throw new tt("No session defined in URL");const u=Math.round(Date.now()/1e3),h=parseInt(a);let d=u+h;l&&(d=parseInt(l));const f=d-u;f*1e3<=we&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${f}s, should have been closer to ${h}s`);const g=d-h;u-g>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",g,d,u):u-g<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",g,d,u);const{data:p,error:y}=await this._getUser(i);if(y)throw y;const _={provider_token:r,provider_refresh_token:n,access_token:i,expires_in:h,expires_at:d,refresh_token:o,token_type:c,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:_,redirectType:e.type},error:null})}catch(r){if(E(r))return this._returnResult({data:{session:null,redirectType:null},error:r});throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await ie(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:n,error:i}=t;if(i)return this._returnResult({error:i});const o=(r=n.session)===null||r===void 0?void 0:r.access_token;if(o){const{error:a}=await this.admin.signOut(o,e);if(a&&!(Qi(a)&&(a.status===404||a.status===401||a.status===403)))return this._returnResult({error:a})}return e!=="others"&&(await this._removeSession(),await X(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const t=ao(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,n;try{const{data:{session:i},error:o}=t;if(o)throw o;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let r=null,n=null;this.flowType==="pkce"&&([r,n]=await pe(this.storage,this.storageKey,!0));try{return await T(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:n,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(E(i))return this._returnResult({data:null,error:i});throw i}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return this._returnResult({data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(t){if(E(t))return this._returnResult({data:null,error:t});throw t}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var t;try{const{data:r,error:n}=await this._useSession(async i=>{var o,a,l,c,u;const{data:h,error:d}=i;if(d)throw d;const f=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await T(this.fetch,"GET",f,{headers:this.headers,jwt:(u=(c=h.session)===null||c===void 0?void 0:c.access_token)!==null&&u!==void 0?u:void 0})});if(n)throw n;return D()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r?.url),this._returnResult({data:{provider:e.provider,url:r?.url},error:null})}catch(r){if(E(r))return this._returnResult({data:{provider:e.provider,url:null},error:r});throw r}}async linkIdentityIdToken(e){return await this._useSession(async t=>{var r;try{const{error:n,data:{session:i}}=t;if(n)throw n;const{options:o,provider:a,token:l,access_token:c,nonce:u}=e,h=await T(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(r=i?.access_token)!==null&&r!==void 0?r:void 0,body:{provider:a,id_token:l,access_token:c,nonce:u,link_identity:!0,gotrue_meta_security:{captcha_token:o?.captchaToken}},xform:V}),{data:d,error:f}=h;return f?this._returnResult({data:{user:null,session:null},error:f}):!d||!d.session||!d.user?this._returnResult({data:{user:null,session:null},error:new ge}):(d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("USER_UPDATED",d.session)),this._returnResult({data:d,error:f}))}catch(n){if(E(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}})}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,n;const{data:i,error:o}=t;if(o)throw o;return await T(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(n=(r=i.session)===null||r===void 0?void 0:r.access_token)!==null&&n!==void 0?n:void 0})})}catch(t){if(E(t))return this._returnResult({data:null,error:t});throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await ho(async n=>(n>0&&await uo(200*Math.pow(2,n-1)),this._debug(t,"refreshing attempt",n),await T(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:V})),(n,i)=>{const o=200*Math.pow(2,n);return i&&Ct(i)&&Date.now()+o-r<we})}catch(r){if(this._debug(t,"error",r),E(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),D()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,t;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const n=await ie(this.storage,this.storageKey);if(n&&this.userStorage){let o=await ie(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:n.user},await ve(this.userStorage,this.storageKey+"-user",o)),n.user=(e=o?.user)!==null&&e!==void 0?e:Pt()}else if(n&&!n.user&&!n.user){const o=await ie(this.storage,this.storageKey+"-user");o&&o?.user?(n.user=o.user,await X(this.storage,this.storageKey+"-user"),await ve(this.storage,this.storageKey,n)):n.user=Pt()}if(this._debug(r,"session from storage",n),!this._isValidSession(n)){this._debug(r,"session is not valid"),n!==null&&await this._removeSession();return}const i=((t=n.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<kt;if(this._debug(r,`session has${i?"":" not"} expired with margin of ${kt}s`),i){if(this.autoRefreshToken&&n.refresh_token){const{error:o}=await this._callRefreshToken(n.refresh_token);o&&(console.error(o),Ct(o)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(n.user&&n.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:a}=await this._getUser(n.access_token);!a&&o?.user?(n.user=o.user,await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(r,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){this._debug(r,"error",n),console.error(n);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new W;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new mt;const{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new W;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const a={data:i.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(i){if(this._debug(n,"error",i),E(i)){const o={data:null,error:i};return Ct(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(i),i}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(e,t,r=!0){const n=`#_notifyAllSubscribers(${e})`;this._debug(n,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,t)}catch(l){i.push(l)}});if(await Promise.all(o),i.length>0){for(let a=0;a<i.length;a+=1)console.error(i[a]);throw i[0]}}finally{this._debug(n,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),r=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&t.user&&await ve(this.userStorage,this.storageKey+"-user",{user:t.user});const n=Object.assign({},t);delete n.user;const i=Mr(n);await ve(this.storage,this.storageKey,i)}else{const n=Mr(t);await ve(this.storage,this.storageKey,n)}}async _removeSession(){this._debug("#_removeSession()"),await X(this.storage,this.storageKey),await X(this.storage,this.storageKey+"-code-verifier"),await X(this.storage,this.storageKey+"-user"),this.userStorage&&await X(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&D()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),we);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const n=Math.floor((r.expires_at*1e3-e)/we);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${we}ms, refresh threshold is ${Ht} ticks`),n<=Ht&&await this._callRefreshToken(r.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Xs)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!D()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const n=[`provider=${encodeURIComponent(t)}`];if(r?.redirectTo&&n.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r?.scopes&&n.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[i,o]=await pe(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});n.push(a.toString())}if(r?.queryParams){const i=new URLSearchParams(r.queryParams);n.push(i.toString())}return r?.skipBrowserRedirect&&n.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${n.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:n,error:i}=t;return i?this._returnResult({data:null,error:i}):await T(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=n?.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(E(t))return this._returnResult({data:null,error:t});throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,n;const{data:i,error:o}=t;if(o)return this._returnResult({data:null,error:o});const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:l,error:c}=await T(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(r=i?.session)===null||r===void 0?void 0:r.access_token});return c?this._returnResult({data:null,error:c}):(e.factorType==="totp"&&l.type==="totp"&&(!((n=l?.totp)===null||n===void 0)&&n.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),this._returnResult({data:l,error:null}))})}catch(t){if(E(t))return this._returnResult({data:null,error:t});throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:n,error:i}=t;if(i)return this._returnResult({data:null,error:i});const o=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?qo(e.webauthn.credential_response):Wo(e.webauthn.credential_response)})}:{code:e.code}),{data:a,error:l}=await T(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:o,headers:this.headers,jwt:(r=n?.session)===null||r===void 0?void 0:r.access_token});return l?this._returnResult({data:null,error:l}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),this._returnResult({data:a,error:l}))})}catch(t){if(E(t))return this._returnResult({data:null,error:t});throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:n,error:i}=t;if(i)return this._returnResult({data:null,error:i});const o=await T(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(r=n?.session)===null||r===void 0?void 0:r.access_token});if(o.error)return o;const{data:a}=o;if(a.type!=="webauthn")return{data:a,error:null};switch(a.webauthn.type){case"create":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:Bo(a.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:Fo(a.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(t){if(E(t))return this._returnResult({data:null,error:t});throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?this._returnResult({data:null,error:r}):await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){var e;const{data:{user:t},error:r}=await this.getUser();if(r)return{data:null,error:r};const n={all:[],phone:[],totp:[],webauthn:[]};for(const i of(e=t?.factors)!==null&&e!==void 0?e:[])n.all.push(i),i.status==="verified"&&n[i.factor_type].push(i);return{data:n,error:null}}async _getAuthenticatorAssuranceLevel(){var e,t;const{data:{session:r},error:n}=await this.getSession();if(n)return this._returnResult({data:null,error:n});if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=It(r.access_token);let o=null;i.aal&&(o=i.aal);let a=o;((t=(e=r.user.factors)===null||e===void 0?void 0:e.filter(u=>u.status==="verified"))!==null&&t!==void 0?t:[]).length>0&&(a="aal2");const c=i.amr||[];return{data:{currentLevel:o,nextLevel:a,currentAuthenticationMethods:c},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async t=>{const{data:{session:r},error:n}=t;return n?this._returnResult({data:null,error:n}):r?await T(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:r.access_token,xform:i=>({data:i,error:null})}):this._returnResult({data:null,error:new W})})}catch(t){if(E(t))return this._returnResult({data:null,error:t});throw t}}async _approveAuthorization(e,t){try{return await this._useSession(async r=>{const{data:{session:n},error:i}=r;if(i)return this._returnResult({data:null,error:i});if(!n)return this._returnResult({data:null,error:new W});const o=await T(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:n.access_token,body:{action:"approve"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&D()&&!t?.skipBrowserRedirect&&window.location.assign(o.data.redirect_url),o})}catch(r){if(E(r))return this._returnResult({data:null,error:r});throw r}}async _denyAuthorization(e,t){try{return await this._useSession(async r=>{const{data:{session:n},error:i}=r;if(i)return this._returnResult({data:null,error:i});if(!n)return this._returnResult({data:null,error:new W});const o=await T(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:n.access_token,body:{action:"deny"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&D()&&!t?.skipBrowserRedirect&&window.location.assign(o.data.redirect_url),o})}catch(r){if(E(r))return this._returnResult({data:null,error:r});throw r}}async fetchJwk(e,t={keys:[]}){let r=t.keys.find(a=>a.kid===e);if(r)return r;const n=Date.now();if(r=this.jwks.keys.find(a=>a.kid===e),r&&this.jwks_cached_at+Yi>n)return r;const{data:i,error:o}=await T(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=n,r=i.keys.find(a=>a.kid===e),!r)?null:r}async getClaims(e,t={}){try{let r=e;if(!r){const{data:f,error:g}=await this.getSession();if(g||!f.session)return this._returnResult({data:null,error:g});r=f.session.access_token}const{header:n,payload:i,signature:o,raw:{header:a,payload:l}}=It(r);t?.allowExpired||wo(i.exp);const c=!n.alg||n.alg.startsWith("HS")||!n.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(n.kid,t?.keys?{keys:t.keys}:t?.jwks);if(!c){const{error:f}=await this.getUser(r);if(f)throw f;return{data:{claims:i,header:n,signature:o},error:null}}const u=vo(n.alg),h=await crypto.subtle.importKey("jwk",c,u,!0,["verify"]);if(!await crypto.subtle.verify(u,h,o,io(`${a}.${l}`)))throw new Jt("Invalid JWT signature");return{data:{claims:i,header:n,signature:o},error:null}}catch(r){if(E(r))return this._returnResult({data:null,error:r});throw r}}}Be.nextInstanceID={};const Qo=Be;class Zo extends Qo{constructor(e){super(e)}}class ea{constructor(e,t,r){var n,i,o;this.supabaseUrl=e,this.supabaseKey=t;const a=zi(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",a),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",a),this.storageUrl=new URL("storage/v1",a),this.functionsUrl=new URL("functions/v1",a);const l=`sb-${a.hostname.split(".")[0]}-auth-token`,c={db:Ni,realtime:Mi,auth:Object.assign(Object.assign({},Di),{storageKey:l}),global:Ui},u=Vi(r??{},c);this.storageKey=(n=u.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(i=u.global.headers)!==null&&i!==void 0?i:{},u.accessToken?(this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(h,d)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(d)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=u.auth)!==null&&o!==void 0?o:{},this.headers,u.global.fetch),this.fetch=qi(t,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},u.realtime)),this.accessToken&&this.accessToken().then(h=>this.realtime.setAuth(h)).catch(h=>console.warn("Failed to set initial Realtime auth token:",h)),this.rest=new Hn(new URL("rest/v1",a).href,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),this.storage=new Li(this.storageUrl.href,this.headers,this.fetch,r?.storage),u.accessToken||this._listenForAuthEvents()}get functions(){return new Bn(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e,t;if(this.accessToken)return await this.accessToken();const{data:r}=await this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:n,userStorage:i,storageKey:o,flowType:a,lock:l,debug:c,throwOnError:u},h,d){const f={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Zo({url:this.authUrl.href,headers:Object.assign(Object.assign({},f),h),storageKey:o,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:n,userStorage:i,flowType:a,lock:l,debug:c,throwOnError:u,fetch:d,hasCustomAuthorizationHeader:Object.keys(this.headers).some(g=>g.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new ci(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r?.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?(this.changedAccessToken=r,this.realtime.setAuth(r)):e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const ta=(s,e,t)=>new ea(s,e,t);function ra(){if(typeof window<"u"||typeof process>"u")return!1;const s=process.version;if(s==null)return!1;const e=s.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}ra()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const sa=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,en=new Set,Yt=typeof process=="object"&&process?process:{},tn=(s,e,t,r)=>{typeof Yt.emitWarning=="function"?Yt.emitWarning(s,e,t,r):console.error(`[${t}] ${e}: ${s}`)};let gt=globalThis.AbortController,Hr=globalThis.AbortSignal;if(typeof gt>"u"){Hr=class{onabort;_onabort=[];reason;aborted=!1;addEventListener(r,n){this._onabort.push(n)}},gt=class{constructor(){e()}signal=new Hr;abort(r){if(!this.signal.aborted){this.signal.reason=r,this.signal.aborted=!0;for(const n of this.signal._onabort)n(r);this.signal.onabort?.(r)}}};let s=Yt.env?.LRU_CACHE_IGNORE_AC_WARNING!=="1";const e=()=>{s&&(s=!1,tn("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",e))}}const na=s=>!en.has(s),Q=s=>s&&s===Math.floor(s)&&s>0&&isFinite(s),rn=s=>Q(s)?s<=Math.pow(2,8)?Uint8Array:s<=Math.pow(2,16)?Uint16Array:s<=Math.pow(2,32)?Uint32Array:s<=Number.MAX_SAFE_INTEGER?rt:null:null;class rt extends Array{constructor(e){super(e),this.fill(0)}}class be{heap;length;static#l=!1;static create(e){const t=rn(e);if(!t)return[];be.#l=!0;const r=new be(e,t);return be.#l=!1,r}constructor(e,t){if(!be.#l)throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new t(e),this.length=0}push(e){this.heap[this.length++]=e}pop(){return this.heap[--this.length]}}class wt{#l;#h;#p;#k;#y;#j;#L;#_;get perf(){return this.#_}ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#n;#m;#s;#r;#e;#c;#d;#a;#i;#w;#o;#v;#b;#f;#E;#R;#u;#x;static unsafeExposeInternals(e){return{starts:e.#b,ttls:e.#f,sizes:e.#v,keyMap:e.#s,keyList:e.#r,valList:e.#e,next:e.#c,prev:e.#d,get head(){return e.#a},get tail(){return e.#i},free:e.#w,isBackgroundFetch:t=>e.#t(t),backgroundFetch:(t,r,n,i)=>e.#N(t,r,n,i),moveToTail:t=>e.#P(t),indexes:t=>e.#S(t),rindexes:t=>e.#T(t),isStale:t=>e.#g(t)}}get max(){return this.#l}get maxSize(){return this.#h}get calculatedSize(){return this.#m}get size(){return this.#n}get fetchMethod(){return this.#j}get memoMethod(){return this.#L}get dispose(){return this.#p}get onInsert(){return this.#k}get disposeAfter(){return this.#y}constructor(e){const{max:t=0,ttl:r,ttlResolution:n=1,ttlAutopurge:i,updateAgeOnGet:o,updateAgeOnHas:a,allowStale:l,dispose:c,onInsert:u,disposeAfter:h,noDisposeOnSet:d,noUpdateTTL:f,maxSize:g=0,maxEntrySize:p=0,sizeCalculation:y,fetchMethod:_,memoMethod:w,noDeleteOnFetchRejection:m,noDeleteOnStaleGet:v,allowStaleOnFetchRejection:O,allowStaleOnFetchAbort:A,ignoreFetchAbort:k,perf:R}=e;if(R!==void 0&&typeof R?.now!="function")throw new TypeError("perf option must have a now() method if specified");if(this.#_=R??sa,t!==0&&!Q(t))throw new TypeError("max option must be a nonnegative integer");const U=t?rn(t):Array;if(!U)throw new Error("invalid max value: "+t);if(this.#l=t,this.#h=g,this.maxEntrySize=p||this.#h,this.sizeCalculation=y,this.sizeCalculation){if(!this.#h&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(w!==void 0&&typeof w!="function")throw new TypeError("memoMethod must be a function if defined");if(this.#L=w,_!==void 0&&typeof _!="function")throw new TypeError("fetchMethod must be a function if specified");if(this.#j=_,this.#R=!!_,this.#s=new Map,this.#r=new Array(t).fill(void 0),this.#e=new Array(t).fill(void 0),this.#c=new U(t),this.#d=new U(t),this.#a=0,this.#i=0,this.#w=be.create(t),this.#n=0,this.#m=0,typeof c=="function"&&(this.#p=c),typeof u=="function"&&(this.#k=u),typeof h=="function"?(this.#y=h,this.#o=[]):(this.#y=void 0,this.#o=void 0),this.#E=!!this.#p,this.#x=!!this.#k,this.#u=!!this.#y,this.noDisposeOnSet=!!d,this.noUpdateTTL=!!f,this.noDeleteOnFetchRejection=!!m,this.allowStaleOnFetchRejection=!!O,this.allowStaleOnFetchAbort=!!A,this.ignoreFetchAbort=!!k,this.maxEntrySize!==0){if(this.#h!==0&&!Q(this.#h))throw new TypeError("maxSize must be a positive integer if specified");if(!Q(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.#V()}if(this.allowStale=!!l,this.noDeleteOnStaleGet=!!v,this.updateAgeOnGet=!!o,this.updateAgeOnHas=!!a,this.ttlResolution=Q(n)||n===0?n:1,this.ttlAutopurge=!!i,this.ttl=r||0,this.ttl){if(!Q(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.#D()}if(this.#l===0&&this.ttl===0&&this.#h===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#l&&!this.#h){const fe="LRU_CACHE_UNBOUNDED";na(fe)&&(en.add(fe),tn("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",fe,wt))}}getRemainingTTL(e){return this.#s.has(e)?1/0:0}#D(){const e=new rt(this.#l),t=new rt(this.#l);this.#f=e,this.#b=t,this.#M=(i,o,a=this.#_.now())=>{if(t[i]=o!==0?a:0,e[i]=o,o!==0&&this.ttlAutopurge){const l=setTimeout(()=>{this.#g(i)&&this.#A(this.#r[i],"expire")},o+1);l.unref&&l.unref()}},this.#C=i=>{t[i]=e[i]!==0?this.#_.now():0},this.#O=(i,o)=>{if(e[o]){const a=e[o],l=t[o];if(!a||!l)return;i.ttl=a,i.start=l,i.now=r||n();const c=i.now-l;i.remainingTTL=a-c}};let r=0;const n=()=>{const i=this.#_.now();if(this.ttlResolution>0){r=i;const o=setTimeout(()=>r=0,this.ttlResolution);o.unref&&o.unref()}return i};this.getRemainingTTL=i=>{const o=this.#s.get(i);if(o===void 0)return 0;const a=e[o],l=t[o];if(!a||!l)return 1/0;const c=(r||n())-l;return a-c},this.#g=i=>{const o=t[i],a=e[i];return!!a&&!!o&&(r||n())-o>a}}#C=()=>{};#O=()=>{};#M=()=>{};#g=()=>!1;#V(){const e=new rt(this.#l);this.#m=0,this.#v=e,this.#I=t=>{this.#m-=e[t],e[t]=0},this.#B=(t,r,n,i)=>{if(this.#t(r))return 0;if(!Q(n))if(i){if(typeof i!="function")throw new TypeError("sizeCalculation must be a function");if(n=i(r,t),!Q(n))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return n},this.#$=(t,r,n)=>{if(e[t]=r,this.#h){const i=this.#h-e[t];for(;this.#m>i;)this.#U(!0)}this.#m+=e[t],n&&(n.entrySize=r,n.totalCalculatedSize=this.#m)}}#I=e=>{};#$=(e,t,r)=>{};#B=(e,t,r,n)=>{if(r||n)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0};*#S({allowStale:e=this.allowStale}={}){if(this.#n)for(let t=this.#i;!(!this.#F(t)||((e||!this.#g(t))&&(yield t),t===this.#a));)t=this.#d[t]}*#T({allowStale:e=this.allowStale}={}){if(this.#n)for(let t=this.#a;!(!this.#F(t)||((e||!this.#g(t))&&(yield t),t===this.#i));)t=this.#c[t]}#F(e){return e!==void 0&&this.#s.get(this.#r[e])===e}*entries(){for(const e of this.#S())this.#e[e]!==void 0&&this.#r[e]!==void 0&&!this.#t(this.#e[e])&&(yield[this.#r[e],this.#e[e]])}*rentries(){for(const e of this.#T())this.#e[e]!==void 0&&this.#r[e]!==void 0&&!this.#t(this.#e[e])&&(yield[this.#r[e],this.#e[e]])}*keys(){for(const e of this.#S()){const t=this.#r[e];t!==void 0&&!this.#t(this.#e[e])&&(yield t)}}*rkeys(){for(const e of this.#T()){const t=this.#r[e];t!==void 0&&!this.#t(this.#e[e])&&(yield t)}}*values(){for(const e of this.#S())this.#e[e]!==void 0&&!this.#t(this.#e[e])&&(yield this.#e[e])}*rvalues(){for(const e of this.#T())this.#e[e]!==void 0&&!this.#t(this.#e[e])&&(yield this.#e[e])}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="LRUCache";find(e,t={}){for(const r of this.#S()){const n=this.#e[r],i=this.#t(n)?n.__staleWhileFetching:n;if(i!==void 0&&e(i,this.#r[r],this))return this.get(this.#r[r],t)}}forEach(e,t=this){for(const r of this.#S()){const n=this.#e[r],i=this.#t(n)?n.__staleWhileFetching:n;i!==void 0&&e.call(t,i,this.#r[r],this)}}rforEach(e,t=this){for(const r of this.#T()){const n=this.#e[r],i=this.#t(n)?n.__staleWhileFetching:n;i!==void 0&&e.call(t,i,this.#r[r],this)}}purgeStale(){let e=!1;for(const t of this.#T({allowStale:!0}))this.#g(t)&&(this.#A(this.#r[t],"expire"),e=!0);return e}info(e){const t=this.#s.get(e);if(t===void 0)return;const r=this.#e[t],n=this.#t(r)?r.__staleWhileFetching:r;if(n===void 0)return;const i={value:n};if(this.#f&&this.#b){const o=this.#f[t],a=this.#b[t];if(o&&a){const l=o-(this.#_.now()-a);i.ttl=l,i.start=Date.now()}}return this.#v&&(i.size=this.#v[t]),i}dump(){const e=[];for(const t of this.#S({allowStale:!0})){const r=this.#r[t],n=this.#e[t],i=this.#t(n)?n.__staleWhileFetching:n;if(i===void 0||r===void 0)continue;const o={value:i};if(this.#f&&this.#b){o.ttl=this.#f[t];const a=this.#_.now()-this.#b[t];o.start=Math.floor(Date.now()-a)}this.#v&&(o.size=this.#v[t]),e.unshift([r,o])}return e}load(e){this.clear();for(const[t,r]of e){if(r.start){const n=Date.now()-r.start;r.start=this.#_.now()-n}this.set(t,r.value,r)}}set(e,t,r={}){if(t===void 0)return this.delete(e),this;const{ttl:n=this.ttl,start:i,noDisposeOnSet:o=this.noDisposeOnSet,sizeCalculation:a=this.sizeCalculation,status:l}=r;let{noUpdateTTL:c=this.noUpdateTTL}=r;const u=this.#B(e,t,r.size||0,a);if(this.maxEntrySize&&u>this.maxEntrySize)return l&&(l.set="miss",l.maxEntrySizeExceeded=!0),this.#A(e,"set"),this;let h=this.#n===0?void 0:this.#s.get(e);if(h===void 0)h=this.#n===0?this.#i:this.#w.length!==0?this.#w.pop():this.#n===this.#l?this.#U(!1):this.#n,this.#r[h]=e,this.#e[h]=t,this.#s.set(e,h),this.#c[this.#i]=h,this.#d[h]=this.#i,this.#i=h,this.#n++,this.#$(h,u,l),l&&(l.set="add"),c=!1,this.#x&&this.#k?.(t,e,"add");else{this.#P(h);const d=this.#e[h];if(t!==d){if(this.#R&&this.#t(d)){d.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:f}=d;f!==void 0&&!o&&(this.#E&&this.#p?.(f,e,"set"),this.#u&&this.#o?.push([f,e,"set"]))}else o||(this.#E&&this.#p?.(d,e,"set"),this.#u&&this.#o?.push([d,e,"set"]));if(this.#I(h),this.#$(h,u,l),this.#e[h]=t,l){l.set="replace";const f=d&&this.#t(d)?d.__staleWhileFetching:d;f!==void 0&&(l.oldValue=f)}}else l&&(l.set="update");this.#x&&this.onInsert?.(t,e,t===d?"update":"replace")}if(n!==0&&!this.#f&&this.#D(),this.#f&&(c||this.#M(h,n,i),l&&this.#O(l,h)),!o&&this.#u&&this.#o){const d=this.#o;let f;for(;f=d?.shift();)this.#y?.(...f)}return this}pop(){try{for(;this.#n;){const e=this.#e[this.#a];if(this.#U(!0),this.#t(e)){if(e.__staleWhileFetching)return e.__staleWhileFetching}else if(e!==void 0)return e}}finally{if(this.#u&&this.#o){const e=this.#o;let t;for(;t=e?.shift();)this.#y?.(...t)}}}#U(e){const t=this.#a,r=this.#r[t],n=this.#e[t];return this.#R&&this.#t(n)?n.__abortController.abort(new Error("evicted")):(this.#E||this.#u)&&(this.#E&&this.#p?.(n,r,"evict"),this.#u&&this.#o?.push([n,r,"evict"])),this.#I(t),e&&(this.#r[t]=void 0,this.#e[t]=void 0,this.#w.push(t)),this.#n===1?(this.#a=this.#i=0,this.#w.length=0):this.#a=this.#c[t],this.#s.delete(r),this.#n--,t}has(e,t={}){const{updateAgeOnHas:r=this.updateAgeOnHas,status:n}=t,i=this.#s.get(e);if(i!==void 0){const o=this.#e[i];if(this.#t(o)&&o.__staleWhileFetching===void 0)return!1;if(this.#g(i))n&&(n.has="stale",this.#O(n,i));else return r&&this.#C(i),n&&(n.has="hit",this.#O(n,i)),!0}else n&&(n.has="miss");return!1}peek(e,t={}){const{allowStale:r=this.allowStale}=t,n=this.#s.get(e);if(n===void 0||!r&&this.#g(n))return;const i=this.#e[n];return this.#t(i)?i.__staleWhileFetching:i}#N(e,t,r,n){const i=t===void 0?void 0:this.#e[t];if(this.#t(i))return i;const o=new gt,{signal:a}=r;a?.addEventListener("abort",()=>o.abort(a.reason),{signal:o.signal});const l={signal:o.signal,options:r,context:n},c=(p,y=!1)=>{const{aborted:_}=o.signal,w=r.ignoreFetchAbort&&p!==void 0;if(r.status&&(_&&!y?(r.status.fetchAborted=!0,r.status.fetchError=o.signal.reason,w&&(r.status.fetchAbortIgnored=!0)):r.status.fetchResolved=!0),_&&!w&&!y)return h(o.signal.reason);const m=f,v=this.#e[t];return(v===f||w&&y&&v===void 0)&&(p===void 0?m.__staleWhileFetching!==void 0?this.#e[t]=m.__staleWhileFetching:this.#A(e,"fetch"):(r.status&&(r.status.fetchUpdated=!0),this.set(e,p,l.options))),p},u=p=>(r.status&&(r.status.fetchRejected=!0,r.status.fetchError=p),h(p)),h=p=>{const{aborted:y}=o.signal,_=y&&r.allowStaleOnFetchAbort,w=_||r.allowStaleOnFetchRejection,m=w||r.noDeleteOnFetchRejection,v=f;if(this.#e[t]===f&&(!m||v.__staleWhileFetching===void 0?this.#A(e,"fetch"):_||(this.#e[t]=v.__staleWhileFetching)),w)return r.status&&v.__staleWhileFetching!==void 0&&(r.status.returnedStale=!0),v.__staleWhileFetching;if(v.__returned===v)throw p},d=(p,y)=>{const _=this.#j?.(e,i,l);_&&_ instanceof Promise&&_.then(w=>p(w===void 0?void 0:w),y),o.signal.addEventListener("abort",()=>{(!r.ignoreFetchAbort||r.allowStaleOnFetchAbort)&&(p(void 0),r.allowStaleOnFetchAbort&&(p=w=>c(w,!0)))})};r.status&&(r.status.fetchDispatched=!0);const f=new Promise(d).then(c,u),g=Object.assign(f,{__abortController:o,__staleWhileFetching:i,__returned:void 0});return t===void 0?(this.set(e,g,{...l.options,status:void 0}),t=this.#s.get(e)):this.#e[t]=g,g}#t(e){if(!this.#R)return!1;const t=e;return!!t&&t instanceof Promise&&t.hasOwnProperty("__staleWhileFetching")&&t.__abortController instanceof gt}async fetch(e,t={}){const{allowStale:r=this.allowStale,updateAgeOnGet:n=this.updateAgeOnGet,noDeleteOnStaleGet:i=this.noDeleteOnStaleGet,ttl:o=this.ttl,noDisposeOnSet:a=this.noDisposeOnSet,size:l=0,sizeCalculation:c=this.sizeCalculation,noUpdateTTL:u=this.noUpdateTTL,noDeleteOnFetchRejection:h=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:d=this.allowStaleOnFetchRejection,ignoreFetchAbort:f=this.ignoreFetchAbort,allowStaleOnFetchAbort:g=this.allowStaleOnFetchAbort,context:p,forceRefresh:y=!1,status:_,signal:w}=t;if(!this.#R)return _&&(_.fetch="get"),this.get(e,{allowStale:r,updateAgeOnGet:n,noDeleteOnStaleGet:i,status:_});const m={allowStale:r,updateAgeOnGet:n,noDeleteOnStaleGet:i,ttl:o,noDisposeOnSet:a,size:l,sizeCalculation:c,noUpdateTTL:u,noDeleteOnFetchRejection:h,allowStaleOnFetchRejection:d,allowStaleOnFetchAbort:g,ignoreFetchAbort:f,status:_,signal:w};let v=this.#s.get(e);if(v===void 0){_&&(_.fetch="miss");const O=this.#N(e,v,m,p);return O.__returned=O}else{const O=this.#e[v];if(this.#t(O)){const fe=r&&O.__staleWhileFetching!==void 0;return _&&(_.fetch="inflight",fe&&(_.returnedStale=!0)),fe?O.__staleWhileFetching:O.__returned=O}const A=this.#g(v);if(!y&&!A)return _&&(_.fetch="hit"),this.#P(v),n&&this.#C(v),_&&this.#O(_,v),O;const k=this.#N(e,v,m,p),U=k.__staleWhileFetching!==void 0&&r;return _&&(_.fetch=A?"stale":"refresh",U&&A&&(_.returnedStale=!0)),U?k.__staleWhileFetching:k.__returned=k}}async forceFetch(e,t={}){const r=await this.fetch(e,t);if(r===void 0)throw new Error("fetch() returned undefined");return r}memo(e,t={}){const r=this.#L;if(!r)throw new Error("no memoMethod provided to constructor");const{context:n,forceRefresh:i,...o}=t,a=this.get(e,o);if(!i&&a!==void 0)return a;const l=r(e,a,{options:o,context:n});return this.set(e,l,o),l}get(e,t={}){const{allowStale:r=this.allowStale,updateAgeOnGet:n=this.updateAgeOnGet,noDeleteOnStaleGet:i=this.noDeleteOnStaleGet,status:o}=t,a=this.#s.get(e);if(a!==void 0){const l=this.#e[a],c=this.#t(l);return o&&this.#O(o,a),this.#g(a)?(o&&(o.get="stale"),c?(o&&r&&l.__staleWhileFetching!==void 0&&(o.returnedStale=!0),r?l.__staleWhileFetching:void 0):(i||this.#A(e,"expire"),o&&r&&(o.returnedStale=!0),r?l:void 0)):(o&&(o.get="hit"),c?l.__staleWhileFetching:(this.#P(a),n&&this.#C(a),l))}else o&&(o.get="miss")}#q(e,t){this.#d[t]=e,this.#c[e]=t}#P(e){e!==this.#i&&(e===this.#a?this.#a=this.#c[e]:this.#q(this.#d[e],this.#c[e]),this.#q(this.#i,e),this.#i=e)}delete(e){return this.#A(e,"delete")}#A(e,t){let r=!1;if(this.#n!==0){const n=this.#s.get(e);if(n!==void 0)if(r=!0,this.#n===1)this.#W(t);else{this.#I(n);const i=this.#e[n];if(this.#t(i)?i.__abortController.abort(new Error("deleted")):(this.#E||this.#u)&&(this.#E&&this.#p?.(i,e,t),this.#u&&this.#o?.push([i,e,t])),this.#s.delete(e),this.#r[n]=void 0,this.#e[n]=void 0,n===this.#i)this.#i=this.#d[n];else if(n===this.#a)this.#a=this.#c[n];else{const o=this.#d[n];this.#c[o]=this.#c[n];const a=this.#c[n];this.#d[a]=this.#d[n]}this.#n--,this.#w.push(n)}}if(this.#u&&this.#o?.length){const n=this.#o;let i;for(;i=n?.shift();)this.#y?.(...i)}return r}clear(){return this.#W("delete")}#W(e){for(const t of this.#T({allowStale:!0})){const r=this.#e[t];if(this.#t(r))r.__abortController.abort(new Error("deleted"));else{const n=this.#r[t];this.#E&&this.#p?.(r,n,e),this.#u&&this.#o?.push([r,n,e])}}if(this.#s.clear(),this.#e.fill(void 0),this.#r.fill(void 0),this.#f&&this.#b&&(this.#f.fill(0),this.#b.fill(0)),this.#v&&this.#v.fill(0),this.#a=0,this.#i=0,this.#w.length=0,this.#m=0,this.#n=0,this.#u&&this.#o){const t=this.#o;let r;for(;r=t?.shift();)this.#y?.(...r)}}}const sn={currentPage:1,totalMovies:0,activeFilters:{searchTerm:"",genre:null,year:null,country:null,director:null,actor:null,selection:null,studio:null,sort:ee.SORT,mediaType:ee.MEDIA_TYPE,excludedGenres:[],excludedCountries:[]},userMovieData:{}};let C=structuredClone(sn);const ke=()=>({...C,activeFilters:de(),userMovieData:{...C.userMovieData}}),de=()=>({...C.activeFilters,excludedGenres:[...C.activeFilters.excludedGenres],excludedCountries:[...C.activeFilters.excludedCountries]}),Fe=()=>C.currentPage;function ia(){const{activeFilters:s}=C,e=new Set(["mediaType","sort","page"]);return Object.keys(s).some(t=>{if(e.has(t))return!1;const r=s[t];return Array.isArray(r)?r.length>0:r!==null&&r!==""&&r!==void 0})}const Ce=s=>C.userMovieData[s]?{...C.userMovieData[s]}:void 0;function nn(){const{activeFilters:s}=C;let e=0;s.excludedGenres.length>0&&e++,s.excludedCountries.length>0&&e++;const t=`${I.YEAR_MIN}-${I.YEAR_MAX}`;s.year&&s.year!==t&&e++;const r=new Set(["mediaType","sort","searchTerm","excludedGenres","excludedCountries","year"]);return Object.entries(s).forEach(([n,i])=>{!r.has(n)&&i&&e++}),e}function Xt(s){C.currentPage=s}function oa(s){C.totalMovies=s}function Qt(s,e,t=!1){if(!(s in C.activeFilters))return!1;const r=C.activeFilters[s];return!t&&(e!==null&&r===null)&&nn()>=I.MAX_ACTIVE_FILTERS?!1:(C.activeFilters[s]=e,C.totalMovies=0,!0)}function on(s){C.activeFilters.searchTerm=s,C.totalMovies=0;let e=!1;return s&&s.length>0&&((C.activeFilters.actor||C.activeFilters.director)&&(e=!0),C.activeFilters.actor=null,C.activeFilters.director=null),e}function pt(s){C.activeFilters.sort=s}function Zt(s){C.activeFilters.mediaType=s,C.totalMovies=0}function ul(s,e){const t=s==="genre"?C.activeFilters.excludedGenres:s==="country"?C.activeFilters.excludedCountries:null;if(!t)return!1;const r=t.indexOf(e);return r>-1?(t.splice(r,1),C.totalMovies=0,!0):t.length>=I.MAX_EXCLUDED_FILTERS||nn()>=I.MAX_ACTIVE_FILTERS?!1:(t.push(e),C.totalMovies=0,!0)}function an(){C.activeFilters=structuredClone(sn.activeFilters),C.totalMovies=0}function aa(s){C.userMovieData=s||{}}function yt(s,e){C.userMovieData[s]||(C.userMovieData[s]={onWatchlist:!1,rating:null}),Object.assign(C.userMovieData[s],e),document.dispatchEvent(new CustomEvent("userMovieDataChanged",{detail:{movieId:s}}))}function la(){C.userMovieData={}}const Gr=I.SUPABASE_URL,Kr=I.SUPABASE_ANON_KEY,Y=Gr&&Kr?ta(Gr,Kr):{rpc:()=>Promise.reject(new Error("Error crítico: Supabase no configurado (Faltan credenciales)")),from:()=>({select:()=>Promise.reject(new Error("Supabase no configurado")),upsert:()=>Promise.reject(new Error("Supabase no configurado"))}),auth:{getSession:()=>Promise.resolve({data:{session:null},error:null}),onAuthStateChange:()=>({data:{subscription:{unsubscribe:()=>{}}}}),signInWithPassword:()=>Promise.reject(new Error("Supabase no configurado")),signOut:()=>Promise.reject(new Error("Supabase no configurado")),signUp:()=>Promise.reject(new Error("Supabase no configurado"))}},Lt=new wt({max:300,ttl:1e3*60*30,updateAgeOnGet:!0,ttlAutopurge:!0}),xt=new wt({max:100,ttl:1e3*60*5});function ca(s,e,t){const r={};return Object.keys(s).sort().forEach(n=>{const i=s[n],o=i!=null&&i!=="",a=Array.isArray(i)&&i.length>0;o&&(!Array.isArray(i)||a)&&(typeof i=="string"?r[n]=i.trim().toLowerCase():Array.isArray(i)?r[n]=i.map(l=>typeof l=="string"?l.trim().toLowerCase():l).sort():r[n]=i)}),JSON.stringify({filters:r,page:e,pageSize:t})}function ua(s,e,t,r){let n=null,i=null;if(s.year){const c=s.year.split("-").map(Number);c.length===2&&!c.some(isNaN)&&([n,i]=c)}const[o="relevance",a="asc"]=(s.sort||"relevance,asc").split(","),l=(e-1)*t;return{search_term:s.searchTerm||null,genre_name:s.genre||null,p_year_start:n,p_year_end:i,country_name:s.country||null,director_name:s.director||null,actor_name:s.actor||null,media_type:s.mediaType||"all",p_selection_code:s.selection||null,p_studio_code:s.studio||null,excluded_genres:s.excludedGenres?.length>0?s.excludedGenres:null,excluded_countries:s.excludedCountries?.length>0?s.excludedCountries:null,sort_field:o,sort_direction:a,page_limit:t,page_offset:l,get_count:r}}const Ie=new Map;function er(s,e,t=I.ITEMS_PER_PAGE,r,n=!0){const i=ca({...s,requestCount:n},e,t);if(Lt.has(i))return Promise.resolve(Lt.get(i));const o=Ie.get(i);if(o){if(!o.signal?.aborted)return o.promise;Ie.delete(i)}const a=(async()=>{try{const l=ua(s,e,t,n);let c=Y.rpc("search_movies_offset",l);r&&(c=c.abortSignal(r));const{data:u,error:h}=await c;if(h){if(h.name==="AbortError"||h.message?.includes("abort"))return{aborted:!0,items:[],total:-1};throw console.error("[API] Error RPC Supabase:",h),new Error("Error de base de datos al obtener películas.")}const d={total:u?.total??-1,items:u?.items||[]};return r?.aborted||Lt.set(i,d),d}catch(l){if(l.name==="AbortError"||r&&r.aborted)return{aborted:!0,items:[],total:-1};throw l}finally{Ie.get(i)?.promise===a&&Ie.delete(i)}})();return Ie.set(i,{promise:a,signal:r}),a}async function ha(){const{data:s,error:e}=await Y.from("user_movie_entries").select("movie_id, rating, on_watchlist");if(e)throw new Error("No se pudieron cargar tus datos.");const t={};return s&&s.forEach(r=>{t[r.movie_id]={rating:r.rating,onWatchlist:r.on_watchlist}}),t}async function ln(s,e){const{data:{session:t}}=await Y.auth.getSession();if(!t||!t.user)throw new Error("Debes iniciar sesión.");const r=t.user.id,i={...Ce(s)||{rating:null,onWatchlist:!1},...e},o={user_id:r,movie_id:s,rating:i.rating,on_watchlist:i.onWatchlist,updated_at:new Date().toISOString()},{error:a}=await Y.from("user_movie_entries").upsert(o,{onConflict:"user_id, movie_id"});if(a)throw new Error("No se pudo guardar tu acción.")}const vt=async(s,e)=>{if(!e||e.length<2)return[];const t=`suggest:${s}:${e.toLowerCase()}`;if(xt.has(t))return xt.get(t);const r=`suggestion-${s}`,n=os(r);try{const{data:i,error:o}=await Y.rpc(s,{search_term:e}).abortSignal(n.signal);if(o)return o.name==="AbortError"?[]:[];const a=i.map(l=>l.suggestion);return xt.set(t,a),a}catch{return[]}},hl=s=>vt("get_genre_suggestions",s),dl=s=>vt("get_director_suggestions",s),fl=s=>vt("get_country_suggestions",s),gl=async s=>(await vt("get_actor_suggestions",s)).filter(t=>!lt.includes(t.toLowerCase())),pl=async()=>{const{data:s,error:e}=await Y.rpc("get_random_top_actors",{limit_count:5});return e?[]:s.map(t=>t.name).filter(t=>!lt.includes(t.toLowerCase()))},yl=async()=>{const{data:s,error:e}=await Y.rpc("get_random_top_directors",{limit_count:5});return e?[]:s.map(t=>t.name)},Pe={},da={gridContainer:()=>document.querySelector(P.GRID_CONTAINER),paginationContainer:()=>document.querySelector(P.PAGINATION_CONTAINER),searchForm:()=>document.querySelector(P.SEARCH_FORM),searchInput:()=>document.querySelector(P.SEARCH_INPUT),sortSelect:()=>document.querySelector(P.SORT_SELECT),themeToggleButton:()=>document.querySelector(P.THEME_TOGGLE),sidebarOverlay:()=>document.querySelector(P.SIDEBAR_OVERLAY),sidebar:()=>document.querySelector(".sidebar"),typeFilterToggle:()=>document.querySelector(P.TYPE_FILTER_TOGGLE),headerPrevBtn:()=>document.querySelector(P.HEADER_PREV_BTN),headerNextBtn:()=>document.querySelector(P.HEADER_NEXT_BTN),autocompleteResults:()=>document.querySelector(P.AUTOCOMPLETE_RESULTS),mainHeader:()=>document.querySelector(".main-header"),clearFiltersBtn:()=>document.querySelector(P.CLEAR_FILTERS_BTN),totalResultsContainer:()=>document.getElementById("total-results-container"),totalResultsCount:()=>document.getElementById("total-results-count"),authModal:()=>document.getElementById("auth-modal"),authOverlay:()=>document.getElementById("auth-overlay"),loginButton:()=>document.getElementById("login-button"),toastContainer:()=>document.querySelector(P.TOAST_CONTAINER)},S=new Proxy({},{get:(s,e)=>{if(Pe[e]&&Pe[e].isConnected)return Pe[e];const t=da[e];if(t){const r=t();return r?Pe[e]=r:delete Pe[e],r}}});let Jr="",Yr=0;function Ae(s,e="error"){const{toastContainer:t}=S;if(!t)return;const r=Date.now(),n=s===Jr,i=r-Yr<2e3;if(n&&i&&t.hasChildNodes())return;Jr=s,Yr=r,t.replaceChildren();const o=N("div",{className:`toast toast--${e}`,textContent:s,attributes:{role:"alert"}});o.addEventListener("animationend",a=>{a.animationName.includes("out")&&o.remove()}),setTimeout(()=>{o.isConnected&&o.remove()},8e3),o.addEventListener("click",()=>o.remove()),t.appendChild(o)}function fa(s,e,t){if(!s)return;s.textContent="";const r=Math.ceil(e/I.ITEMS_PER_PAGE);if(r<=1)return;const n=document.createDocumentFragment(),i=(u,h,d,f=!1,g=!1)=>{const p=N("button",{className:`btn btn--pagination${f?" active":""} ${g?"pagination-arrow":""}`,dataset:{page:u},textContent:h,attributes:{"aria-label":d,type:"button"}});n.appendChild(p)},o=()=>{n.appendChild(N("span",{textContent:"...",className:"pagination-separator",attributes:{"aria-hidden":"true"}}))};t>1&&i(t-1,"<","Página anterior",!1,!0);const a=new Set([1,r,t,t-1,t+1]),l=Array.from(a).filter(u=>u>0&&u<=r).sort((u,h)=>u-h);let c=0;for(const u of l)c>0&&u-c>1&&o(),u===t?n.appendChild(N("span",{className:"pagination-current",textContent:u,attributes:{"aria-current":"page","aria-label":`Página actual ${u}`}})):i(u,u,`Ir a página ${u}`),c=u;t<r&&i(t+1,">","Página siguiente",!1,!0),s.appendChild(n)}function st(s,e){const{headerPrevBtn:t,headerNextBtn:r}=S;if(!t||!r)return;const n=Math.ceil(e/I.ITEMS_PER_PAGE);t.disabled=s<=1,r.disabled=s>=n||n===0}function ga(s,e,t){const r=Math.ceil(e/I.ITEMS_PER_PAGE);if(s>=r)return;(window.requestIdleCallback||(i=>setTimeout(i,500)))(()=>{er(t,s+1,I.ITEMS_PER_PAGE,null,!1).catch(()=>{}),s+1<r&&setTimeout(()=>{er(t,s+2,I.ITEMS_PER_PAGE,null,!1).catch(()=>{})},1e3)})}const cn='a[href], button:not([disabled]), textarea:not([disabled]), input:not([type="hidden"]):not([disabled]), select:not([disabled]), [tabindex]:not([tabindex^="-"])';let he=null,nt=null;function un(s){return!!(s.offsetWidth||s.offsetHeight||s.getClientRects().length)}function pa(s){if(s.key!=="Tab")return;const e=Array.from(s.currentTarget.querySelectorAll(cn)).filter(un);if(e.length===0){s.preventDefault();return}const t=e[0],r=e[e.length-1];s.shiftKey&&document.activeElement===t?(s.preventDefault(),r.focus()):!s.shiftKey&&document.activeElement===r&&(s.preventDefault(),t.focus())}function ya(s,e,t=!1){if(s){if(s.hasAttribute("role")||s.setAttribute("role","dialog"),s.hasAttribute("aria-modal")||s.setAttribute("aria-modal","true"),nt=document.activeElement,s.hidden=!1,e&&(e.hidden=!1),s.focus({preventScroll:!0}),!t){const r=s.querySelector(cn);r&&r.focus()}he&&s.removeEventListener("keydown",he),he=pa,s.addEventListener("keydown",he)}}function _a(s,e){s&&(s.hidden=!0,e&&(e.hidden=!0),he&&(s.removeEventListener("keydown",he),he=null),nt&&un(nt)&&nt.focus())}const Xr=()=>_a(S.authModal,S.authOverlay),ma=()=>ya(S.authModal,S.authOverlay);let Qr=!1;function wa(){if(Qr)return;const{loginButton:s,authModal:e,authOverlay:t}=S;!s||!e||(s.addEventListener("click",ma),t?.addEventListener("click",Xr),document.addEventListener("keydown",r=>{r.key==="Escape"&&!e.hidden&&Xr()}),Qr=!0)}function gr(s){const e=S.typeFilterToggle;if(!e)return;const t={movies:{label:"Cine",icon:Et.CLAPPERBOARD,class:te.TYPE_FILTER_MOVIES},series:{label:"TV",icon:Et.TV,class:te.TYPE_FILTER_SERIES},all:{label:"Todo",icon:Et.POPCORN,class:""}},r=t[s]||t.all;e.className=`type-filter-toggle ${r.class}`,e.setAttribute("aria-label",`Filtrar por tipo: ${r.label}`),e.innerHTML=`
    <span class="desktop-text">${r.label}</span>
    <span class="mobile-icon">${r.icon}</span>
  `}function va(s,e){const{totalResultsContainer:t,totalResultsCount:r}=S;t&&(e&&s>0?(r.textContent=s.toLocaleString("es-ES"),t.hidden=!1):t.hidden=!0)}function ba(){const s=S.themeToggleButton;if(!s)return;const e=document.documentElement.classList.contains("dark-mode");s.setAttribute("aria-pressed",e),s.addEventListener("click",t=>{Se(t.currentTarget),document.dispatchEvent(new CustomEvent("uiActionTriggered"));const r=document.documentElement.classList.toggle("dark-mode");localStorage.setItem("theme",r?"dark":"light"),s.setAttribute("aria-pressed",r)})}function Ea(s=null){document.querySelectorAll(P.SIDEBAR_AUTOCOMPLETE_RESULTS).forEach(e=>{const t=e.closest(P.SIDEBAR_FILTER_FORM);if(s&&t===s)return;const r=t?.querySelector(P.SIDEBAR_FILTER_INPUT);r&&r.removeAttribute("aria-expanded"),e.remove()})}const Sa=[5,7,9],Zr={FA:22e4,IMDB:32e5},Ta={FA:Math.sqrt(Zr.FA),IMDB:Math.sqrt(Zr.IMDB)};function hn(s){return s?s>=9?3:s>=7?2:s>=5?1:0:0}function Aa(s){return s<=5.5?0:s>=9?3:(s-5.5)/3.5*3}function dn(s,e,{hideUnfilled:t=!1,snapToInteger:r=!1}={}){const n=s.querySelectorAll(".star-icon"),i=r?Math.round(e):e;for(let o=0;o<n.length;o++){const a=n[o],l=Math.max(0,Math.min(1,i-o)),c=a.querySelector(".star-icon-path--filled");if(t&&l===0)a.style.opacity="0",a.style.visibility="visible";else{a.style.opacity="1",a.style.visibility="visible";const u=(1-l)*100;c.style.clipPath=`inset(0 ${u}% 0 0)`}}}const Oa=(s,e)=>dn(s,e,{hideUnfilled:!0,snapToInteger:!1}),it=(s,e,t=!1)=>dn(s,e,{hideUnfilled:t,snapToInteger:!0});function Ra(s){const e=s.currentTarget,t=e.parentElement;if(!t)return;const r=parseInt(e.dataset.ratingLevel,10);it(t,r,!1)}function ka(s){const e=new CustomEvent("card:requestUpdate",{bubbles:!0,composed:!0,detail:{cardElement:s.currentTarget.closest(".movie-card")}});s.target.dispatchEvent(e)}function Ca(s,e){if(!e)return;s.querySelectorAll(".star-icon").forEach(r=>{r.addEventListener("mouseenter",Ra,{passive:!0})}),s.addEventListener("mouseleave",ka,{passive:!0})}async function es(s,e,t){const r=Ce(s)||{rating:null,onWatchlist:!1};if(r.rating===e)return;const n={rating:e};Ne("light"),yt(s,n),tr(t);try{await ln(s,n),e!==null&&Ne("success")}catch(i){Ae(i.message,"error"),yt(s,r),tr(t)}}function Ia(s,e){const t=s.target,r=t.closest(".star-icon[data-rating-level]"),n=t.closest(".wall-rating-number"),i=t.closest(".card-rating-block");if(r){s.preventDefault(),s.stopPropagation();const o=parseInt(e.dataset.movieId,10),a=Ce(o)?.rating,l=parseInt(r.dataset.ratingLevel,10);let c=null;if(l===1)a===2?c=5:a===5?c=null:c=2;else{const u=Sa[l-1],h=hn(a);l===h?c=null:c=u}return es(o,c,e),!0}else if(n||i&&document.body.classList.contains("rotation-disabled")){s.preventDefault(),s.stopPropagation();const o=parseInt(e.dataset.movieId,10);return es(o,2,e),!0}return!1}function tr(s){const e=parseInt(s.dataset.movieId,10),t=s.movieData;if(!t)return;const n=Ce(e)?.rating,i=document.body.classList.contains("user-logged-in"),o=s.querySelector('[data-action="set-rating-estrellas"]'),a=s.querySelector('[data-action="set-rating-suspenso"]');if(!o||!a)return;if(a.style.display="none",o.style.display="none",i&&typeof n=="number")if(o.classList.add("has-user-rating"),a.classList.add("has-user-rating"),n===2){o.style.display="flex",it(o,0,!1);const c=o.querySelectorAll(".star-icon");for(let u=1;u<c.length;u++)c[u].style.opacity="0"}else n>=5&&(o.style.display="flex",it(o,hn(n),!0));else{o.classList.remove("has-user-rating"),a.classList.remove("has-user-rating");const c=t.avg_rating;if(c&&c>0)if(c<=5.5)if(i){a.style.display="none",o.style.display="flex",it(o,0);const u=o.querySelectorAll(".star-icon");for(let h=1;h<u.length;h++)u[h].style.opacity="0"}else a.style.display="block";else o.style.display="flex",Oa(o,Aa(c))}}function Pa(s,e){const t=(r,n)=>{const i=s.querySelector(`[data-template="${r}-link"]`);if(!i)return;const o=e[`${r}_id`],a=e[`${r}_rating`],l=e[`${r}_votes`]||0;o&&o.startsWith("http")?(i.href=o,i.classList.remove("disabled"),i.setAttribute("aria-label",`Nota ${r.toUpperCase()}: ${a}`)):(i.removeAttribute("href"),i.classList.add("disabled")),s.querySelector(`[data-template="${r}-rating"]`).textContent=a?String(a).includes(".")?a:`${a}.0`:"N/A";const c=s.querySelector(`[data-template="${r}-votes-bar-container"]`),u=s.querySelector(`[data-template="${r}-votes-count"]`);if(c.style.display=l>0?"block":"none",l>0){const h=Math.min(Math.sqrt(l)/Ta[n]*100,100);s.querySelector(`[data-template="${r}-votes-bar"]`).style.width=`${h}%`;const d=On(l,r);c.dataset.votes=d,u&&(u.textContent=d)}};t("fa","FA"),t("imdb","IMDB")}const ja=""+new URL("sprite-CNdduWRw.svg",import.meta.url).href,La=document.querySelector(P.MOVIE_CARD_TEMPLATE);let rr=0,qe=0,G=null,$e,z=null;const xa=1e3,$a=".card-rating-block, .front-director-info, .actors-expand-btn";async function sr(s){const{openModal:e,initQuickView:t}=await at(async()=>{const{openModal:r,initQuickView:n}=await import("./modal-D9ZXnSza.js");return{openModal:r,initQuickView:n}},[],import.meta.url);window._quickViewInitialized||(t(),window._quickViewInitialized=!0),e(s)}function We(s){const e=s.querySelector(".flip-card-back");if(e?.classList.contains("is-expanded")){e.classList.remove("is-expanded","show-actors");const t=e.querySelector(".expand-content-btn");t&&(t.textContent="+",t.setAttribute("aria-label","Expandir sinopsis")),e.querySelectorAll(".scrollable-content, .actors-scrollable-content").forEach(n=>n.scrollTop=0)}}function pr(){G&&(G.querySelector(".flip-card-inner")?.classList.remove("is-flipped"),We(G),G=null,document.removeEventListener("click",nr))}function nr(s){G&&!G.contains(s.target)&&pr()}function ts(s){document.body.classList.contains("rotation-disabled")||s.querySelector(".flip-card-inner").classList.contains("is-flipped")||(clearTimeout($e),$e=setTimeout(()=>{z===s&&s.classList.add("is-hovered")},xa))}const Ua=s=>{if(!s)return;const e=s.querySelector(".flip-card-inner");if(!e)return;const t=e.classList.contains("is-flipped");G&&G!==s&&pr(),e.classList.toggle("is-flipped"),t?(G=null,We(s),document.removeEventListener("click",nr)):(G=s,setTimeout(()=>{G===s&&document.addEventListener("click",nr)},0))};function Na(s){s.addEventListener("pointerover",a=>{if(a.pointerType!=="mouse")return;const l=a.target.closest(".movie-card");l&&(z!==l?(z&&(clearTimeout($e),z.classList.remove("is-hovered"),We(z)),z=l,ts(l)):a.target.closest($a)?clearTimeout($e):ts(l))}),s.addEventListener("pointerout",a=>{a.pointerType!=="mouse"||!z||z.contains(a.relatedTarget)||(clearTimeout($e),z.classList.remove("is-hovered"),We(z),z=null)}),s.addEventListener("dblclick",a=>{const l=a.target.closest(".movie-card");l&&!document.body.classList.contains("rotation-disabled")&&sr(l)});let e=0,t=null,r=0,n=0;const i=250,o=10;s.addEventListener("pointerdown",a=>{a.pointerType==="mouse"||!a.isPrimary||(r=a.clientX,n=a.clientY)},{passive:!0}),s.addEventListener("pointerup",a=>{if(a.pointerType==="mouse")return;const l=a.target.closest(".movie-card");if(!l||document.body.classList.contains("rotation-disabled")||a.target.closest("[data-action], a, button, .expand-content-btn")||Math.abs(a.clientX-r)>o||Math.abs(a.clientY-n)>o)return;a.cancelable&&a.preventDefault();const c=performance.now(),u=c-e;e>0&&u<i&&u>0?(clearTimeout(t),sr(l)):(clearTimeout(t),t=setTimeout(()=>Ua(l),i)),e=c})}async function Da(s,e,t){const n={onWatchlist:!e.classList.contains("is-active")},i=Ce(s)||{onWatchlist:!1,rating:null};Ne("light"),yt(s,n),Ve(t);try{await ln(s,n),Ne("success")}catch(o){Ae(o.message,"error"),yt(s,i),Ve(t)}}function rs(s){if(document.body.dataset.gestureCooldown){s.preventDefault(),s.stopPropagation();return}const e=this,t=s.target,r=parseInt(e.dataset.movieId,10),n=t.closest('[data-action="toggle-watchlist"]');if(n){s.preventDefault(),s.stopPropagation(),Da(r,n,e);return}if(Ia(s,e))return;const i=e.querySelector(".flip-card-back"),o=t.closest(".expand-content-btn");if(t.closest(".actors-expand-btn")){s.stopPropagation(),i.classList.add("is-expanded","show-actors");const c=i.querySelector(".expand-content-btn");c&&(c.textContent="−",c.setAttribute("aria-label","Cerrar detalles"));return}if(o){s.stopPropagation(),i.classList.contains("is-expanded")?We(e):(i.classList.add("is-expanded"),i.classList.remove("show-actors"),o.textContent="−",o.setAttribute("aria-label","Contraer sinopsis"));return}if((t.closest(".scrollable-content")&&i.classList.contains("is-expanded")||t.closest(".actors-scrollable-content"))&&!t.closest(".actor-list-item")){s.stopPropagation();return}const l=t.closest("[data-director-name], [data-actor-name]");if(l){s.preventDefault();const c=l.dataset.directorName?"director":"actor",u=l.dataset.directorName||l.dataset.actorName;document.dispatchEvent(new CustomEvent("filtersReset",{detail:{keepSort:!0,newFilter:{type:c,value:u}}}));return}t.closest("a")?.href&&!t.closest("a").href.endsWith("#")||document.body.classList.contains("rotation-disabled")&&e.id!=="quick-view-content"&&sr(e)}const fn=new IntersectionObserver((s,e)=>{s.forEach(t=>{if(t.isIntersecting){const r=t.target;r.src=r.dataset.src,r.onload=()=>r.classList.add(te.LOADED),r.onerror=()=>r.classList.add(te.LOADED),e.unobserve(r)}})},{rootMargin:"800px"});function bt(s){s&&s.querySelectorAll("img[data-src]").forEach(e=>fn.unobserve(e))}function Ma(s,e){const t=s.querySelector(".movie-summary"),r=s.querySelector(".flip-card-back"),n=s.querySelector("img"),i=e.last_synced_at?new Date(e.last_synced_at).getTime():"1",o=`${I.POSTER_BASE_URL}${e.image}.webp?v=${i}`;n.alt=`Póster de ${e.title}`,n.src=e.thumbhash_st||"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=",n.dataset.src=o,n.classList.add(e.thumbhash_st?te.LAZY_LQIP:""),rr<4&&(n.loading="eager",n.setAttribute("fetchpriority","high")),fn.observe(n),t.querySelector(P.TITLE).textContent=e.title,t.querySelector(P.TITLE).title=e.title;const a=t.querySelector(P.DIRECTOR);a.textContent="",e.directors&&e.directors.split(", ").forEach((A,k,R)=>{const U=N("a",{textContent:A.trim(),href:"#",dataset:{directorName:A.trim()}});a.append(U,k<R.length-1?", ":"")});const l=e.type?.toUpperCase().startsWith("S.");let c=e.year||"N/A";l&&e.year_end&&(c+=e.year_end==="M"?" (M)":e.year_end==="-"?"-":`-${e.year_end.toString().slice(-2)}`),t.querySelector(P.YEAR).textContent=c,In(t.querySelector(P.COUNTRY_CONTAINER),t.querySelector(P.COUNTRY_FLAG),e.country_code,e.country);const u=t.querySelector(".card-icons-line");u&&(u.innerHTML="",[...e.studios_list?.split(",")||[],...e.selections_list?.split(",")||[]].forEach(k=>{const R=is[k];R&&u.appendChild(N("span",{className:`platform-icon ${R.class||""}`,title:R.title,innerHTML:`<svg width="${R.w||24}" height="${R.h||24}" fill="currentColor" viewBox="${R.vb||"0 0 24 24"}"><use href="${ja}#${R.id}"></use></svg>`}))}));const h=s.querySelector('[data-template="wall-rating"]');h&&(h.textContent=e.avg_rating?e.avg_rating.toFixed(1):"");const d=r.querySelector(".back-original-title-wrapper");e.original_title&&e.original_title.trim()?(d.querySelector('[data-template="original-title"]').textContent=e.original_title,d.style.display="flex"):d.style.display="none",r.querySelector(P.DURATION).textContent=Rn(e.minutes,l);const f=r.querySelector('[data-template="episodes"]'),g=l&&e.episodes?`${e.episodes} x`:"";f.textContent=g,f.style.display=g?"inline":"none";const p=(A,k)=>{const R=r.querySelector(`[data-template="${A}-link"]`);k?(R.href=k,R.classList.remove("disabled"),R.setAttribute("aria-label",`Ver en ${A}`),R.style.display="flex"):(R.removeAttribute("href"),R.classList.add("disabled"),R.removeAttribute("aria-label"),R.style.display="flex")};p("justwatch",e.justwatch),p("wikipedia",e.wikipedia),r.querySelector(P.GENRE).textContent=e.genres||"Género no disponible",r.querySelector(P.SYNOPSIS).textContent=e.synopsis||"Sinopsis no disponible.";const y=r.querySelector('[data-template="critic-container"]');e.critic?.trim()?(y.querySelector('[data-template="critic"]').textContent=e.critic,y.style.display="block"):y.style.display="none";const _=r.querySelector(P.ACTORS),w=e.actors?e.actors.split(",").map(A=>A.trim()):[];let m=w.slice(0,4).join(", ");w.length>4&&(m+="..."),e.actors==="(A)"&&(m="Animación"),_.textContent=m||"Reparto no disponible";const v=w.length>0&&!lt.includes(e.actors?.toLowerCase()),O=_.parentElement.querySelector(".actors-expand-btn");if(v){O||_.parentElement.appendChild(N("button",{className:"actors-expand-btn",textContent:"+",attributes:{"aria-label":"Ver reparto"}}));let A=r.querySelector(".actors-scrollable-content");if(!A){A=N("div",{className:"actors-scrollable-content"}),A.innerHTML='<h4>Reparto</h4><div class="actors-list-text"></div>';const k=A.querySelector(".actors-list-text");w.forEach(R=>{lt.includes(R.toLowerCase())?k.appendChild(N("span",{className:"actor-list-item",textContent:R})):k.appendChild(N("button",{type:"button",className:"actor-list-item",textContent:R,dataset:{actorName:R}}))}),r.insertBefore(A,r.querySelector(".expand-content-btn"))}}else O?.remove(),r.querySelector(".actors-scrollable-content")?.remove();Pa(r,e)}function Ve(s){const e=parseInt(s.dataset.movieId,10);if(!s.movieData)return;const r=Ce(e);r?.rating;const n=r?.onWatchlist??!1,i=s.querySelector('[data-action="toggle-watchlist"]');i&&(i.classList.toggle("is-active",n),i.setAttribute("aria-label",n?"Quitar de lista":"Añadir a lista")),tr(s)}function Ba(s){const e=s.querySelector('[data-action="set-rating-estrellas"]');e&&Ca(e,document.body.classList.contains("user-logged-in"))}function ss(s,e){const t=++qe;if(rr=0,pr(),!s)return;bt(s),s.textContent="";const r=12;let n=0;function i(){if(t!==qe||n>=e.length||!document.body.contains(s))return;const o=document.createDocumentFragment(),a=Math.min(n+r,e.length);for(let l=n;l<a;l++){const c=e[l],u=La.content.cloneNode(!0),h=u.querySelector(`.${te.MOVIE_CARD}`);h.dataset.movieId=c.id,h.movieData=c,c.id&&(h.style.viewTransitionName=`movie-${c.id}`),h.style.setProperty("--card-index",l),Ma(h,c),Ve(h),Ba(h),rr++,o.appendChild(u)}s.appendChild(o),n=a,n<e.length&&requestAnimationFrame(i)}i()}function Fa(s,e){if(qe++,s&&(bt(s),s.textContent=""),e&&(e.textContent=""),!s)return;const t=document.createDocumentFragment();for(let r=0;r<I.ITEMS_PER_PAGE;r++)t.appendChild(N("div",{className:"skeleton-card"}));s.appendChild(t)}function qa(s,e,t){if(qe++,s&&(bt(s),s.textContent=""),e&&(e.textContent=""),!s)return;const r=N("div",{className:"no-results",attributes:{role:"status"}});r.appendChild(N("h3",{textContent:"No se encontraron resultados"}));const n=Object.values(t).some(o=>o&&o!=="id,asc"&&o!=="all"),i=t.searchTerm?`Prueba a simplificar tu búsqueda para "${t.searchTerm}".`:n?"Intenta eliminar algunos filtros.":"";i&&r.appendChild(N("p",{textContent:i})),r.appendChild(N("button",{id:"clear-filters-from-empty",className:"btn btn--outline",textContent:"Limpiar filtros"})),s.appendChild(r)}function Wa(s,e,t){qe++,s&&(bt(s),s.textContent=""),e&&(e.textContent="");const r=N("div",{className:"no-results",attributes:{role:"alert"}});r.appendChild(N("h3",{textContent:"¡Vaya! Algo ha ido mal"})),r.appendChild(N("p",{textContent:t})),s?.appendChild(r)}let J=null;async function gn(){if(J)return J;try{return J=await at(()=>import("./sidebar-CDbI5kb0.js"),__vite__mapDeps([0,1,2]),import.meta.url),J.initSidebar(),J}catch(s){console.error("Error loading sidebar",s)}}const pn={q:"searchTerm",genre:"genre",year:"year",country:"country",dir:"director",actor:"actor",sel:"selection",stu:"studio",sort:"sort",type:"mediaType",p:"page",exg:"excludedGenres",exc:"excludedCountries"},Ue=Object.fromEntries(Object.entries(pn).map(([s,e])=>[e,s]));async function re(s=1){const t=os("movie-grid-load").signal;Xt(s),Qa(),Za(),document.body.classList.add("is-fetching"),S.gridContainer.classList.add("is-fetching"),S.gridContainer.setAttribute("aria-busy","true"),Fa(S.gridContainer,S.paginationContainer);const r=ke().totalMovies;st(Fe(),r),window.scrollTo({top:0,behavior:"auto"});const n=!!document.startViewTransition;await(async()=>{try{const o=s===1?I.DYNAMIC_PAGE_SIZE_LIMIT:I.ITEMS_PER_PAGE,a=s===1||r===0,l=await er(de(),s,o,t,a);if(l.aborted)return;const{items:c,total:u}=l;c&&c.length>0&&Pn(c[0]);const h=()=>{const d=u>=0?u:r;Va(c,d),s===1&&window.innerWidth<=700&&window.scrollTo({top:0,behavior:"auto"})};n?document.startViewTransition(h):h()}catch(o){if(o.name==="AbortError")return;console.error("Error en carga (Main):",o);const a=Cn(o);if(a&&Ae(a,"error"),Wa(S.gridContainer,S.paginationContainer,a||"Error desconocido"),a)throw new Error(a)}finally{t.aborted||(document.body.classList.remove("is-fetching"),S.gridContainer.classList.remove("is-fetching"),S.gridContainer.setAttribute("aria-busy","false"))}})()}function Va(s,e){oa(e),va(e,ia());const t=ke();if(t.totalMovies===0)qa(S.gridContainer,S.paginationContainer,de()),st(1,0);else if(t.totalMovies<=I.DYNAMIC_PAGE_SIZE_LIMIT&&t.currentPage===1)ss(S.gridContainer,s),S.paginationContainer.textContent="",st(1,1);else{const r=I.ITEMS_PER_PAGE,n=s.slice(0,r);ss(S.gridContainer,n),t.totalMovies>r?fa(S.paginationContainer,t.totalMovies,t.currentPage):S.paginationContainer.textContent="",st(t.currentPage,t.totalMovies)}t.totalMovies>0&&ga(t.currentPage,t.totalMovies,de())}async function za(s){Se(s.target),document.dispatchEvent(new CustomEvent("uiActionTriggered")),pt(S.sortSelect.value),await re(1)}async function Ha(s){Se(s.currentTarget),document.dispatchEvent(new CustomEvent("uiActionTriggered"));const e=ke().activeFilters.mediaType,t={all:"movies",movies:"series",series:"all"};Zt(t[e]),gr(t[e]),await re(1)}async function $t(){const s=S.searchInput.value.trim();s!==ke().activeFilters.searchTerm&&(s.length>=3||s.length===0)&&(document.dispatchEvent(new CustomEvent("uiActionTriggered")),on(s)&&Ae("Filtros de Actor/Director limpiados","info"),document.dispatchEvent(new CustomEvent("updateSidebarUI")),await re(1))}let Ut=!1,ot=0;function Ga(){Ut||(window.requestAnimationFrame(()=>{const s=window.scrollY;if(S.mainHeader.classList.toggle(te.IS_SCROLLED,s>10),window.innerWidth<=700){const e=document.activeElement===S.searchInput,t=window.visualViewport&&window.visualViewport.height<window.innerHeight*.9;if(e||S.mainHeader.classList.contains("is-search-focused")||t)S.mainHeader.classList.remove("is-hidden-mobile");else{const r=s>ot,n=Math.abs(s-ot);window.innerHeight+s>=document.documentElement.scrollHeight-50?S.mainHeader.classList.remove("is-hidden-mobile"):n>5&&S.mainHeader.classList.toggle("is-hidden-mobile",r&&s>60)}}ot=s,Ut=!1}),Ut=!0)}function Ka(s){const{keepSort:e,newFilter:t}=s.detail||{},r=e?ke().activeFilters.sort:ee.SORT;an(),pt(r),t&&Qt(t.type,t.value),S.searchInput.value="",S.sortSelect.value=r,gr(ee.MEDIA_TYPE),document.dispatchEvent(new CustomEvent("updateSidebarUI")),re(1)}function Ja(){const s=kn($t,I.SEARCH_DEBOUNCE_DELAY);S.searchInput.addEventListener("input",s),S.searchForm.addEventListener("submit",i=>{i.preventDefault(),$t()}),S.searchInput.addEventListener("focus",()=>S.mainHeader.classList.add("is-search-focused")),S.searchInput.addEventListener("blur",()=>S.mainHeader.classList.remove("is-search-focused")),S.sortSelect.addEventListener("change",za),S.typeFilterToggle.addEventListener("click",Ha);const e=document.getElementById("mobile-sidebar-toggle");e&&e.addEventListener("click",async()=>{const i=await gn();if(!i)return;Ne("light"),document.body.classList.contains("sidebar-is-open")?i.closeMobileDrawer():i.openMobileDrawer()});const t=async i=>{const o=Fe(),a=Math.ceil(ke().totalMovies/I.ITEMS_PER_PAGE),l=o+i;l>0&&l<=a&&(document.dispatchEvent(new CustomEvent("uiActionTriggered")),await re(l))};S.headerPrevBtn.addEventListener("click",i=>{Se(i.currentTarget),t(-1)}),S.headerNextBtn.addEventListener("click",i=>{Se(i.currentTarget),t(1)});const r=S.searchForm.querySelector(".search-icon--clear");r&&r.addEventListener("pointerdown",i=>{i.preventDefault(),i.stopPropagation(),S.searchInput.value="",S.searchInput.focus(),$t()});const n=()=>{S.searchInput&&(S.searchInput.placeholder=window.innerWidth<=700?"":"Título")};window.addEventListener("resize",n),n()}function Ya(){document.addEventListener("click",e=>{e.target.closest(P.SIDEBAR_FILTER_FORM)||Ea(),!e.target.closest(".sidebar")&&J&&J.collapseAllSections()}),S.gridContainer.addEventListener("click",function(e){const t=e.target.closest(".movie-card");if(t){rs.call(t,e);return}e.target.closest("#clear-filters-from-empty")&&document.dispatchEvent(new CustomEvent("filtersReset"))}),Na(S.gridContainer),document.getElementById("quick-view-content").addEventListener("click",function(e){rs.call(this,e)}),S.paginationContainer.addEventListener("click",async e=>{const t=e.target.closest(".btn[data-page]");if(t){document.dispatchEvent(new CustomEvent("uiActionTriggered")),Se(t);const r=parseInt(t.dataset.page,10);await re(r)}}),ot=window.scrollY,window.addEventListener("scroll",Ga,{passive:!0}),document.addEventListener("keydown",e=>{if(e.key==="Escape"&&document.body.classList.contains(te.SIDEBAR_OPEN)){if(document.body.classList.contains("modal-open"))return;J&&J.closeMobileDrawer()}}),document.addEventListener("card:requestUpdate",e=>{e.detail.cardElement&&Ve(e.detail.cardElement)});const s=()=>document.querySelectorAll(".movie-card").forEach(Ve);document.addEventListener("userMovieDataChanged",s),document.addEventListener("userDataUpdated",s),document.addEventListener("filtersReset",Ka)}function Xa(){const s=document.getElementById("user-avatar-initials"),e=document.getElementById("logout-button");async function t(i){document.body.classList.add("user-logged-in");const o=i.email||"";s.textContent=o.charAt(0).toUpperCase(),s.title=`Sesión iniciada como: ${o}`;try{const a=await ha();aa(a),document.dispatchEvent(new CustomEvent("userDataUpdated"))}catch(a){Ae(a.message,"error")}}function r(){document.body.classList.remove("user-logged-in"),s.textContent="",s.title="",la(),document.dispatchEvent(new CustomEvent("userDataUpdated"))}async function n(){const{error:i}=await Y.auth.signOut();i&&(console.error("Logout error:",i),Ae("Error al cerrar sesión.","error"))}e&&e.addEventListener("click",n),Y.auth.onAuthStateChange((i,o)=>{o?.user?t(o.user):r()})}function Qa(){const{searchTerm:s,genre:e,year:t,country:r,director:n,actor:i,selection:o,studio:a,mediaType:l}=de();let c="Películas y series";l==="movies"?c="Películas":l==="series"&&(c="Series");let u=c;const h=t&&t!==`${I.YEAR_MIN}-${I.YEAR_MAX}`?` (${t.replace("-"," a ")})`:"";if(s)u=`Resultados para "${s}"`;else if(o){const d=Sn.selection,f=d.titles?.[o]||d.items[o];f&&(u=f+h)}else a?u=(is[a]?.title||u)+h:e?u=`${c} de ${e}`:n?u=`${c} de ${n}`:i?u=`${c} con ${i}`:t&&t!==`${I.YEAR_MIN}-${I.YEAR_MAX}`?u=`${c} de ${t.replace("-"," a ")}`:r&&(u=`${c} de ${r}`);document.title=`${u} | videoclub.digital`}function ns(){an();const s=new URLSearchParams(window.location.search);Object.entries(pn).forEach(([t,r])=>{const n=s.get(t);n!==null&&(r==="page"?Xt(parseInt(n,10)||1):r==="searchTerm"?on(n):r==="sort"?pt(n):r==="mediaType"?Zt(n):r==="excludedGenres"||r==="excludedCountries"?Qt(r,n.split(","),!0):Qt(r,n,!0))}),s.has(Ue.sort)||pt(ee.SORT),s.has(Ue.mediaType)||Zt(ee.MEDIA_TYPE),s.has(Ue.page)||Xt(1);const e=de();S.searchInput.value=e.searchTerm,S.sortSelect.value=e.sort,gr(e.mediaType)}function Za(){const s=new URLSearchParams,e=de(),t=Fe();Object.entries(e).forEach(([n,i])=>{const o=Ue[n];if(o){if(Array.isArray(i)&&i.length>0)s.set(o,i.join(","));else if(typeof i=="string"&&i.trim()!==""){if(n==="mediaType"&&i===ee.MEDIA_TYPE||n==="sort"&&i===ee.SORT||n==="year"&&i===`${I.YEAR_MIN}-${I.YEAR_MAX}`)return;s.set(o,i)}}}),t>1&&s.set(Ue.page,t);const r=s.toString()?`${window.location.pathname}?${s.toString()}`:window.location.pathname;r!==`${window.location.pathname}${window.location.search}`&&history.pushState({path:r},"",r)}function el(){requestAnimationFrame(()=>{document.querySelectorAll("[data-loading]").forEach(t=>{t.removeAttribute("data-loading")})}),Ln.get("rotationState")==="disabled"&&document.body.classList.add("rotation-disabled"),"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("sw.js").catch(t=>console.error("Fallo SW:",t))}),window.addEventListener("popstate",async()=>{const{closeModal:t}=await at(async()=>{const{closeModal:r}=await import("./modal-D9ZXnSza.js");return{closeModal:r}},[],import.meta.url);t(),ns(),document.dispatchEvent(new CustomEvent("updateSidebarUI")),re(Fe())}),(window.requestIdleCallback||(t=>setTimeout(t,1e3)))(()=>gn()),ba(),Ja(),Ya(),Xa(),wa();const e=document.getElementById("login-button");e&&e.addEventListener("click",async()=>{try{const{initAuthForms:t}=await at(async()=>{const{initAuthForms:r}=await import("./auth-OA7bFgmR.js");return{initAuthForms:r}},[],import.meta.url);t()}catch(t){console.error("Error loading auth module",t)}},{once:!0}),ns(),document.dispatchEvent(new CustomEvent("updateSidebarUI")),re(Fe())}document.addEventListener("DOMContentLoaded",el);export{ya as A,Pa as B,te as C,Ve as D,Ba as E,Sn as F,In as G,Rn as H,Et as I,lt as J,Y as K,Ln as L,Xr as M,P as S,is as a,yl as b,N as c,I as d,kn as e,pl as f,de as g,Se as h,Ea as i,fl as j,gl as k,dl as l,hl as m,ul as n,Ae as o,re as p,Qt as q,an as r,ja as s,Ne as t,pr as u,pt as v,Zt as w,rl as x,nn as y,_a as z};
