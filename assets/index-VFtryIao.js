function Vo(r,e){for(var t=0;t<e.length;t++){const s=e[t];if(typeof s!="string"&&!Array.isArray(s)){for(const n in s)if(n!=="default"&&!(n in r)){const i=Object.getOwnPropertyDescriptor(s,n);i&&Object.defineProperty(r,n,i.get?i:{enumerable:!0,get:()=>s[n]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();const Wo="https://wibygecgfczcvaqewleq.supabase.co",Ho="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndpYnlnZWNnZmN6Y3ZhcWV3bGVxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQyNTQzOTYsImV4cCI6MjA2OTgzMDM5Nn0.rmTThnjKCQDbwY-_3Xa2ravmUyChgiXNE9tLq2upkOc",zo=Wo,Go=Ho,N={SUPABASE_URL:zo,SUPABASE_ANON_KEY:Go,POSTER_BASE_URL:"https://wibygecgfczcvaqewleq.supabase.co/storage/v1/object/public/posters/",ITEMS_PER_PAGE:42,DYNAMIC_PAGE_SIZE_LIMIT:56,MAX_ACTIVE_FILTERS:20,MAX_EXCLUDED_FILTERS:20,SEARCH_DEBOUNCE_DELAY:400,YEAR_MIN:1926,YEAR_MAX:2025,STORAGE_VERSION:1},Et=["(a)","animación","animacion","documental"],Me={SORT:"relevance,asc",MEDIA_TYPE:"all"},ae={ACTIVE:"active",IS_SCROLLED:"is-scrolled",SIDEBAR_OPEN:"sidebar-is-open",MOVIE_CARD:"movie-card",SIDEBAR_AUTOCOMPLETE_ITEM:"sidebar-autocomplete-item",TYPE_FILTER_MOVIES:"type-filter--movies",TYPE_FILTER_SERIES:"type-filter--series",LAZY_LQIP:"lazy-lqip",LOADED:"loaded"},M={TITLE:'[data-template="title"]',DIRECTOR:'[data-template="director"]',YEAR:'[data-template="year"]',COUNTRY_CONTAINER:'[data-template="country-container"]',COUNTRY_FLAG:'[data-template="country-flag"]',DURATION:'[data-template="duration"]',GENRE:'[data-template="genre"]',ACTORS:'[data-template="actors"]',SYNOPSIS:'[data-template="synopsis"]',GRID_CONTAINER:"#grid-container",PAGINATION_CONTAINER:"#pagination-container",SEARCH_FORM:"#search-form",SEARCH_INPUT:"#search-input",SORT_SELECT:"#sort-select",THEME_TOGGLE:"#theme-toggle",SIDEBAR_OVERLAY:"#sidebar-overlay",TYPE_FILTER_TOGGLE:"#type-filter-toggle",HEADER_PREV_BTN:"#header-prev-btn",HEADER_NEXT_BTN:"#header-next-btn",AUTOCOMPLETE_RESULTS:"#autocomplete-results",CLEAR_FILTERS_BTN:"#clear-filters-btn",YEAR_SLIDER:"#year-slider",YEAR_START_INPUT:"#year-start-input",YEAR_END_INPUT:"#year-end-input",TOAST_CONTAINER:"#toast-container",MOVIE_CARD_TEMPLATE:"#movie-card-template",SIDEBAR_FILTER_FORM:".sidebar-filter-form",SIDEBAR_AUTOCOMPLETE_RESULTS:".sidebar-autocomplete-results",SIDEBAR_FILTER_INPUT:".sidebar-filter-input"},we={PAUSE:'<svg class="sidebar-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>',SQUARE_STOP:'<svg class="sidebar-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect></svg>',REWIND:'<svg class="sidebar-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 19 2 12 11 5 11 19"></polygon><polygon points="22 19 13 12 22 5 22 19"></polygon></svg>',FORWARD:'<svg class="sidebar-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 19 22 12 13 5 13 19"></polygon><polygon points="2 19 11 12 2 5 2 19"></polygon></svg>',PAUSE_SMALL:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 11v6"/><path d="M14 11v6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/><path d="M3 6h18"/><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>',CHEVRON_RIGHT:'<svg class="chevron-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>',POPCORN:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 7 3 5m6 1V3m4 4 2-2"/><circle cx="9" cy="13" r="3"/><path d="M11.83 12H20a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h2.17M16 16h2"/></svg>',CLAPPERBOARD:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.2 6 3 11l-.9-2.4c-.3-1.1.3-2.2 1.3-2.5l13.5-4c1.1-.3 2.2.3 2.5 1.3Zm-14-.7 3.1 3.9m3.1-5.8 3.1 4M3 11h18v8a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2Z"/></svg>',TV:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m17 2-5 5-5-5"/><rect width="20" height="15" x="2" y="7" rx="2"/></svg>'},St={N:{id:"icon-netflix",class:"netflix-icon",title:"Netflix"},D:{id:"icon-disney",class:"disney-icon",title:"Disney"},W:{id:"icon-wb",class:"wb-icon",title:"Warner Bros."},U:{id:"icon-universal",class:"universal-icon",title:"Universal"},S:{id:"icon-sony",class:"sony-icon",title:"Sony-Columbia"},P:{id:"icon-paramount",class:"paramount-icon",title:"Paramount"},L:{id:"icon-lionsgate",class:"lionsgate-icon",title:"Lionsgate"},Z:{id:"icon-amazon",class:"amazon-icon",title:"Amazon MGM"},F:{id:"icon-twenty",class:"twenty-icon",title:"20th Century Fox"},2:{id:"icon-a24",class:"a24-icon",title:"A24"},O:{id:"icon-movistar",class:"movistar-icon",title:"Movistar"},X:{id:"icon-miramax",class:"miramax-icon",title:"Miramax"}},Ye={selection:{label:"Selección",items:{C:"Criterion",M:"1001 Movies",A:"Arrow",K:"Kino Lorber",E:"Eureka",H:"Series HBO",T:"A Contra+"},titles:{C:"Colección Criterion",M:"1001 Películas que ver",A:"Arrow Video",H:"Series de HBO",T:"A Contracorriente"}},studio:{label:"Estudios",items:{D:"Disney",W:"Warner Bros.",P:"Paramount",U:"Universal",S:"Sony",N:"Netflix",Z:"Amazon",L:"Lionsgate",F:"20th Century",2:"A24",O:"Movistar",X:"Miramax"}},genre:{label:"Géneros",items:{Drama:"Drama",Comedia:"Comedia",Thriller:"Thriller",Acción:"Acción",Animación:"Animación",Documental:"Documental"},excludable:["Animación","Documental"]},country:{label:"Países",items:{EEUU:"EEUU",España:"España",UK:"UK",Francia:"Francia",Japón:"Japón",Italia:"Italia"},excludable:["EEUU"]},director:{label:"Directores",items:{}},actor:{label:"Actores",items:{}}},Ko="/videoclub.digital/assets/flags-CqS_mVee.svg",Js=(r,e)=>{const t=parseInt(String(r).replace(/\D/g,""),10);return isNaN(t)||t===0?"":t>=1e6?new Intl.NumberFormat("es-ES",{notation:"compact",maximumFractionDigits:1}).format(t).replace("M"," M"):t>=1e5?`${Math.floor(t/1e3)} k`:t<3e3?(Math.ceil(t/100)*100).toString().replace(/\B(?=(\d{3})+(?!\d))/g,"."):e==="imdb"?(Math.ceil(t/1e3)*1e3).toString().replace(/\B(?=(\d{3})+(?!\d))/g,"."):e==="fa"?(Math.ceil(t/100)*100).toString().replace(/\B(?=(\d{3})+(?!\d))/g,"."):t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")},zn=(r,e=!1)=>{const t=parseInt(r,10);if(isNaN(t)||t<=0)return"";if(e)return`${t} min`;const s=Math.floor(t/60),n=t%60,i="min";return s>0&&n===0?`${s}h`:s>0?`${s}h ${n}${i}`:`${n}${i}`},Ys=r=>r?r.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""):"",Jo=(r,e)=>{const t=document.createDocumentFragment();if(!r)return t;if(!e)return t.textContent=r,t;const s=Ys(r),n=Ys(e),i=s.indexOf(n);if(i===-1)return t.textContent=r,t;const o=r.substring(0,i),a=r.substring(i,i+n.length),l=r.substring(i+n.length);t.appendChild(document.createTextNode(o));const c=document.createElement("strong");return c.textContent=a,t.appendChild(c),t.appendChild(document.createTextNode(l)),t},ps=(r,e)=>{let t;return function(...s){const n=this;clearTimeout(t),t=setTimeout(()=>r.apply(n,s),e)}};function Yo(r){return r instanceof TypeError&&r.message.includes("Failed to fetch")?"Error de conexión. Comprueba tu internet.":r.name==="AbortError"?null:"Ha ocurrido un error inesperado. Inténtalo más tarde."}const Dt=new Map;function Gn(r){const e=Dt.get(r);e&&(e.abort(),Dt.delete(r));const t=new AbortController;return Dt.set(r,t),t.signal.addEventListener("abort",()=>{Dt.delete(r)},{once:!0}),t}function Kn(r,e,t,s=""){if(r)if(t&&e){const n=t.toLowerCase();r.style.display="flex",e.className="country-flag-icon",e.title=s||"",e.innerHTML=`
      <svg width="16" height="16">
        <use href="${Ko}#flag-${n}"></use>
      </svg>
    `}else r.style.display="none"}function q(r,e={}){const t=document.createElement(r);for(const[s,n]of Object.entries(e))if(s==="dataset")Object.assign(t.dataset,n);else if(s==="attributes")for(const[i,o]of Object.entries(n))t.setAttribute(i,o);else s==="innerHTML"?t.innerHTML=n:t[s]=n;return t}const Ie=r=>{r&&(r.classList.remove("pop-animation"),r.offsetWidth,r.classList.add("pop-animation"),r.addEventListener("animationend",()=>r.classList.remove("pop-animation"),{once:!0}))};function Xo(r){if(!r?.image||r.image===".")return;const e=r.last_synced_at?new Date(r.last_synced_at).getTime():"1",t=`${N.POSTER_BASE_URL}${r.image}.webp?v=${e}`;if(document.querySelector(`link[rel="preload"][href="${t}"]`))return;const s=document.createElement("link");s.rel="preload",s.as="image",s.href=t,s.setAttribute("fetchpriority","high"),s.onload=()=>s.remove(),s.onerror=()=>s.remove(),document.head.appendChild(s)}function he(r="light"){if("vibrate"in navigator&&!window.matchMedia("(prefers-reduced-motion: reduce)").matches)try{switch(r){case"light":navigator.vibrate(10);break;case"medium":navigator.vibrate(20);break;case"success":navigator.vibrate([10,50,20]);break}}catch{}}const Jn={get(r){try{const e=localStorage.getItem(r);if(!e)return null;try{const t=JSON.parse(e);if(t&&typeof t=="object"&&"v"in t&&"d"in t)return t.v!==N.STORAGE_VERSION?null:t.d}catch{return null}return null}catch{return null}},set(r,e){try{const t={v:N.STORAGE_VERSION,d:e};localStorage.setItem(r,JSON.stringify(t))}catch(t){console.warn("LocalStore write failed",t)}}};var zr=function(r,e){return zr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,s){t.__proto__=s}||function(t,s){for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])},zr(r,e)};function Yn(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");zr(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Qt=function(){return Qt=Object.assign||function(e){for(var t,s=1,n=arguments.length;s<n;s++){t=arguments[s];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},Qt.apply(this,arguments)};function dt(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(r);n<s.length;n++)e.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(r,s[n])&&(t[s[n]]=r[s[n]]);return t}function Xn(r,e,t,s){var n=arguments.length,i=n<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,s);else for(var a=r.length-1;a>=0;a--)(o=r[a])&&(i=(n<3?o(i):n>3?o(e,t,i):o(e,t))||i);return n>3&&i&&Object.defineProperty(e,t,i),i}function Qn(r,e){return function(t,s){e(t,s,r)}}function Zn(r,e,t,s,n,i){function o(_){if(_!==void 0&&typeof _!="function")throw new TypeError("Function expected");return _}for(var a=s.kind,l=a==="getter"?"get":a==="setter"?"set":"value",c=!e&&r?s.static?r:r.prototype:null,u=e||(c?Object.getOwnPropertyDescriptor(c,s.name):{}),d,g=!1,f=t.length-1;f>=0;f--){var v={};for(var y in s)v[y]=y==="access"?{}:s[y];for(var y in s.access)v.access[y]=s.access[y];v.addInitializer=function(_){if(g)throw new TypeError("Cannot add initializers after decoration has completed");i.push(o(_||null))};var w=(0,t[f])(a==="accessor"?{get:u.get,set:u.set}:u[l],v);if(a==="accessor"){if(w===void 0)continue;if(w===null||typeof w!="object")throw new TypeError("Object expected");(d=o(w.get))&&(u.get=d),(d=o(w.set))&&(u.set=d),(d=o(w.init))&&n.unshift(d)}else(d=o(w))&&(a==="field"?n.unshift(d):u[l]=d)}c&&Object.defineProperty(c,s.name,u),g=!0}function ei(r,e,t){for(var s=arguments.length>2,n=0;n<e.length;n++)t=s?e[n].call(r,t):e[n].call(r);return s?t:void 0}function ti(r){return typeof r=="symbol"?r:"".concat(r)}function ri(r,e,t){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(r,"name",{configurable:!0,value:t?"".concat(t," ",e):e})}function si(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)}function R(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(u){try{c(s.next(u))}catch(d){o(d)}}function l(u){try{c(s.throw(u))}catch(d){o(d)}}function c(u){u.done?i(u.value):n(u.value).then(a,l)}c((s=s.apply(r,e||[])).next())})}function ni(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},s,n,i,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(u){return l([c,u])}}function l(c){if(s)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(t=0)),t;)try{if(s=1,n&&(i=c[0]&2?n.return:c[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,c[1])).done)return i;switch(n=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,n=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(r,t)}catch(u){c=[6,u],n=0}finally{s=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}var dr=Object.create?(function(r,e,t,s){s===void 0&&(s=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,s,n)}):(function(r,e,t,s){s===void 0&&(s=t),r[s]=e[t]});function ii(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&dr(e,r,t)}function Zt(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],s=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&s>=r.length&&(r=void 0),{value:r&&r[s++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ms(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var s=t.call(r),n,i=[],o;try{for(;(e===void 0||e-- >0)&&!(n=s.next()).done;)i.push(n.value)}catch(a){o={error:a}}finally{try{n&&!n.done&&(t=s.return)&&t.call(s)}finally{if(o)throw o.error}}return i}function oi(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(ms(arguments[e]));return r}function ai(){for(var r=0,e=0,t=arguments.length;e<t;e++)r+=arguments[e].length;for(var s=Array(r),n=0,e=0;e<t;e++)for(var i=arguments[e],o=0,a=i.length;o<a;o++,n++)s[n]=i[o];return s}function li(r,e,t){if(t||arguments.length===2)for(var s=0,n=e.length,i;s<n;s++)(i||!(s in e))&&(i||(i=Array.prototype.slice.call(e,0,s)),i[s]=e[s]);return r.concat(i||Array.prototype.slice.call(e))}function ut(r){return this instanceof ut?(this.v=r,this):new ut(r)}function ci(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=t.apply(r,e||[]),n,i=[];return n=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),n[Symbol.asyncIterator]=function(){return this},n;function o(f){return function(v){return Promise.resolve(v).then(f,d)}}function a(f,v){s[f]&&(n[f]=function(y){return new Promise(function(w,_){i.push([f,y,w,_])>1||l(f,y)})},v&&(n[f]=v(n[f])))}function l(f,v){try{c(s[f](v))}catch(y){g(i[0][3],y)}}function c(f){f.value instanceof ut?Promise.resolve(f.value.v).then(u,d):g(i[0][2],f)}function u(f){l("next",f)}function d(f){l("throw",f)}function g(f,v){f(v),i.shift(),i.length&&l(i[0][0],i[0][1])}}function ui(r){var e,t;return e={},s("next"),s("throw",function(n){throw n}),s("return"),e[Symbol.iterator]=function(){return this},e;function s(n,i){e[n]=r[n]?function(o){return(t=!t)?{value:ut(r[n](o)),done:!1}:i?i(o):o}:i}}function di(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof Zt=="function"?Zt(r):r[Symbol.iterator](),t={},s("next"),s("throw"),s("return"),t[Symbol.asyncIterator]=function(){return this},t);function s(i){t[i]=r[i]&&function(o){return new Promise(function(a,l){o=r[i](o),n(a,l,o.done,o.value)})}}function n(i,o,a,l){Promise.resolve(l).then(function(c){i({value:c,done:a})},o)}}function hi(r,e){return Object.defineProperty?Object.defineProperty(r,"raw",{value:e}):r.raw=e,r}var Qo=Object.create?(function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}):function(r,e){r.default=e},Gr=function(r){return Gr=Object.getOwnPropertyNames||function(e){var t=[];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[t.length]=s);return t},Gr(r)};function fi(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t=Gr(r),s=0;s<t.length;s++)t[s]!=="default"&&dr(e,r,t[s]);return Qo(e,r),e}function gi(r){return r&&r.__esModule?r:{default:r}}function pi(r,e,t,s){if(t==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?s:t==="a"?s.call(r):s?s.value:e.get(r)}function mi(r,e,t,s,n){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?n.call(r,t):n?n.value=t:e.set(r,t),t}function vi(r,e){if(e===null||typeof e!="object"&&typeof e!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof r=="function"?e===r:r.has(e)}function yi(r,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var s,n;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");s=e[Symbol.asyncDispose]}if(s===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");s=e[Symbol.dispose],t&&(n=s)}if(typeof s!="function")throw new TypeError("Object not disposable.");n&&(s=function(){try{n.call(this)}catch(i){return Promise.reject(i)}}),r.stack.push({value:e,dispose:s,async:t})}else t&&r.stack.push({async:!0});return e}var Zo=typeof SuppressedError=="function"?SuppressedError:function(r,e,t){var s=new Error(t);return s.name="SuppressedError",s.error=r,s.suppressed=e,s};function wi(r){function e(i){r.error=r.hasError?new Zo(i,r.error,"An error was suppressed during disposal."):i,r.hasError=!0}var t,s=0;function n(){for(;t=r.stack.pop();)try{if(!t.async&&s===1)return s=0,r.stack.push(t),Promise.resolve().then(n);if(t.dispose){var i=t.dispose.call(t.value);if(t.async)return s|=2,Promise.resolve(i).then(n,function(o){return e(o),n()})}else s|=1}catch(o){e(o)}if(s===1)return r.hasError?Promise.reject(r.error):Promise.resolve();if(r.hasError)throw r.error}return n()}function bi(r,e){return typeof r=="string"&&/^\.\.?\//.test(r)?r.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(t,s,n,i,o){return s?e?".jsx":".js":n&&(!i||!o)?t:n+i+"."+o.toLowerCase()+"js"}):r}const ea={__extends:Yn,__assign:Qt,__rest:dt,__decorate:Xn,__param:Qn,__esDecorate:Zn,__runInitializers:ei,__propKey:ti,__setFunctionName:ri,__metadata:si,__awaiter:R,__generator:ni,__createBinding:dr,__exportStar:ii,__values:Zt,__read:ms,__spread:oi,__spreadArrays:ai,__spreadArray:li,__await:ut,__asyncGenerator:ci,__asyncDelegator:ui,__asyncValues:di,__makeTemplateObject:hi,__importStar:fi,__importDefault:gi,__classPrivateFieldGet:pi,__classPrivateFieldSet:mi,__classPrivateFieldIn:vi,__addDisposableResource:yi,__disposeResources:wi,__rewriteRelativeImportExtension:bi},ta=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:yi,get __assign(){return Qt},__asyncDelegator:ui,__asyncGenerator:ci,__asyncValues:di,__await:ut,__awaiter:R,__classPrivateFieldGet:pi,__classPrivateFieldIn:vi,__classPrivateFieldSet:mi,__createBinding:dr,__decorate:Xn,__disposeResources:wi,__esDecorate:Zn,__exportStar:ii,__extends:Yn,__generator:ni,__importDefault:gi,__importStar:fi,__makeTemplateObject:hi,__metadata:si,__param:Qn,__propKey:ti,__read:ms,__rest:dt,__rewriteRelativeImportExtension:bi,__runInitializers:ei,__setFunctionName:ri,__spread:oi,__spreadArray:li,__spreadArrays:ai,__values:Zt,default:ea},Symbol.toStringTag,{value:"Module"})),ra=r=>r?(...e)=>r(...e):(...e)=>fetch(...e);class vs extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class sa extends vs{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Xs extends vs{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Qs extends vs{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Kr;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(Kr||(Kr={}));class na{constructor(e,{headers:t={},customFetch:s,region:n=Kr.Any}={}){this.url=e,this.headers=t,this.region=n,this.fetch=ra(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return R(this,arguments,void 0,function*(t,s={}){var n;let i,o;try{const{headers:a,method:l,body:c,signal:u,timeout:d}=s;let g={},{region:f}=s;f||(f=this.region);const v=new URL(`${this.url}/${t}`);f&&f!=="any"&&(g["x-region"]=f,v.searchParams.set("forceFunctionRegion",f));let y;c&&(a&&!Object.prototype.hasOwnProperty.call(a,"Content-Type")||!a)?typeof Blob<"u"&&c instanceof Blob||c instanceof ArrayBuffer?(g["Content-Type"]="application/octet-stream",y=c):typeof c=="string"?(g["Content-Type"]="text/plain",y=c):typeof FormData<"u"&&c instanceof FormData?y=c:(g["Content-Type"]="application/json",y=JSON.stringify(c)):y=c;let w=u;d&&(o=new AbortController,i=setTimeout(()=>o.abort(),d),u?(w=o.signal,u.addEventListener("abort",()=>o.abort())):w=o.signal);const _=yield this.fetch(v.toString(),{method:l||"POST",headers:Object.assign(Object.assign(Object.assign({},g),this.headers),a),body:y,signal:w}).catch(k=>{throw new sa(k)}),S=_.headers.get("x-relay-error");if(S&&S==="true")throw new Xs(_);if(!_.ok)throw new Qs(_);let b=((n=_.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),A;return b==="application/json"?A=yield _.json():b==="application/octet-stream"||b==="application/pdf"?A=yield _.blob():b==="text/event-stream"?A=_:b==="multipart/form-data"?A=yield _.formData():A=yield _.text(),{data:A,error:null,response:_}}catch(a){return{data:null,error:a,response:a instanceof Qs||a instanceof Xs?a.context:void 0}}finally{i&&clearTimeout(i)}})}}function ia(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function oa(r){if(Object.prototype.hasOwnProperty.call(r,"__esModule"))return r;var e=r.default;if(typeof e=="function"){var t=function s(){var n=!1;try{n=this instanceof s}catch{}return n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(s){var n=Object.getOwnPropertyDescriptor(r,s);Object.defineProperty(t,s,n.get?n:{enumerable:!0,get:function(){return r[s]}})}),t}var ce={};const ht=oa(ta);var $t={},Nt={},Mt={},Bt={},Ft={},qt={},Zs;function _i(){if(Zs)return qt;Zs=1,Object.defineProperty(qt,"__esModule",{value:!0});class r extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return qt.default=r,qt}var en;function Ei(){if(en)return Ft;en=1,Object.defineProperty(Ft,"__esModule",{value:!0});const e=ht.__importDefault(_i());class t{constructor(n){var i,o;this.shouldThrowOnError=!1,this.method=n.method,this.url=n.url,this.headers=new Headers(n.headers),this.schema=n.schema,this.body=n.body,this.shouldThrowOnError=(i=n.shouldThrowOnError)!==null&&i!==void 0?i:!1,this.signal=n.signal,this.isMaybeSingle=(o=n.isMaybeSingle)!==null&&o!==void 0?o:!1,n.fetch?this.fetch=n.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(n,i){return this.headers=new Headers(this.headers),this.headers.set(n,i),this}then(n,i){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const o=this.fetch;let a=o(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async l=>{var c,u,d,g;let f=null,v=null,y=null,w=l.status,_=l.statusText;if(l.ok){if(this.method!=="HEAD"){const k=await l.text();k===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((c=this.headers.get("Accept"))===null||c===void 0)&&c.includes("application/vnd.pgrst.plan+text"))?v=k:v=JSON.parse(k))}const b=(u=this.headers.get("Prefer"))===null||u===void 0?void 0:u.match(/count=(exact|planned|estimated)/),A=(d=l.headers.get("content-range"))===null||d===void 0?void 0:d.split("/");b&&A&&A.length>1&&(y=parseInt(A[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(v)&&(v.length>1?(f={code:"PGRST116",details:`Results contain ${v.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},v=null,y=null,w=406,_="Not Acceptable"):v.length===1?v=v[0]:v=null)}else{const b=await l.text();try{f=JSON.parse(b),Array.isArray(f)&&l.status===404&&(v=[],f=null,w=200,_="OK")}catch{l.status===404&&b===""?(w=204,_="No Content"):f={message:b}}if(f&&this.isMaybeSingle&&(!((g=f?.details)===null||g===void 0)&&g.includes("0 rows"))&&(f=null,w=200,_="OK"),f&&this.shouldThrowOnError)throw new e.default(f)}return{error:f,data:v,count:y,status:w,statusText:_}});return this.shouldThrowOnError||(a=a.catch(l=>{var c,u,d;return{error:{message:`${(c=l?.name)!==null&&c!==void 0?c:"FetchError"}: ${l?.message}`,details:`${(u=l?.stack)!==null&&u!==void 0?u:""}`,hint:"",code:`${(d=l?.code)!==null&&d!==void 0?d:""}`},data:null,count:null,status:0,statusText:""}})),a.then(n,i)}returns(){return this}overrideTypes(){return this}}return Ft.default=t,Ft}var tn;function Si(){if(tn)return Bt;tn=1,Object.defineProperty(Bt,"__esModule",{value:!0});const e=ht.__importDefault(Ei());class t extends e.default{select(n){let i=!1;const o=(n??"*").split("").map(a=>/\s/.test(a)&&!i?"":(a==='"'&&(i=!i),a)).join("");return this.url.searchParams.set("select",o),this.headers.append("Prefer","return=representation"),this}order(n,{ascending:i=!0,nullsFirst:o,foreignTable:a,referencedTable:l=a}={}){const c=l?`${l}.order`:"order",u=this.url.searchParams.get(c);return this.url.searchParams.set(c,`${u?`${u},`:""}${n}.${i?"asc":"desc"}${o===void 0?"":o?".nullsfirst":".nullslast"}`),this}limit(n,{foreignTable:i,referencedTable:o=i}={}){const a=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(a,`${n}`),this}range(n,i,{foreignTable:o,referencedTable:a=o}={}){const l=typeof a>"u"?"offset":`${a}.offset`,c=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(l,`${n}`),this.url.searchParams.set(c,`${i-n+1}`),this}abortSignal(n){return this.signal=n,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:n=!1,verbose:i=!1,settings:o=!1,buffers:a=!1,wal:l=!1,format:c="text"}={}){var u;const d=[n?"analyze":null,i?"verbose":null,o?"settings":null,a?"buffers":null,l?"wal":null].filter(Boolean).join("|"),g=(u=this.headers.get("Accept"))!==null&&u!==void 0?u:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${c}; for="${g}"; options=${d};`),c==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(n){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${n}`),this}}return Bt.default=t,Bt}var rn;function ys(){if(rn)return Mt;rn=1,Object.defineProperty(Mt,"__esModule",{value:!0});const e=ht.__importDefault(Si()),t=new RegExp("[,()]");class s extends e.default{eq(i,o){return this.url.searchParams.append(i,`eq.${o}`),this}neq(i,o){return this.url.searchParams.append(i,`neq.${o}`),this}gt(i,o){return this.url.searchParams.append(i,`gt.${o}`),this}gte(i,o){return this.url.searchParams.append(i,`gte.${o}`),this}lt(i,o){return this.url.searchParams.append(i,`lt.${o}`),this}lte(i,o){return this.url.searchParams.append(i,`lte.${o}`),this}like(i,o){return this.url.searchParams.append(i,`like.${o}`),this}likeAllOf(i,o){return this.url.searchParams.append(i,`like(all).{${o.join(",")}}`),this}likeAnyOf(i,o){return this.url.searchParams.append(i,`like(any).{${o.join(",")}}`),this}ilike(i,o){return this.url.searchParams.append(i,`ilike.${o}`),this}ilikeAllOf(i,o){return this.url.searchParams.append(i,`ilike(all).{${o.join(",")}}`),this}ilikeAnyOf(i,o){return this.url.searchParams.append(i,`ilike(any).{${o.join(",")}}`),this}is(i,o){return this.url.searchParams.append(i,`is.${o}`),this}in(i,o){const a=Array.from(new Set(o)).map(l=>typeof l=="string"&&t.test(l)?`"${l}"`:`${l}`).join(",");return this.url.searchParams.append(i,`in.(${a})`),this}contains(i,o){return typeof o=="string"?this.url.searchParams.append(i,`cs.${o}`):Array.isArray(o)?this.url.searchParams.append(i,`cs.{${o.join(",")}}`):this.url.searchParams.append(i,`cs.${JSON.stringify(o)}`),this}containedBy(i,o){return typeof o=="string"?this.url.searchParams.append(i,`cd.${o}`):Array.isArray(o)?this.url.searchParams.append(i,`cd.{${o.join(",")}}`):this.url.searchParams.append(i,`cd.${JSON.stringify(o)}`),this}rangeGt(i,o){return this.url.searchParams.append(i,`sr.${o}`),this}rangeGte(i,o){return this.url.searchParams.append(i,`nxl.${o}`),this}rangeLt(i,o){return this.url.searchParams.append(i,`sl.${o}`),this}rangeLte(i,o){return this.url.searchParams.append(i,`nxr.${o}`),this}rangeAdjacent(i,o){return this.url.searchParams.append(i,`adj.${o}`),this}overlaps(i,o){return typeof o=="string"?this.url.searchParams.append(i,`ov.${o}`):this.url.searchParams.append(i,`ov.{${o.join(",")}}`),this}textSearch(i,o,{config:a,type:l}={}){let c="";l==="plain"?c="pl":l==="phrase"?c="ph":l==="websearch"&&(c="w");const u=a===void 0?"":`(${a})`;return this.url.searchParams.append(i,`${c}fts${u}.${o}`),this}match(i){return Object.entries(i).forEach(([o,a])=>{this.url.searchParams.append(o,`eq.${a}`)}),this}not(i,o,a){return this.url.searchParams.append(i,`not.${o}.${a}`),this}or(i,{foreignTable:o,referencedTable:a=o}={}){const l=a?`${a}.or`:"or";return this.url.searchParams.append(l,`(${i})`),this}filter(i,o,a){return this.url.searchParams.append(i,`${o}.${a}`),this}}return Mt.default=s,Mt}var sn;function Ai(){if(sn)return Nt;sn=1,Object.defineProperty(Nt,"__esModule",{value:!0});const e=ht.__importDefault(ys());class t{constructor(n,{headers:i={},schema:o,fetch:a}){this.url=n,this.headers=new Headers(i),this.schema=o,this.fetch=a}select(n,i){const{head:o=!1,count:a}=i??{},l=o?"HEAD":"GET";let c=!1;const u=(n??"*").split("").map(d=>/\s/.test(d)&&!c?"":(d==='"'&&(c=!c),d)).join("");return this.url.searchParams.set("select",u),a&&this.headers.append("Prefer",`count=${a}`),new e.default({method:l,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(n,{count:i,defaultToNull:o=!0}={}){var a;const l="POST";if(i&&this.headers.append("Prefer",`count=${i}`),o||this.headers.append("Prefer","missing=default"),Array.isArray(n)){const c=n.reduce((u,d)=>u.concat(Object.keys(d)),[]);if(c.length>0){const u=[...new Set(c)].map(d=>`"${d}"`);this.url.searchParams.set("columns",u.join(","))}}return new e.default({method:l,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch})}upsert(n,{onConflict:i,ignoreDuplicates:o=!1,count:a,defaultToNull:l=!0}={}){var c;const u="POST";if(this.headers.append("Prefer",`resolution=${o?"ignore":"merge"}-duplicates`),i!==void 0&&this.url.searchParams.set("on_conflict",i),a&&this.headers.append("Prefer",`count=${a}`),l||this.headers.append("Prefer","missing=default"),Array.isArray(n)){const d=n.reduce((g,f)=>g.concat(Object.keys(f)),[]);if(d.length>0){const g=[...new Set(d)].map(f=>`"${f}"`);this.url.searchParams.set("columns",g.join(","))}}return new e.default({method:u,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(c=this.fetch)!==null&&c!==void 0?c:fetch})}update(n,{count:i}={}){var o;const a="PATCH";return i&&this.headers.append("Prefer",`count=${i}`),new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}delete({count:n}={}){var i;const o="DELETE";return n&&this.headers.append("Prefer",`count=${n}`),new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}}return Nt.default=t,Nt}var nn;function aa(){if(nn)return $t;nn=1,Object.defineProperty($t,"__esModule",{value:!0});const r=ht,e=r.__importDefault(Ai()),t=r.__importDefault(ys());class s{constructor(i,{headers:o={},schema:a,fetch:l}={}){this.url=i,this.headers=new Headers(o),this.schemaName=a,this.fetch=l}from(i){const o=new URL(`${this.url}/${i}`);return new e.default(o,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(i){return new s(this.url,{headers:this.headers,schema:i,fetch:this.fetch})}rpc(i,o={},{head:a=!1,get:l=!1,count:c}={}){var u;let d;const g=new URL(`${this.url}/rpc/${i}`);let f;a||l?(d=a?"HEAD":"GET",Object.entries(o).filter(([y,w])=>w!==void 0).map(([y,w])=>[y,Array.isArray(w)?`{${w.join(",")}}`:`${w}`]).forEach(([y,w])=>{g.searchParams.append(y,w)})):(d="POST",f=o);const v=new Headers(this.headers);return c&&v.set("Prefer",`count=${c}`),new t.default({method:d,url:g,headers:v,schema:this.schemaName,body:f,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch})}}return $t.default=s,$t}var on;function la(){if(on)return ce;on=1,Object.defineProperty(ce,"__esModule",{value:!0}),ce.PostgrestError=ce.PostgrestBuilder=ce.PostgrestTransformBuilder=ce.PostgrestFilterBuilder=ce.PostgrestQueryBuilder=ce.PostgrestClient=void 0;const r=ht,e=r.__importDefault(aa());ce.PostgrestClient=e.default;const t=r.__importDefault(Ai());ce.PostgrestQueryBuilder=t.default;const s=r.__importDefault(ys());ce.PostgrestFilterBuilder=s.default;const n=r.__importDefault(Si());ce.PostgrestTransformBuilder=n.default;const i=r.__importDefault(Ei());ce.PostgrestBuilder=i.default;const o=r.__importDefault(_i());return ce.PostgrestError=o.default,ce.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:s.default,PostgrestTransformBuilder:n.default,PostgrestBuilder:i.default,PostgrestError:o.default},ce}var Ti=la();const Ci=ia(Ti),ca=Vo({__proto__:null,default:Ci},[Ti]),{PostgrestClient:ua,PostgrestQueryBuilder:Rd,PostgrestFilterBuilder:kd,PostgrestTransformBuilder:Id,PostgrestBuilder:Pd,PostgrestError:xd}=Ci||ca;class da{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const t=process.versions;if(t&&t.node){const s=t.node,n=parseInt(s.replace(/^v/,"").split(".")[0]);return n>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${n} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${n} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const s=this.getWebSocketConstructor();return new s(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const ha="2.81.1",fa=`realtime-js/${ha}`,Oi="1.0.0",ga="2.0.0",an=Oi,Jr=1e4,pa=1e3,ma=100;var Ge;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(Ge||(Ge={}));var se;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(se||(se={}));var ye;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(ye||(ye={}));var Yr;(function(r){r.websocket="websocket"})(Yr||(Yr={}));var Ke;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(Ke||(Ke={}));class va{constructor(){this.HEADER_LENGTH=1,this.META_LENGTH=4,this.USER_BROADCAST_PUSH_META_LENGTH=5,this.KINDS={push:0,reply:1,broadcast:2,userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST="broadcast"}encode(e,t){if(this._isArrayBuffer(e.payload))return t(this._binaryEncodePush(e));if(e.event===this.BROADCAST&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return t(this._binaryEncodeUserBroadcastPush(e));let s=[e.join_ref,e.ref,e.topic,e.event,e.payload];return t(JSON.stringify(s))}_binaryEncodePush(e){const{join_ref:t,ref:s,event:n,topic:i,payload:o}=e,a=this.META_LENGTH+t.length+s.length+i.length+n.length,l=new ArrayBuffer(this.HEADER_LENGTH+a);let c=new DataView(l),u=0;c.setUint8(u++,this.KINDS.push),c.setUint8(u++,t.length),c.setUint8(u++,s.length),c.setUint8(u++,i.length),c.setUint8(u++,n.length),Array.from(t,g=>c.setUint8(u++,g.charCodeAt(0))),Array.from(s,g=>c.setUint8(u++,g.charCodeAt(0))),Array.from(i,g=>c.setUint8(u++,g.charCodeAt(0))),Array.from(n,g=>c.setUint8(u++,g.charCodeAt(0)));var d=new Uint8Array(l.byteLength+o.byteLength);return d.set(new Uint8Array(l),0),d.set(new Uint8Array(o),l.byteLength),d.buffer}_binaryEncodeUserBroadcastPush(e){var t;return this._isArrayBuffer((t=e.payload)===null||t===void 0?void 0:t.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var t,s;const{join_ref:n,ref:i,topic:o}=e,a=e.payload.event,l=(s=(t=e.payload)===null||t===void 0?void 0:t.payload)!==null&&s!==void 0?s:new ArrayBuffer(0),c=this.USER_BROADCAST_PUSH_META_LENGTH+n.length+i.length+o.length+a.length,u=new ArrayBuffer(this.HEADER_LENGTH+c);let d=new DataView(u),g=0;d.setUint8(g++,this.KINDS.userBroadcastPush),d.setUint8(g++,n.length),d.setUint8(g++,i.length),d.setUint8(g++,o.length),d.setUint8(g++,a.length),d.setUint8(g++,this.BINARY_ENCODING),Array.from(n,v=>d.setUint8(g++,v.charCodeAt(0))),Array.from(i,v=>d.setUint8(g++,v.charCodeAt(0))),Array.from(o,v=>d.setUint8(g++,v.charCodeAt(0))),Array.from(a,v=>d.setUint8(g++,v.charCodeAt(0)));var f=new Uint8Array(u.byteLength+l.byteLength);return f.set(new Uint8Array(u),0),f.set(new Uint8Array(l),u.byteLength),f.buffer}_encodeJsonUserBroadcastPush(e){var t,s;const{join_ref:n,ref:i,topic:o}=e,a=e.payload.event,l=(s=(t=e.payload)===null||t===void 0?void 0:t.payload)!==null&&s!==void 0?s:{},u=new TextEncoder().encode(JSON.stringify(l)).buffer,d=this.USER_BROADCAST_PUSH_META_LENGTH+n.length+i.length+o.length+a.length,g=new ArrayBuffer(this.HEADER_LENGTH+d);let f=new DataView(g),v=0;f.setUint8(v++,this.KINDS.userBroadcastPush),f.setUint8(v++,n.length),f.setUint8(v++,i.length),f.setUint8(v++,o.length),f.setUint8(v++,a.length),f.setUint8(v++,this.JSON_ENCODING),Array.from(n,w=>f.setUint8(v++,w.charCodeAt(0))),Array.from(i,w=>f.setUint8(v++,w.charCodeAt(0))),Array.from(o,w=>f.setUint8(v++,w.charCodeAt(0))),Array.from(a,w=>f.setUint8(v++,w.charCodeAt(0)));var y=new Uint8Array(g.byteLength+u.byteLength);return y.set(new Uint8Array(g),0),y.set(new Uint8Array(u),g.byteLength),y.buffer}decode(e,t){if(this._isArrayBuffer(e)){let s=this._binaryDecode(e);return t(s)}if(typeof e=="string"){const s=JSON.parse(e),[n,i,o,a,l]=s;return t({join_ref:n,ref:i,topic:o,event:a,payload:l})}return t({})}_binaryDecode(e){const t=new DataView(e),s=t.getUint8(0),n=new TextDecoder;switch(s){case this.KINDS.push:return this._decodePush(e,t,n);case this.KINDS.reply:return this._decodeReply(e,t,n);case this.KINDS.broadcast:return this._decodeBroadcast(e,t,n);case this.KINDS.userBroadcast:return this._decodeUserBroadcast(e,t,n)}}_decodePush(e,t,s){const n=t.getUint8(1),i=t.getUint8(2),o=t.getUint8(3);let a=this.HEADER_LENGTH+this.META_LENGTH-1;const l=s.decode(e.slice(a,a+n));a=a+n;const c=s.decode(e.slice(a,a+i));a=a+i;const u=s.decode(e.slice(a,a+o));a=a+o;const d=JSON.parse(s.decode(e.slice(a,e.byteLength)));return{join_ref:l,ref:null,topic:c,event:u,payload:d}}_decodeReply(e,t,s){const n=t.getUint8(1),i=t.getUint8(2),o=t.getUint8(3),a=t.getUint8(4);let l=this.HEADER_LENGTH+this.META_LENGTH;const c=s.decode(e.slice(l,l+n));l=l+n;const u=s.decode(e.slice(l,l+i));l=l+i;const d=s.decode(e.slice(l,l+o));l=l+o;const g=s.decode(e.slice(l,l+a));l=l+a;const f=JSON.parse(s.decode(e.slice(l,e.byteLength))),v={status:g,response:f};return{join_ref:c,ref:u,topic:d,event:ye.reply,payload:v}}_decodeBroadcast(e,t,s){const n=t.getUint8(1),i=t.getUint8(2);let o=this.HEADER_LENGTH+2;const a=s.decode(e.slice(o,o+n));o=o+n;const l=s.decode(e.slice(o,o+i));o=o+i;const c=JSON.parse(s.decode(e.slice(o,e.byteLength)));return{join_ref:null,ref:null,topic:a,event:l,payload:c}}_decodeUserBroadcast(e,t,s){const n=t.getUint8(1),i=t.getUint8(2),o=t.getUint8(3),a=t.getUint8(4);let l=this.HEADER_LENGTH+4;const c=s.decode(e.slice(l,l+n));l=l+n;const u=s.decode(e.slice(l,l+i));l=l+i;const d=s.decode(e.slice(l,l+o));l=l+o;const g=e.slice(l,e.byteLength),f=a===this.JSON_ENCODING?JSON.parse(s.decode(g)):g,v={type:this.BROADCAST,event:u,payload:f};return o>0&&(v.meta=JSON.parse(d)),{join_ref:null,ref:null,topic:c,event:this.BROADCAST,payload:v}}_isArrayBuffer(e){var t;return e instanceof ArrayBuffer||((t=e?.constructor)===null||t===void 0?void 0:t.name)==="ArrayBuffer"}}class Ri{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var G;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(G||(G={}));const ln=(r,e,t={})=>{var s;const n=(s=t.skipTypes)!==null&&s!==void 0?s:[];return e?Object.keys(e).reduce((i,o)=>(i[o]=ya(o,r,e,n),i),{}):{}},ya=(r,e,t,s)=>{const n=e.find(a=>a.name===r),i=n?.type,o=t[r];return i&&!s.includes(i)?ki(i,o):Xr(o)},ki=(r,e)=>{if(r.charAt(0)==="_"){const t=r.slice(1,r.length);return Ea(e,t)}switch(r){case G.bool:return wa(e);case G.float4:case G.float8:case G.int2:case G.int4:case G.int8:case G.numeric:case G.oid:return ba(e);case G.json:case G.jsonb:return _a(e);case G.timestamp:return Sa(e);case G.abstime:case G.date:case G.daterange:case G.int4range:case G.int8range:case G.money:case G.reltime:case G.text:case G.time:case G.timestamptz:case G.timetz:case G.tsrange:case G.tstzrange:return Xr(e);default:return Xr(e)}},Xr=r=>r,wa=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},ba=r=>{if(typeof r=="string"){const e=parseFloat(r);if(!Number.isNaN(e))return e}return r},_a=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(e){return console.log(`JSON parse error: ${e}`),r}return r},Ea=(r,e)=>{if(typeof r!="string")return r;const t=r.length-1,s=r[t];if(r[0]==="{"&&s==="}"){let i;const o=r.slice(1,t);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(a=>ki(e,a))}return r},Sa=r=>typeof r=="string"?r.replace(" ","T"):r,Ii=r=>{const e=new URL(r);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class Lr{constructor(e,t,s={},n=Jr){this.channel=e,this.event=t,this.payload=s,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var cn;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(cn||(cn={}));class wt{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},n=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=wt.syncState(this.state,n,i,o),this.pendingDiffs.forEach(l=>{this.state=wt.syncDiff(this.state,l,i,o)}),this.pendingDiffs=[],a()}),this.channel._on(s.diff,{},n=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=wt.syncDiff(this.state,n,i,o),a())}),this.onJoin((n,i,o)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:i,newPresences:o})}),this.onLeave((n,i,o)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,n){const i=this.cloneDeep(e),o=this.transformState(t),a={},l={};return this.map(i,(c,u)=>{o[c]||(l[c]=u)}),this.map(o,(c,u)=>{const d=i[c];if(d){const g=u.map(w=>w.presence_ref),f=d.map(w=>w.presence_ref),v=u.filter(w=>f.indexOf(w.presence_ref)<0),y=d.filter(w=>g.indexOf(w.presence_ref)<0);v.length>0&&(a[c]=v),y.length>0&&(l[c]=y)}else a[c]=u}),this.syncDiff(i,{joins:a,leaves:l},s,n)}static syncDiff(e,t,s,n){const{joins:i,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),n||(n=()=>{}),this.map(i,(a,l)=>{var c;const u=(c=e[a])!==null&&c!==void 0?c:[];if(e[a]=this.cloneDeep(l),u.length>0){const d=e[a].map(f=>f.presence_ref),g=u.filter(f=>d.indexOf(f.presence_ref)<0);e[a].unshift(...g)}s(a,u,l)}),this.map(o,(a,l)=>{let c=e[a];if(!c)return;const u=l.map(d=>d.presence_ref);c=c.filter(d=>u.indexOf(d.presence_ref)<0),e[a]=c,n(a,c,l),c.length===0&&delete e[a]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const n=e[s];return"metas"in n?t[s]=n.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[s]=n,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var un;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(un||(un={}));var bt;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes",r.SYSTEM="system"})(bt||(bt={}));var xe;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(xe||(xe={}));class ws{constructor(e,t={config:{}},s){var n,i;if(this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=se.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Lr(this,ye.join,this.params,this.timeout),this.rejoinTimer=new Ri(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=se.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=se.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=se.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=se.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=se.errored,this.rejoinTimer.scheduleTimeout())}),this._on(ye.reply,{},(o,a)=>{this._trigger(this._replyEventName(a),o)}),this.presence=new wt(this),this.broadcastEndpointURL=Ii(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((i=(n=this.params.config)===null||n===void 0?void 0:n.broadcast)===null||i===void 0)&&i.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var s,n,i;if(this.socket.isConnected()||this.socket.connect(),this.state==se.closed){const{config:{broadcast:o,presence:a,private:l}}=this.params,c=(n=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(f=>f.filter))!==null&&n!==void 0?n:[],u=!!this.bindings[bt.PRESENCE]&&this.bindings[bt.PRESENCE].length>0||((i=this.params.config.presence)===null||i===void 0?void 0:i.enabled)===!0,d={},g={broadcast:o,presence:Object.assign(Object.assign({},a),{enabled:u}),postgres_changes:c,private:l};this.socket.accessTokenValue&&(d.access_token=this.socket.accessTokenValue),this._onError(f=>e?.(xe.CHANNEL_ERROR,f)),this._onClose(()=>e?.(xe.CLOSED)),this.updateJoinPayload(Object.assign({config:g},d)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:f})=>{var v;if(this.socket.setAuth(),f===void 0){e?.(xe.SUBSCRIBED);return}else{const y=this.bindings.postgres_changes,w=(v=y?.length)!==null&&v!==void 0?v:0,_=[];for(let S=0;S<w;S++){const b=y[S],{filter:{event:A,schema:k,table:I,filter:$}}=b,W=f&&f[S];if(W&&W.event===A&&W.schema===k&&W.table===I&&W.filter===$)_.push(Object.assign(Object.assign({},b),{id:W.id}));else{this.unsubscribe(),this.state=se.errored,e?.(xe.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=_,e&&e(xe.SUBSCRIBED);return}}).receive("error",f=>{this.state=se.errored,e?.(xe.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(f).join(", ")||"error")))}).receive("timeout",()=>{e?.(xe.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this.state===se.joined&&e===bt.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,s)}async httpSend(e,t,s={}){var n;const i=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(t==null)return Promise.reject("Payload is required for httpSend()");const o={method:"POST",headers:{Authorization:i,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:t,private:this.private}]})},a=await this._fetchWithTimeout(this.broadcastEndpointURL,o,(n=s.timeout)!==null&&n!==void 0?n:this.timeout);if(a.status===202)return{success:!0};let l=a.statusText;try{const c=await a.json();l=c.error||c.message||l}catch{}return Promise.reject(new Error(l))}async send(e,t={}){var s,n;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:i,payload:o}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(s=t.timeout)!==null&&s!==void 0?s:this.timeout);return await((n=c.body)===null||n===void 0?void 0:n.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,a,l;const c=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&i("ok"),c.receive("ok",()=>i("ok")),c.receive("error",()=>i("error")),c.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=se.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(ye.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(n=>{s=new Lr(this,ye.leave,{},e),s.receive("ok",()=>{t(),n("ok")}).receive("timeout",()=>{t(),n("timed out")}).receive("error",()=>{n("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{s?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=se.closed,this.bindings={}}async _fetchWithTimeout(e,t,s){const n=new AbortController,i=setTimeout(()=>n.abort(),s),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:n.signal}));return clearTimeout(i),o}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new Lr(this,e,t,s);return this._canPush()?n.send():this._addToPushBuffer(n),n}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>ma){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var n,i;const o=e.toLocaleLowerCase(),{close:a,error:l,leave:c,join:u}=ye;if(s&&[a,l,c,u].indexOf(o)>=0&&s!==this._joinRef())return;let g=this._onMessage(o,t,s);if(t&&!g)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(f=>{var v,y,w;return((v=f.filter)===null||v===void 0?void 0:v.event)==="*"||((w=(y=f.filter)===null||y===void 0?void 0:y.event)===null||w===void 0?void 0:w.toLocaleLowerCase())===o}).map(f=>f.callback(g,s)):(i=this.bindings[o])===null||i===void 0||i.filter(f=>{var v,y,w,_,S,b;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in f){const A=f.id,k=(v=f.filter)===null||v===void 0?void 0:v.event;return A&&((y=t.ids)===null||y===void 0?void 0:y.includes(A))&&(k==="*"||k?.toLocaleLowerCase()===((w=t.data)===null||w===void 0?void 0:w.type.toLocaleLowerCase()))}else{const A=(S=(_=f?.filter)===null||_===void 0?void 0:_.event)===null||S===void 0?void 0:S.toLocaleLowerCase();return A==="*"||A===((b=t?.event)===null||b===void 0?void 0:b.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===o}).map(f=>{if(typeof g=="object"&&"ids"in g){const v=g.data,{schema:y,table:w,commit_timestamp:_,type:S,errors:b}=v;g=Object.assign(Object.assign({},{schema:y,table:w,commit_timestamp:_,eventType:S,new:{},old:{},errors:b}),this._getPayloadRecords(v))}f.callback(g,s)})}_isClosed(){return this.state===se.closed}_isJoined(){return this.state===se.joined}_isJoining(){return this.state===se.joining}_isLeaving(){return this.state===se.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const n=e.toLocaleLowerCase(),i={type:n,filter:t,callback:s};return this.bindings[n]?this.bindings[n].push(i):this.bindings[n]=[i],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]&&(this.bindings[s]=this.bindings[s].filter(n=>{var i;return!(((i=n.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===s&&ws.isEqual(n.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(ye.close,{},e)}_onError(e){this._on(ye.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=se.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=ln(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=ln(e.columns,e.old_record)),t}}const jr=()=>{},Vt={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Aa=[1e3,2e3,5e3,1e4],Ta=1e4,Ca=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Oa{constructor(e,t){var s;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Jr,this.transport=null,this.heartbeatIntervalMs=Vt.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=jr,this.ref=0,this.reconnectTimer=null,this.vsn=an,this.logger=jr,this.conn=null,this.sendBuffer=[],this.serializer=new va,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=n=>n?(...i)=>n(...i):(...i)=>fetch(...i),!(!((s=t?.params)===null||s===void 0)&&s.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${Yr.websocket}`,this.httpEndpoint=Ii(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=da.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const s=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(s),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,t??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case Ge.connecting:return Ke.Connecting;case Ge.open:return Ke.Open;case Ge.closing:return Ke.Closing;default:return Ke.Closed}}isConnected(){return this.connectionState()===Ke.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const s=`realtime:${e}`,n=this.getChannels().find(i=>i.topic===s);if(n)return n;{const i=new ws(`realtime:${e}`,t,this);return this.channels.push(i),i}}push(e){const{topic:t,event:s,payload:n,ref:i}=e,o=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${t} ${s} (${i})`,n),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(pa,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},Vt.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{if(t.topic==="phoenix"&&t.event==="phx_reply")try{this.heartbeatCallback(t.payload.status==="ok"?"ok":"error")}catch(c){this.log("error","error in heartbeat callback",c)}t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:s,event:n,payload:i,ref:o}=t,a=o?`(${o})`:"",l=i.status||"";this.log("receive",`${l} ${s} ${n} ${a}`.trim(),i),this.channels.filter(c=>c._isMember(s)).forEach(c=>c._trigger(n,i,o)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){if(this.conn){if(this.conn.readyState===Ge.open||this.conn.readyState===Ge.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(t=>{this.log("error","error waiting for auth on connect",t),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(ye.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const s=e.match(/\?/)?"&":"?",n=new URLSearchParams(t);return`${e}${s}${n}`}_workerObjectUrl(e){let t;if(e)t=e;else{const s=new Blob([Ca],{type:"application/javascript"});t=URL.createObjectURL(s)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;e?t=e:this.accessToken?t=await this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(s=>{const n={access_token:t,version:fa};t&&s.updateJoinPayload(n),s.joinedOnce&&s._isJoined()&&s._push(ye.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(s=>{try{s(t)}catch(n){this.log("error",`error in ${e} callback`,n)}})}catch(s){this.log("error",`error triggering ${e} callbacks`,s)}}_setupReconnectionTimer(){this.reconnectTimer=new Ri(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Vt.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,s,n,i,o,a,l,c,u,d,g,f;switch(this.transport=(t=e?.transport)!==null&&t!==void 0?t:null,this.timeout=(s=e?.timeout)!==null&&s!==void 0?s:Jr,this.heartbeatIntervalMs=(n=e?.heartbeatIntervalMs)!==null&&n!==void 0?n:Vt.HEARTBEAT_INTERVAL,this.worker=(i=e?.worker)!==null&&i!==void 0?i:!1,this.accessToken=(o=e?.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(a=e?.heartbeatCallback)!==null&&a!==void 0?a:jr,this.vsn=(l=e?.vsn)!==null&&l!==void 0?l:an,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(c=e?.reconnectAfterMs)!==null&&c!==void 0?c:(v=>Aa[v-1]||Ta),this.vsn){case Oi:this.encode=(u=e?.encode)!==null&&u!==void 0?u:((v,y)=>y(JSON.stringify(v))),this.decode=(d=e?.decode)!==null&&d!==void 0?d:((v,y)=>y(JSON.parse(v)));break;case ga:this.encode=(g=e?.encode)!==null&&g!==void 0?g:this.serializer.encode.bind(this.serializer),this.decode=(f=e?.decode)!==null&&f!==void 0?f:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}}class bs extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function X(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}class Ra extends bs{constructor(e,t,s){super(e),this.name="StorageApiError",this.status=t,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Qr extends bs{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}const _s=r=>r?(...e)=>r(...e):(...e)=>fetch(...e),ka=()=>Response,Zr=r=>{if(Array.isArray(r))return r.map(t=>Zr(t));if(typeof r=="function"||r!==Object(r))return r;const e={};return Object.entries(r).forEach(([t,s])=>{const n=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[n]=Zr(s)}),e},Ia=r=>{if(typeof r!="object"||r===null)return!1;const e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},Ur=r=>{var e;return r.msg||r.message||r.error_description||(typeof r.error=="string"?r.error:(e=r.error)===null||e===void 0?void 0:e.message)||JSON.stringify(r)},Pa=(r,e,t)=>R(void 0,void 0,void 0,function*(){const s=yield ka();r instanceof s&&!t?.noResolveJson?r.json().then(n=>{const i=r.status||500,o=n?.statusCode||i+"";e(new Ra(Ur(n),i,o))}).catch(n=>{e(new Qr(Ur(n),n))}):e(new Qr(Ur(r),r))}),xa=(r,e,t,s)=>{const n={method:r,headers:e?.headers||{}};return r==="GET"||!s?n:(Ia(s)?(n.headers=Object.assign({"Content-Type":"application/json"},e?.headers),n.body=JSON.stringify(s)):n.body=s,e?.duplex&&(n.duplex=e.duplex),Object.assign(Object.assign({},n),t))};function Pt(r,e,t,s,n,i){return R(this,void 0,void 0,function*(){return new Promise((o,a)=>{r(t,xa(e,s,n,i)).then(l=>{if(!l.ok)throw l;return s?.noResolveJson?l:l.json()}).then(l=>o(l)).catch(l=>Pa(l,a,s))})})}function At(r,e,t,s){return R(this,void 0,void 0,function*(){return Pt(r,"GET",e,t,s)})}function Se(r,e,t,s,n){return R(this,void 0,void 0,function*(){return Pt(r,"POST",e,s,n,t)})}function es(r,e,t,s,n){return R(this,void 0,void 0,function*(){return Pt(r,"PUT",e,s,n,t)})}function La(r,e,t,s){return R(this,void 0,void 0,function*(){return Pt(r,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),s)})}function Es(r,e,t,s,n){return R(this,void 0,void 0,function*(){return Pt(r,"DELETE",e,s,n,t)})}class ja{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}execute(){return R(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(X(e))return{data:null,error:e};throw e}})}}var Pi;class Ua{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t,this[Pi]="BlobDownloadBuilder",this.promise=null}asStream(){return new ja(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.getPromise().then(e,t)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return R(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(X(e))return{data:null,error:e};throw e}})}}Pi=Symbol.toStringTag;const Da={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},dn={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class $a{constructor(e,t={},s,n){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=s,this.fetch=_s(n)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,t,s,n){return R(this,void 0,void 0,function*(){try{let i;const o=Object.assign(Object.assign({},dn),n);let a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const l=o.metadata;typeof Blob<"u"&&s instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),l&&i.append("metadata",this.encodeMetadata(l)),i.append("",s)):typeof FormData<"u"&&s instanceof FormData?(i=s,i.has("cacheControl")||i.append("cacheControl",o.cacheControl),l&&!i.has("metadata")&&i.append("metadata",this.encodeMetadata(l))):(i=s,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,l&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(l))),(typeof ReadableStream<"u"&&i instanceof ReadableStream||i&&typeof i=="object"&&"pipe"in i&&typeof i.pipe=="function")&&!o.duplex&&(o.duplex="half")),n?.headers&&(a=Object.assign(Object.assign({},a),n.headers));const c=this._removeEmptyFolders(t),u=this._getFinalPath(c),d=yield(e=="PUT"?es:Se)(this.fetch,`${this.url}/object/${u}`,i,Object.assign({headers:a},o?.duplex?{duplex:o.duplex}:{}));return{data:{path:c,id:d.Id,fullPath:d.Key},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(X(i))return{data:null,error:i};throw i}})}upload(e,t,s){return R(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,n){return R(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),o=this._getFinalPath(i),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",t);try{let l;const c=Object.assign({upsert:dn.upsert},n),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&s instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",s)):typeof FormData<"u"&&s instanceof FormData?(l=s,l.append("cacheControl",c.cacheControl)):(l=s,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType);const d=yield es(this.fetch,a.toString(),l,{headers:u});return{data:{path:i,fullPath:d.Key},error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(X(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,t){return R(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e);const n=Object.assign({},this.headers);t?.upsert&&(n["x-upsert"]="true");const i=yield Se(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:n}),o=new URL(this.url+i.url),a=o.searchParams.get("token");if(!a)throw new bs("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:a},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(X(s))return{data:null,error:s};throw s}})}update(e,t,s){return R(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t,s){return R(this,void 0,void 0,function*(){try{return{data:yield Se(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s?.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(X(n))return{data:null,error:n};throw n}})}copy(e,t,s){return R(this,void 0,void 0,function*(){try{return{data:{path:(yield Se(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(X(n))return{data:null,error:n};throw n}})}createSignedUrl(e,t,s){return R(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e),i=yield Se(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:t},s?.transform?{transform:s.transform}:{}),{headers:this.headers});const o=s?.download?`&download=${s.download===!0?"":s.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(X(n))return{data:null,error:n};throw n}})}createSignedUrls(e,t,s){return R(this,void 0,void 0,function*(){try{const n=yield Se(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=s?.download?`&download=${s.download===!0?"":s.download}`:"";return{data:n.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${i}`):null})),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(X(n))return{data:null,error:n};throw n}})}download(e,t){const n=typeof t?.transform<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString(t?.transform||{}),o=i?`?${i}`:"",a=this._getFinalPath(e),l=()=>At(this.fetch,`${this.url}/${n}/${a}${o}`,{headers:this.headers,noResolveJson:!0});return new Ua(l,this.shouldThrowOnError)}info(e){return R(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const s=yield At(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Zr(s),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(X(s))return{data:null,error:s};throw s}})}exists(e){return R(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield La(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(X(s)&&s instanceof Qr){const n=s.originalError;if([400,404].includes(n?.status))return{data:!1,error:s}}throw s}})}getPublicUrl(e,t){const s=this._getFinalPath(e),n=[],i=t?.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&n.push(i);const a=typeof t?.transform<"u"?"render/image":"object",l=this.transformOptsToQueryString(t?.transform||{});l!==""&&n.push(l);let c=n.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${s}${c}`)}}}remove(e){return R(this,void 0,void 0,function*(){try{return{data:yield Es(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(X(t))return{data:null,error:t};throw t}})}list(e,t,s){return R(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},Da),t),{prefix:e||""});return{data:yield Se(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},s),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(X(n))return{data:null,error:n};throw n}})}listV2(e,t){return R(this,void 0,void 0,function*(){try{const s=Object.assign({},e);return{data:yield Se(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,s,{headers:this.headers},t),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(X(s))return{data:null,error:s};throw s}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const xi="2.81.1",Li={"X-Client-Info":`storage-js/${xi}`};class Na{constructor(e,t={},s,n){this.shouldThrowOnError=!1;const i=new URL(e);n?.useNewHostname&&/supabase\.(co|in|red)$/.test(i.hostname)&&!i.hostname.includes("storage.supabase.")&&(i.hostname=i.hostname.replace("supabase.","storage.supabase.")),this.url=i.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Li),t),this.fetch=_s(s)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(e){return R(this,void 0,void 0,function*(){try{const t=this.listBucketOptionsToQueryString(e);return{data:yield At(this.fetch,`${this.url}/bucket${t}`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(X(t))return{data:null,error:t};throw t}})}getBucket(e){return R(this,void 0,void 0,function*(){try{return{data:yield At(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(X(t))return{data:null,error:t};throw t}})}createBucket(e){return R(this,arguments,void 0,function*(t,s={public:!1}){try{return{data:yield Se(this.fetch,`${this.url}/bucket`,{id:t,name:t,type:s.type,public:s.public,file_size_limit:s.fileSizeLimit,allowed_mime_types:s.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(X(n))return{data:null,error:n};throw n}})}updateBucket(e,t){return R(this,void 0,void 0,function*(){try{return{data:yield es(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(X(s))return{data:null,error:s};throw s}})}emptyBucket(e){return R(this,void 0,void 0,function*(){try{return{data:yield Se(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(X(t))return{data:null,error:t};throw t}})}deleteBucket(e){return R(this,void 0,void 0,function*(){try{return{data:yield Es(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(X(t))return{data:null,error:t};throw t}})}listBucketOptionsToQueryString(e){const t={};return e&&("limit"in e&&(t.limit=String(e.limit)),"offset"in e&&(t.offset=String(e.offset)),e.search&&(t.search=e.search),e.sortColumn&&(t.sortColumn=e.sortColumn),e.sortOrder&&(t.sortOrder=e.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}}class Ma{constructor(e,t={},s){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Li),t),this.fetch=_s(s)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return R(this,void 0,void 0,function*(){try{return{data:yield Se(this.fetch,`${this.url}/bucket`,{name:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(X(t))return{data:null,error:t};throw t}})}listBuckets(e){return R(this,void 0,void 0,function*(){try{const t=new URLSearchParams;e?.limit!==void 0&&t.set("limit",e.limit.toString()),e?.offset!==void 0&&t.set("offset",e.offset.toString()),e?.sortColumn&&t.set("sortColumn",e.sortColumn),e?.sortOrder&&t.set("sortOrder",e.sortOrder),e?.search&&t.set("search",e.search);const s=t.toString(),n=s?`${this.url}/bucket?${s}`:`${this.url}/bucket`;return{data:yield At(this.fetch,n,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(X(t))return{data:null,error:t};throw t}})}deleteBucket(e){return R(this,void 0,void 0,function*(){try{return{data:yield Es(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(X(t))return{data:null,error:t};throw t}})}}const Ss={"X-Client-Info":`storage-js/${xi}`,"Content-Type":"application/json"};class ji extends Error{constructor(e){super(e),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function pe(r){return typeof r=="object"&&r!==null&&"__isStorageVectorsError"in r}class Dr extends ji{constructor(e,t,s){super(e),this.name="StorageVectorsApiError",this.status=t,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Ba extends ji{constructor(e,t){super(e),this.name="StorageVectorsUnknownError",this.originalError=t}}var hn;(function(r){r.InternalError="InternalError",r.S3VectorConflictException="S3VectorConflictException",r.S3VectorNotFoundException="S3VectorNotFoundException",r.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",r.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",r.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded"})(hn||(hn={}));const As=r=>r?(...e)=>r(...e):(...e)=>fetch(...e),Fa=r=>{if(typeof r!="object"||r===null)return!1;const e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},fn=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),qa=(r,e,t)=>R(void 0,void 0,void 0,function*(){if(r&&typeof r=="object"&&"status"in r&&"ok"in r&&typeof r.status=="number"&&!t?.noResolveJson){const n=r.status||500,i=r;if(typeof i.json=="function")i.json().then(o=>{const a=o?.statusCode||o?.code||n+"";e(new Dr(fn(o),n,a))}).catch(()=>{const o=n+"",a=i.statusText||`HTTP ${n} error`;e(new Dr(a,n,o))});else{const o=n+"",a=i.statusText||`HTTP ${n} error`;e(new Dr(a,n,o))}}else e(new Ba(fn(r),r))}),Va=(r,e,t,s)=>{const n={method:r,headers:e?.headers||{}};return s?(Fa(s)?(n.headers=Object.assign({"Content-Type":"application/json"},e?.headers),n.body=JSON.stringify(s)):n.body=s,Object.assign(Object.assign({},n),t)):n};function Wa(r,e,t,s,n,i){return R(this,void 0,void 0,function*(){return new Promise((o,a)=>{r(t,Va(e,s,n,i)).then(l=>{if(!l.ok)throw l;if(s?.noResolveJson)return l;const c=l.headers.get("content-type");return!c||!c.includes("application/json")?{}:l.json()}).then(l=>o(l)).catch(l=>qa(l,a,s))})})}function me(r,e,t,s,n){return R(this,void 0,void 0,function*(){return Wa(r,"POST",e,s,n,t)})}class Ha{constructor(e,t={},s){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Ss),t),this.fetch=As(s)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(e){return R(this,void 0,void 0,function*(){try{return{data:(yield me(this.fetch,`${this.url}/CreateIndex`,e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(pe(t))return{data:null,error:t};throw t}})}getIndex(e,t){return R(this,void 0,void 0,function*(){try{return{data:yield me(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:e,indexName:t},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(pe(s))return{data:null,error:s};throw s}})}listIndexes(e){return R(this,void 0,void 0,function*(){try{return{data:yield me(this.fetch,`${this.url}/ListIndexes`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(pe(t))return{data:null,error:t};throw t}})}deleteIndex(e,t){return R(this,void 0,void 0,function*(){try{return{data:(yield me(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:e,indexName:t},{headers:this.headers}))||{},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(pe(s))return{data:null,error:s};throw s}})}}class za{constructor(e,t={},s){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Ss),t),this.fetch=As(s)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(e){return R(this,void 0,void 0,function*(){try{if(e.vectors.length<1||e.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield me(this.fetch,`${this.url}/PutVectors`,e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(pe(t))return{data:null,error:t};throw t}})}getVectors(e){return R(this,void 0,void 0,function*(){try{return{data:yield me(this.fetch,`${this.url}/GetVectors`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(pe(t))return{data:null,error:t};throw t}})}listVectors(e){return R(this,void 0,void 0,function*(){try{if(e.segmentCount!==void 0){if(e.segmentCount<1||e.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(e.segmentIndex!==void 0&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw new Error(`segmentIndex must be between 0 and ${e.segmentCount-1}`)}return{data:yield me(this.fetch,`${this.url}/ListVectors`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(pe(t))return{data:null,error:t};throw t}})}queryVectors(e){return R(this,void 0,void 0,function*(){try{return{data:yield me(this.fetch,`${this.url}/QueryVectors`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(pe(t))return{data:null,error:t};throw t}})}deleteVectors(e){return R(this,void 0,void 0,function*(){try{if(e.keys.length<1||e.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield me(this.fetch,`${this.url}/DeleteVectors`,e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(pe(t))return{data:null,error:t};throw t}})}}class Ga{constructor(e,t={},s){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Ss),t),this.fetch=As(s)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return R(this,void 0,void 0,function*(){try{return{data:(yield me(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(pe(t))return{data:null,error:t};throw t}})}getBucket(e){return R(this,void 0,void 0,function*(){try{return{data:yield me(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(pe(t))return{data:null,error:t};throw t}})}listBuckets(){return R(this,arguments,void 0,function*(e={}){try{return{data:yield me(this.fetch,`${this.url}/ListVectorBuckets`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(pe(t))return{data:null,error:t};throw t}})}deleteBucket(e){return R(this,void 0,void 0,function*(){try{return{data:(yield me(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(pe(t))return{data:null,error:t};throw t}})}}class Ka extends Ga{constructor(e,t={}){super(e,t.headers||{},t.fetch)}from(e){return new Ja(this.url,this.headers,e,this.fetch)}}class Ja extends Ha{constructor(e,t,s,n){super(e,t,n),this.vectorBucketName=s}createIndex(e){const t=Object.create(null,{createIndex:{get:()=>super.createIndex}});return R(this,void 0,void 0,function*(){return t.createIndex.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){const e=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return R(this,arguments,void 0,function*(t={}){return e.listIndexes.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName}))})}getIndex(e){const t=Object.create(null,{getIndex:{get:()=>super.getIndex}});return R(this,void 0,void 0,function*(){return t.getIndex.call(this,this.vectorBucketName,e)})}deleteIndex(e){const t=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return R(this,void 0,void 0,function*(){return t.deleteIndex.call(this,this.vectorBucketName,e)})}index(e){return new Ya(this.url,this.headers,this.vectorBucketName,e,this.fetch)}}class Ya extends za{constructor(e,t,s,n,i){super(e,t,i),this.vectorBucketName=s,this.indexName=n}putVectors(e){const t=Object.create(null,{putVectors:{get:()=>super.putVectors}});return R(this,void 0,void 0,function*(){return t.putVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(e){const t=Object.create(null,{getVectors:{get:()=>super.getVectors}});return R(this,void 0,void 0,function*(){return t.getVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){const e=Object.create(null,{listVectors:{get:()=>super.listVectors}});return R(this,arguments,void 0,function*(t={}){return e.listVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(e){const t=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return R(this,void 0,void 0,function*(){return t.queryVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(e){const t=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return R(this,void 0,void 0,function*(){return t.deleteVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class Xa extends Na{constructor(e,t={},s,n){super(e,t,s,n)}from(e){return new $a(this.url,this.headers,e,this.fetch)}get vectors(){return new Ka(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new Ma(this.url+"/iceberg",this.headers,this.fetch)}}const Qa="2.81.1";let vt="";typeof Deno<"u"?vt="deno":typeof document<"u"?vt="web":typeof navigator<"u"&&navigator.product==="ReactNative"?vt="react-native":vt="node";const Za={"X-Client-Info":`supabase-js-${vt}/${Qa}`},el={headers:Za},tl={schema:"public"},rl={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},sl={},nl=r=>r?(...e)=>r(...e):(...e)=>fetch(...e),il=()=>Headers,ol=(r,e,t)=>{const s=nl(t),n=il();return async(i,o)=>{var a;const l=(a=await e())!==null&&a!==void 0?a:r;let c=new n(o?.headers);return c.has("apikey")||c.set("apikey",r),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),s(i,Object.assign(Object.assign({},o),{headers:c}))}};function al(r){return r.endsWith("/")?r:r+"/"}function ll(r,e){var t,s;const{db:n,auth:i,realtime:o,global:a}=r,{db:l,auth:c,realtime:u,global:d}=e,g={db:Object.assign(Object.assign({},l),n),auth:Object.assign(Object.assign({},c),i),realtime:Object.assign(Object.assign({},u),o),storage:{},global:Object.assign(Object.assign(Object.assign({},d),a),{headers:Object.assign(Object.assign({},(t=d?.headers)!==null&&t!==void 0?t:{}),(s=a?.headers)!==null&&s!==void 0?s:{})}),accessToken:async()=>""};return r.accessToken?g.accessToken=r.accessToken:delete g.accessToken,g}function cl(r){const e=r?.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(al(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const Ui="2.81.1",it=30*1e3,ts=3,$r=ts*it,ul="http://localhost:9999",dl="supabase.auth.token",hl={"X-Client-Info":`gotrue-js/${Ui}`},rs="X-Supabase-Api-Version",Di={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},fl=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,gl=600*1e3;class Tt extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function x(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class pl extends Tt{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}function ml(r){return x(r)&&r.name==="AuthApiError"}class Je extends Tt{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Fe extends Tt{constructor(e,t,s,n){super(e,s,n),this.name=t,this.status=s}}class _e extends Fe{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function vl(r){return x(r)&&r.name==="AuthSessionMissingError"}class et extends Fe{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Wt extends Fe{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Ht extends Fe{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function yl(r){return x(r)&&r.name==="AuthImplicitGrantRedirectError"}class gn extends Fe{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ss extends Fe{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Nr(r){return x(r)&&r.name==="AuthRetryableFetchError"}class pn extends Fe{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}class ns extends Fe{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const er="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),mn=` 	
\r=`.split(""),wl=(()=>{const r=new Array(128);for(let e=0;e<r.length;e+=1)r[e]=-1;for(let e=0;e<mn.length;e+=1)r[mn[e].charCodeAt(0)]=-2;for(let e=0;e<er.length;e+=1)r[er[e].charCodeAt(0)]=e;return r})();function vn(r,e,t){if(r!==null)for(e.queue=e.queue<<8|r,e.queuedBits+=8;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;t(er[s]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;t(er[s]),e.queuedBits-=6}}function $i(r,e,t){const s=wl[r];if(s>-1)for(e.queue=e.queue<<6|s,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(s===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(r)}"`)}}function yn(r){const e=[],t=o=>{e.push(String.fromCodePoint(o))},s={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},i=o=>{El(o,s,t)};for(let o=0;o<r.length;o+=1)$i(r.charCodeAt(o),n,i);return e.join("")}function bl(r,e){if(r<=127){e(r);return}else if(r<=2047){e(192|r>>6),e(128|r&63);return}else if(r<=65535){e(224|r>>12),e(128|r>>6&63),e(128|r&63);return}else if(r<=1114111){e(240|r>>18),e(128|r>>12&63),e(128|r>>6&63),e(128|r&63);return}throw new Error(`Unrecognized Unicode codepoint: ${r.toString(16)}`)}function _l(r,e){for(let t=0;t<r.length;t+=1){let s=r.charCodeAt(t);if(s>55295&&s<=56319){const n=(s-55296)*1024&65535;s=(r.charCodeAt(t+1)-56320&65535|n)+65536,t+=1}bl(s,e)}}function El(r,e,t){if(e.utf8seq===0){if(r<=127){t(r);return}for(let s=1;s<6;s+=1)if((r>>7-s&1)===0){e.utf8seq=s;break}if(e.utf8seq===2)e.codepoint=r&31;else if(e.utf8seq===3)e.codepoint=r&15;else if(e.utf8seq===4)e.codepoint=r&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(r<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|r&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function lt(r){const e=[],t={queue:0,queuedBits:0},s=n=>{e.push(n)};for(let n=0;n<r.length;n+=1)$i(r.charCodeAt(n),t,s);return new Uint8Array(e)}function Sl(r){const e=[];return _l(r,t=>e.push(t)),new Uint8Array(e)}function Xe(r){const e=[],t={queue:0,queuedBits:0},s=n=>{e.push(n)};return r.forEach(n=>vn(n,t,s)),vn(null,t,s),e.join("")}function Al(r){return Math.round(Date.now()/1e3)+r}function Tl(){return Symbol("auth-callback")}const oe=()=>typeof window<"u"&&typeof document<"u",We={tested:!1,writable:!1},Ni=()=>{if(!oe())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(We.tested)return We.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),We.tested=!0,We.writable=!0}catch{We.tested=!0,We.writable=!1}return We.writable};function Cl(r){const e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((n,i)=>{e[i]=n})}catch{}return t.searchParams.forEach((s,n)=>{e[n]=s}),e}const Mi=r=>r?(...e)=>r(...e):(...e)=>fetch(...e),Ol=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",ot=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))},He=async(r,e)=>{const t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Le=async(r,e)=>{await r.removeItem(e)};class hr{constructor(){this.promise=new hr.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}hr.promiseConstructor=Promise;function Mr(r){const e=r.split(".");if(e.length!==3)throw new ns("Invalid JWT structure");for(let s=0;s<e.length;s++)if(!fl.test(e[s]))throw new ns("JWT not in base64url format");return{header:JSON.parse(yn(e[0])),payload:JSON.parse(yn(e[1])),signature:lt(e[2]),raw:{header:e[0],payload:e[1]}}}async function Rl(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function kl(r,e){return new Promise((s,n)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await r(i);if(!e(i,null,o)){s(o);return}}catch(o){if(!e(i,o)){n(o);return}}})()})}function Il(r){return("0"+r.toString(16)).substr(-2)}function Pl(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=t.length;let n="";for(let i=0;i<56;i++)n+=t.charAt(Math.floor(Math.random()*s));return n}return crypto.getRandomValues(e),Array.from(e,Il).join("")}async function xl(r){const t=new TextEncoder().encode(r),s=await crypto.subtle.digest("SHA-256",t),n=new Uint8Array(s);return Array.from(n).map(i=>String.fromCharCode(i)).join("")}async function Ll(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;const t=await xl(r);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function tt(r,e,t=!1){const s=Pl();let n=s;t&&(n+="/PASSWORD_RECOVERY"),await ot(r,`${e}-code-verifier`,n);const i=await Ll(s);return[i,s===i?"plain":"s256"]}const jl=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Ul(r){const e=r.headers.get(rs);if(!e||!e.match(jl))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Dl(r){if(!r)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(r<=e)throw new Error("JWT has expired")}function $l(r){switch(r){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Nl=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function rt(r){if(!Nl.test(r))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Br(){const r={};return new Proxy(r,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const s=t.toString();if(s==="Symbol(Symbol.toPrimitive)"||s==="Symbol(Symbol.toStringTag)"||s==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Ml(r,e){return new Proxy(r,{get:(t,s,n)=>{if(s==="__isInsecureUserWarningProxy")return!0;if(typeof s=="symbol"){const i=s.toString();if(i==="Symbol(Symbol.toPrimitive)"||i==="Symbol(Symbol.toStringTag)"||i==="Symbol(util.inspect.custom)"||i==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(t,s,n)}return!e.value&&typeof s=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(t,s,n)}})}function wn(r){return JSON.parse(JSON.stringify(r))}const ze=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),Bl=[502,503,504];async function bn(r){var e;if(!Ol(r))throw new ss(ze(r),0);if(Bl.includes(r.status))throw new ss(ze(r),r.status);let t;try{t=await r.json()}catch(i){throw new Je(ze(i),i)}let s;const n=Ul(r);if(n&&n.getTime()>=Di["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?s=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(s=t.error_code),s){if(s==="weak_password")throw new pn(ze(t),r.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(s==="session_not_found")throw new _e}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new pn(ze(t),r.status,t.weak_password.reasons);throw new pl(ze(t),r.status||500,s)}const Fl=(r,e,t,s)=>{const n={method:r,headers:e?.headers||{}};return r==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),n.body=JSON.stringify(s),Object.assign(Object.assign({},n),t))};async function U(r,e,t,s){var n;const i=Object.assign({},s?.headers);i[rs]||(i[rs]=Di["2024-01-01"].name),s?.jwt&&(i.Authorization=`Bearer ${s.jwt}`);const o=(n=s?.query)!==null&&n!==void 0?n:{};s?.redirectTo&&(o.redirect_to=s.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await ql(r,e,t+a,{headers:i,noResolveJson:s?.noResolveJson},{},s?.body);return s?.xform?s?.xform(l):{data:Object.assign({},l),error:null}}async function ql(r,e,t,s,n,i){const o=Fl(e,s,n,i);let a;try{a=await r(t,Object.assign({},o))}catch(l){throw console.error(l),new ss(ze(l),0)}if(a.ok||await bn(a),s?.noResolveJson)return a;try{return await a.json()}catch(l){await bn(l)}}function Ee(r){var e;let t=null;Hl(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=Al(r.expires_in)));const s=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:s},error:null}}function _n(r){const e=Ee(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,s)=>t&&typeof s=="string",!0)&&(e.data.weak_password=r.weak_password),e}function $e(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function Vl(r){return{data:r,error:null}}function Wl(r){const{action_link:e,email_otp:t,hashed_token:s,redirect_to:n,verification_type:i}=r,o=dt(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:t,hashed_token:s,redirect_to:n,verification_type:i},l=Object.assign({},o);return{data:{properties:a,user:l},error:null}}function En(r){return r}function Hl(r){return r.access_token&&r.refresh_token&&r.expires_in}const Fr=["global","local","others"];class zl{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=Mi(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,t=Fr[0]){if(Fr.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Fr.join(", ")}`);try{return await U(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(x(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await U(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:$e})}catch(s){if(x(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=dt(e,["options"]),n=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(n.new_email=s?.newEmail,delete n.newEmail),await U(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:Wl,redirectTo:t?.redirectTo})}catch(t){if(x(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await U(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:$e})}catch(t){if(x(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,n,i,o,a,l;try{const c={nextPage:null,lastPage:0,total:0},u=await U(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(i=(n=e?.perPage)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""},xform:En});if(u.error)throw u.error;const d=await u.json(),g=(o=u.headers.get("x-total-count"))!==null&&o!==void 0?o:0,f=(l=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(v=>{const y=parseInt(v.split(";")[0].split("=")[1].substring(0,1)),w=JSON.parse(v.split(";")[1].split("=")[1]);c[`${w}Page`]=y}),c.total=parseInt(g)),{data:Object.assign(Object.assign({},d),c),error:null}}catch(c){if(x(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){rt(e);try{return await U(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:$e})}catch(t){if(x(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){rt(e);try{return await U(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:$e})}catch(s){if(x(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){rt(e);try{return await U(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:$e})}catch(s){if(x(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){rt(e.userId);try{const{data:t,error:s}=await U(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:t,error:s}}catch(t){if(x(t))return{data:null,error:t};throw t}}async _deleteFactor(e){rt(e.userId),rt(e.id);try{return{data:await U(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(x(t))return{data:null,error:t};throw t}}async _listOAuthClients(e){var t,s,n,i,o,a,l;try{const c={nextPage:null,lastPage:0,total:0},u=await U(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(i=(n=e?.perPage)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""},xform:En});if(u.error)throw u.error;const d=await u.json(),g=(o=u.headers.get("x-total-count"))!==null&&o!==void 0?o:0,f=(l=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(v=>{const y=parseInt(v.split(";")[0].split("=")[1].substring(0,1)),w=JSON.parse(v.split(";")[1].split("=")[1]);c[`${w}Page`]=y}),c.total=parseInt(g)),{data:Object.assign(Object.assign({},d),c),error:null}}catch(c){if(x(c))return{data:{clients:[]},error:c};throw c}}async _createOAuthClient(e){try{return await U(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(x(t))return{data:null,error:t};throw t}}async _getOAuthClient(e){try{return await U(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(x(t))return{data:null,error:t};throw t}}async _updateOAuthClient(e,t){try{return await U(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:t,headers:this.headers,xform:s=>({data:s,error:null})})}catch(s){if(x(s))return{data:null,error:s};throw s}}async _deleteOAuthClient(e){try{return await U(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(t){if(x(t))return{data:null,error:t};throw t}}async _regenerateOAuthClientSecret(e){try{return await U(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(x(t))return{data:null,error:t};throw t}}}function Sn(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}const st={debug:!!(globalThis&&Ni()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Bi extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Gl extends Bi{}async function Kl(r,e,t){st.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);const s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort(),st.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async n=>{if(n){st.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,n.name);try{return await t()}finally{st.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,n.name)}}else{if(e===0)throw st.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new Gl(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(st.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}function Jl(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function Fi(r){if(!/^0x[a-fA-F0-9]{40}$/.test(r))throw new Error(`@supabase/auth-js: Address "${r}" is invalid.`);return r.toLowerCase()}function Yl(r){return parseInt(r,16)}function Xl(r){const e=new TextEncoder().encode(r);return"0x"+Array.from(e,s=>s.toString(16).padStart(2,"0")).join("")}function Ql(r){var e;const{chainId:t,domain:s,expirationTime:n,issuedAt:i=new Date,nonce:o,notBefore:a,requestId:l,resources:c,scheme:u,uri:d,version:g}=r;{if(!Number.isInteger(t))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${t}`);if(!s)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!d)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(g!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${g}`);if(!((e=r.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${r.statement}`)}const f=Fi(r.address),v=u?`${u}://${s}`:s,y=r.statement?`${r.statement}
`:"",w=`${v} wants you to sign in with your Ethereum account:
${f}

${y}`;let _=`URI: ${d}
Version: ${g}
Chain ID: ${t}${o?`
Nonce: ${o}`:""}
Issued At: ${i.toISOString()}`;if(n&&(_+=`
Expiration Time: ${n.toISOString()}`),a&&(_+=`
Not Before: ${a.toISOString()}`),l&&(_+=`
Request ID: ${l}`),c){let S=`
Resources:`;for(const b of c){if(!b||typeof b!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${b}`);S+=`
- ${b}`}_+=S}return`${w}
${_}`}class te extends Error{constructor({message:e,code:t,cause:s,name:n}){var i;super(e,{cause:s}),this.__isWebAuthnError=!0,this.name=(i=n??(s instanceof Error?s.name:void 0))!==null&&i!==void 0?i:"Unknown Error",this.code=t}}class tr extends te{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}}function Zl({error:r,options:e}){var t,s,n;const{publicKey:i}=e;if(!i)throw Error("options was missing required publicKey property");if(r.name==="AbortError"){if(e.signal instanceof AbortSignal)return new te({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:r})}else if(r.name==="ConstraintError"){if(((t=i.authenticatorSelection)===null||t===void 0?void 0:t.requireResidentKey)===!0)return new te({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:r});if(e.mediation==="conditional"&&((s=i.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new te({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:r});if(((n=i.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new te({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:r})}else{if(r.name==="InvalidStateError")return new te({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:r});if(r.name==="NotAllowedError")return new te({message:r.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r});if(r.name==="NotSupportedError")return i.pubKeyCredParams.filter(a=>a.type==="public-key").length===0?new te({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:r}):new te({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:r});if(r.name==="SecurityError"){const o=window.location.hostname;if(qi(o)){if(i.rp.id!==o)return new te({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:r})}else return new te({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:r})}else if(r.name==="TypeError"){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new te({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:r})}else if(r.name==="UnknownError")return new te({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:r})}return new te({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r})}function ec({error:r,options:e}){const{publicKey:t}=e;if(!t)throw Error("options was missing required publicKey property");if(r.name==="AbortError"){if(e.signal instanceof AbortSignal)return new te({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:r})}else{if(r.name==="NotAllowedError")return new te({message:r.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r});if(r.name==="SecurityError"){const s=window.location.hostname;if(qi(s)){if(t.rpId!==s)return new te({message:`The RP ID "${t.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:r})}else return new te({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:r})}else if(r.name==="UnknownError")return new te({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:r})}return new te({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r})}class tc{createNewAbortSignal(){if(this.controller){const t=new Error("Cancelling existing WebAuthn API call for new one");t.name="AbortError",this.controller.abort(t)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const rc=new tc;function sc(r){if(!r)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(r);const{challenge:e,user:t,excludeCredentials:s}=r,n=dt(r,["challenge","user","excludeCredentials"]),i=lt(e).buffer,o=Object.assign(Object.assign({},t),{id:lt(t.id).buffer}),a=Object.assign(Object.assign({},n),{challenge:i,user:o});if(s&&s.length>0){a.excludeCredentials=new Array(s.length);for(let l=0;l<s.length;l++){const c=s[l];a.excludeCredentials[l]=Object.assign(Object.assign({},c),{id:lt(c.id).buffer,type:c.type||"public-key",transports:c.transports})}}return a}function nc(r){if(!r)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(r);const{challenge:e,allowCredentials:t}=r,s=dt(r,["challenge","allowCredentials"]),n=lt(e).buffer,i=Object.assign(Object.assign({},s),{challenge:n});if(t&&t.length>0){i.allowCredentials=new Array(t.length);for(let o=0;o<t.length;o++){const a=t[o];i.allowCredentials[o]=Object.assign(Object.assign({},a),{id:lt(a.id).buffer,type:a.type||"public-key",transports:a.transports})}}return i}function ic(r){var e;if("toJSON"in r&&typeof r.toJSON=="function")return r.toJSON();const t=r;return{id:r.id,rawId:r.id,response:{attestationObject:Xe(new Uint8Array(r.response.attestationObject)),clientDataJSON:Xe(new Uint8Array(r.response.clientDataJSON))},type:"public-key",clientExtensionResults:r.getClientExtensionResults(),authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function oc(r){var e;if("toJSON"in r&&typeof r.toJSON=="function")return r.toJSON();const t=r,s=r.getClientExtensionResults(),n=r.response;return{id:r.id,rawId:r.id,response:{authenticatorData:Xe(new Uint8Array(n.authenticatorData)),clientDataJSON:Xe(new Uint8Array(n.clientDataJSON)),signature:Xe(new Uint8Array(n.signature)),userHandle:n.userHandle?Xe(new Uint8Array(n.userHandle)):void 0},type:"public-key",clientExtensionResults:s,authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function qi(r){return r==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(r)}function An(){var r,e;return!!(oe()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((r=navigator?.credentials)===null||r===void 0?void 0:r.create)=="function"&&typeof((e=navigator?.credentials)===null||e===void 0?void 0:e.get)=="function")}async function ac(r){try{const e=await navigator.credentials.create(r);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new tr("Browser returned unexpected credential type",e)}:{data:null,error:new tr("Empty credential response",e)}}catch(e){return{data:null,error:Zl({error:e,options:r})}}}async function lc(r){try{const e=await navigator.credentials.get(r);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new tr("Browser returned unexpected credential type",e)}:{data:null,error:new tr("Empty credential response",e)}}catch(e){return{data:null,error:ec({error:e,options:r})}}}const cc={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},uc={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function rr(...r){const e=n=>n!==null&&typeof n=="object"&&!Array.isArray(n),t=n=>n instanceof ArrayBuffer||ArrayBuffer.isView(n),s={};for(const n of r)if(n)for(const i in n){const o=n[i];if(o!==void 0)if(Array.isArray(o))s[i]=o;else if(t(o))s[i]=o;else if(e(o)){const a=s[i];e(a)?s[i]=rr(a,o):s[i]=rr(o)}else s[i]=o}return s}function dc(r,e){return rr(cc,r,e||{})}function hc(r,e){return rr(uc,r,e||{})}class fc{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:t,friendlyName:s,signal:n},i){try{const{data:o,error:a}=await this.client.mfa.challenge({factorId:e,webauthn:t});if(!o)return{data:null,error:a};const l=n??rc.createNewAbortSignal();if(o.webauthn.type==="create"){const{user:c}=o.webauthn.credential_options.publicKey;c.name||(c.name=`${c.id}:${s}`),c.displayName||(c.displayName=c.name)}switch(o.webauthn.type){case"create":{const c=dc(o.webauthn.credential_options.publicKey,i?.create),{data:u,error:d}=await ac({publicKey:c,signal:l});return u?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:u}},error:null}:{data:null,error:d}}case"request":{const c=hc(o.webauthn.credential_options.publicKey,i?.request),{data:u,error:d}=await lc(Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:c,signal:l}));return u?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:u}},error:null}:{data:null,error:d}}}}catch(o){return x(o)?{data:null,error:o}:{data:null,error:new Je("Unexpected error in challenge",o)}}}async _verify({challengeId:e,factorId:t,webauthn:s}){return this.client.mfa.verify({factorId:t,challengeId:e,webauthn:s})}async _authenticate({factorId:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:s=typeof window<"u"?[window.location.origin]:void 0,signal:n}={}},i){if(!t)return{data:null,error:new Tt("rpId is required for WebAuthn authentication")};try{if(!An())return{data:null,error:new Je("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this.challenge({factorId:e,webauthn:{rpId:t,rpOrigins:s},signal:n},{request:i});if(!o)return{data:null,error:a};const{webauthn:l}=o;return this._verify({factorId:e,challengeId:o.challengeId,webauthn:{type:l.type,rpId:t,rpOrigins:s,credential_response:l.credential_response}})}catch(o){return x(o)?{data:null,error:o}:{data:null,error:new Je("Unexpected error in authenticate",o)}}}async _register({friendlyName:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:s=typeof window<"u"?[window.location.origin]:void 0,signal:n}={}},i){if(!t)return{data:null,error:new Tt("rpId is required for WebAuthn registration")};try{if(!An())return{data:null,error:new Je("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this._enroll({friendlyName:e});if(!o)return await this.client.mfa.listFactors().then(u=>{var d;return(d=u.data)===null||d===void 0?void 0:d.all.find(g=>g.factor_type==="webauthn"&&g.friendly_name===e&&g.status!=="unverified")}).then(u=>u?this.client.mfa.unenroll({factorId:u?.id}):void 0),{data:null,error:a};const{data:l,error:c}=await this._challenge({factorId:o.id,friendlyName:o.friendly_name,webauthn:{rpId:t,rpOrigins:s},signal:n},{create:i});return l?this._verify({factorId:o.id,challengeId:l.challengeId,webauthn:{rpId:t,rpOrigins:s,type:l.webauthn.type,credential_response:l.webauthn.credential_response}}):{data:null,error:c}}catch(o){return x(o)?{data:null,error:o}:{data:null,error:new Je("Unexpected error in register",o)}}}}Jl();const gc={url:ul,storageKey:dl,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:hl,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function Tn(r,e,t){return await t()}const nt={};class Ct{get jwks(){var e,t;return(t=(e=nt[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){nt[this.storageKey]=Object.assign(Object.assign({},nt[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=nt[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){nt[this.storageKey]=Object.assign(Object.assign({},nt[this.storageKey]),{cachedAt:e})}constructor(e){var t,s,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const i=Object.assign(Object.assign({},gc),e);if(this.storageKey=i.storageKey,this.instanceID=(t=Ct.nextInstanceID[this.storageKey])!==null&&t!==void 0?t:0,Ct.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.instanceID>0&&oe()){const o=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(o),this.logDebugMessages&&console.trace(o)}if(this.persistSession=i.persistSession,this.autoRefreshToken=i.autoRefreshToken,this.admin=new zl({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=Mi(i.fetch),this.lock=i.lock||Tn,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,this.throwOnError=i.throwOnError,i.lock?this.lock=i.lock:oe()&&(!((s=globalThis?.navigator)===null||s===void 0)&&s.locks)?this.lock=Kl:this.lock=Tn,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new fc(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this)},this.persistSession?(i.storage?this.storage=i.storage:Ni()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Sn(this.memoryStorage)),i.userStorage&&(this.userStorage=i.userStorage)):(this.memoryStorage={},this.storage=Sn(this.memoryStorage)),oe()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o),await this._notifyAllSubscribers(o.data.event,o.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${Ui}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let t={},s="none";if(oe()&&(t=Cl(window.location.href),this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce")),oe()&&this.detectSessionInUrl&&s!=="none"){const{data:n,error:i}=await this._getSessionFromURL(t,s);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),yl(i)){const l=(e=i.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:o,redirectType:a}=n;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),await this._saveSession(o),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return x(t)?this._returnResult({error:t}):this._returnResult({error:new Je("Unexpected error during initialization",t)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,n;try{const i=await U(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(n=e?.options)===null||n===void 0?void 0:n.captchaToken}},xform:Ee}),{data:o,error:a}=i;if(a||!o)return this._returnResult({data:{user:null,session:null},error:a});const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(i){if(x(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signUp(e){var t,s,n;try{let i;if("email"in e){const{email:u,password:d,options:g}=e;let f=null,v=null;this.flowType==="pkce"&&([f,v]=await tt(this.storage,this.storageKey)),i=await U(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:g?.emailRedirectTo,body:{email:u,password:d,data:(t=g?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:g?.captchaToken},code_challenge:f,code_challenge_method:v},xform:Ee})}else if("phone"in e){const{phone:u,password:d,options:g}=e;i=await U(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:d,data:(s=g?.data)!==null&&s!==void 0?s:{},channel:(n=g?.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:g?.captchaToken}},xform:Ee})}else throw new Wt("You must provide either an email or phone number and a password");const{data:o,error:a}=i;if(a||!o)return this._returnResult({data:{user:null,session:null},error:a});const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(i){if(x(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:o,options:a}=e;t=await U(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:_n})}else if("phone"in e){const{phone:i,password:o,options:a}=e;t=await U(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:_n})}else throw new Wt("You must provide either an email or phone number and a password");const{data:s,error:n}=t;if(n)return this._returnResult({data:{user:null,session:null},error:n});if(!s||!s.session||!s.user){const i=new et;return this._returnResult({data:{user:null,session:null},error:i})}return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),this._returnResult({data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:n})}catch(t){if(x(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOAuth(e){var t,s,n,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(n=e.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;switch(t){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}}async signInWithEthereum(e){var t,s,n,i,o,a,l,c,u,d,g;let f,v;if("message"in e)f=e.message,v=e.signature;else{const{chain:y,wallet:w,statement:_,options:S}=e;let b;if(oe())if(typeof w=="object")b=w;else{const B=window;if("ethereum"in B&&typeof B.ethereum=="object"&&"request"in B.ethereum&&typeof B.ethereum.request=="function")b=B.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof w!="object"||!S?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");b=w}const A=new URL((t=S?.url)!==null&&t!==void 0?t:window.location.href),k=await b.request({method:"eth_requestAccounts"}).then(B=>B).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!k||k.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const I=Fi(k[0]);let $=(s=S?.signInWithEthereum)===null||s===void 0?void 0:s.chainId;if(!$){const B=await b.request({method:"eth_chainId"});$=Yl(B)}const W={domain:A.host,address:I,statement:_,uri:A.href,version:"1",chainId:$,nonce:(n=S?.signInWithEthereum)===null||n===void 0?void 0:n.nonce,issuedAt:(o=(i=S?.signInWithEthereum)===null||i===void 0?void 0:i.issuedAt)!==null&&o!==void 0?o:new Date,expirationTime:(a=S?.signInWithEthereum)===null||a===void 0?void 0:a.expirationTime,notBefore:(l=S?.signInWithEthereum)===null||l===void 0?void 0:l.notBefore,requestId:(c=S?.signInWithEthereum)===null||c===void 0?void 0:c.requestId,resources:(u=S?.signInWithEthereum)===null||u===void 0?void 0:u.resources};f=Ql(W),v=await b.request({method:"personal_sign",params:[Xl(f),I]})}try{const{data:y,error:w}=await U(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:f,signature:v},!((d=e.options)===null||d===void 0)&&d.captchaToken?{gotrue_meta_security:{captcha_token:(g=e.options)===null||g===void 0?void 0:g.captchaToken}}:null),xform:Ee});if(w)throw w;if(!y||!y.session||!y.user){const _=new et;return this._returnResult({data:{user:null,session:null},error:_})}return y.session&&(await this._saveSession(y.session),await this._notifyAllSubscribers("SIGNED_IN",y.session)),this._returnResult({data:Object.assign({},y),error:w})}catch(y){if(x(y))return this._returnResult({data:{user:null,session:null},error:y});throw y}}async signInWithSolana(e){var t,s,n,i,o,a,l,c,u,d,g,f;let v,y;if("message"in e)v=e.message,y=e.signature;else{const{chain:w,wallet:_,statement:S,options:b}=e;let A;if(oe())if(typeof _=="object")A=_;else{const I=window;if("solana"in I&&typeof I.solana=="object"&&("signIn"in I.solana&&typeof I.solana.signIn=="function"||"signMessage"in I.solana&&typeof I.solana.signMessage=="function"))A=I.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof _!="object"||!b?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");A=_}const k=new URL((t=b?.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in A&&A.signIn){const I=await A.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},b?.signInWithSolana),{version:"1",domain:k.host,uri:k.href}),S?{statement:S}:null));let $;if(Array.isArray(I)&&I[0]&&typeof I[0]=="object")$=I[0];else if(I&&typeof I=="object"&&"signedMessage"in I&&"signature"in I)$=I;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in $&&"signature"in $&&(typeof $.signedMessage=="string"||$.signedMessage instanceof Uint8Array)&&$.signature instanceof Uint8Array)v=typeof $.signedMessage=="string"?$.signedMessage:new TextDecoder().decode($.signedMessage),y=$.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in A)||typeof A.signMessage!="function"||!("publicKey"in A)||typeof A!="object"||!A.publicKey||!("toBase58"in A.publicKey)||typeof A.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");v=[`${k.host} wants you to sign in with your Solana account:`,A.publicKey.toBase58(),...S?["",S,""]:[""],"Version: 1",`URI: ${k.href}`,`Issued At: ${(n=(s=b?.signInWithSolana)===null||s===void 0?void 0:s.issuedAt)!==null&&n!==void 0?n:new Date().toISOString()}`,...!((i=b?.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${b.signInWithSolana.notBefore}`]:[],...!((o=b?.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${b.signInWithSolana.expirationTime}`]:[],...!((a=b?.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${b.signInWithSolana.chainId}`]:[],...!((l=b?.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${b.signInWithSolana.nonce}`]:[],...!((c=b?.signInWithSolana)===null||c===void 0)&&c.requestId?[`Request ID: ${b.signInWithSolana.requestId}`]:[],...!((d=(u=b?.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||d===void 0)&&d.length?["Resources",...b.signInWithSolana.resources.map($=>`- ${$}`)]:[]].join(`
`);const I=await A.signMessage(new TextEncoder().encode(v),"utf8");if(!I||!(I instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");y=I}}try{const{data:w,error:_}=await U(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:v,signature:Xe(y)},!((g=e.options)===null||g===void 0)&&g.captchaToken?{gotrue_meta_security:{captcha_token:(f=e.options)===null||f===void 0?void 0:f.captchaToken}}:null),xform:Ee});if(_)throw _;if(!w||!w.session||!w.user){const S=new et;return this._returnResult({data:{user:null,session:null},error:S})}return w.session&&(await this._saveSession(w.session),await this._notifyAllSubscribers("SIGNED_IN",w.session)),this._returnResult({data:Object.assign({},w),error:_})}catch(w){if(x(w))return this._returnResult({data:{user:null,session:null},error:w});throw w}}async _exchangeCodeForSession(e){const t=await He(this.storage,`${this.storageKey}-code-verifier`),[s,n]=(t??"").split("/");try{const{data:i,error:o}=await U(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:Ee});if(await Le(this.storage,`${this.storageKey}-code-verifier`),o)throw o;if(!i||!i.session||!i.user){const a=new et;return this._returnResult({data:{user:null,session:null,redirectType:null},error:a})}return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),this._returnResult({data:Object.assign(Object.assign({},i),{redirectType:n??null}),error:o})}catch(i){if(x(i))return this._returnResult({data:{user:null,session:null,redirectType:null},error:i});throw i}}async signInWithIdToken(e){try{const{options:t,provider:s,token:n,access_token:i,nonce:o}=e,a=await U(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:n,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:Ee}),{data:l,error:c}=a;if(c)return this._returnResult({data:{user:null,session:null},error:c});if(!l||!l.session||!l.user){const u=new et;return this._returnResult({data:{user:null,session:null},error:u})}return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),this._returnResult({data:l,error:c})}catch(t){if(x(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOtp(e){var t,s,n,i,o;try{if("email"in e){const{email:a,options:l}=e;let c=null,u=null;this.flowType==="pkce"&&([c,u]=await tt(this.storage,this.storageKey));const{error:d}=await U(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(t=l?.data)!==null&&t!==void 0?t:{},create_user:(s=l?.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},code_challenge:c,code_challenge_method:u},redirectTo:l?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:d})}if("phone"in e){const{phone:a,options:l}=e,{data:c,error:u}=await U(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(n=l?.data)!==null&&n!==void 0?n:{},create_user:(i=l?.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},channel:(o=l?.channel)!==null&&o!==void 0?o:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:c?.message_id},error:u})}throw new Wt("You must provide either an email or phone number.")}catch(a){if(x(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async verifyOtp(e){var t,s;try{let n,i;"options"in e&&(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(s=e.options)===null||s===void 0?void 0:s.captchaToken);const{data:o,error:a}=await U(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:n,xform:Ee});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const l=o.session,c=o.user;return l?.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(n){if(x(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithSSO(e){var t,s,n,i,o;try{let a=null,l=null;this.flowType==="pkce"&&([a,l]=await tt(this.storage,this.storageKey));const c=await U(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&s!==void 0?s:void 0}),!((n=e?.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:a,code_challenge_method:l}),headers:this.headers,xform:Vl});return!((i=c.data)===null||i===void 0)&&i.url&&oe()&&!(!((o=e.options)===null||o===void 0)&&o.skipBrowserRedirect)&&window.location.assign(c.data.url),this._returnResult(c)}catch(a){if(x(a))return this._returnResult({data:null,error:a});throw a}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new _e;const{error:n}=await U(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return this._returnResult({data:{user:null,session:null},error:n})})}catch(e){if(x(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:n,options:i}=e,{error:o}=await U(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:n,gotrue_meta_security:{captcha_token:i?.captchaToken}},redirectTo:i?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}else if("phone"in e){const{phone:s,type:n,options:i}=e,{data:o,error:a}=await U(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:n,gotrue_meta_security:{captcha_token:i?.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:o?.message_id},error:a})}throw new Wt("You must provide either an email or phone number and a type")}catch(t){if(x(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await s,await t()))();return this.pendingInLock.push((async()=>{try{await n}catch{}})()),n}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=t();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const n=[...this.pendingInLock];await Promise.all(n),this.pendingInLock.splice(0,n.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await He(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=e.expires_at?e.expires_at*1e3-Date.now()<$r:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.userStorage){const o=await He(this.userStorage,this.storageKey+"-user");o?.user?e.user=o.user:e.user=Br()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const o={value:this.suppressGetSessionWarning};e.user=Ml(e.user,o),o.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{session:null},error:i}):this._returnResult({data:{session:n},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await U(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:$e}):await this._useSession(async t=>{var s,n,i;const{data:o,error:a}=t;if(a)throw a;return!(!((s=o.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new _e}:await U(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(n=o.session)===null||n===void 0?void 0:n.access_token)!==null&&i!==void 0?i:void 0,xform:$e})})}catch(t){if(x(t))return vl(t)&&(await this._removeSession(),await Le(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:t});throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{const{data:n,error:i}=s;if(i)throw i;if(!n.session)throw new _e;const o=n.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await tt(this.storage,this.storageKey));const{data:c,error:u}=await U(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:o.access_token,xform:$e});if(u)throw u;return o.user=c.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),this._returnResult({data:{user:o.user},error:null})})}catch(s){if(x(s))return this._returnResult({data:{user:null},error:s});throw s}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new _e;const t=Date.now()/1e3;let s=t,n=!0,i=null;const{payload:o}=Mr(e.access_token);if(o.exp&&(s=o.exp,n=s<=t),n){const{data:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!a)return{data:{user:null,session:null},error:null};i=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)throw l;i={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return this._returnResult({data:{user:i.user,session:i},error:null})}catch(t){if(x(t))return this._returnResult({data:{session:null,user:null},error:t});throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){const{data:o,error:a}=t;if(a)throw a;e=(s=o.session)!==null&&s!==void 0?s:void 0}if(!e?.refresh_token)throw new _e;const{data:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{user:null,session:null},error:i}):n?this._returnResult({data:{user:n.user,session:n},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(t){if(x(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async _getSessionFromURL(e,t){try{if(!oe())throw new Ht("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Ht(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new gn("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Ht("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new gn("No code detected.");const{data:S,error:b}=await this._exchangeCodeForSession(e.code);if(b)throw b;const A=new URL(window.location.href);return A.searchParams.delete("code"),window.history.replaceState(window.history.state,"",A.toString()),{data:{session:S.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:n,access_token:i,refresh_token:o,expires_in:a,expires_at:l,token_type:c}=e;if(!i||!a||!o||!c)throw new Ht("No session defined in URL");const u=Math.round(Date.now()/1e3),d=parseInt(a);let g=u+d;l&&(g=parseInt(l));const f=g-u;f*1e3<=it&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${f}s, should have been closer to ${d}s`);const v=g-d;u-v>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",v,g,u):u-v<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",v,g,u);const{data:y,error:w}=await this._getUser(i);if(w)throw w;const _={provider_token:s,provider_refresh_token:n,access_token:i,expires_in:d,expires_at:g,refresh_token:o,token_type:c,user:y.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:_,redirectType:e.type},error:null})}catch(s){if(x(s))return this._returnResult({data:{session:null,redirectType:null},error:s});throw s}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await He(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;const{data:n,error:i}=t;if(i)return this._returnResult({error:i});const o=(s=n.session)===null||s===void 0?void 0:s.access_token;if(o){const{error:a}=await this.admin.signOut(o,e);if(a&&!(ml(a)&&(a.status===404||a.status===401||a.status===403)))return this._returnResult({error:a})}return e!=="others"&&(await this._removeSession(),await Le(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const t=Tl(),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,n;try{const{data:{session:i},error:o}=t;if(o)throw o;await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let s=null,n=null;this.flowType==="pkce"&&([s,n]=await tt(this.storage,this.storageKey,!0));try{return await U(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:n,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(x(i))return this._returnResult({data:null,error:i});throw i}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return this._returnResult({data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(t){if(x(t))return this._returnResult({data:null,error:t});throw t}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var t;try{const{data:s,error:n}=await this._useSession(async i=>{var o,a,l,c,u;const{data:d,error:g}=i;if(g)throw g;const f=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await U(this.fetch,"GET",f,{headers:this.headers,jwt:(u=(c=d.session)===null||c===void 0?void 0:c.access_token)!==null&&u!==void 0?u:void 0})});if(n)throw n;return oe()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(s?.url),this._returnResult({data:{provider:e.provider,url:s?.url},error:null})}catch(s){if(x(s))return this._returnResult({data:{provider:e.provider,url:null},error:s});throw s}}async linkIdentityIdToken(e){return await this._useSession(async t=>{var s;try{const{error:n,data:{session:i}}=t;if(n)throw n;const{options:o,provider:a,token:l,access_token:c,nonce:u}=e,d=await U(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(s=i?.access_token)!==null&&s!==void 0?s:void 0,body:{provider:a,id_token:l,access_token:c,nonce:u,link_identity:!0,gotrue_meta_security:{captcha_token:o?.captchaToken}},xform:Ee}),{data:g,error:f}=d;return f?this._returnResult({data:{user:null,session:null},error:f}):!g||!g.session||!g.user?this._returnResult({data:{user:null,session:null},error:new et}):(g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("USER_UPDATED",g.session)),this._returnResult({data:g,error:f}))}catch(n){if(x(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}})}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,n;const{data:i,error:o}=t;if(o)throw o;return await U(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(n=(s=i.session)===null||s===void 0?void 0:s.access_token)!==null&&n!==void 0?n:void 0})})}catch(t){if(x(t))return this._returnResult({data:null,error:t});throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const s=Date.now();return await kl(async n=>(n>0&&await Rl(200*Math.pow(2,n-1)),this._debug(t,"refreshing attempt",n),await U(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Ee})),(n,i)=>{const o=200*Math.pow(2,n);return i&&Nr(i)&&Date.now()+o-s<it})}catch(s){if(this._debug(t,"error",s),x(s))return this._returnResult({data:{session:null,user:null},error:s});throw s}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),oe()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e,t;const s="#_recoverAndRefresh()";this._debug(s,"begin");try{const n=await He(this.storage,this.storageKey);if(n&&this.userStorage){let o=await He(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:n.user},await ot(this.userStorage,this.storageKey+"-user",o)),n.user=(e=o?.user)!==null&&e!==void 0?e:Br()}else if(n&&!n.user&&!n.user){const o=await He(this.storage,this.storageKey+"-user");o&&o?.user?(n.user=o.user,await Le(this.storage,this.storageKey+"-user"),await ot(this.storage,this.storageKey,n)):n.user=Br()}if(this._debug(s,"session from storage",n),!this._isValidSession(n)){this._debug(s,"session is not valid"),n!==null&&await this._removeSession();return}const i=((t=n.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<$r;if(this._debug(s,`session has${i?"":" not"} expired with margin of ${$r}s`),i){if(this.autoRefreshToken&&n.refresh_token){const{error:o}=await this._callRefreshToken(n.refresh_token);o&&(console.error(o),Nr(o)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(n.user&&n.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:a}=await this._getUser(n.access_token);!a&&o?.user?(n.user=o.user,await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)):this._debug(s,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(s,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){this._debug(s,"error",n),console.error(n);return}finally{this._debug(s,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new _e;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new hr;const{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new _e;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const a={data:i.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(i){if(this._debug(n,"error",i),x(i)){const o={data:null,error:i};return Nr(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(i),i}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(e,t,s=!0){const n=`#_notifyAllSubscribers(${e})`;this._debug(n,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,t)}catch(l){i.push(l)}});if(await Promise.all(o),i.length>0){for(let a=0;a<i.length;a+=1)console.error(i[a]);throw i[0]}}finally{this._debug(n,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),s=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!s&&t.user&&await ot(this.userStorage,this.storageKey+"-user",{user:t.user});const n=Object.assign({},t);delete n.user;const i=wn(n);await ot(this.storage,this.storageKey,i)}else{const n=wn(t);await ot(this.storage,this.storageKey,n)}}async _removeSession(){this._debug("#_removeSession()"),await Le(this.storage,this.storageKey),await Le(this.storage,this.storageKey+"-code-verifier"),await Le(this.storage,this.storageKey+"-user"),this.userStorage&&await Le(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&oe()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),it);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:s}}=t;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const n=Math.floor((s.expires_at*1e3-e)/it);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${it}ms, refresh threshold is ${ts} ticks`),n<=ts&&await this._callRefreshToken(s.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Bi)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!oe()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const n=[`provider=${encodeURIComponent(t)}`];if(s?.redirectTo&&n.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s?.scopes&&n.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[i,o]=await tt(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});n.push(a.toString())}if(s?.queryParams){const i=new URLSearchParams(s.queryParams);n.push(i.toString())}return s?.skipBrowserRedirect&&n.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${n.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;const{data:n,error:i}=t;return i?this._returnResult({data:null,error:i}):await U(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=n?.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(x(t))return this._returnResult({data:null,error:t});throw t}}async _enroll(e){try{return await this._useSession(async t=>{var s,n;const{data:i,error:o}=t;if(o)return this._returnResult({data:null,error:o});const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:l,error:c}=await U(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(s=i?.session)===null||s===void 0?void 0:s.access_token});return c?this._returnResult({data:null,error:c}):(e.factorType==="totp"&&l.type==="totp"&&(!((n=l?.totp)===null||n===void 0)&&n.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),this._returnResult({data:l,error:null}))})}catch(t){if(x(t))return this._returnResult({data:null,error:t});throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:n,error:i}=t;if(i)return this._returnResult({data:null,error:i});const o=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?ic(e.webauthn.credential_response):oc(e.webauthn.credential_response)})}:{code:e.code}),{data:a,error:l}=await U(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:o,headers:this.headers,jwt:(s=n?.session)===null||s===void 0?void 0:s.access_token});return l?this._returnResult({data:null,error:l}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),this._returnResult({data:a,error:l}))})}catch(t){if(x(t))return this._returnResult({data:null,error:t});throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:n,error:i}=t;if(i)return this._returnResult({data:null,error:i});const o=await U(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(s=n?.session)===null||s===void 0?void 0:s.access_token});if(o.error)return o;const{data:a}=o;if(a.type!=="webauthn")return{data:a,error:null};switch(a.webauthn.type){case"create":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:sc(a.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:nc(a.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(t){if(x(t))return this._returnResult({data:null,error:t});throw t}})}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?this._returnResult({data:null,error:s}):await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){var e;const{data:{user:t},error:s}=await this.getUser();if(s)return{data:null,error:s};const n={all:[],phone:[],totp:[],webauthn:[]};for(const i of(e=t?.factors)!==null&&e!==void 0?e:[])n.all.push(i),i.status==="verified"&&n[i.factor_type].push(i);return{data:n,error:null}}async _getAuthenticatorAssuranceLevel(){var e,t;const{data:{session:s},error:n}=await this.getSession();if(n)return this._returnResult({data:null,error:n});if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=Mr(s.access_token);let o=null;i.aal&&(o=i.aal);let a=o;((t=(e=s.user.factors)===null||e===void 0?void 0:e.filter(u=>u.status==="verified"))!==null&&t!==void 0?t:[]).length>0&&(a="aal2");const c=i.amr||[];return{data:{currentLevel:o,nextLevel:a,currentAuthenticationMethods:c},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async t=>{const{data:{session:s},error:n}=t;return n?this._returnResult({data:null,error:n}):s?await U(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:s.access_token,xform:i=>({data:i,error:null})}):this._returnResult({data:null,error:new _e})})}catch(t){if(x(t))return this._returnResult({data:null,error:t});throw t}}async _approveAuthorization(e,t){try{return await this._useSession(async s=>{const{data:{session:n},error:i}=s;if(i)return this._returnResult({data:null,error:i});if(!n)return this._returnResult({data:null,error:new _e});const o=await U(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:n.access_token,body:{action:"approve"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&oe()&&!t?.skipBrowserRedirect&&window.location.assign(o.data.redirect_url),o})}catch(s){if(x(s))return this._returnResult({data:null,error:s});throw s}}async _denyAuthorization(e,t){try{return await this._useSession(async s=>{const{data:{session:n},error:i}=s;if(i)return this._returnResult({data:null,error:i});if(!n)return this._returnResult({data:null,error:new _e});const o=await U(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:n.access_token,body:{action:"deny"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&oe()&&!t?.skipBrowserRedirect&&window.location.assign(o.data.redirect_url),o})}catch(s){if(x(s))return this._returnResult({data:null,error:s});throw s}}async fetchJwk(e,t={keys:[]}){let s=t.keys.find(a=>a.kid===e);if(s)return s;const n=Date.now();if(s=this.jwks.keys.find(a=>a.kid===e),s&&this.jwks_cached_at+gl>n)return s;const{data:i,error:o}=await U(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=n,s=i.keys.find(a=>a.kid===e),!s)?null:s}async getClaims(e,t={}){try{let s=e;if(!s){const{data:f,error:v}=await this.getSession();if(v||!f.session)return this._returnResult({data:null,error:v});s=f.session.access_token}const{header:n,payload:i,signature:o,raw:{header:a,payload:l}}=Mr(s);t?.allowExpired||Dl(i.exp);const c=!n.alg||n.alg.startsWith("HS")||!n.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(n.kid,t?.keys?{keys:t.keys}:t?.jwks);if(!c){const{error:f}=await this.getUser(s);if(f)throw f;return{data:{claims:i,header:n,signature:o},error:null}}const u=$l(n.alg),d=await crypto.subtle.importKey("jwk",c,u,!0,["verify"]);if(!await crypto.subtle.verify(u,d,o,Sl(`${a}.${l}`)))throw new ns("Invalid JWT signature");return{data:{claims:i,header:n,signature:o},error:null}}catch(s){if(x(s))return this._returnResult({data:null,error:s});throw s}}}Ct.nextInstanceID={};const pc=Ct;class mc extends pc{constructor(e){super(e)}}class vc{constructor(e,t,s){var n,i,o;this.supabaseUrl=e,this.supabaseKey=t;const a=cl(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",a),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",a),this.storageUrl=new URL("storage/v1",a),this.functionsUrl=new URL("functions/v1",a);const l=`sb-${a.hostname.split(".")[0]}-auth-token`,c={db:tl,realtime:sl,auth:Object.assign(Object.assign({},rl),{storageKey:l}),global:el},u=ll(s??{},c);this.storageKey=(n=u.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(i=u.global.headers)!==null&&i!==void 0?i:{},u.accessToken?(this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(d,g)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(g)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=u.auth)!==null&&o!==void 0?o:{},this.headers,u.global.fetch),this.fetch=ol(t,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},u.realtime)),this.accessToken&&this.accessToken().then(d=>this.realtime.setAuth(d)).catch(d=>console.warn("Failed to set initial Realtime auth token:",d)),this.rest=new ua(new URL("rest/v1",a).href,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),this.storage=new Xa(this.storageUrl.href,this.headers,this.fetch,s?.storage),u.accessToken||this._listenForAuthEvents()}get functions(){return new na(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e,t;if(this.accessToken)return await this.accessToken();const{data:s}=await this.auth.getSession();return(t=(e=s.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:n,userStorage:i,storageKey:o,flowType:a,lock:l,debug:c,throwOnError:u},d,g){const f={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new mc({url:this.authUrl.href,headers:Object.assign(Object.assign({},f),d),storageKey:o,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:n,userStorage:i,flowType:a,lock:l,debug:c,throwOnError:u,fetch:g,hasCustomAuthorizationHeader:Object.keys(this.headers).some(v=>v.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new Oa(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,s)=>{this._handleTokenChanged(t,"CLIENT",s?.access_token)})}_handleTokenChanged(e,t,s){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==s?(this.changedAccessToken=s,this.realtime.setAuth(s)):e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const yc=(r,e,t)=>new vc(r,e,t);function wc(){if(typeof window<"u"||typeof process>"u")return!1;const r=process.version;if(r==null)return!1;const e=r.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}wc()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const bc=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,Vi=new Set,is=typeof process=="object"&&process?process:{},Wi=(r,e,t,s)=>{typeof is.emitWarning=="function"?is.emitWarning(r,e,t,s):console.error(`[${t}] ${e}: ${r}`)};let sr=globalThis.AbortController,Cn=globalThis.AbortSignal;if(typeof sr>"u"){Cn=class{onabort;_onabort=[];reason;aborted=!1;addEventListener(s,n){this._onabort.push(n)}},sr=class{constructor(){e()}signal=new Cn;abort(s){if(!this.signal.aborted){this.signal.reason=s,this.signal.aborted=!0;for(const n of this.signal._onabort)n(s);this.signal.onabort?.(s)}}};let r=is.env?.LRU_CACHE_IGNORE_AC_WARNING!=="1";const e=()=>{r&&(r=!1,Wi("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",e))}}const _c=r=>!Vi.has(r),Ue=r=>r&&r===Math.floor(r)&&r>0&&isFinite(r),Hi=r=>Ue(r)?r<=Math.pow(2,8)?Uint8Array:r<=Math.pow(2,16)?Uint16Array:r<=Math.pow(2,32)?Uint32Array:r<=Number.MAX_SAFE_INTEGER?Gt:null:null;class Gt extends Array{constructor(e){super(e),this.fill(0)}}class at{heap;length;static#l=!1;static create(e){const t=Hi(e);if(!t)return[];at.#l=!0;const s=new at(e,t);return at.#l=!1,s}constructor(e,t){if(!at.#l)throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new t(e),this.length=0}push(e){this.heap[this.length++]=e}pop(){return this.heap[--this.length]}}class fr{#l;#d;#p;#R;#m;#x;#L;#v;get perf(){return this.#v}ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#n;#y;#s;#r;#e;#c;#h;#a;#i;#w;#o;#b;#_;#f;#E;#O;#u;#j;static unsafeExposeInternals(e){return{starts:e.#_,ttls:e.#f,sizes:e.#b,keyMap:e.#s,keyList:e.#r,valList:e.#e,next:e.#c,prev:e.#h,get head(){return e.#a},get tail(){return e.#i},free:e.#w,isBackgroundFetch:t=>e.#t(t),backgroundFetch:(t,s,n,i)=>e.#$(t,s,n,i),moveToTail:t=>e.#P(t),indexes:t=>e.#S(t),rindexes:t=>e.#A(t),isStale:t=>e.#g(t)}}get max(){return this.#l}get maxSize(){return this.#d}get calculatedSize(){return this.#y}get size(){return this.#n}get fetchMethod(){return this.#x}get memoMethod(){return this.#L}get dispose(){return this.#p}get onInsert(){return this.#R}get disposeAfter(){return this.#m}constructor(e){const{max:t=0,ttl:s,ttlResolution:n=1,ttlAutopurge:i,updateAgeOnGet:o,updateAgeOnHas:a,allowStale:l,dispose:c,onInsert:u,disposeAfter:d,noDisposeOnSet:g,noUpdateTTL:f,maxSize:v=0,maxEntrySize:y=0,sizeCalculation:w,fetchMethod:_,memoMethod:S,noDeleteOnFetchRejection:b,noDeleteOnStaleGet:A,allowStaleOnFetchRejection:k,allowStaleOnFetchAbort:I,ignoreFetchAbort:$,perf:W}=e;if(W!==void 0&&typeof W?.now!="function")throw new TypeError("perf option must have a now() method if specified");if(this.#v=W??bc,t!==0&&!Ue(t))throw new TypeError("max option must be a nonnegative integer");const B=t?Hi(t):Array;if(!B)throw new Error("invalid max value: "+t);if(this.#l=t,this.#d=v,this.maxEntrySize=y||this.#d,this.sizeCalculation=w,this.sizeCalculation){if(!this.#d&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(S!==void 0&&typeof S!="function")throw new TypeError("memoMethod must be a function if defined");if(this.#L=S,_!==void 0&&typeof _!="function")throw new TypeError("fetchMethod must be a function if specified");if(this.#x=_,this.#O=!!_,this.#s=new Map,this.#r=new Array(t).fill(void 0),this.#e=new Array(t).fill(void 0),this.#c=new B(t),this.#h=new B(t),this.#a=0,this.#i=0,this.#w=at.create(t),this.#n=0,this.#y=0,typeof c=="function"&&(this.#p=c),typeof u=="function"&&(this.#R=u),typeof d=="function"?(this.#m=d,this.#o=[]):(this.#m=void 0,this.#o=void 0),this.#E=!!this.#p,this.#j=!!this.#R,this.#u=!!this.#m,this.noDisposeOnSet=!!g,this.noUpdateTTL=!!f,this.noDeleteOnFetchRejection=!!b,this.allowStaleOnFetchRejection=!!k,this.allowStaleOnFetchAbort=!!I,this.ignoreFetchAbort=!!$,this.maxEntrySize!==0){if(this.#d!==0&&!Ue(this.#d))throw new TypeError("maxSize must be a positive integer if specified");if(!Ue(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.#W()}if(this.allowStale=!!l,this.noDeleteOnStaleGet=!!A,this.updateAgeOnGet=!!o,this.updateAgeOnHas=!!a,this.ttlResolution=Ue(n)||n===0?n:1,this.ttlAutopurge=!!i,this.ttl=s||0,this.ttl){if(!Ue(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.#N()}if(this.#l===0&&this.ttl===0&&this.#d===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#l&&!this.#d){const ve="LRU_CACHE_UNBOUNDED";_c(ve)&&(Vi.add(ve),Wi("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",ve,fr))}}getRemainingTTL(e){return this.#s.has(e)?1/0:0}#N(){const e=new Gt(this.#l),t=new Gt(this.#l);this.#f=e,this.#_=t,this.#M=(i,o,a=this.#v.now())=>{if(t[i]=o!==0?a:0,e[i]=o,o!==0&&this.ttlAutopurge){const l=setTimeout(()=>{this.#g(i)&&this.#T(this.#r[i],"expire")},o+1);l.unref&&l.unref()}},this.#k=i=>{t[i]=e[i]!==0?this.#v.now():0},this.#C=(i,o)=>{if(e[o]){const a=e[o],l=t[o];if(!a||!l)return;i.ttl=a,i.start=l,i.now=s||n();const c=i.now-l;i.remainingTTL=a-c}};let s=0;const n=()=>{const i=this.#v.now();if(this.ttlResolution>0){s=i;const o=setTimeout(()=>s=0,this.ttlResolution);o.unref&&o.unref()}return i};this.getRemainingTTL=i=>{const o=this.#s.get(i);if(o===void 0)return 0;const a=e[o],l=t[o];if(!a||!l)return 1/0;const c=(s||n())-l;return a-c},this.#g=i=>{const o=t[i],a=e[i];return!!a&&!!o&&(s||n())-o>a}}#k=()=>{};#C=()=>{};#M=()=>{};#g=()=>!1;#W(){const e=new Gt(this.#l);this.#y=0,this.#b=e,this.#I=t=>{this.#y-=e[t],e[t]=0},this.#B=(t,s,n,i)=>{if(this.#t(s))return 0;if(!Ue(n))if(i){if(typeof i!="function")throw new TypeError("sizeCalculation must be a function");if(n=i(s,t),!Ue(n))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return n},this.#U=(t,s,n)=>{if(e[t]=s,this.#d){const i=this.#d-e[t];for(;this.#y>i;)this.#D(!0)}this.#y+=e[t],n&&(n.entrySize=s,n.totalCalculatedSize=this.#y)}}#I=e=>{};#U=(e,t,s)=>{};#B=(e,t,s,n)=>{if(s||n)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0};*#S({allowStale:e=this.allowStale}={}){if(this.#n)for(let t=this.#i;!(!this.#F(t)||((e||!this.#g(t))&&(yield t),t===this.#a));)t=this.#h[t]}*#A({allowStale:e=this.allowStale}={}){if(this.#n)for(let t=this.#a;!(!this.#F(t)||((e||!this.#g(t))&&(yield t),t===this.#i));)t=this.#c[t]}#F(e){return e!==void 0&&this.#s.get(this.#r[e])===e}*entries(){for(const e of this.#S())this.#e[e]!==void 0&&this.#r[e]!==void 0&&!this.#t(this.#e[e])&&(yield[this.#r[e],this.#e[e]])}*rentries(){for(const e of this.#A())this.#e[e]!==void 0&&this.#r[e]!==void 0&&!this.#t(this.#e[e])&&(yield[this.#r[e],this.#e[e]])}*keys(){for(const e of this.#S()){const t=this.#r[e];t!==void 0&&!this.#t(this.#e[e])&&(yield t)}}*rkeys(){for(const e of this.#A()){const t=this.#r[e];t!==void 0&&!this.#t(this.#e[e])&&(yield t)}}*values(){for(const e of this.#S())this.#e[e]!==void 0&&!this.#t(this.#e[e])&&(yield this.#e[e])}*rvalues(){for(const e of this.#A())this.#e[e]!==void 0&&!this.#t(this.#e[e])&&(yield this.#e[e])}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="LRUCache";find(e,t={}){for(const s of this.#S()){const n=this.#e[s],i=this.#t(n)?n.__staleWhileFetching:n;if(i!==void 0&&e(i,this.#r[s],this))return this.get(this.#r[s],t)}}forEach(e,t=this){for(const s of this.#S()){const n=this.#e[s],i=this.#t(n)?n.__staleWhileFetching:n;i!==void 0&&e.call(t,i,this.#r[s],this)}}rforEach(e,t=this){for(const s of this.#A()){const n=this.#e[s],i=this.#t(n)?n.__staleWhileFetching:n;i!==void 0&&e.call(t,i,this.#r[s],this)}}purgeStale(){let e=!1;for(const t of this.#A({allowStale:!0}))this.#g(t)&&(this.#T(this.#r[t],"expire"),e=!0);return e}info(e){const t=this.#s.get(e);if(t===void 0)return;const s=this.#e[t],n=this.#t(s)?s.__staleWhileFetching:s;if(n===void 0)return;const i={value:n};if(this.#f&&this.#_){const o=this.#f[t],a=this.#_[t];if(o&&a){const l=o-(this.#v.now()-a);i.ttl=l,i.start=Date.now()}}return this.#b&&(i.size=this.#b[t]),i}dump(){const e=[];for(const t of this.#S({allowStale:!0})){const s=this.#r[t],n=this.#e[t],i=this.#t(n)?n.__staleWhileFetching:n;if(i===void 0||s===void 0)continue;const o={value:i};if(this.#f&&this.#_){o.ttl=this.#f[t];const a=this.#v.now()-this.#_[t];o.start=Math.floor(Date.now()-a)}this.#b&&(o.size=this.#b[t]),e.unshift([s,o])}return e}load(e){this.clear();for(const[t,s]of e){if(s.start){const n=Date.now()-s.start;s.start=this.#v.now()-n}this.set(t,s.value,s)}}set(e,t,s={}){if(t===void 0)return this.delete(e),this;const{ttl:n=this.ttl,start:i,noDisposeOnSet:o=this.noDisposeOnSet,sizeCalculation:a=this.sizeCalculation,status:l}=s;let{noUpdateTTL:c=this.noUpdateTTL}=s;const u=this.#B(e,t,s.size||0,a);if(this.maxEntrySize&&u>this.maxEntrySize)return l&&(l.set="miss",l.maxEntrySizeExceeded=!0),this.#T(e,"set"),this;let d=this.#n===0?void 0:this.#s.get(e);if(d===void 0)d=this.#n===0?this.#i:this.#w.length!==0?this.#w.pop():this.#n===this.#l?this.#D(!1):this.#n,this.#r[d]=e,this.#e[d]=t,this.#s.set(e,d),this.#c[this.#i]=d,this.#h[d]=this.#i,this.#i=d,this.#n++,this.#U(d,u,l),l&&(l.set="add"),c=!1,this.#j&&this.#R?.(t,e,"add");else{this.#P(d);const g=this.#e[d];if(t!==g){if(this.#O&&this.#t(g)){g.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:f}=g;f!==void 0&&!o&&(this.#E&&this.#p?.(f,e,"set"),this.#u&&this.#o?.push([f,e,"set"]))}else o||(this.#E&&this.#p?.(g,e,"set"),this.#u&&this.#o?.push([g,e,"set"]));if(this.#I(d),this.#U(d,u,l),this.#e[d]=t,l){l.set="replace";const f=g&&this.#t(g)?g.__staleWhileFetching:g;f!==void 0&&(l.oldValue=f)}}else l&&(l.set="update");this.#j&&this.onInsert?.(t,e,t===g?"update":"replace")}if(n!==0&&!this.#f&&this.#N(),this.#f&&(c||this.#M(d,n,i),l&&this.#C(l,d)),!o&&this.#u&&this.#o){const g=this.#o;let f;for(;f=g?.shift();)this.#m?.(...f)}return this}pop(){try{for(;this.#n;){const e=this.#e[this.#a];if(this.#D(!0),this.#t(e)){if(e.__staleWhileFetching)return e.__staleWhileFetching}else if(e!==void 0)return e}}finally{if(this.#u&&this.#o){const e=this.#o;let t;for(;t=e?.shift();)this.#m?.(...t)}}}#D(e){const t=this.#a,s=this.#r[t],n=this.#e[t];return this.#O&&this.#t(n)?n.__abortController.abort(new Error("evicted")):(this.#E||this.#u)&&(this.#E&&this.#p?.(n,s,"evict"),this.#u&&this.#o?.push([n,s,"evict"])),this.#I(t),e&&(this.#r[t]=void 0,this.#e[t]=void 0,this.#w.push(t)),this.#n===1?(this.#a=this.#i=0,this.#w.length=0):this.#a=this.#c[t],this.#s.delete(s),this.#n--,t}has(e,t={}){const{updateAgeOnHas:s=this.updateAgeOnHas,status:n}=t,i=this.#s.get(e);if(i!==void 0){const o=this.#e[i];if(this.#t(o)&&o.__staleWhileFetching===void 0)return!1;if(this.#g(i))n&&(n.has="stale",this.#C(n,i));else return s&&this.#k(i),n&&(n.has="hit",this.#C(n,i)),!0}else n&&(n.has="miss");return!1}peek(e,t={}){const{allowStale:s=this.allowStale}=t,n=this.#s.get(e);if(n===void 0||!s&&this.#g(n))return;const i=this.#e[n];return this.#t(i)?i.__staleWhileFetching:i}#$(e,t,s,n){const i=t===void 0?void 0:this.#e[t];if(this.#t(i))return i;const o=new sr,{signal:a}=s;a?.addEventListener("abort",()=>o.abort(a.reason),{signal:o.signal});const l={signal:o.signal,options:s,context:n},c=(y,w=!1)=>{const{aborted:_}=o.signal,S=s.ignoreFetchAbort&&y!==void 0;if(s.status&&(_&&!w?(s.status.fetchAborted=!0,s.status.fetchError=o.signal.reason,S&&(s.status.fetchAbortIgnored=!0)):s.status.fetchResolved=!0),_&&!S&&!w)return d(o.signal.reason);const b=f,A=this.#e[t];return(A===f||S&&w&&A===void 0)&&(y===void 0?b.__staleWhileFetching!==void 0?this.#e[t]=b.__staleWhileFetching:this.#T(e,"fetch"):(s.status&&(s.status.fetchUpdated=!0),this.set(e,y,l.options))),y},u=y=>(s.status&&(s.status.fetchRejected=!0,s.status.fetchError=y),d(y)),d=y=>{const{aborted:w}=o.signal,_=w&&s.allowStaleOnFetchAbort,S=_||s.allowStaleOnFetchRejection,b=S||s.noDeleteOnFetchRejection,A=f;if(this.#e[t]===f&&(!b||A.__staleWhileFetching===void 0?this.#T(e,"fetch"):_||(this.#e[t]=A.__staleWhileFetching)),S)return s.status&&A.__staleWhileFetching!==void 0&&(s.status.returnedStale=!0),A.__staleWhileFetching;if(A.__returned===A)throw y},g=(y,w)=>{const _=this.#x?.(e,i,l);_&&_ instanceof Promise&&_.then(S=>y(S===void 0?void 0:S),w),o.signal.addEventListener("abort",()=>{(!s.ignoreFetchAbort||s.allowStaleOnFetchAbort)&&(y(void 0),s.allowStaleOnFetchAbort&&(y=S=>c(S,!0)))})};s.status&&(s.status.fetchDispatched=!0);const f=new Promise(g).then(c,u),v=Object.assign(f,{__abortController:o,__staleWhileFetching:i,__returned:void 0});return t===void 0?(this.set(e,v,{...l.options,status:void 0}),t=this.#s.get(e)):this.#e[t]=v,v}#t(e){if(!this.#O)return!1;const t=e;return!!t&&t instanceof Promise&&t.hasOwnProperty("__staleWhileFetching")&&t.__abortController instanceof sr}async fetch(e,t={}){const{allowStale:s=this.allowStale,updateAgeOnGet:n=this.updateAgeOnGet,noDeleteOnStaleGet:i=this.noDeleteOnStaleGet,ttl:o=this.ttl,noDisposeOnSet:a=this.noDisposeOnSet,size:l=0,sizeCalculation:c=this.sizeCalculation,noUpdateTTL:u=this.noUpdateTTL,noDeleteOnFetchRejection:d=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:g=this.allowStaleOnFetchRejection,ignoreFetchAbort:f=this.ignoreFetchAbort,allowStaleOnFetchAbort:v=this.allowStaleOnFetchAbort,context:y,forceRefresh:w=!1,status:_,signal:S}=t;if(!this.#O)return _&&(_.fetch="get"),this.get(e,{allowStale:s,updateAgeOnGet:n,noDeleteOnStaleGet:i,status:_});const b={allowStale:s,updateAgeOnGet:n,noDeleteOnStaleGet:i,ttl:o,noDisposeOnSet:a,size:l,sizeCalculation:c,noUpdateTTL:u,noDeleteOnFetchRejection:d,allowStaleOnFetchRejection:g,allowStaleOnFetchAbort:v,ignoreFetchAbort:f,status:_,signal:S};let A=this.#s.get(e);if(A===void 0){_&&(_.fetch="miss");const k=this.#$(e,A,b,y);return k.__returned=k}else{const k=this.#e[A];if(this.#t(k)){const ve=s&&k.__staleWhileFetching!==void 0;return _&&(_.fetch="inflight",ve&&(_.returnedStale=!0)),ve?k.__staleWhileFetching:k.__returned=k}const I=this.#g(A);if(!w&&!I)return _&&(_.fetch="hit"),this.#P(A),n&&this.#k(A),_&&this.#C(_,A),k;const $=this.#$(e,A,b,y),B=$.__staleWhileFetching!==void 0&&s;return _&&(_.fetch=I?"stale":"refresh",B&&I&&(_.returnedStale=!0)),B?$.__staleWhileFetching:$.__returned=$}}async forceFetch(e,t={}){const s=await this.fetch(e,t);if(s===void 0)throw new Error("fetch() returned undefined");return s}memo(e,t={}){const s=this.#L;if(!s)throw new Error("no memoMethod provided to constructor");const{context:n,forceRefresh:i,...o}=t,a=this.get(e,o);if(!i&&a!==void 0)return a;const l=s(e,a,{options:o,context:n});return this.set(e,l,o),l}get(e,t={}){const{allowStale:s=this.allowStale,updateAgeOnGet:n=this.updateAgeOnGet,noDeleteOnStaleGet:i=this.noDeleteOnStaleGet,status:o}=t,a=this.#s.get(e);if(a!==void 0){const l=this.#e[a],c=this.#t(l);return o&&this.#C(o,a),this.#g(a)?(o&&(o.get="stale"),c?(o&&s&&l.__staleWhileFetching!==void 0&&(o.returnedStale=!0),s?l.__staleWhileFetching:void 0):(i||this.#T(e,"expire"),o&&s&&(o.returnedStale=!0),s?l:void 0)):(o&&(o.get="hit"),c?l.__staleWhileFetching:(this.#P(a),n&&this.#k(a),l))}else o&&(o.get="miss")}#q(e,t){this.#h[t]=e,this.#c[e]=t}#P(e){e!==this.#i&&(e===this.#a?this.#a=this.#c[e]:this.#q(this.#h[e],this.#c[e]),this.#q(this.#i,e),this.#i=e)}delete(e){return this.#T(e,"delete")}#T(e,t){let s=!1;if(this.#n!==0){const n=this.#s.get(e);if(n!==void 0)if(s=!0,this.#n===1)this.#V(t);else{this.#I(n);const i=this.#e[n];if(this.#t(i)?i.__abortController.abort(new Error("deleted")):(this.#E||this.#u)&&(this.#E&&this.#p?.(i,e,t),this.#u&&this.#o?.push([i,e,t])),this.#s.delete(e),this.#r[n]=void 0,this.#e[n]=void 0,n===this.#i)this.#i=this.#h[n];else if(n===this.#a)this.#a=this.#c[n];else{const o=this.#h[n];this.#c[o]=this.#c[n];const a=this.#c[n];this.#h[a]=this.#h[n]}this.#n--,this.#w.push(n)}}if(this.#u&&this.#o?.length){const n=this.#o;let i;for(;i=n?.shift();)this.#m?.(...i)}return s}clear(){return this.#V("delete")}#V(e){for(const t of this.#A({allowStale:!0})){const s=this.#e[t];if(this.#t(s))s.__abortController.abort(new Error("deleted"));else{const n=this.#r[t];this.#E&&this.#p?.(s,n,e),this.#u&&this.#o?.push([s,n,e])}}if(this.#s.clear(),this.#e.fill(void 0),this.#r.fill(void 0),this.#f&&this.#_&&(this.#f.fill(0),this.#_.fill(0)),this.#b&&this.#b.fill(0),this.#a=0,this.#i=0,this.#w.length=0,this.#y=0,this.#n=0,this.#u&&this.#o){const t=this.#o;let s;for(;s=t?.shift();)this.#m?.(...s)}}}const zi={currentPage:1,totalMovies:0,activeFilters:{searchTerm:"",genre:null,year:null,country:null,director:null,actor:null,selection:null,studio:null,sort:Me.SORT,mediaType:Me.MEDIA_TYPE,excludedGenres:[],excludedCountries:[]},userMovieData:{}};let K=structuredClone(zi);const ft=()=>{const r={...K};return r.activeFilters=be(),r.userMovieData={...K.userMovieData},r},be=()=>{const r={...K.activeFilters};return r.excludedGenres=[...K.activeFilters.excludedGenres],r.excludedCountries=[...K.activeFilters.excludedCountries],r},Ot=()=>K.currentPage;function Ec(){const{activeFilters:r}=K;for(const e in r){if(e==="mediaType"||e==="sort")continue;const t=r[e];if(Array.isArray(t)?t.length>0:t)return!0}return!1}const gr=r=>{const e=K.userMovieData[r];return e?{...e}:void 0};function Ts(){const{activeFilters:r}=K;let e=0;["selection","studio","genre","country","director","actor"].forEach(n=>{r[n]&&e++}),r.excludedGenres.length>0&&e++,r.excludedCountries.length>0&&e++;const s=`${N.YEAR_MIN}-${N.YEAR_MAX}`;return r.year&&r.year!==s&&e++,e}function os(r){K.currentPage=r}function Sc(r){K.totalMovies=r}function ee(r,e,t=!1){if(r in K.activeFilters){const s=e!==null&&K.activeFilters[r]!==e;return!t&&s&&Ts()>=N.MAX_ACTIVE_FILTERS?!1:(K.activeFilters[r]=e,!0)}return!1}function Gi(r){K.activeFilters.searchTerm=r}function Rt(r){K.activeFilters.sort=r}function nr(r){K.activeFilters.mediaType=r}function On(r,e){const t={genre:{list:K.activeFilters.excludedGenres,limit:N.MAX_EXCLUDED_FILTERS},country:{list:K.activeFilters.excludedCountries,limit:N.MAX_EXCLUDED_FILTERS}};if(!t[r])return!1;const{list:s,limit:n}=t[r],i=s.indexOf(e);return i>-1?(s.splice(i,1),!0):s.length>=n||Ts()>=N.MAX_ACTIVE_FILTERS?!1:(s.push(e),!0)}function Cs(){K.activeFilters=structuredClone(zi.activeFilters),K.totalMovies=0}function Ac(r){K.userMovieData=r||{}}function ir(r,e){K.userMovieData[r]||(K.userMovieData[r]={onWatchlist:!1,rating:null}),Object.assign(K.userMovieData[r],e),document.dispatchEvent(new CustomEvent("userMovieDataChanged",{detail:{movieId:r}}))}function Tc(){K.userMovieData={}}const Ce=yc(N.SUPABASE_URL,N.SUPABASE_ANON_KEY),qr=new fr({max:300,ttl:1e3*60*30,updateAgeOnGet:!0,ttlAutopurge:!0}),Vr=new fr({max:100,ttl:1e3*60*5});function Cc(r,e,t){const s={};return Object.keys(r).sort().forEach(n=>{const i=r[n],o=i!=null&&i!=="",a=Array.isArray(i)&&i.length>0;o&&(!Array.isArray(i)||a)&&(s[n]=a?[...i].sort():i)}),JSON.stringify({filters:s,page:e,pageSize:t})}function Oc(r,e,t,s){let n=null,i=null;if(r.year){const c=r.year.split("-").map(Number);c.length===2&&!c.some(isNaN)&&([n,i]=c)}const[o="relevance",a="asc"]=(r.sort||"relevance,asc").split(","),l=(e-1)*t;return{search_term:r.searchTerm||null,genre_name:r.genre||null,p_year_start:n,p_year_end:i,country_name:r.country||null,director_name:r.director||null,actor_name:r.actor||null,media_type:r.mediaType||"all",p_selection_code:r.selection||null,p_studio_code:r.studio||null,excluded_genres:r.excludedGenres?.length>0?r.excludedGenres:null,excluded_countries:r.excludedCountries?.length>0?r.excludedCountries:null,sort_field:o,sort_direction:a,page_limit:t,page_offset:l,get_count:s}}async function Ki(r,e,t=N.ITEMS_PER_PAGE,s,n=!0){const i=Cc({...r,requestCount:n},e,t);return qr.has(i)?qr.get(i):(async()=>{try{const o=Oc(r,e,t,n);let a=Ce.rpc("search_movies_offset",o);s&&(a=a.abortSignal(s));const{data:l,error:c}=await a;if(c){if(c.name==="AbortError"||c.message?.includes("abort"))return{aborted:!0,items:[],total:-1};throw console.error("[API] Error RPC Supabase:",c),new Error("Error de base de datos al obtener películas.")}const u={total:l?.total??-1,items:l?.items||[]};return s?.aborted||qr.set(i,u),u}catch(o){if(o.name==="AbortError"||s&&s.aborted)return{aborted:!0,items:[],total:-1};throw o}})()}async function Rc(){const{data:r,error:e}=await Ce.from("user_movie_entries").select("movie_id, rating, on_watchlist");if(e)throw new Error("No se pudieron cargar tus datos.");const t={};return r&&r.forEach(s=>{t[s.movie_id]={rating:s.rating,onWatchlist:s.on_watchlist}}),t}async function Ji(r,e){const{data:{session:t}}=await Ce.auth.getSession();if(!t||!t.user)throw new Error("Debes iniciar sesión.");const s=t.user.id,i={...gr(r)||{rating:null,onWatchlist:!1},...e},o={user_id:s,movie_id:r,rating:i.rating,on_watchlist:i.onWatchlist,updated_at:new Date().toISOString()},{error:a}=await Ce.from("user_movie_entries").upsert(o,{onConflict:"user_id, movie_id"});if(a)throw new Error("No se pudo guardar tu acción.")}const pr=async(r,e)=>{if(!e||e.length<2)return[];const t=`suggest:${r}:${e.toLowerCase()}`;if(Vr.has(t))return Vr.get(t);const s=`suggestion-${r}`,n=Gn(s);try{const{data:i,error:o}=await Ce.rpc(r,{search_term:e}).abortSignal(n.signal);if(o)return o.name==="AbortError"?[]:[];const a=i.map(l=>l.suggestion);return Vr.set(t,a),a}catch{return[]}},kc=r=>pr("get_genre_suggestions",r),Ic=r=>pr("get_director_suggestions",r),Pc=r=>pr("get_country_suggestions",r),xc=async r=>(await pr("get_actor_suggestions",r)).filter(t=>!Et.includes(t.toLowerCase())),Lc=async()=>{const{data:r,error:e}=await Ce.rpc("get_random_top_actors",{limit_count:5});return e?[]:r.map(t=>t.name).filter(t=>!Et.includes(t.toLowerCase()))},jc=async()=>{const{data:r,error:e}=await Ce.rpc("get_random_top_directors",{limit_count:5});return e?[]:r.map(t=>t.name)},P={gridContainer:document.querySelector(M.GRID_CONTAINER),paginationContainer:document.querySelector(M.PAGINATION_CONTAINER),searchForm:document.querySelector(M.SEARCH_FORM),searchInput:document.querySelector(M.SEARCH_INPUT),sortSelect:document.querySelector(M.SORT_SELECT),themeToggleButton:document.querySelector(M.THEME_TOGGLE),sidebarOverlay:document.querySelector(M.SIDEBAR_OVERLAY),sidebar:document.querySelector(".sidebar"),typeFilterToggle:document.querySelector(M.TYPE_FILTER_TOGGLE),headerPrevBtn:document.querySelector(M.HEADER_PREV_BTN),headerNextBtn:document.querySelector(M.HEADER_NEXT_BTN),autocompleteResults:document.querySelector(M.AUTOCOMPLETE_RESULTS),mainHeader:document.querySelector(".main-header"),clearFiltersBtn:document.querySelector(M.CLEAR_FILTERS_BTN),totalResultsContainer:document.getElementById("total-results-container"),totalResultsCount:document.getElementById("total-results-count"),authModal:document.getElementById("auth-modal"),authOverlay:document.getElementById("auth-overlay"),loginButton:document.getElementById("login-button"),toastContainer:document.querySelector(M.TOAST_CONTAINER)},Uc=5e3;function Ae(r,e="error"){const t=P.toastContainer;if(!t)return;const s=q("div",{className:`toast toast--${e}`,textContent:r,attributes:{role:"alert"}});t.appendChild(s),setTimeout(()=>s.remove(),Uc)}function Dc(r,e,t){if(!r)return;r.textContent="";const s=Math.ceil(e/N.ITEMS_PER_PAGE);if(s<=1)return;const n=(c,u=c,d=!1,g=`Ir a página ${c}`)=>q("button",{className:`btn btn--pagination${d?" active":""}`,dataset:{page:c},textContent:u,attributes:{"aria-label":g,type:"button"}}),i=()=>q("span",{textContent:"...",className:"pagination-separator",attributes:{"aria-hidden":"true"}});if(t>1){const c=n(t-1,"<",!1,"Página anterior");c.classList.add("pagination-arrow"),r.appendChild(c)}const o=new Set([1,s,t,t-1,t+1]),a=Array.from(o).filter(c=>c>0&&c<=s).sort((c,u)=>c-u);let l=0;for(const c of a)l>0&&c-l>1&&r.appendChild(i()),c===t?r.appendChild(q("span",{className:"pagination-current",textContent:c,attributes:{"aria-current":"page","aria-label":`Página actual ${c}`}})):r.appendChild(n(c,c,!1)),l=c;if(t<s){const c=n(t+1,">",!1,"Página siguiente");c.classList.add("pagination-arrow"),r.appendChild(c)}}function Kt(r,e){const{headerPrevBtn:t,headerNextBtn:s}=P;if(!t||!s)return;const n=Math.ceil(e/N.ITEMS_PER_PAGE);t.disabled=r<=1,s.disabled=r>=n||n===0}function $c(r,e,t){const s=Math.ceil(e/N.ITEMS_PER_PAGE);if(r>=s)return;const n=r+1,i=async()=>{try{await Ki(t,n,N.ITEMS_PER_PAGE,null,!1)}catch{}};"requestIdleCallback"in window?requestIdleCallback(i):setTimeout(i,600)}let or=null,zt=null;const Yi='a[href], button:not([disabled]), textarea:not([disabled]), input:not([type="hidden"]):not([disabled]), select:not([disabled]), [tabindex]:not([tabindex^="-"])';function Xi(r){return r.offsetParent!==null&&getComputedStyle(r).visibility!=="hidden"}function Rn(r){if(r.key!=="Tab")return;const t=Array.from(r.currentTarget.querySelectorAll(Yi)).filter(Xi);if(t.length===0){r.preventDefault();return}const s=t[0],n=t[t.length-1];r.shiftKey?document.activeElement===s&&(r.preventDefault(),n.focus()):document.activeElement===n&&(r.preventDefault(),s.focus())}function Nc(r,e=!1){if(zt=document.activeElement,r.addEventListener("keydown",Rn),!e){const t=Array.from(r.querySelectorAll(Yi)).find(Xi);setTimeout(()=>{t&&t.focus()},0)}or=()=>{r.removeEventListener("keydown",Rn),zt&&setTimeout(()=>zt.focus(),0),or=null,zt=null}}function Qi(r,e,t=!1){r&&(r.hidden=!1,e&&(e.hidden=!1),r.focus({preventScroll:!0}),Nc(r,t))}function Zi(r,e){r&&(r.hidden=!0,e&&(e.hidden=!0),typeof or=="function"&&or())}function as(){Zi(P.authModal,P.authOverlay)}function Mc(){Qi(P.authModal,P.authOverlay)}function Bc(){!P.loginButton||!P.authModal||!P.authOverlay||(P.loginButton.addEventListener("click",Mc),P.authOverlay.addEventListener("click",as),document.addEventListener("keydown",r=>{r.key==="Escape"&&!P.authModal.hidden&&as()}))}function Os(r){const e=P.typeFilterToggle;if(e)switch(e.classList.remove(ae.TYPE_FILTER_MOVIES,ae.TYPE_FILTER_SERIES),r){case"movies":e.innerHTML=`<span class="desktop-text">Cine</span><span class="mobile-icon">${we.CLAPPERBOARD}</span>`,e.setAttribute("aria-label","Filtrar por tipo: Cine"),e.classList.add(ae.TYPE_FILTER_MOVIES);break;case"series":e.innerHTML=`<span class="desktop-text">TV</span><span class="mobile-icon">${we.TV}</span>`,e.setAttribute("aria-label","Filtrar por tipo: TV"),e.classList.add(ae.TYPE_FILTER_SERIES);break;default:e.innerHTML=`<span class="desktop-text">Todo</span><span class="mobile-icon">${we.POPCORN}</span>`,e.setAttribute("aria-label","Filtrar por tipo: Todo");break}}function Fc(r,e){const{totalResultsContainer:t,totalResultsCount:s}=P;!t||!s||(e&&r>0?(s.textContent=r.toLocaleString("es-ES"),t.hidden=!1):t.hidden=!0)}function qc(){if(P.themeToggleButton){const r=document.documentElement.classList.contains("dark-mode");P.themeToggleButton.setAttribute("aria-pressed",r),P.themeToggleButton.addEventListener("click",e=>{Ie(e.currentTarget),document.dispatchEvent(new CustomEvent("uiActionTriggered"));const t=document.documentElement.classList.toggle("dark-mode");localStorage.setItem("theme",t?"dark":"light"),e.currentTarget.setAttribute("aria-pressed",t)})}}function Jt(r=null){document.querySelectorAll(M.SIDEBAR_AUTOCOMPLETE_RESULTS).forEach(e=>{if(!r||e.closest(M.SIDEBAR_FILTER_FORM)!==r){const t=e.parentElement.querySelector(M.SIDEBAR_FILTER_INPUT);t&&t.removeAttribute("aria-expanded"),e.remove()}})}var De;(function(r){r.Range="range",r.Steps="steps",r.Positions="positions",r.Count="count",r.Values="values"})(De||(De={}));var de;(function(r){r[r.None=-1]="None",r[r.NoValue=0]="NoValue",r[r.LargeValue=1]="LargeValue",r[r.SmallValue=2]="SmallValue"})(de||(de={}));function Vc(r){return ar(r)&&typeof r.from=="function"}function ar(r){return typeof r=="object"&&typeof r.to=="function"}function kn(r){r.parentElement.removeChild(r)}function ls(r){return r!=null}function In(r){r.preventDefault()}function Wc(r){return r.filter(function(e){return this[e]?!1:this[e]=!0},{})}function Hc(r,e){return Math.round(r/e)*e}function zc(r,e){var t=r.getBoundingClientRect(),s=r.ownerDocument,n=s.documentElement,i=eo(s);return/webkit.*Chrome.*Mobile/i.test(navigator.userAgent)&&(i.x=0),e?t.top+i.y-n.clientTop:t.left+i.x-n.clientLeft}function Te(r){return typeof r=="number"&&!isNaN(r)&&isFinite(r)}function Pn(r,e,t){t>0&&(ue(r,e),setTimeout(function(){Yt(r,e)},t))}function xn(r){return Math.max(Math.min(r,100),0)}function mr(r){return Array.isArray(r)?r:[r]}function Gc(r){r=String(r);var e=r.split(".");return e.length>1?e[1].length:0}function ue(r,e){r.classList&&!/\s/.test(e)?r.classList.add(e):r.className+=" "+e}function Yt(r,e){r.classList&&!/\s/.test(e)?r.classList.remove(e):r.className=r.className.replace(new RegExp("(^|\\b)"+e.split(" ").join("|")+"(\\b|$)","gi")," ")}function Kc(r,e){return r.classList?r.classList.contains(e):new RegExp("\\b"+e+"\\b").test(r.className)}function eo(r){var e=window.pageXOffset!==void 0,t=(r.compatMode||"")==="CSS1Compat",s=e?window.pageXOffset:t?r.documentElement.scrollLeft:r.body.scrollLeft,n=e?window.pageYOffset:t?r.documentElement.scrollTop:r.body.scrollTop;return{x:s,y:n}}function Jc(){return window.navigator.pointerEnabled?{start:"pointerdown",move:"pointermove",end:"pointerup"}:window.navigator.msPointerEnabled?{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:{start:"mousedown touchstart",move:"mousemove touchmove",end:"mouseup touchend"}}function Yc(){var r=!1;try{var e=Object.defineProperty({},"passive",{get:function(){r=!0}});window.addEventListener("test",null,e)}catch{}return r}function Xc(){return window.CSS&&CSS.supports&&CSS.supports("touch-action","none")}function Rs(r,e){return 100/(e-r)}function cs(r,e,t){return e*100/(r[t+1]-r[t])}function Qc(r,e){return cs(r,r[0]<0?e+Math.abs(r[0]):e-r[0],0)}function Zc(r,e){return e*(r[1]-r[0])/100+r[0]}function kt(r,e){for(var t=1;r>=e[t];)t+=1;return t}function eu(r,e,t){if(t>=r.slice(-1)[0])return 100;var s=kt(t,r),n=r[s-1],i=r[s],o=e[s-1],a=e[s];return o+Qc([n,i],t)/Rs(o,a)}function tu(r,e,t){if(t>=100)return r.slice(-1)[0];var s=kt(t,e),n=r[s-1],i=r[s],o=e[s-1],a=e[s];return Zc([n,i],(t-o)*Rs(o,a))}function ru(r,e,t,s){if(s===100)return s;var n=kt(s,r),i=r[n-1],o=r[n];return t?s-i>(o-i)/2?o:i:e[n-1]?r[n-1]+Hc(s-r[n-1],e[n-1]):s}var to=(function(){function r(e,t,s){this.xPct=[],this.xVal=[],this.xSteps=[],this.xNumSteps=[],this.xHighestCompleteStep=[],this.xSteps=[s||!1],this.xNumSteps=[!1],this.snap=t;var n,i=[];for(Object.keys(e).forEach(function(o){i.push([mr(e[o]),o])}),i.sort(function(o,a){return o[0][0]-a[0][0]}),n=0;n<i.length;n++)this.handleEntryPoint(i[n][1],i[n][0]);for(this.xNumSteps=this.xSteps.slice(0),n=0;n<this.xNumSteps.length;n++)this.handleStepPoint(n,this.xNumSteps[n])}return r.prototype.getDistance=function(e){for(var t=[],s=0;s<this.xNumSteps.length-1;s++)t[s]=cs(this.xVal,e,s);return t},r.prototype.getAbsoluteDistance=function(e,t,s){var n=0;if(e<this.xPct[this.xPct.length-1])for(;e>this.xPct[n+1];)n++;else e===this.xPct[this.xPct.length-1]&&(n=this.xPct.length-2);!s&&e===this.xPct[n+1]&&n++,t===null&&(t=[]);var i,o=1,a=t[n],l=0,c=0,u=0,d=0;for(s?i=(e-this.xPct[n])/(this.xPct[n+1]-this.xPct[n]):i=(this.xPct[n+1]-e)/(this.xPct[n+1]-this.xPct[n]);a>0;)l=this.xPct[n+1+d]-this.xPct[n+d],t[n+d]*o+100-i*100>100?(c=l*i,o=(a-100*i)/t[n+d],i=1):(c=t[n+d]*l/100*o,o=0),s?(u=u-c,this.xPct.length+d>=1&&d--):(u=u+c,this.xPct.length-d>=1&&d++),a=t[n+d]*o;return e+u},r.prototype.toStepping=function(e){return e=eu(this.xVal,this.xPct,e),e},r.prototype.fromStepping=function(e){return tu(this.xVal,this.xPct,e)},r.prototype.getStep=function(e){return e=ru(this.xPct,this.xSteps,this.snap,e),e},r.prototype.getDefaultStep=function(e,t,s){var n=kt(e,this.xPct);return(e===100||t&&e===this.xPct[n-1])&&(n=Math.max(n-1,1)),(this.xVal[n]-this.xVal[n-1])/s},r.prototype.getNearbySteps=function(e){var t=kt(e,this.xPct);return{stepBefore:{startValue:this.xVal[t-2],step:this.xNumSteps[t-2],highestStep:this.xHighestCompleteStep[t-2]},thisStep:{startValue:this.xVal[t-1],step:this.xNumSteps[t-1],highestStep:this.xHighestCompleteStep[t-1]},stepAfter:{startValue:this.xVal[t],step:this.xNumSteps[t],highestStep:this.xHighestCompleteStep[t]}}},r.prototype.countStepDecimals=function(){var e=this.xNumSteps.map(Gc);return Math.max.apply(null,e)},r.prototype.hasNoSize=function(){return this.xVal[0]===this.xVal[this.xVal.length-1]},r.prototype.convert=function(e){return this.getStep(this.toStepping(e))},r.prototype.handleEntryPoint=function(e,t){var s;if(e==="min"?s=0:e==="max"?s=100:s=parseFloat(e),!Te(s)||!Te(t[0]))throw new Error("noUiSlider: 'range' value isn't numeric.");this.xPct.push(s),this.xVal.push(t[0]);var n=Number(t[1]);s?this.xSteps.push(isNaN(n)?!1:n):isNaN(n)||(this.xSteps[0]=n),this.xHighestCompleteStep.push(0)},r.prototype.handleStepPoint=function(e,t){if(t){if(this.xVal[e]===this.xVal[e+1]){this.xSteps[e]=this.xHighestCompleteStep[e]=this.xVal[e];return}this.xSteps[e]=cs([this.xVal[e],this.xVal[e+1]],t,0)/Rs(this.xPct[e],this.xPct[e+1]);var s=(this.xVal[e+1]-this.xVal[e])/this.xNumSteps[e],n=Math.ceil(Number(s.toFixed(3))-1),i=this.xVal[e]+this.xNumSteps[e]*n;this.xHighestCompleteStep[e]=i}},r})(),Ln={to:function(r){return r===void 0?"":r.toFixed(2)},from:Number},ro={target:"target",base:"base",origin:"origin",handle:"handle",handleLower:"handle-lower",handleUpper:"handle-upper",touchArea:"touch-area",horizontal:"horizontal",vertical:"vertical",background:"background",connect:"connect",connects:"connects",ltr:"ltr",rtl:"rtl",textDirectionLtr:"txt-dir-ltr",textDirectionRtl:"txt-dir-rtl",draggable:"draggable",drag:"state-drag",tap:"state-tap",active:"active",tooltip:"tooltip",pips:"pips",pipsHorizontal:"pips-horizontal",pipsVertical:"pips-vertical",marker:"marker",markerHorizontal:"marker-horizontal",markerVertical:"marker-vertical",markerNormal:"marker-normal",markerLarge:"marker-large",markerSub:"marker-sub",value:"value",valueHorizontal:"value-horizontal",valueVertical:"value-vertical",valueNormal:"value-normal",valueLarge:"value-large",valueSub:"value-sub"},je={tooltips:".__tooltips",aria:".__aria"};function su(r,e){if(!Te(e))throw new Error("noUiSlider: 'step' is not numeric.");r.singleStep=e}function nu(r,e){if(!Te(e))throw new Error("noUiSlider: 'keyboardPageMultiplier' is not numeric.");r.keyboardPageMultiplier=e}function iu(r,e){if(!Te(e))throw new Error("noUiSlider: 'keyboardMultiplier' is not numeric.");r.keyboardMultiplier=e}function ou(r,e){if(!Te(e))throw new Error("noUiSlider: 'keyboardDefaultStep' is not numeric.");r.keyboardDefaultStep=e}function au(r,e){if(typeof e!="object"||Array.isArray(e))throw new Error("noUiSlider: 'range' is not an object.");if(e.min===void 0||e.max===void 0)throw new Error("noUiSlider: Missing 'min' or 'max' in 'range'.");r.spectrum=new to(e,r.snap||!1,r.singleStep)}function lu(r,e){if(e=mr(e),!Array.isArray(e)||!e.length)throw new Error("noUiSlider: 'start' option is incorrect.");r.handles=e.length,r.start=e}function cu(r,e){if(typeof e!="boolean")throw new Error("noUiSlider: 'snap' option must be a boolean.");r.snap=e}function uu(r,e){if(typeof e!="boolean")throw new Error("noUiSlider: 'animate' option must be a boolean.");r.animate=e}function du(r,e){if(typeof e!="number")throw new Error("noUiSlider: 'animationDuration' option must be a number.");r.animationDuration=e}function so(r,e){var t=[!1],s;if(e==="lower"?e=[!0,!1]:e==="upper"&&(e=[!1,!0]),e===!0||e===!1){for(s=1;s<r.handles;s++)t.push(e);t.push(!1)}else{if(!Array.isArray(e)||!e.length||e.length!==r.handles+1)throw new Error("noUiSlider: 'connect' option doesn't match handle count.");t=e}r.connect=t}function hu(r,e){switch(e){case"horizontal":r.ort=0;break;case"vertical":r.ort=1;break;default:throw new Error("noUiSlider: 'orientation' option is invalid.")}}function no(r,e){if(!Te(e))throw new Error("noUiSlider: 'margin' option must be numeric.");e!==0&&(r.margin=r.spectrum.getDistance(e))}function fu(r,e){if(!Te(e))throw new Error("noUiSlider: 'limit' option must be numeric.");if(r.limit=r.spectrum.getDistance(e),!r.limit||r.handles<2)throw new Error("noUiSlider: 'limit' option is only supported on linear sliders with 2 or more handles.")}function gu(r,e){var t;if(!Te(e)&&!Array.isArray(e))throw new Error("noUiSlider: 'padding' option must be numeric or array of exactly 2 numbers.");if(Array.isArray(e)&&!(e.length===2||Te(e[0])||Te(e[1])))throw new Error("noUiSlider: 'padding' option must be numeric or array of exactly 2 numbers.");if(e!==0){for(Array.isArray(e)||(e=[e,e]),r.padding=[r.spectrum.getDistance(e[0]),r.spectrum.getDistance(e[1])],t=0;t<r.spectrum.xNumSteps.length-1;t++)if(r.padding[0][t]<0||r.padding[1][t]<0)throw new Error("noUiSlider: 'padding' option must be a positive number(s).");var s=e[0]+e[1],n=r.spectrum.xVal[0],i=r.spectrum.xVal[r.spectrum.xVal.length-1];if(s/(i-n)>1)throw new Error("noUiSlider: 'padding' option must not exceed 100% of the range.")}}function pu(r,e){switch(e){case"ltr":r.dir=0;break;case"rtl":r.dir=1;break;default:throw new Error("noUiSlider: 'direction' option was not recognized.")}}function mu(r,e){if(typeof e!="string")throw new Error("noUiSlider: 'behaviour' must be a string containing options.");var t=e.indexOf("tap")>=0,s=e.indexOf("drag")>=0,n=e.indexOf("fixed")>=0,i=e.indexOf("snap")>=0,o=e.indexOf("hover")>=0,a=e.indexOf("unconstrained")>=0,l=e.indexOf("invert-connects")>=0,c=e.indexOf("drag-all")>=0,u=e.indexOf("smooth-steps")>=0;if(n){if(r.handles!==2)throw new Error("noUiSlider: 'fixed' behaviour must be used with 2 handles");no(r,r.start[1]-r.start[0])}if(l&&r.handles!==2)throw new Error("noUiSlider: 'invert-connects' behaviour must be used with 2 handles");if(a&&(r.margin||r.limit))throw new Error("noUiSlider: 'unconstrained' behaviour cannot be used with margin or limit");r.events={tap:t||i,drag:s,dragAll:c,smoothSteps:u,fixed:n,snap:i,hover:o,unconstrained:a,invertConnects:l}}function vu(r,e){if(e!==!1)if(e===!0||ar(e)){r.tooltips=[];for(var t=0;t<r.handles;t++)r.tooltips.push(e)}else{if(e=mr(e),e.length!==r.handles)throw new Error("noUiSlider: must pass a formatter for all handles.");e.forEach(function(s){if(typeof s!="boolean"&&!ar(s))throw new Error("noUiSlider: 'tooltips' must be passed a formatter or 'false'.")}),r.tooltips=e}}function yu(r,e){if(e.length!==r.handles)throw new Error("noUiSlider: must pass a attributes for all handles.");r.handleAttributes=e}function wu(r,e){if(!ar(e))throw new Error("noUiSlider: 'ariaFormat' requires 'to' method.");r.ariaFormat=e}function bu(r,e){if(!Vc(e))throw new Error("noUiSlider: 'format' requires 'to' and 'from' methods.");r.format=e}function _u(r,e){if(typeof e!="boolean")throw new Error("noUiSlider: 'keyboardSupport' option must be a boolean.");r.keyboardSupport=e}function Eu(r,e){r.documentElement=e}function Su(r,e){if(typeof e!="string"&&e!==!1)throw new Error("noUiSlider: 'cssPrefix' must be a string or `false`.");r.cssPrefix=e}function Au(r,e){if(typeof e!="object")throw new Error("noUiSlider: 'cssClasses' must be an object.");typeof r.cssPrefix=="string"?(r.cssClasses={},Object.keys(e).forEach(function(t){r.cssClasses[t]=r.cssPrefix+e[t]})):r.cssClasses=e}function io(r){var e={margin:null,limit:null,padding:null,animate:!0,animationDuration:300,ariaFormat:Ln,format:Ln},t={step:{r:!1,t:su},keyboardPageMultiplier:{r:!1,t:nu},keyboardMultiplier:{r:!1,t:iu},keyboardDefaultStep:{r:!1,t:ou},start:{r:!0,t:lu},connect:{r:!0,t:so},direction:{r:!0,t:pu},snap:{r:!1,t:cu},animate:{r:!1,t:uu},animationDuration:{r:!1,t:du},range:{r:!0,t:au},orientation:{r:!1,t:hu},margin:{r:!1,t:no},limit:{r:!1,t:fu},padding:{r:!1,t:gu},behaviour:{r:!0,t:mu},ariaFormat:{r:!1,t:wu},format:{r:!1,t:bu},tooltips:{r:!1,t:vu},keyboardSupport:{r:!0,t:_u},documentElement:{r:!1,t:Eu},cssPrefix:{r:!0,t:Su},cssClasses:{r:!0,t:Au},handleAttributes:{r:!1,t:yu}},s={connect:!1,direction:"ltr",behaviour:"tap",orientation:"horizontal",keyboardSupport:!0,cssPrefix:"noUi-",cssClasses:ro,keyboardPageMultiplier:5,keyboardMultiplier:1,keyboardDefaultStep:10};r.format&&!r.ariaFormat&&(r.ariaFormat=r.format),Object.keys(t).forEach(function(l){if(!ls(r[l])&&s[l]===void 0){if(t[l].r)throw new Error("noUiSlider: '"+l+"' is required.");return}t[l].t(e,ls(r[l])?r[l]:s[l])}),e.pips=r.pips;var n=document.createElement("div"),i=n.style.msTransform!==void 0,o=n.style.transform!==void 0;e.transformRule=o?"transform":i?"msTransform":"webkitTransform";var a=[["left","top"],["right","bottom"]];return e.style=a[e.dir][e.ort],e}function Tu(r,e,t){var s=Jc(),n=Xc(),i=n&&Yc(),o=r,a,l,c,u,d,g,f=e.spectrum,v=[],y=[],w=[],_=0,S={},b=!1,A=r.ownerDocument,k=e.documentElement||A.documentElement,I=A.body,$=A.dir==="rtl"||e.ort===1?0:100;function W(h,p){var m=A.createElement("div");return p&&ue(m,p),h.appendChild(m),m}function B(h,p){var m=W(h,e.cssClasses.origin),E=W(m,e.cssClasses.handle);if(W(E,e.cssClasses.touchArea),E.setAttribute("data-handle",String(p)),e.keyboardSupport&&(E.setAttribute("tabindex","0"),E.addEventListener("keydown",function(C){return Lo(C,p)})),e.handleAttributes!==void 0){var T=e.handleAttributes[p];Object.keys(T).forEach(function(C){E.setAttribute(C,T[C])})}return E.setAttribute("role","slider"),E.setAttribute("aria-orientation",e.ort?"vertical":"horizontal"),p===0?ue(E,e.cssClasses.handleLower):p===e.handles-1&&ue(E,e.cssClasses.handleUpper),m.handle=E,m}function ve(h,p){return p?W(h,e.cssClasses.connect):!1}function Ls(h,p){l=W(p,e.cssClasses.connects),c=[],u=[],u.push(ve(l,h[0]));for(var m=0;m<e.handles;m++)c.push(B(p,m)),w[m]=m,u.push(ve(l,h[m+1]))}function wo(h){ue(h,e.cssClasses.target),e.dir===0?ue(h,e.cssClasses.ltr):ue(h,e.cssClasses.rtl),e.ort===0?ue(h,e.cssClasses.horizontal):ue(h,e.cssClasses.vertical);var p=getComputedStyle(h).direction;return p==="rtl"?ue(h,e.cssClasses.textDirectionRtl):ue(h,e.cssClasses.textDirectionLtr),W(h,e.cssClasses.base)}function bo(h,p){return!e.tooltips||!e.tooltips[p]?!1:W(h.firstChild,e.cssClasses.tooltip)}function js(){return o.hasAttribute("disabled")}function br(h){var p=c[h];return p.hasAttribute("disabled")}function _o(h){h!=null?(c[h].setAttribute("disabled",""),c[h].handle.removeAttribute("tabindex")):(o.setAttribute("disabled",""),c.forEach(function(p){p.handle.removeAttribute("tabindex")}))}function Eo(h){h!=null?(c[h].removeAttribute("disabled"),c[h].handle.setAttribute("tabindex","0")):(o.removeAttribute("disabled"),c.forEach(function(p){p.removeAttribute("disabled"),p.handle.setAttribute("tabindex","0")}))}function _r(){g&&(pt("update"+je.tooltips),g.forEach(function(h){h&&kn(h)}),g=null)}function Us(){_r(),g=c.map(bo),Cr("update"+je.tooltips,function(h,p,m){if(!(!g||!e.tooltips)&&g[p]!==!1){var E=h[p];e.tooltips[p]!==!0&&(E=e.tooltips[p].to(m[p])),g[p].innerHTML=E}})}function So(){pt("update"+je.aria),Cr("update"+je.aria,function(h,p,m,E,T){w.forEach(function(C){var L=c[C],O=Lt(y,C,0,!0,!0,!0),H=Lt(y,C,100,!0,!0,!0),z=T[C],J=String(e.ariaFormat.to(m[C]));O=f.fromStepping(O).toFixed(1),H=f.fromStepping(H).toFixed(1),z=f.fromStepping(z).toFixed(1),L.children[0].setAttribute("aria-valuemin",O),L.children[0].setAttribute("aria-valuemax",H),L.children[0].setAttribute("aria-valuenow",z),L.children[0].setAttribute("aria-valuetext",J)})})}function Ao(h){if(h.mode===De.Range||h.mode===De.Steps)return f.xVal;if(h.mode===De.Count){if(h.values<2)throw new Error("noUiSlider: 'values' (>= 2) required for mode 'count'.");for(var p=h.values-1,m=100/p,E=[];p--;)E[p]=p*m;return E.push(100),Ds(E,h.stepped)}return h.mode===De.Positions?Ds(h.values,h.stepped):h.mode===De.Values?h.stepped?h.values.map(function(T){return f.fromStepping(f.getStep(f.toStepping(T)))}):h.values:[]}function Ds(h,p){return h.map(function(m){return f.fromStepping(p?f.getStep(m):m)})}function To(h){function p(z,J){return Number((z+J).toFixed(7))}var m=Ao(h),E={},T=f.xVal[0],C=f.xVal[f.xVal.length-1],L=!1,O=!1,H=0;return m=Wc(m.slice().sort(function(z,J){return z-J})),m[0]!==T&&(m.unshift(T),L=!0),m[m.length-1]!==C&&(m.push(C),O=!0),m.forEach(function(z,J){var Y,V,Z,le=z,ne=m[J+1],ie,kr,Ir,Pr,zs,xr,Gs,Ks=h.mode===De.Steps;for(Ks&&(Y=f.xNumSteps[J]),Y||(Y=ne-le),ne===void 0&&(ne=le),Y=Math.max(Y,1e-7),V=le;V<=ne;V=p(V,Y)){for(ie=f.toStepping(V),kr=ie-H,zs=kr/(h.density||1),xr=Math.round(zs),Gs=kr/xr,Z=1;Z<=xr;Z+=1)Ir=H+Z*Gs,E[Ir.toFixed(5)]=[f.fromStepping(Ir),0];Pr=m.indexOf(V)>-1?de.LargeValue:Ks?de.SmallValue:de.NoValue,!J&&L&&V!==ne&&(Pr=0),V===ne&&O||(E[ie.toFixed(5)]=[V,Pr]),H=ie}}),E}function Co(h,p,m){var E,T,C=A.createElement("div"),L=(E={},E[de.None]="",E[de.NoValue]=e.cssClasses.valueNormal,E[de.LargeValue]=e.cssClasses.valueLarge,E[de.SmallValue]=e.cssClasses.valueSub,E),O=(T={},T[de.None]="",T[de.NoValue]=e.cssClasses.markerNormal,T[de.LargeValue]=e.cssClasses.markerLarge,T[de.SmallValue]=e.cssClasses.markerSub,T),H=[e.cssClasses.valueHorizontal,e.cssClasses.valueVertical],z=[e.cssClasses.markerHorizontal,e.cssClasses.markerVertical];ue(C,e.cssClasses.pips),ue(C,e.ort===0?e.cssClasses.pipsHorizontal:e.cssClasses.pipsVertical);function J(V,Z){var le=Z===e.cssClasses.value,ne=le?H:z,ie=le?L:O;return Z+" "+ne[e.ort]+" "+ie[V]}function Y(V,Z,le){if(le=p?p(Z,le):le,le!==de.None){var ne=W(C,!1);ne.className=J(le,e.cssClasses.marker),ne.style[e.style]=V+"%",le>de.NoValue&&(ne=W(C,!1),ne.className=J(le,e.cssClasses.value),ne.setAttribute("data-value",String(Z)),ne.style[e.style]=V+"%",ne.innerHTML=String(m.to(Z)))}}return Object.keys(h).forEach(function(V){Y(V,h[V][0],h[V][1])}),C}function Er(){d&&(kn(d),d=null)}function Sr(h){Er();var p=To(h),m=h.filter,E=h.format||{to:function(T){return String(Math.round(T))}};return d=o.appendChild(Co(p,m,E)),d}function $s(){var h=a.getBoundingClientRect(),p="offset"+["Width","Height"][e.ort];return e.ort===0?h.width||a[p]:h.height||a[p]}function qe(h,p,m,E){var T=function(L){var O=Oo(L,E.pageOffset,E.target||p);if(!O||js()&&!E.doNotReject||Kc(o,e.cssClasses.tap)&&!E.doNotReject||h===s.start&&O.buttons!==void 0&&O.buttons>1||E.hover&&O.buttons)return!1;i||O.preventDefault(),O.calcPoint=O.points[e.ort],m(O,E)},C=[];return h.split(" ").forEach(function(L){p.addEventListener(L,T,i?{passive:!0}:!1),C.push([L,T])}),C}function Oo(h,p,m){var E=h.type.indexOf("touch")===0,T=h.type.indexOf("mouse")===0,C=h.type.indexOf("pointer")===0,L=0,O=0;if(h.type.indexOf("MSPointer")===0&&(C=!0),h.type==="mousedown"&&!h.buttons&&!h.touches)return!1;if(E){var H=function(Y){var V=Y.target;return V===m||m.contains(V)||h.composed&&h.composedPath().shift()===m};if(h.type==="touchstart"){var z=Array.prototype.filter.call(h.touches,H);if(z.length>1)return!1;L=z[0].pageX,O=z[0].pageY}else{var J=Array.prototype.find.call(h.changedTouches,H);if(!J)return!1;L=J.pageX,O=J.pageY}}return p=p||eo(A),(T||C)&&(L=h.clientX+p.x,O=h.clientY+p.y),h.pageOffset=p,h.points=[L,O],h.cursor=T||C,h}function Ns(h){var p=h-zc(a,e.ort),m=p*100/$s();return m=xn(m),e.dir?100-m:m}function Ro(h){var p=100,m=!1;return c.forEach(function(E,T){if(!br(T)){var C=y[T],L=Math.abs(C-h),O=L===100&&p===100,H=L<p,z=L<=p&&h>C;(H||z||O)&&(m=T,p=L)}}),m}function ko(h,p){h.type==="mouseout"&&h.target.nodeName==="HTML"&&h.relatedTarget===null&&Ar(h,p)}function Io(h,p){if(navigator.appVersion.indexOf("MSIE 9")===-1&&h.buttons===0&&p.buttonsProperty!==0)return Ar(h,p);var m=(e.dir?-1:1)*(h.calcPoint-p.startCalcPoint),E=m*100/p.baseSize;Bs(m>0,E,p.locations,p.handleNumbers,p.connect)}function Ar(h,p){p.handle&&(Yt(p.handle,e.cssClasses.active),_-=1),p.listeners.forEach(function(m){k.removeEventListener(m[0],m[1])}),_===0&&(Yt(o,e.cssClasses.drag),Rr(),h.cursor&&(I.style.cursor="",I.removeEventListener("selectstart",In))),e.events.smoothSteps&&(p.handleNumbers.forEach(function(m){Ve(m,y[m],!0,!0,!1,!1)}),p.handleNumbers.forEach(function(m){Q("update",m)})),p.handleNumbers.forEach(function(m){Q("change",m),Q("set",m),Q("end",m)})}function Tr(h,p){if(!p.handleNumbers.some(br)){var m;if(p.handleNumbers.length===1){var E=c[p.handleNumbers[0]];m=E.children[0],_+=1,ue(m,e.cssClasses.active)}h.stopPropagation();var T=[],C=qe(s.move,k,Io,{target:h.target,handle:m,connect:p.connect,listeners:T,startCalcPoint:h.calcPoint,baseSize:$s(),pageOffset:h.pageOffset,handleNumbers:p.handleNumbers,buttonsProperty:h.buttons,locations:y.slice()}),L=qe(s.end,k,Ar,{target:h.target,handle:m,listeners:T,doNotReject:!0,handleNumbers:p.handleNumbers}),O=qe("mouseout",k,ko,{target:h.target,handle:m,listeners:T,doNotReject:!0,handleNumbers:p.handleNumbers});T.push.apply(T,C.concat(L,O)),h.cursor&&(I.style.cursor=getComputedStyle(h.target).cursor,c.length>1&&ue(o,e.cssClasses.drag),I.addEventListener("selectstart",In,!1)),p.handleNumbers.forEach(function(H){Q("start",H)})}}function Po(h){h.stopPropagation();var p=Ns(h.calcPoint),m=Ro(p);m!==!1&&(e.events.snap||Pn(o,e.cssClasses.tap,e.animationDuration),Ve(m,p,!0,!0),Rr(),Q("slide",m,!0),Q("update",m,!0),e.events.snap?Tr(h,{handleNumbers:[m]}):(Q("change",m,!0),Q("set",m,!0)))}function xo(h){var p=Ns(h.calcPoint),m=f.getStep(p),E=f.fromStepping(m);Object.keys(S).forEach(function(T){T.split(".")[0]==="hover"&&S[T].forEach(function(C){C.call(Ut,E)})})}function Lo(h,p){if(js()||br(p))return!1;var m=["Left","Right"],E=["Down","Up"],T=["PageDown","PageUp"],C=["Home","End"];e.dir&&!e.ort?m.reverse():e.ort&&!e.dir&&(E.reverse(),T.reverse());var L=h.key.replace("Arrow",""),O=L===T[0],H=L===T[1],z=L===E[0]||L===m[0]||O,J=L===E[1]||L===m[1]||H,Y=L===C[0],V=L===C[1];if(!z&&!J&&!Y&&!V)return!0;h.preventDefault();var Z;if(J||z){var le=z?0:1,ne=Ws(p),ie=ne[le];if(ie===null)return!1;ie===!1&&(ie=f.getDefaultStep(y[p],z,e.keyboardDefaultStep)),H||O?ie*=e.keyboardPageMultiplier:ie*=e.keyboardMultiplier,ie=Math.max(ie,1e-7),ie=(z?-1:1)*ie,Z=v[p]+ie}else V?Z=e.spectrum.xVal[e.spectrum.xVal.length-1]:Z=e.spectrum.xVal[0];return Ve(p,f.toStepping(Z),!0,!0),Q("slide",p),Q("update",p),Q("change",p),Q("set",p),!1}function Ms(h){h.fixed||c.forEach(function(p,m){qe(s.start,p.children[0],Tr,{handleNumbers:[m]})}),h.tap&&qe(s.start,a,Po,{}),h.hover&&qe(s.move,a,xo,{hover:!0}),h.drag&&u.forEach(function(p,m){if(!(p===!1||m===0||m===u.length-1)){var E=c[m-1],T=c[m],C=[p],L=[E,T],O=[m-1,m];ue(p,e.cssClasses.draggable),h.fixed&&(C.push(E.children[0]),C.push(T.children[0])),h.dragAll&&(L=c,O=w),C.forEach(function(H){qe(s.start,H,Tr,{handles:L,handleNumbers:O,connect:p})})}})}function Cr(h,p){S[h]=S[h]||[],S[h].push(p),h.split(".")[0]==="update"&&c.forEach(function(m,E){Q("update",E)})}function jo(h){return h===je.aria||h===je.tooltips}function pt(h){var p=h&&h.split(".")[0],m=p?h.substring(p.length):h;Object.keys(S).forEach(function(E){var T=E.split(".")[0],C=E.substring(T.length);(!p||p===T)&&(!m||m===C)&&(!jo(C)||m===C)&&delete S[E]})}function Q(h,p,m){Object.keys(S).forEach(function(E){var T=E.split(".")[0];h===T&&S[E].forEach(function(C){C.call(Ut,v.map(e.format.to),p,v.slice(),m||!1,y.slice(),Ut)})})}function Lt(h,p,m,E,T,C,L){var O;return c.length>1&&!e.events.unconstrained&&(E&&p>0&&(O=f.getAbsoluteDistance(h[p-1],e.margin,!1),m=Math.max(m,O)),T&&p<c.length-1&&(O=f.getAbsoluteDistance(h[p+1],e.margin,!0),m=Math.min(m,O))),c.length>1&&e.limit&&(E&&p>0&&(O=f.getAbsoluteDistance(h[p-1],e.limit,!1),m=Math.min(m,O)),T&&p<c.length-1&&(O=f.getAbsoluteDistance(h[p+1],e.limit,!0),m=Math.max(m,O))),e.padding&&(p===0&&(O=f.getAbsoluteDistance(0,e.padding[0],!1),m=Math.max(m,O)),p===c.length-1&&(O=f.getAbsoluteDistance(100,e.padding[1],!0),m=Math.min(m,O))),L||(m=f.getStep(m)),m=xn(m),m===h[p]&&!C?!1:m}function Or(h,p){var m=e.ort;return(m?p:h)+", "+(m?h:p)}function Bs(h,p,m,E,T){var C=m.slice(),L=E[0],O=e.events.smoothSteps,H=[!h,h],z=[h,!h];E=E.slice(),h&&E.reverse(),E.length>1?E.forEach(function(Y,V){var Z=Lt(C,Y,C[Y]+p,H[V],z[V],!1,O);Z===!1?p=0:(p=Z-C[Y],C[Y]=Z)}):H=z=[!0];var J=!1;E.forEach(function(Y,V){J=Ve(Y,m[Y]+p,H[V],z[V],!1,O)||J}),J&&(E.forEach(function(Y){Q("update",Y),Q("slide",Y)}),T!=null&&Q("drag",L))}function Fs(h,p){return e.dir?100-h-p:h}function Uo(h,p){y[h]=p,v[h]=f.fromStepping(p);var m=Fs(p,0)-$,E="translate("+Or(m+"%","0")+")";if(c[h].style[e.transformRule]=E,e.events.invertConnects&&y.length>1){var T=y.every(function(C,L,O){return L===0||C>=O[L-1]});if(b!==!T){Fo();return}}mt(h),mt(h+1),b&&(mt(h-1),mt(h+2))}function Rr(){w.forEach(function(h){var p=y[h]>50?-1:1,m=3+(c.length+p*h);c[h].style.zIndex=String(m)})}function Ve(h,p,m,E,T,C){return T||(p=Lt(y,h,p,m,E,!1,C)),p===!1?!1:(Uo(h,p),!0)}function mt(h){if(u[h]){var p=y.slice();b&&p.sort(function(O,H){return O-H});var m=0,E=100;h!==0&&(m=p[h-1]),h!==u.length-1&&(E=p[h]);var T=E-m,C="translate("+Or(Fs(m,T)+"%","0")+")",L="scale("+Or(T/100,"1")+")";u[h].style[e.transformRule]=C+" "+L}}function qs(h,p){return h===null||h===!1||h===void 0||(typeof h=="number"&&(h=String(h)),h=e.format.from(h),h!==!1&&(h=f.toStepping(h)),h===!1||isNaN(h))?y[p]:h}function jt(h,p,m){var E=mr(h),T=y[0]===void 0;p=p===void 0?!0:p,e.animate&&!T&&Pn(o,e.cssClasses.tap,e.animationDuration),w.forEach(function(O){Ve(O,qs(E[O],O),!0,!1,m)});var C=w.length===1?0:1;if(T&&f.hasNoSize()&&(m=!0,y[0]=0,w.length>1)){var L=100/(w.length-1);w.forEach(function(O){y[O]=O*L})}for(;C<w.length;++C)w.forEach(function(O){Ve(O,y[O],!0,!0,m)});Rr(),w.forEach(function(O){Q("update",O),E[O]!==null&&p&&Q("set",O)})}function Do(h){jt(e.start,h)}function $o(h,p,m,E){if(h=Number(h),!(h>=0&&h<w.length))throw new Error("noUiSlider: invalid handle number, got: "+h);Ve(h,qs(p,h),!0,!0,E),Q("update",h),m&&Q("set",h)}function Vs(h){if(h===void 0&&(h=!1),h)return v.length===1?v[0]:v.slice(0);var p=v.map(e.format.to);return p.length===1?p[0]:p}function No(){for(pt(je.aria),pt(je.tooltips),Object.keys(e.cssClasses).forEach(function(h){Yt(o,e.cssClasses[h])});o.firstChild;)o.removeChild(o.firstChild);delete o.noUiSlider}function Ws(h){var p=y[h],m=f.getNearbySteps(p),E=v[h],T=m.thisStep.step,C=null;if(e.snap)return[E-m.stepBefore.startValue||null,m.stepAfter.startValue-E||null];T!==!1&&E+T>m.stepAfter.startValue&&(T=m.stepAfter.startValue-E),E>m.thisStep.startValue?C=m.thisStep.step:m.stepBefore.step===!1?C=!1:C=E-m.stepBefore.highestStep,p===100?T=null:p===0&&(C=null);var L=f.countStepDecimals();return T!==null&&T!==!1&&(T=Number(T.toFixed(L))),C!==null&&C!==!1&&(C=Number(C.toFixed(L))),[C,T]}function Mo(){return w.map(Ws)}function Bo(h,p){var m=Vs(),E=["margin","limit","padding","range","animate","snap","step","format","pips","tooltips","connect"];E.forEach(function(C){h[C]!==void 0&&(t[C]=h[C])});var T=io(t);E.forEach(function(C){h[C]!==void 0&&(e[C]=T[C])}),f=T.spectrum,e.margin=T.margin,e.limit=T.limit,e.padding=T.padding,e.pips?Sr(e.pips):Er(),e.tooltips?Us():_r(),y=[],jt(ls(h.start)?h.start:m,p),h.connect&&Hs()}function Hs(){for(;l.firstChild;)l.removeChild(l.firstChild);for(var h=0;h<=e.handles;h++)u[h]=ve(l,e.connect[h]),mt(h);Ms({drag:e.events.drag,fixed:!0})}function Fo(){b=!b,so(e,e.connect.map(function(h){return!h})),Hs()}function qo(){a=wo(o),Ls(e.connect,a),Ms(e.events),jt(e.start),e.pips&&Sr(e.pips),e.tooltips&&Us(),So()}qo();var Ut={destroy:No,steps:Mo,on:Cr,off:pt,get:Vs,set:jt,setHandle:$o,reset:Do,disable:_o,enable:Eo,__moveHandles:function(h,p,m){Bs(h,p,y,m)},options:t,updateOptions:Bo,target:o,removePips:Er,removeTooltips:_r,getPositions:function(){return y.slice()},getTooltips:function(){return g},getOrigins:function(){return c},pips:Sr};return Ut}function Cu(r,e){if(!r||!r.nodeName)throw new Error("noUiSlider: create requires a single element, got: "+r);if(r.noUiSlider)throw new Error("noUiSlider: Slider was already initialized.");var t=io(e),s=Tu(r,t,e);return r.noUiSlider=s,s}const Ou={__spectrum:to,cssClasses:ro,create:Cu},ks="/videoclub.digital/assets/sprite-CNdduWRw.svg",j={overlay:document.getElementById("quick-view-overlay"),modal:document.getElementById("quick-view-modal"),content:document.getElementById("quick-view-content"),template:document.getElementById("movie-card-template")?.content,prevBtn:document.getElementById("modal-prev-btn"),nextBtn:document.getElementById("modal-next-btn")};let oo=0,Is=0,us=0,Qe=!1,Ze=!1;function ao(r){const e=r.target.closest(".movie-card");j.modal.classList.contains("is-visible")&&!j.modal.contains(r.target)&&!e&&gt()}function Ru(r){const e=r.target.closest(".front-director-info a[data-director-name]"),t=r.target.closest('[data-template="actors"] a[data-actor-name]');if(e||t){r.preventDefault(),gt();const s=e?"director":"actor",n=e?e.dataset.directorName:t.dataset.actorName;document.dispatchEvent(new CustomEvent("filtersReset",{detail:{keepSort:!0,newFilter:{type:s,value:n}}}))}}function ku(r){oo=r.touches[0].clientY,Is=r.touches[0].clientX,Qe=!1,Ze=!1,j.modal.classList.remove("is-dragging")}function Iu(r){if(!Qe&&!Ze&&r.defaultPrevented)return;const e=r.touches[0].clientY,t=r.touches[0].clientX,s=e-oo,n=t-Is;if(!Qe&&!Ze){if(Math.abs(n)<5&&Math.abs(s)<5)return;Math.abs(s)>Math.abs(n)&&s>0&&j.content.scrollTop<=0?window.innerWidth<=700&&(Qe=!0,j.modal.classList.add("is-dragging")):Math.abs(n)>Math.abs(s)&&(Ze=!0)}Qe?(r.cancelable&&r.preventDefault(),j.modal.style.transform=`translate(-50%, ${s}px)`,us=s):Ze&&r.cancelable&&r.preventDefault()}function Pu(r){if(Ze){const e=r.changedTouches[0].clientX-Is;Math.abs(e)>80&&yt(e<0?1:-1),Ze=!1;return}Qe&&(j.modal.classList.remove("is-dragging"),us>120?gt():j.modal.style.transform="",us=0,Qe=!1)}function yt(r){const e=j.content.dataset.movieId;if(!e)return;const t=document.querySelector(`.movie-card[data-movie-id="${e}"]`);if(!t)return;const s=r===1?t.nextElementSibling:t.previousElementSibling;s&&s.classList.contains("movie-card")&&lr(s)}function xu(r){const e=document.querySelector(`.movie-card[data-movie-id="${r}"]`);if(!e)return;const t=e.previousElementSibling,s=e.nextElementSibling,n=t&&t.classList.contains("movie-card"),i=s&&s.classList.contains("movie-card");j.prevBtn&&(j.prevBtn.disabled=!n,j.prevBtn.style.opacity=n?"1":"0",j.prevBtn.style.pointerEvents=n?"auto":"none"),j.nextBtn&&(j.nextBtn.disabled=!i,j.nextBtn.style.opacity=i?"1":"0",j.nextBtn.style.pointerEvents=i?"auto":"none")}function Lu(r){if(!j.template)return;const e=r.movieData,t=j.template.cloneNode(!0);j.modal.classList.contains("is-visible")||j.modal.classList.remove("hide-arrows"),t.querySelector(".movie-card").classList.add("is-quick-view"),j.content.movieData=e,j.content.dataset.movieId=e.id;const n=t.querySelector(".flip-card-front"),i=t.querySelector(".flip-card-back"),o=n.querySelector("img"),a=r.querySelector(".flip-card-front img");o&&a&&(o.src=a.dataset.src||a.src,o.alt=a.alt);const l=n.querySelector('[data-template="title"]');l.textContent=e.title,l.classList.remove("title-long","title-xl-long");const c=e.title.length;c>45?l.classList.add("title-xl-long"):c>25&&l.classList.add("title-long");const u=n.querySelector('[data-template="director"]');u.textContent="",e.directors&&e.directors.split(", ").forEach((I,$,W)=>{const B=q("a",{textContent:I.trim(),href:"#",dataset:{directorName:I.trim()}});u.appendChild(B),$<W.length-1&&u.appendChild(document.createTextNode(", "))}),n.querySelector('[data-template="year"]').textContent=e.year||"",Kn(n.querySelector('[data-template="country-container"]'),n.querySelector('[data-template="country-flag"]'),e.country_code,e.country);const d=n.querySelector(".card-icons-line");if(d){d.innerHTML="";const I=[...e.studios_list?e.studios_list.split(","):[],...e.selections_list?e.selections_list.split(","):[]];if(I.length>0){const $=document.createDocumentFragment();I.forEach(W=>{const B=St[W];B&&$.appendChild(q("span",{className:B.class?`platform-icon ${B.class}`:"platform-icon",title:B.title,innerHTML:`<svg width="${B.w||24}" height="${B.h||24}" fill="currentColor" viewBox="${B.vb||"0 0 24 24"}"><use href="${ks}#${B.id}"></use></svg>`}))}),d.appendChild($)}}const g=i.querySelector(".back-original-title-wrapper");if(e.original_title&&e.original_title.trim()!==""){const I=g.querySelector("span");I.textContent=e.original_title,I.classList.remove("title-long","title-xl-long");const $=e.original_title.length;$>40?I.classList.add("title-xl-long"):$>20&&I.classList.add("title-long"),g.style.display="flex"}else g.style.display="none";const v=e.type?.toUpperCase().startsWith("S.");i.querySelector('[data-template="duration"]').textContent=zn(e.minutes,v);const y=i.querySelector('[data-template="episodes"]'),w=e.episodes?e.episodes.toString().replace(/\B(?=(\d{3})+(?!\d))/g,"."):"",_=v&&e.episodes?`${w} x`:"";y.textContent=_,y.style.display=_?"inline":"none";const S=i.querySelector('[data-template="justwatch-link"]');e.justwatch?(S.href=e.justwatch,S.setAttribute("aria-label",`Ver ${e.title} en JustWatch`),S.classList.remove("disabled")):(S.removeAttribute("href"),S.removeAttribute("aria-label"),S.classList.add("disabled")),S.style.display="flex";const b=i.querySelector('[data-template="wikipedia-link"]');e.wikipedia?(b.href=e.wikipedia,b.setAttribute("aria-label",`Ver ${e.title} en Wikipedia`),b.classList.remove("disabled")):(b.removeAttribute("href"),b.removeAttribute("aria-label"),b.classList.add("disabled")),b.style.display="flex",fo(i,e),i.querySelector('[data-template="genre"]').textContent=e.genres||"No disponible";const A=i.querySelector('[data-template="actors"]');A.textContent="",e.actors?e.actors.split(",").forEach((I,$,W)=>{const B=I.trim();if(Et.includes(B.toLowerCase()))A.appendChild(document.createTextNode(B));else{const ve=q("a",{textContent:B,href:"#",dataset:{actorName:B}});A.appendChild(ve)}$<W.length-1&&A.appendChild(document.createTextNode(", "))}):A.textContent="No disponible",i.querySelector('[data-template="synopsis"]').textContent=e.synopsis||"No disponible";const k=i.querySelector('[data-template="critic-container"]');e.critic?.trim()?(k.querySelector('[data-template="critic"]').textContent=e.critic,k.style.display="block"):k.style.display="none",j.content.textContent="",j.content.appendChild(t),Be(j.content),go(j.content),xu(e.id)}function gt(){j.modal.classList.contains("is-visible")&&(j.modal.classList.remove("is-visible"),j.overlay.classList.remove("is-visible"),document.body.classList.remove("modal-open"),setTimeout(()=>{j.modal.style.transform=""},300),Zi(j.modal,j.overlay),document.removeEventListener("click",ao))}function lr(r){r&&(xt(),Lu(r),document.body.classList.add("modal-open"),requestAnimationFrame(()=>{j.modal.classList.add("is-visible"),j.overlay.classList.add("is-visible"),Qi(j.modal,j.overlay,!0),j.content&&(j.content.scrollTop=0),setTimeout(()=>document.addEventListener("click",ao),50)}))}function ju(){if(!j.modal){console.error("Elemento modal no encontrado en el DOM.");return}j.content&&j.content.addEventListener("click",r=>{Ru(r),window.innerWidth<=700&&r.target.closest(".movie-card")&&(r.target.closest("button, a, [data-action]")||j.modal.classList.toggle("hide-arrows"))}),window.addEventListener("keydown",r=>{j.modal.classList.contains("is-visible")&&(r.key==="Escape"?gt():r.key==="ArrowLeft"?yt(-1):r.key==="ArrowRight"&&yt(1))}),j.prevBtn&&j.prevBtn.addEventListener("click",r=>{r.stopPropagation(),yt(-1)}),j.nextBtn&&j.nextBtn.addEventListener("click",r=>{r.stopPropagation(),yt(1)}),navigator.maxTouchPoints>0&&(j.modal.addEventListener("touchstart",ku,{passive:!0}),j.modal.addEventListener("touchmove",Iu,{passive:!1}),j.modal.addEventListener("touchend",Pu,{passive:!0}))}const Uu=[3,5,7,9];function lo(r){return r==null?0:r>=9?4:r>=7?3:r>=5?2:r>=1?1:0}function Du(r){return r<=5.5?0:r>=9?4:(r-5.5)/(9-5.5)*4}function co(r,e,{hideUnfilled:t=!1,snapToInteger:s=!1}={}){const n=r.querySelectorAll(".star-icon"),i=s?Math.round(e):e;n.forEach((o,a)=>{const l=Math.max(0,Math.min(1,i-a)),c=o.querySelector(".star-icon-path--filled");if(t&&l===0)o.style.opacity="0",o.style.visibility="visible";else{o.style.opacity="1",o.style.visibility="visible";const u=100-l*100;c.style.clipPath=`inset(0 ${u}% 0 0)`}})}function $u(r,e){co(r,e,{hideUnfilled:!0,snapToInteger:!1})}function uo(r,e,t=!1){co(r,e,{hideUnfilled:t,snapToInteger:!0})}function Nu(r){const e=r.currentTarget.closest(".star-rating-container");if(!e)return;const t=parseInt(r.currentTarget.dataset.ratingLevel,10);uo(e,t,!1)}function Mu(r){const e=r.currentTarget.closest("[data-movie-id]");if(e){const t=new CustomEvent("card:requestUpdate",{bubbles:!0,composed:!0,detail:{cardElement:e}});e.dispatchEvent(t)}}function Bu(r,e){const t=r.querySelectorAll(".star-icon[data-rating-level]");e&&(t.forEach(s=>{s.addEventListener("mouseenter",Nu)}),r.addEventListener("mouseleave",Mu))}const jn={FA:22e4,IMDB:32e5},Fu={FA:Math.sqrt(jn.FA),IMDB:Math.sqrt(jn.IMDB)},Un=document.querySelector(M.MOVIE_CARD_TEMPLATE);let ds=0,ke=null,It=0,hs,Pe=null;const qu=1e3,Vu=".card-rating-block, .front-director-info, .actors-expand-btn";function Dn(r){document.body.classList.contains("rotation-disabled")||r.querySelector(".flip-card-inner").classList.contains("is-flipped")||(clearTimeout(hs),hs=setTimeout(()=>{Pe===r&&r.classList.add("is-hovered")},qu))}function ho(){clearTimeout(hs)}function $n(r){ho(),r&&(r.classList.remove("is-hovered"),vr(r))}function vr(r){const e=r.querySelector(".flip-card-back");if(e?.classList.contains("is-expanded")){e.classList.remove("is-expanded","show-actors");const t=e.querySelector(".expand-content-btn");t&&(t.textContent="+",t.setAttribute("aria-label","Expandir sinopsis")),e.querySelectorAll(".scrollable-content, .actors-scrollable-content").forEach(n=>n.scrollTop=0)}}function xt(){ke&&(ke.querySelector(".flip-card-inner")?.classList.remove("is-flipped"),vr(ke),ke=null,document.removeEventListener("click",fs))}function fs(r){ke&&!ke.contains(r.target)&&xt()}const Wu=r=>{if(!r)return;const e=r.querySelector(".flip-card-inner");if(!e)return;const t=e.classList.contains("is-flipped");ke&&ke!==r&&xt(),e.classList.toggle("is-flipped"),t?(ke=null,vr(r),document.removeEventListener("click",fs)):(ke=r,setTimeout(()=>document.addEventListener("click",fs),0))};function Hu(r){r.addEventListener("pointerover",a=>{if(a.pointerType!=="mouse")return;const l=a.target,c=l.closest(".movie-card");c&&(Pe!==c?(Pe&&$n(Pe),Pe=c,Dn(c)):l.closest(Vu)?ho():Dn(c))}),r.addEventListener("pointerout",a=>{a.pointerType==="mouse"&&Pe&&(Pe.contains(a.relatedTarget)||($n(Pe),Pe=null))}),r.addEventListener("dblclick",a=>{const l=a.target.closest(".movie-card");l&&!document.body.classList.contains("rotation-disabled")&&lr(l)});let e=0,t=null,s=0,n=0;const i=300,o=10;r.addEventListener("pointerdown",a=>{a.pointerType!=="mouse"&&a.isPrimary&&(s=a.clientX,n=a.clientY)},{passive:!0}),r.addEventListener("pointerup",a=>{if(a.pointerType==="mouse")return;const l=a.target.closest(".movie-card");if(!l||document.body.classList.contains("rotation-disabled")||a.target.closest("[data-action], a, button, .expand-content-btn"))return;const c=Math.abs(a.clientX-s),u=Math.abs(a.clientY-n);if(c>o||u>o)return;a.cancelable&&a.preventDefault();const d=new Date().getTime(),g=d-e;g<i&&g>0?(clearTimeout(t),t=null,e=0,lr(l)):(clearTimeout(t),t=setTimeout(()=>{Wu(l)},i)),e=d})}async function zu(r){r.preventDefault(),r.stopPropagation();const e=this,t=r.target.closest('[data-action="toggle-watchlist"]');if(!e||!t)return;const s=parseInt(e.dataset.movieId,10),i={onWatchlist:!t.classList.contains("is-active")},o=gr(s)||{onWatchlist:!1,rating:null};he("light"),ir(s,i),Be(e);try{await Ji(s,i),he("success")}catch(a){Ae(a.message,"error"),ir(s,o),Be(e)}}async function Gu(r){r.preventDefault(),r.stopPropagation();const e=this,t=parseInt(e.dataset.movieId,10);if(!t)return;const s=gr(t)||{rating:null,onWatchlist:!1},n=s;let i=null;const o=r.target.closest('[data-action="set-rating-suspenso"]'),a=r.target.closest(".star-icon[data-rating-level]");if(o)n.rating===null?i=2:n.rating===2?i=3:i=null;else if(a){const c=parseInt(a.dataset.ratingLevel,10),u=lo(n.rating);c===1&&u===0?i=2:i=c===u?null:Uu[c-1]}if(i===n.rating)return;const l={rating:i};he("light"),ir(t,l),Be(e);try{await Ji(t,l),i!==null&&he("success")}catch(c){Ae(c.message,"error"),ir(t,s),Be(e)}}function Nn(r){if(document.body.dataset.gestureCooldown){r.preventDefault(),r.stopPropagation();return}const e=this,t=r.target;if(t.closest('[data-action="toggle-watchlist"]')){zu.call(e,r);return}if(t.closest('[data-action^="set-rating-"]')){Gu.call(e,r);return}const s=e.querySelector(".flip-card-back"),n=t.closest(".expand-content-btn");if(t.closest(".actors-expand-btn")){r.stopPropagation(),s.classList.add("is-expanded","show-actors");const d=s.querySelector(".expand-content-btn");d&&(d.textContent="−",d.setAttribute("aria-label","Cerrar detalles"));return}if(n){r.stopPropagation(),s.classList.contains("is-expanded")?vr(e):(s.classList.add("is-expanded"),s.classList.remove("show-actors"),n.textContent="−",n.setAttribute("aria-label","Contraer sinopsis"));return}if((t.closest(".scrollable-content")&&s.classList.contains("is-expanded")||t.closest(".actors-scrollable-content"))&&!t.closest(".actor-list-item")){r.stopPropagation();return}const a=t.closest(".front-director-info a[data-director-name]");if(a){r.preventDefault(),document.dispatchEvent(new CustomEvent("filtersReset",{detail:{keepSort:!0,newFilter:{type:"director",value:a.dataset.directorName}}}));return}const l=t.closest(".actor-list-item");if(l){r.preventDefault(),document.dispatchEvent(new CustomEvent("filtersReset",{detail:{keepSort:!0,newFilter:{type:"actor",value:l.dataset.actorName}}}));return}const c=t.closest("a");if(c&&c.href&&!c.href.endsWith("#")||e.id==="quick-view-content")return;document.body.classList.contains("rotation-disabled")&&lr(e)}const Mn=new IntersectionObserver((r,e)=>{r.forEach(t=>{if(t.isIntersecting){const s=t.target;s.src=s.dataset.src,s.decode().then(()=>s.classList.add(ae.LOADED)).catch(()=>s.classList.add(ae.LOADED)),e.unobserve(s)}})},{rootMargin:"0px 0px 800px 0px"});function Ku(r,e){const t=e.last_synced_at?new Date(e.last_synced_at).getTime():"1",n=`${e.image&&e.image!=="."?`${N.POSTER_BASE_URL}${e.image}.webp`:`https://via.placeholder.com/400x496.png?text=${encodeURIComponent(e.title)}`}?v=${t}`;r.alt=`Póster de ${e.title}`,ds<4?(r.src=n,r.loading="eager",r.setAttribute("fetchpriority","high"),r.decoding="auto"):e.thumbhash_st?(r.src=e.thumbhash_st,r.dataset.src=n,r.classList.add(ae.LAZY_LQIP),Mn.observe(r)):(r.src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=",r.dataset.src=n,Mn.observe(r))}function Ju(r,e=85){if(!r||r.trim()==="")return{truncated:"Reparto no disponible",full:[]};if(r.toUpperCase()==="(A)")return{truncated:"Animación",full:[]};const t=r.split(",").map(i=>i.trim());if(r.length<=e)return{truncated:r,full:t,isTruncated:!1};let s=[],n=0;for(const i of t){const o=n+(s.length>0?2:0)+i.length;if(o>e)break;s.push(i),n=o}return{truncated:s.join(", "),full:t,isTruncated:!0}}function Yu(r,e){const t=r.querySelector(".movie-summary"),s=r.querySelector(".flip-card-back"),n=t.querySelector(M.TITLE);n.textContent=e.title||"Título no disponible",n.title=e.title||"Título no disponible";const i=t.querySelector(M.DIRECTOR);i.textContent="",e.directors&&e.directors.split(", ").forEach((b,A,k)=>{const I=q("a",{textContent:b.trim(),href:"#"});I.dataset.directorName=b.trim(),i.appendChild(I),A<k.length-1&&i.appendChild(document.createTextNode(", "))});const o=e.type?.toUpperCase().startsWith("S.");t.querySelector(M.YEAR).textContent=o&&e.year_end?String(e.year_end).toUpperCase()==="M"?`${e.year} (M)`:String(e.year_end)==="-"?`${e.year}-`:`${e.year}-${String(e.year_end).length===4?String(e.year_end).substring(2):e.year_end}`:e.year||"N/A",Kn(t.querySelector(M.COUNTRY_CONTAINER),t.querySelector(M.COUNTRY_FLAG),e.country_code,e.country);const a=s.querySelector(".back-original-title-wrapper");e.original_title&&e.original_title.trim()!==""?(a.querySelector('[data-template="original-title"]').textContent=e.original_title,a.style.display="flex"):a.style.display="none",s.querySelector(M.DURATION).textContent=zn(e.minutes,o);const l=s.querySelector('[data-template="episodes"]'),c=e.episodes?e.episodes.toString().replace(/\B(?=(\d{3})+(?!\d))/g,"."):"",u=o&&e.episodes?`${c} x`:"";l.textContent=u,l.style.display=u?"inline":"none";const d=s.querySelector('[data-template="justwatch-link"]');e.justwatch?(d.href=e.justwatch,d.setAttribute("aria-label",`Ver ${e.title} en JustWatch`),d.classList.remove("disabled")):(d.removeAttribute("href"),d.removeAttribute("aria-label"),d.classList.add("disabled")),d.style.display="flex";const g=s.querySelector('[data-template="wikipedia-link"]');e.wikipedia?(g.href=e.wikipedia,g.setAttribute("aria-label",`Ver ${e.title} en Wikipedia`),g.classList.remove("disabled")):(g.removeAttribute("href"),g.removeAttribute("aria-label"),g.classList.add("disabled")),g.style.display="flex",s.querySelector(M.GENRE).textContent=e.genres||"Género no disponible";const f=s.querySelector(M.ACTORS),v=Ju(e.actors);f.textContent=v.truncated;const y=e.actors?e.actors.trim():"";if(y.length>0&&!Et.includes(y.toLowerCase())){const b=f.parentElement;if(!b.querySelector(".actors-expand-btn")){const I=q("button",{className:"actors-expand-btn",textContent:"+",attributes:{"aria-label":"Ver reparto completo"}});b.appendChild(I)}let A=s.querySelector(".actors-scrollable-content");if(!A){A=q("div",{className:"actors-scrollable-content"});const I=s.querySelector(".expand-content-btn");s.insertBefore(A,I)}A.textContent="",A.appendChild(q("h4",{textContent:"Reparto"}));const k=q("div",{className:"actors-list-text"});e.actors.split(",").forEach(I=>{const $=I.trim();$&&(Et.includes($.toLowerCase())?k.appendChild(q("span",{className:"actor-list-item",textContent:$,style:"cursor: default; pointer-events: none;"})):k.appendChild(q("button",{type:"button",className:"actor-list-item",textContent:$,dataset:{actorName:$}})))}),A.appendChild(k)}else f.parentElement.querySelector(".actors-expand-btn")?.remove(),s.querySelector(".actors-scrollable-content")?.remove();s.querySelector(M.SYNOPSIS).textContent=e.synopsis||"Argumento no disponible.";const _=s.querySelector('[data-template="critic-container"]');e.critic?.trim()?(_.querySelector('[data-template="critic"]').textContent=e.critic,_.style.display="block"):_.style.display="none";const S=t.querySelector(".card-icons-line");if(S){S.innerHTML="";const b=[...e.studios_list?e.studios_list.split(","):[],...e.selections_list?e.selections_list.split(","):[]];b.length>0&&b.forEach(A=>{const k=St[A];k&&S.appendChild(q("span",{className:k.class?`platform-icon ${k.class}`:"platform-icon",title:k.title,innerHTML:`<svg width="${k.w||24}" height="${k.h||24}" fill="currentColor" viewBox="${k.vb||"0 0 24 24"}"><use href="${ks}#${k.id}"></use></svg>`}))})}}function fo(r,e){const t=(s,n)=>{const i=r.querySelector(`[data-template="${s}-link"]`);if(!i)return;const o=r.querySelector(`[data-template="${s}-rating"]`),a=r.querySelector(`[data-template="${s}-votes-bar-container"]`),l=r.querySelector(`[data-template="${s}-votes-bar"]`),c=r.querySelector(`[data-template="${s}-votes-count"]`),u=e[`${s}_id`],d=e[`${s}_rating`],g=e[`${s}_votes`];if(u&&(u.startsWith("http://")||u.startsWith("https://"))){i.href=u;const v=s==="fa"?"Filmaffinity":"IMDb";i.setAttribute("aria-label",`Ver en ${v} - Nota: ${d||"N/A"}`),i.classList.remove("disabled")}else i.removeAttribute("href"),i.removeAttribute("aria-label"),i.classList.add("disabled");o.textContent=d?String(d).includes(".")?d:`${d}.0`:"N/A";const f=parseInt(String(g).replace(/\D/g,""),10)||0;a.style.display=f>0?"block":"none",f>0?(l.style.width=`${Math.min(Math.sqrt(f)/Fu[n]*100,100)}%`,a.title="",a.dataset.votes=Js(f,s),c&&(c.textContent=Js(f,s),c.style.display="flex")):c&&(c.style.display="none")};t("fa","FA"),t("imdb","IMDB")}function Be(r){const e=parseInt(r.dataset.movieId,10),t=r.movieData;if(!t)return;const s=gr(e),n=s?.rating,i=r.querySelector('[data-action="set-rating-estrellas"]'),o=r.querySelector('[data-action="set-rating-suspenso"]'),a=r.querySelector('[data-action="toggle-watchlist"]'),l=document.body.classList.contains("user-logged-in");if(!i||!o||!a)return;r.dataset.previousUserData=JSON.stringify(s||{onWatchlist:!1,rating:null});const c=s?.onWatchlist??!1;if(a.classList.toggle("is-active",c),a.setAttribute("aria-label",c?"Quitar de mi lista":"Añadir a mi lista"),o.style.display="none",i.style.display="none",l&&n!==null&&n!==void 0)i.classList.add("has-user-rating"),o.classList.add("has-user-rating"),n===2?o.style.display="block":n>=3&&(i.style.display="flex",uo(i,lo(n),!0));else{i.classList.remove("has-user-rating"),o.classList.remove("has-user-rating");const u=[t.fa_rating,t.imdb_rating].filter(d=>d&&d>0);if(u.length>0){const d=u.reduce((g,f)=>g+f,0)/u.length;d<=5.5?o.style.display="block":(i.style.display="flex",$u(i,Du(d)))}}}function go(r){const e=r.querySelector('[data-action="set-rating-estrellas"]');e&&Bu(e,document.body.classList.contains("user-logged-in"))}function Xu(r){if(!Un)return null;const e=Un.content.cloneNode(!0),t=e.querySelector(`.${ae.MOVIE_CARD}`);t.dataset.movieId=r.id,t.movieData=r,r.id&&(t.style.viewTransitionName=`movie-${r.id}`),Yu(t,r),Ku(t.querySelector("img"),r);const s=e.querySelector(".flip-card-back");return fo(s,r),Be(t),go(t),e}function Bn(r,e){const t=++It;if(ds=0,xt(),!r)return;r.textContent="";const s=12;let n=0;function i(){if(t!==It||n>=e.length||!document.body.contains(r))return;const o=document.createDocumentFragment(),a=Math.min(n+s,e.length);for(let l=n;l<a;l++){const c=e[l],u=Xu(c);if(u){const d=u.querySelector(".movie-card");if(d){const g=l;d.style.setProperty("--card-index",g),ds++}o.appendChild(u)}}r.appendChild(o),n=a,n<e.length&&requestAnimationFrame(i)}i()}function Qu(r,e){if(It++,r&&(r.textContent=""),e&&(e.textContent=""),!r)return;const t=document.createDocumentFragment();for(let s=0;s<N.ITEMS_PER_PAGE;s++)t.appendChild(q("div",{className:"skeleton-card"}));r.appendChild(t)}function Zu(r,e,t){if(It++,r&&(r.textContent=""),e&&(e.textContent=""),!r)return;const s=q("div",{className:"no-results",attributes:{role:"status"}});s.appendChild(q("h3",{textContent:"No se encontraron resultados"}));const n=Object.values(t).some(i=>i&&i!=="id,asc"&&i!=="all");t.searchTerm?s.appendChild(q("p",{textContent:`Prueba a simplificar tu búsqueda para "${t.searchTerm}".`})):n&&s.appendChild(q("p",{textContent:"Intenta eliminar algunos filtros para obtener más resultados."})),s.appendChild(q("button",{id:"clear-filters-from-empty",className:"btn btn--outline",textContent:"Limpiar todos los filtros"})),r.appendChild(s)}function ed(r,e,t){if(It++,r&&(r.textContent=""),e&&(e.textContent=""),!r)return;const s=q("div",{className:"no-results",attributes:{role:"alert"}});s.appendChild(q("h3",{textContent:"¡Vaya! Algo ha ido mal"})),s.appendChild(q("p",{textContent:t})),r.appendChild(s)}const ge=768,Fn=.4;let Ne=280;const D={sidebar:document.getElementById("sidebar"),sidebarInnerWrapper:document.querySelector(".sidebar-inner-wrapper"),rewindButton:document.querySelector("#rewind-button"),toggleRotationBtn:document.querySelector("#toggle-rotation-btn"),playButton:document.querySelector("#play-button"),collapsibleSections:document.querySelectorAll(".collapsible-section"),sidebarFilterForms:document.querySelectorAll(M.SIDEBAR_FILTER_FORM),sidebarScrollable:document.querySelector(".sidebar-scrollable-filters"),yearSlider:document.querySelector(M.YEAR_SLIDER),yearStartInput:document.querySelector(M.YEAR_START_INPUT),yearEndInput:document.querySelector(M.YEAR_END_INPUT),sidebarOverlay:document.getElementById("sidebar-overlay"),mainContent:document.querySelector(".main-content-wrapper")},po={};let F={isDragging:!1,isHorizontalDrag:!1,startX:0,startY:0,startTime:0,currentTranslate:0,startTranslate:0,isInteractive:!1};const Ps=()=>{document.body.classList.add("sidebar-is-open"),D.sidebar.style.transform="",F.currentTranslate=0,yr(!0)},fe=()=>{document.body.classList.remove("sidebar-is-open"),D.sidebar.style.transform="",F.currentTranslate=-Ne,yr(!1)};function qn(){if(D.sidebar){const r=D.sidebar.offsetWidth;r>0&&(Ne=r)}}function td(r){if(window.innerWidth>ge||document.body.classList.contains("modal-open"))return;const e=document.body.classList.contains("sidebar-is-open");if(!(e&&r.target.closest("#sidebar")||!e&&r.touches[0].clientX<150)){F.isDragging=!1;return}F.isDragging=!0,F.isHorizontalDrag=!1,F.startX=r.touches[0].clientX,F.startY=r.touches[0].clientY,F.startTime=Date.now(),F.startTranslate=e?0:-Ne,F.isInteractive=!e&&!!r.target.closest("button, a, input, select, textarea, .movie-card, .noUi-handle"),document.addEventListener("touchmove",xs,{passive:!1})}function xs(r){if(!F.isDragging)return;const e=r.touches[0].clientX,t=r.touches[0].clientY,s=e-F.startX,n=t-F.startY;if(!F.isHorizontalDrag){const o=F.isInteractive?15:5;if(Math.abs(s)<o&&Math.abs(n)<o)return;if(Math.abs(n)>Math.abs(s)){F.isDragging=!1,document.removeEventListener("touchmove",xs);return}F.isHorizontalDrag=!0,F.startX=e,F.startY=t,F.startTime=Date.now(),D.sidebar.classList.add("is-dragging"),document.body.classList.add("sidebar-is-dragging")}r.cancelable&&r.preventDefault();let i=F.startTranslate+(e-F.startX);if(i>0)i*=.2;else if(i<-Ne){const o=Math.abs(i+Ne);i=-Ne-o*.2}F.currentTranslate=i,D.sidebar.style.transform=`translateX(${F.currentTranslate}px)`}function rd(r){if(!F.isDragging)return;if(document.removeEventListener("touchmove",xs),!F.isHorizontalDrag){F.isDragging=!1;return}F.isDragging=!1,F.isHorizontalDrag=!1,D.sidebar.classList.remove("is-dragging"),document.body.classList.remove("sidebar-is-dragging");const e=Date.now()-F.startTime,s=r.changedTouches[0].clientX-F.startX,n=e>0?s/e:0;let i;n>Fn?i=!0:n<-Fn?i=!1:i=F.currentTranslate>-Ne*.5,i?Ps():fe()}function yr(r){if(!D.rewindButton)return;D.rewindButton.innerHTML=r?we.REWIND:we.FORWARD,D.rewindButton.setAttribute("aria-label",r?"Contraer sidebar":"Expandir sidebar"),D.rewindButton.setAttribute("aria-expanded",r);const e=document.getElementById("mobile-sidebar-toggle");e&&(e.setAttribute("aria-expanded",String(r)),e.setAttribute("aria-label",r?"Cerrar menú de filtros":"Abrir menú de filtros"))}function sd(){D.sidebar&&(qn(),document.addEventListener("touchstart",td,{passive:!0}),document.addEventListener("touchend",rd,{passive:!0}),window.addEventListener("resize",()=>{window.innerWidth<=ge&&qn(),window.innerWidth>ge&&(document.body.classList.remove("sidebar-is-open"),D.sidebar.style.transform="",F.currentTranslate=-Ne)}))}function mo(r=null){const e=D.toggleRotationBtn;if(!e)return;const t=document.body.classList.contains("rotation-disabled"),s=r!==null?r:!t;if(t===s)return;he("medium"),xt(),gt();const n=()=>{document.body.classList.toggle("rotation-disabled",s),e.innerHTML=s?we.SQUARE_STOP:we.PAUSE,e.setAttribute("aria-label",s?"Activar rotación de tarjetas":"Pausar rotación de tarjetas"),e.title=s?"Giro automático":"Vista Rápida",e.setAttribute("aria-pressed",s),Jn.set("rotationState",s?"disabled":"enabled")};document.startViewTransition?document.startViewTransition(()=>n()):n(),Ie(e)}function nd(){const r=document.querySelector(".main-content-wrapper");if(!r)return;window.addEventListener("click",o=>{document.body.dataset.gestureCooldown==="true"&&o.target.closest(".movie-card, .grid-container")&&(o.preventDefault(),o.stopPropagation(),o.stopImmediatePropagation())},{capture:!0});let e=null,t=!1,s=!1,n=null;const i=()=>{document.body.dataset.gestureCooldown="true",n&&clearTimeout(n),n=setTimeout(()=>{delete document.body.dataset.gestureCooldown,n=null},800)};r.addEventListener("touchstart",o=>{o.touches.length===2&&(t=!0,s=!1,e=Math.hypot(o.touches[0].pageX-o.touches[1].pageX,o.touches[0].pageY-o.touches[1].pageY))},{passive:!0}),r.addEventListener("touchmove",o=>{if(!t||o.touches.length!==2||e===null)return;if(s){i();return}const l=Math.hypot(o.touches[0].pageX-o.touches[1].pageX,o.touches[0].pageY-o.touches[1].pageY)-e;Math.abs(l)>60&&l<0&&(mo(),i(),s=!0)},{passive:!0}),r.addEventListener("touchend",o=>{s&&i(),o.touches.length<2&&(t=!1,e=null),o.touches.length===0&&(s=!1)})}function id(r,e,t){const s=r.querySelector(M.SIDEBAR_FILTER_INPUT);let n=r.querySelector(M.SIDEBAR_AUTOCOMPLETE_RESULTS);if(n||(n=q("div",{className:"sidebar-autocomplete-results"}),r.appendChild(n)),n.textContent="",e.length===0){s.setAttribute("aria-expanded","false"),s.removeAttribute("aria-activedescendant"),s.removeAttribute("aria-controls"),n.remove();return}n.id=`autocomplete-results-${r.dataset.filterType}`,n.setAttribute("role","listbox"),s.setAttribute("aria-expanded","true"),s.setAttribute("aria-controls",n.id);const i=document.createDocumentFragment();e.forEach((o,a)=>{const l=q("div",{className:ae.SIDEBAR_AUTOCOMPLETE_ITEM,dataset:{value:o},id:`suggestion-item-${r.dataset.filterType}-${a}`,attributes:{role:"option"}});l.appendChild(Jo(o,t)),i.appendChild(l)}),n.appendChild(i)}function od(){const r=be(),t=Ts()>=N.MAX_ACTIVE_FILTERS;document.querySelectorAll(".filter-link").forEach(n=>{const i=n.dataset.filterType,o=n.dataset.filterValue,a=i==="genre"&&r.excludedGenres?.includes(o)||i==="country"&&r.excludedCountries?.includes(o),c=r[i]===o||a;if(n.style.display!==(c?"none":"flex")&&(n.style.display=c?"none":"flex"),!c){const d=t;n.hasAttribute("disabled")!==d&&(n.toggleAttribute("disabled",d),n.style.pointerEvents=d?"none":"auto",n.style.opacity=d?"0.5":"1")}const u=n.querySelector(".exclude-filter-btn");if(u){const d=i==="country"&&r.country;u.style.display!==(d?"none":"")&&(u.style.display=d?"none":"")}}),document.querySelectorAll(".sidebar-filter-input").forEach(n=>{n.disabled!==t&&(n.disabled=t,n.placeholder=t?"Límite de filtros":`Otro ${n.closest("form").dataset.filterType}...`)})}let Vn={};function ct(){const r=be();let e=0;const t=(n,i,o=!1,a=0)=>{const l=q("div",{className:`filter-pill ${o?"filter-pill--exclude":""}`,dataset:{filterType:n,filterValue:i}});l.style.setProperty("--pill-index",a);const c=Ye[n]?.items[i]||i;return l.appendChild(q("span",{textContent:c})),l.appendChild(q("span",{className:"remove-filter-btn",innerHTML:o?we.PAUSE_SMALL:"×",attributes:{"aria-hidden":"true"}})),l},s=n=>{const i=po[n];if(!i)return;const o=r[n];let a=[];n==="genre"?a=r.excludedGenres||[]:n==="country"&&(a=r.excludedCountries||[]);const l=`${n}-combined`,c=JSON.stringify({inc:o,exc:a});if(Vn[l]===c){o&&e++,e+=a.length;return}Vn[l]=c,i.textContent="",o&&i.appendChild(t(n,o,!1,e++)),a.forEach(u=>{i.appendChild(t(n,u,!0,e++))})};Object.keys(Ye).forEach(n=>s(n)),od()}async function wr(r,e,t=!1){const s=be();if(e&&(r==="actor"||r==="director")){const o=s.sort,a=s.mediaType;Cs(),Rt(o),nr(a),ee(r,e,!0),document.dispatchEvent(new CustomEvent("updateSidebarUI")),ct(),document.dispatchEvent(new CustomEvent("uiActionTriggered"));try{await Oe(1)}catch(l){l.name!=="AbortError"&&Ae("Error al cargar filmografía.","error")}return}e&&(r==="selection"&&s.studio?ee("studio",null):r==="studio"&&s.selection&&ee("selection",null));const i=t||s[r]!==e?e:null;if(i&&r!=="actor"&&r!=="director"&&(s.actor&&ee("actor",null),s.director&&ee("director",null)),i&&r==="country"&&ee("excludedCountries",[],!0),!ee(r,i)){Ae(`Límite de ${N.MAX_ACTIVE_FILTERS} filtros alcanzado.`,"error"),r==="selection"&&s.studio&&ee("studio",s.studio),r==="studio"&&s.selection&&ee("selection",s.selection);return}ct(),document.dispatchEvent(new CustomEvent("uiActionTriggered"));try{await Oe(1)}catch(o){if(o.name==="AbortError")return;console.error("Fallo al aplicar filtro:",o),Ae("No se pudo aplicar el filtro.","error"),ee("selection",s.selection),ee("studio",s.studio),ee("actor",s.actor),ee("director",s.director),ee("excludedCountries",s.excludedCountries,!0),ee(r,s[r]),ct()}}async function vo(r,e){const t=be();if(!(r==="country"&&t.country)){if(!On(r,e)){Ae("Límite de filtros alcanzado.","error");return}ct(),document.dispatchEvent(new CustomEvent("uiActionTriggered"));try{await Oe(1)}catch(s){if(s.name==="AbortError")return;Ae("No se pudo aplicar el filtro de exclusión.","error"),On(r,e),ee("country",t.country),ee("genre",t.genre),ct()}}}function ad(){D.playButton&&Ie(D.playButton),he("medium"),document.dispatchEvent(new CustomEvent("filtersReset")),window.innerWidth<=ge&&fe()}function gs(){D.collapsibleSections.forEach(r=>{r.classList.remove(ae.ACTIVE),r.querySelector(".section-header")?.setAttribute("aria-expanded","false")}),D.sidebarInnerWrapper&&D.sidebarInnerWrapper.classList.remove("is-compact")}function ld(){if(!D.yearSlider||!D.yearStartInput||!D.yearEndInput)return;const r=[D.yearStartInput,D.yearEndInput],e=Ou.create(D.yearSlider,{start:[N.YEAR_MIN,N.YEAR_MAX],connect:!0,step:1,range:{min:N.YEAR_MIN,max:N.YEAR_MAX},format:{to:n=>Math.round(n),from:n=>Number(n)}});e.on("update",(n,i)=>{r[i].value=n[i]});const s=ps((n,i)=>{let[o,a]=n.map(Number);o>a&&(i===0?a=o:o=a);const l=`${o}-${a}`;wr("year",l,!0),window.innerWidth<=ge&&fe()},500);e.on("set",s),r.forEach((n,i)=>{n.addEventListener("change",o=>{const a=parseFloat(o.target.value),l=e.get().map(u=>parseFloat(u));if(l[0]===l[1]){if(i===0&&a>l[0]){e.set([a,a]);return}if(i===1&&a<l[1]){e.set([a,a]);return}}const c=[null,null];c[i]=o.target.value,e.set(c)})})}function cd(){document.querySelectorAll(".year-input-wrapper").forEach(r=>{const e=r.querySelector(".year-input"),t=r.querySelector(".stepper-btn.stepper-up"),s=r.querySelector(".stepper-btn.stepper-down");if(!e||!t||!s)return;const n=i=>{he("light");let o=parseInt(e.value,10);isNaN(o)&&(o=i>0?N.YEAR_MIN:N.YEAR_MAX);const a=Math.min(Math.max(o+i,N.YEAR_MIN),N.YEAR_MAX);e.value=a,e.dispatchEvent(new Event("change",{bubbles:!0}))};t.addEventListener("click",()=>n(1)),s.addEventListener("click",()=>n(-1))})}const ud={genre:kc,director:Ic,actor:xc,country:Pc};function dd(){D.sidebarFilterForms.forEach(r=>{const e=r.querySelector(M.SIDEBAR_FILTER_INPUT),t=r.dataset.filterType,s=ud[t];if(!e||!s)return;e.setAttribute("role","combobox"),e.setAttribute("aria-autocomplete","list"),e.setAttribute("aria-expanded","false");const n=ps(async()=>{const i=e.value;if(i.length<3){Jt(r);return}const o=await s(i);id(r,o,i)},N.SEARCH_DEBOUNCE_DELAY);e.addEventListener("input",n),e.addEventListener("keydown",i=>{const o=r.querySelector(M.SIDEBAR_AUTOCOMPLETE_RESULTS);if(!o||o.children.length===0)return;const a=Array.from(o.children);let l=a.findIndex(u=>u.classList.contains("is-active"));const c=u=>{a.forEach(d=>d.classList.remove("is-active")),u>=0&&a[u]?(a[u].classList.add("is-active"),e.setAttribute("aria-activedescendant",a[u].id)):e.removeAttribute("aria-activedescendant")};switch(i.key){case"ArrowDown":i.preventDefault(),l=Math.min(l+1,a.length-1),c(l);break;case"ArrowUp":i.preventDefault(),l=Math.max(l-1,-1),c(l);break;case"Enter":i.preventDefault(),l>=0&&a[l]&&a[l].click();break;case"Escape":i.preventDefault(),Jt();break}}),r.addEventListener("click",i=>{const o=i.target.closest(`.${ae.SIDEBAR_AUTOCOMPLETE_ITEM}`);o&&(he("light"),wr(t,o.dataset.value),e.value="",Jt(),window.innerWidth<=ge&&fe())})})}function Wn(r){const e=r.target.closest(".filter-pill");if(!e)return!1;he("medium");const{filterType:t,filterValue:s}=e.dataset;return e.classList.add("is-removing"),e.addEventListener("animationend",()=>{e.classList.contains("filter-pill--exclude")?vo(t,s):wr(t,null)},{once:!0}),!0}function hd(){document.querySelectorAll(".collapsible-section .section-header").forEach(e=>{const t=document.createElement("div");t.innerHTML=we.CHEVRON_RIGHT,t.firstChild&&e.appendChild(t.firstChild)});const r=document.querySelector(".sidebar-static-filters");r&&r.addEventListener("click",e=>{Wn(e)&&window.innerWidth<=ge&&fe()}),D.rewindButton&&D.rewindButton.addEventListener("click",e=>{if(he("light"),window.innerWidth<=ge)document.body.classList.contains("sidebar-is-open")?fe():Ps();else{document.body.classList.toggle("sidebar-collapsed");const s=document.body.classList.contains("sidebar-collapsed");yr(!s)}}),D.sidebarOverlay&&D.sidebarOverlay.addEventListener("click",fe),D.toggleRotationBtn&&D.toggleRotationBtn.addEventListener("click",e=>{mo(),window.innerWidth<=ge&&fe()}),D.sidebarScrollable&&D.sidebarScrollable.addEventListener("click",e=>{const t=e.target.closest(".exclude-filter-btn");if(t){e.stopPropagation(),he("medium"),Ie(t),vo(t.dataset.type,t.dataset.value),window.innerWidth<=ge&&fe();return}if(Wn(e)){window.innerWidth<=ge&&fe();return}const s=e.target.closest(".filter-link");s&&!s.hasAttribute("disabled")&&(he("light"),Ie(s),wr(s.dataset.filterType,s.dataset.filterValue),window.innerWidth<=ge&&fe())}),D.playButton&&D.playButton.addEventListener("click",ad),D.collapsibleSections.forEach(e=>{const t=e.querySelector(".section-header");t?.addEventListener("click",()=>{he("light");const n=!e.classList.contains(ae.ACTIVE);D.collapsibleSections.forEach(i=>{i!==e&&(i.classList.remove(ae.ACTIVE),i.querySelector(".section-header")?.setAttribute("aria-expanded","false"))}),e.classList.toggle(ae.ACTIVE,n),t.setAttribute("aria-expanded",n),D.sidebarInnerWrapper?.classList.toggle("is-compact",n),n&&setTimeout(()=>{e.classList.contains(ae.ACTIVE)&&t&&t.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})},300)})})}function fd(){window.innerWidth<=ge&&yr(!1);const r=t=>{const s=Ye[t];if(!s)return;const n=t==="country"?"countries-content":`${t}s-content`,i=document.querySelector(`#${n} > div:first-child`);if(!i)return;const o=i.closest(".collapsible-section").querySelector(".active-filters-list");o&&(po[t]=o),i.textContent="";const a=document.createDocumentFragment();Object.entries(s.items).forEach(([l,c])=>{const u=q("button",{type:"button",className:"filter-link",dataset:{filterType:t,filterValue:l}});if(t==="studio"&&St[l]){const d=St[l];u.classList.add("filter-link--studio"),u.title=c;const g=document.createElementNS("http://www.w3.org/2000/svg","svg");g.setAttribute("width",d.w||"24"),g.setAttribute("height",d.h||"24"),g.setAttribute("viewBox",d.vb||"0 0 24 24"),g.setAttribute("class",`sidebar-platform-icon ${d.class||""}`),g.setAttribute("fill","currentColor");const f=document.createElementNS("http://www.w3.org/2000/svg","use");f.setAttribute("href",`${ks}#${d.id}`),g.appendChild(f),u.appendChild(g),u.appendChild(q("span",{className:"sr-only",textContent:c}))}else{const d=q("span",{textContent:c});u.appendChild(d)}if(s.excludable?.includes(l)){const d=q("button",{type:"button",className:"exclude-filter-btn",dataset:{value:l,type:t},attributes:{"aria-label":`Excluir ${s.label} ${c}`},innerHTML:we.PAUSE_SMALL});u.appendChild(d)}a.appendChild(u)}),i.appendChild(a)};Object.keys(Ye).forEach(r);const e=async()=>{try{const[t,s]=await Promise.all([Lc(),jc()]);t&&t.length>0&&(Ye.actor.items=t.reduce((n,i)=>({...n,[i]:i}),{}),r("actor")),s&&s.length>0&&(Ye.director.items=s.reduce((n,i)=>({...n,[i]:i}),{}),r("director"))}catch{}};if("requestIdleCallback"in window?requestIdleCallback(e):setTimeout(e,500),Jn.get("rotationState")==="disabled"&&document.body.classList.add("rotation-disabled"),D.toggleRotationBtn){const t=document.body.classList.contains("rotation-disabled");D.toggleRotationBtn.innerHTML=t?we.SQUARE_STOP:we.PAUSE,D.toggleRotationBtn.setAttribute("aria-label",t?"Activar rotación de tarjetas":"Pausar rotación de tarjetas"),D.toggleRotationBtn.title=t?"Giro automático":"Vista Rápida",D.toggleRotationBtn.setAttribute("aria-pressed",t)}ld(),sd(),hd(),nd(),dd(),cd(),document.addEventListener("updateSidebarUI",()=>{D.sidebarFilterForms.forEach(n=>{const i=n.querySelector(M.SIDEBAR_FILTER_INPUT);i&&(i.value="")});const s=(be().year||`${N.YEAR_MIN}-${N.YEAR_MAX}`).split("-").map(Number);D.yearSlider?.noUiSlider&&D.yearSlider.noUiSlider.set(s,!1),requestAnimationFrame(()=>{ct()})}),document.addEventListener("filtersReset",gs),document.addEventListener("uiActionTriggered",gs)}const re={loginView:document.getElementById("login-view"),registerView:document.getElementById("register-view"),loginForm:document.getElementById("login-form"),registerForm:document.getElementById("register-form"),showRegisterBtn:document.getElementById("show-register-view"),showLoginBtn:document.getElementById("show-login-view"),authMessage:document.getElementById("auth-message")};function Re(r,e="error"){re.authMessage&&(re.authMessage.textContent=r,re.authMessage.className=`auth-message auth-message--${e}`,re.authMessage.style.display="block")}function cr(){re.authMessage&&(re.authMessage.style.display="none",re.authMessage.textContent="")}function ur(r,e,t){r&&(r.disabled=e,r.textContent=e?"Procesando...":t,r.style.cursor=e?"wait":"pointer",r.style.opacity=e?"0.7":"1")}async function gd(r){r.preventDefault(),cr();const e=re.registerForm,t=e.elements["register-email"].value.trim(),s=e.elements["register-password"].value.trim(),n=e.querySelector('button[type="submit"]'),i=n.textContent;if(!t||!s){Re("Por favor, completa todos los campos.","error");return}ur(n,!0,i);try{const{data:o,error:a}=await Ce.auth.signUp({email:t,password:s});a?Re(`Error en el registro: ${a.message}`):o.user&&o.user.identities&&o.user.identities.length===0?Re("Este usuario ya está registrado.","error"):o.user&&(Re("¡Registro exitoso! Revisa tu email para confirmar tu cuenta.","success"),e.reset())}catch(o){Re("Ocurrió un error inesperado.","error"),console.error(o)}finally{ur(n,!1,i)}}async function pd(r){r.preventDefault(),cr();const e=re.loginForm,t=e.elements["login-email"].value.trim(),s=e.elements["login-password"].value.trim(),n=e.querySelector('button[type="submit"]'),i=n.textContent;if(!t||!s){Re("Introduce tu email y contraseña.","error");return}ur(n,!0,i);try{const{error:o}=await Ce.auth.signInWithPassword({email:t,password:s});o?o.message.includes("Invalid login")?Re("Email o contraseña incorrectos."):o.message.includes("not confirmed")?Re("Por favor, confirma tu email antes de iniciar sesión."):Re(`Error: ${o.message}`):(Ae("¡Hola de nuevo! Sesión iniciada.","success"),as(),e.reset())}catch(o){Re("Error de conexión al iniciar sesión.","error"),console.error(o)}finally{ur(n,!1,i)}}function md(){re.loginForm&&(re.loginForm.addEventListener("submit",pd),re.registerForm.addEventListener("submit",gd),re.showRegisterBtn.addEventListener("click",()=>{cr(),re.loginView.style.display="none",re.registerView.style.display="block";const r=re.registerForm.elements["register-email"];r&&setTimeout(()=>r.focus(),50)}),re.showLoginBtn.addEventListener("click",()=>{cr(),re.registerView.style.display="none",re.loginView.style.display="block";const r=re.loginForm.elements["login-email"];r&&setTimeout(()=>r.focus(),50)}))}const yo={q:"searchTerm",genre:"genre",year:"year",country:"country",dir:"director",actor:"actor",sel:"selection",stu:"studio",sort:"sort",type:"mediaType",p:"page",exg:"excludedGenres",exc:"excludedCountries"},_t=Object.fromEntries(Object.entries(yo).map(([r,e])=>[e,r]));async function Oe(r=1){const t=Gn("movie-grid-load").signal;os(r),Td(),Cd(),document.body.classList.add("is-fetching"),P.gridContainer.classList.add("is-fetching"),P.gridContainer.setAttribute("aria-busy","true"),Qu(P.gridContainer,P.paginationContainer);const s=ft().totalMovies;Kt(Ot(),s),window.scrollTo({top:0,behavior:"auto"});const n=!!document.startViewTransition;await(async()=>{try{const o=r===1?N.DYNAMIC_PAGE_SIZE_LIMIT:N.ITEMS_PER_PAGE,a=r===1||s===0,l=await Ki(be(),r,o,t,a);if(l.aborted)return;const{items:c,total:u}=l;c&&c.length>0&&Xo(c[0]);const d=()=>{const g=u>=0?u:s;vd(c,g),r===1&&window.innerWidth<=700&&window.scrollTo({top:0,behavior:"auto"})};n?document.startViewTransition(d):d()}catch(o){if(o.name==="AbortError")return;console.error("Error en carga (Main):",o);const a=Yo(o);if(a&&Ae(a,"error"),ed(P.gridContainer,P.paginationContainer,a||"Error desconocido"),a)throw new Error(a)}finally{t.aborted||(document.body.classList.remove("is-fetching"),P.gridContainer.classList.remove("is-fetching"),P.gridContainer.setAttribute("aria-busy","false"))}})()}function vd(r,e){Sc(e),Fc(e,Ec());const t=ft();if(t.totalMovies===0)Zu(P.gridContainer,P.paginationContainer,be()),Kt(1,0);else if(t.totalMovies<=N.DYNAMIC_PAGE_SIZE_LIMIT&&t.currentPage===1)Bn(P.gridContainer,r),P.paginationContainer.textContent="",Kt(1,1);else{const s=N.ITEMS_PER_PAGE,n=r.slice(0,s);Bn(P.gridContainer,n),t.totalMovies>s?Dc(P.paginationContainer,t.totalMovies,t.currentPage):P.paginationContainer.textContent="",Kt(t.currentPage,t.totalMovies)}t.totalMovies>0&&$c(t.currentPage,t.totalMovies,be())}async function yd(r){Ie(r.target),document.dispatchEvent(new CustomEvent("uiActionTriggered")),Rt(P.sortSelect.value),await Oe(1)}async function wd(r){Ie(r.currentTarget),document.dispatchEvent(new CustomEvent("uiActionTriggered"));const e=ft().activeFilters.mediaType,t={all:"movies",movies:"series",series:"all"};nr(t[e]),Os(t[e]),await Oe(1)}async function Wr(){const r=P.searchInput.value.trim();r!==ft().activeFilters.searchTerm&&(r.length>=3||r.length===0)&&(document.dispatchEvent(new CustomEvent("uiActionTriggered")),Gi(r),await Oe(1))}let Hr=!1,Xt=0;function bd(){Hr||(window.requestAnimationFrame(()=>{const r=window.scrollY;if(P.mainHeader.classList.toggle(ae.IS_SCROLLED,r>10),window.innerWidth<=700){const e=r>Xt,t=Math.abs(r-Xt);window.innerHeight+r>=document.documentElement.scrollHeight-50?P.mainHeader.classList.remove("is-hidden-mobile"):t>5&&P.mainHeader.classList.toggle("is-hidden-mobile",e&&r>60)}Xt=r,Hr=!1}),Hr=!0)}function _d(r){const{keepSort:e,newFilter:t}=r.detail||{},s=e?ft().activeFilters.sort:Me.SORT;Cs(),Rt(s),t&&ee(t.type,t.value),P.searchInput.value="",P.sortSelect.value=s,Os(Me.MEDIA_TYPE),document.dispatchEvent(new CustomEvent("updateSidebarUI")),Oe(1)}function Ed(){const r=ps(Wr,N.SEARCH_DEBOUNCE_DELAY);P.searchInput.addEventListener("input",r),P.searchForm.addEventListener("submit",i=>{i.preventDefault(),Wr()}),P.searchInput.addEventListener("focus",()=>P.mainHeader.classList.add("is-search-focused")),P.searchInput.addEventListener("blur",()=>P.mainHeader.classList.remove("is-search-focused")),P.sortSelect.addEventListener("change",yd),P.typeFilterToggle.addEventListener("click",wd);const e=document.getElementById("mobile-sidebar-toggle");e&&e.addEventListener("click",()=>{he("light"),document.body.classList.contains("sidebar-is-open")?fe():Ps()});const t=async i=>{const o=Ot(),a=Math.ceil(ft().totalMovies/N.ITEMS_PER_PAGE),l=o+i;l>0&&l<=a&&(document.dispatchEvent(new CustomEvent("uiActionTriggered")),await Oe(l))};P.headerPrevBtn.addEventListener("click",i=>{Ie(i.currentTarget),t(-1)}),P.headerNextBtn.addEventListener("click",i=>{Ie(i.currentTarget),t(1)});const s=P.searchForm.querySelector(".search-icon--clear");if(s){const i=o=>{o.cancelable&&o.preventDefault(),o.stopPropagation(),P.searchInput.value="",P.searchInput.focus(),Wr()};s.addEventListener("mousedown",o=>o.preventDefault()),s.addEventListener("touchstart",i,{passive:!1}),s.addEventListener("click",i)}const n=()=>{P.searchInput&&(P.searchInput.placeholder=window.innerWidth<=700?"":"Título")};window.addEventListener("resize",n),n()}function Sd(){document.addEventListener("click",e=>{e.target.closest(M.SIDEBAR_FILTER_FORM)||Jt(),e.target.closest(".sidebar")||gs()}),P.gridContainer.addEventListener("click",function(e){const t=e.target.closest(".movie-card");if(t){Nn.call(t,e);return}e.target.closest("#clear-filters-from-empty")&&document.dispatchEvent(new CustomEvent("filtersReset"))}),Hu(P.gridContainer),document.getElementById("quick-view-content").addEventListener("click",function(e){Nn.call(this,e)}),P.paginationContainer.addEventListener("click",async e=>{const t=e.target.closest(".btn[data-page]");if(t){document.dispatchEvent(new CustomEvent("uiActionTriggered")),Ie(t);const s=parseInt(t.dataset.page,10);await Oe(s)}}),Xt=window.scrollY,window.addEventListener("scroll",bd,{passive:!0}),document.addEventListener("keydown",e=>{e.key==="Escape"&&document.body.classList.contains(ae.SIDEBAR_OPEN)&&fe()}),document.addEventListener("card:requestUpdate",e=>{e.detail.cardElement&&Be(e.detail.cardElement)});const r=()=>document.querySelectorAll(".movie-card").forEach(Be);document.addEventListener("userMovieDataChanged",r),document.addEventListener("userDataUpdated",r),document.addEventListener("filtersReset",_d)}function Ad(){const r=document.getElementById("user-avatar-initials"),e=document.getElementById("logout-button");async function t(i){document.body.classList.add("user-logged-in");const o=i.email||"";r.textContent=o.charAt(0).toUpperCase(),r.title=`Sesión iniciada como: ${o}`;try{const a=await Rc();Ac(a),document.dispatchEvent(new CustomEvent("userDataUpdated"))}catch(a){Ae(a.message,"error")}}function s(){document.body.classList.remove("user-logged-in"),r.textContent="",r.title="",Tc(),document.dispatchEvent(new CustomEvent("userDataUpdated"))}async function n(){const{error:i}=await Ce.auth.signOut();i&&(console.error("Logout error:",i),Ae("Error al cerrar sesión.","error"))}e&&e.addEventListener("click",n),Ce.auth.onAuthStateChange((i,o)=>{o?.user?t(o.user):s()})}function Td(){const{searchTerm:r,genre:e,year:t,country:s,director:n,actor:i,selection:o,studio:a,mediaType:l}=be();let c="Películas y series";l==="movies"?c="Películas":l==="series"&&(c="Series");let u=c;const d=t&&t!==`${N.YEAR_MIN}-${N.YEAR_MAX}`?` (${t.replace("-"," a ")})`:"";if(r)u=`Resultados para "${r}"`;else if(o){const g=Ye.selection,f=g.titles?.[o]||g.items[o];f&&(u=f+d)}else a?u=(St[a]?.title||u)+d:e?u=`${c} de ${e}`:n?u=`${c} de ${n}`:i?u=`${c} con ${i}`:t&&t!==`${N.YEAR_MIN}-${N.YEAR_MAX}`?u=`${c} de ${t.replace("-"," a ")}`:s&&(u=`${c} de ${s}`);document.title=`${u} | videoclub.digital`}function Hn(){Cs();const r=new URLSearchParams(window.location.search);Object.entries(yo).forEach(([t,s])=>{const n=r.get(t);n!==null&&(s==="page"?os(parseInt(n,10)||1):s==="searchTerm"?Gi(n):s==="sort"?Rt(n):s==="mediaType"?nr(n):s==="excludedGenres"||s==="excludedCountries"?ee(s,n.split(","),!0):ee(s,n,!0))}),r.has(_t.sort)||Rt(Me.SORT),r.has(_t.mediaType)||nr(Me.MEDIA_TYPE),r.has(_t.page)||os(1);const e=be();P.searchInput.value=e.searchTerm,P.sortSelect.value=e.sort,Os(e.mediaType)}function Cd(){const r=new URLSearchParams,e=be(),t=Ot();Object.entries(e).forEach(([n,i])=>{const o=_t[n];if(o){if(Array.isArray(i)&&i.length>0)r.set(o,i.join(","));else if(typeof i=="string"&&i.trim()!==""){if(n==="mediaType"&&i===Me.MEDIA_TYPE||n==="sort"&&i===Me.SORT||n==="year"&&i===`${N.YEAR_MIN}-${N.YEAR_MAX}`)return;r.set(o,i)}}}),t>1&&r.set(_t.page,t);const s=r.toString()?`${window.location.pathname}?${r.toString()}`:window.location.pathname;s!==`${window.location.pathname}${window.location.search}`&&history.pushState({path:s},"",s)}function Od(){requestAnimationFrame(()=>{document.querySelectorAll("[data-loading]").forEach(r=>{r.removeAttribute("data-loading")})}),"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("sw.js").catch(r=>console.error("Fallo SW:",r))}),window.addEventListener("popstate",()=>{gt(),Hn(),document.dispatchEvent(new CustomEvent("updateSidebarUI")),Oe(Ot())}),fd(),ju(),qc(),Ed(),Sd(),Ad(),Bc(),md(),Hn(),document.dispatchEvent(new CustomEvent("updateSidebarUI")),Oe(Ot())}document.addEventListener("DOMContentLoaded",Od);
