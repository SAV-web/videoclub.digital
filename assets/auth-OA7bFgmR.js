import{K as m,o as h,M as v}from"./index-DSIcWjIj.js";const l=()=>({loginView:document.getElementById("login-view"),registerView:document.getElementById("register-view"),loginForm:document.getElementById("login-form"),registerForm:document.getElementById("register-form"),showRegisterBtn:document.getElementById("show-register-view"),showLoginBtn:document.getElementById("show-login-view"),authMessage:document.getElementById("auth-message")});function o(t,e="error"){const{authMessage:r}=l();if(r){if(!t){r.style.display="none",r.textContent="";return}r.textContent=t,r.className=`auth-message auth-message--${e}`,r.style.display="block"}}function g(t){const e=(t?.message||"").toLowerCase();return e.includes("invalid login")||e.includes("invalid credentials")?"Email o contraseña incorrectos.":e.includes("user already registered")?"Este email ya está registrado.":e.includes("rate limit")?"Demasiados intentos. Espera un momento.":e.includes("not confirmed")?"Por favor, confirma tu email primero.":e.includes("weak password")?"La contraseña es muy débil.":t?.message?`Error: ${t.message}`:"Error desconocido"}async function f(t,e){t.preventDefault(),o(null);const r=t.currentTarget,s=r.querySelector('button[type="submit"]'),i=s?s.textContent:"",c=r.id==="login-form",u=r.querySelector(c?"#login-email":"#register-email"),d=r.querySelector(c?"#login-password":"#register-password"),n=u?.value.trim(),a=d?.value.trim();if(!n||!a){o("Por favor, completa todos los campos."),n?a||d?.focus():u?.focus();return}s&&(s.disabled=!0,s.textContent="Procesando...",s.style.opacity="0.7");try{await e(n,a,r)}catch(w){console.error(w),o("Ocurrió un error inesperado de conexión.")}finally{s&&(s.disabled=!1,s.textContent=i,s.style.opacity="1")}}const y={login:async(t,e,r)=>{const{error:s}=await m.auth.signInWithPassword({email:t,password:e});s?o(g(s)):(h("¡Hola de nuevo! Sesión iniciada.","success"),v(),r.reset())},register:async(t,e,r)=>{const{data:s,error:i}=await m.auth.signUp({email:t,password:e});i?o(g(i)):s.user&&s.user.identities?.length===0?o("Este usuario ya está registrado.","error"):s.user&&(o("¡Registro exitoso! Revisa tu email para confirmar.","success"),r.reset())}};function p(t){const e=l();o(null),t?(e.loginView.style.display="none",e.registerView.style.display="block",requestAnimationFrame(()=>{e.registerForm.querySelector("input")?.focus({preventScroll:!0})})):(e.registerView.style.display="none",e.loginView.style.display="block",requestAnimationFrame(()=>{e.loginForm.querySelector("input")?.focus({preventScroll:!0})}))}function b(){const t=l();t.loginForm&&(t.loginForm.addEventListener("submit",e=>f(e,y.login)),t.registerForm.addEventListener("submit",e=>f(e,y.register)),t.showRegisterBtn.addEventListener("click",()=>p(!0)),t.showLoginBtn.addEventListener("click",()=>p(!1)))}export{b as initAuthForms};
