import{z as x,u as A,A as E,B as b,D as q,E as I,c as S,G as D,a as k,s as T,H as B,J as M}from"./index-BIYfxE9S.js";const p=()=>({overlay:document.getElementById("quick-view-overlay"),modal:document.getElementById("quick-view-modal"),content:document.getElementById("quick-view-content"),template:document.getElementById("movie-card-template")?.content,prevBtn:document.getElementById("modal-prev-btn"),nextBtn:document.getElementById("modal-next-btn")}),o={startY:0,startX:0,currentY:0,isDragging:!1,isHorizontalSwipe:!1},_=80,H=120;function v(e){const{modal:t}=p(),s=e.target.closest(".movie-card");t.classList.contains("is-visible")&&!t.contains(e.target)&&!s&&y()}function N(e){const t=e.target.closest(".front-director-info a[data-director-name]"),s=e.target.closest('[data-template="actors"] a[data-actor-name]');if(t||s){e.preventDefault(),y();const a=t?"director":"actor",n=t?t.dataset.directorName:s.dataset.actorName;document.dispatchEvent(new CustomEvent("filtersReset",{detail:{keepSort:!0,newFilter:{type:a,value:n}}}))}}function Y(e){const{modal:t}=p();o.startY=e.touches[0].clientY,o.startX=e.touches[0].clientX,o.isDragging=!1,o.isHorizontalSwipe=!1,t.classList.remove("is-dragging")}function X(e){if(!o.isDragging&&!o.isHorizontalSwipe&&e.defaultPrevented)return;const{modal:t,content:s}=p(),a=e.touches[0].clientY,n=e.touches[0].clientX,i=a-o.startY,r=n-o.startX;if(!o.isDragging&&!o.isHorizontalSwipe){if(Math.abs(r)<5&&Math.abs(i)<5)return;Math.abs(i)>Math.abs(r)&&i>0&&s.scrollTop<=0?window.innerWidth<=700&&(o.isDragging=!0,t.classList.add("is-dragging")):Math.abs(r)>Math.abs(i)&&(o.isHorizontalSwipe=!0)}o.isDragging?(e.cancelable&&e.preventDefault(),t.style.transform=`translate(-50%, ${i}px)`,o.currentY=i):o.isHorizontalSwipe&&e.cancelable&&e.preventDefault()}function L(e){const{modal:t}=p();if(o.isHorizontalSwipe){const s=e.changedTouches[0].clientX-o.startX;Math.abs(s)>_&&g(s<0?1:-1),o.isHorizontalSwipe=!1;return}o.isDragging&&(t.classList.remove("is-dragging"),o.currentY>H?y():t.style.transform="",o.currentY=0,o.isDragging=!1)}function C(){const e=document.getElementById("grid-container");return e?Array.from(e.querySelectorAll(".movie-card")):[]}function g(e){const{content:t}=p(),s=t.dataset.movieId;if(!s)return;const a=C(),n=a.findIndex(r=>r.dataset.movieId===s);if(n===-1)return;const i=n+e;i>=0&&i<a.length&&R(a[i])}function $(e){const{prevBtn:t,nextBtn:s}=p(),a=String(e),n=C(),i=n.findIndex(l=>l.dataset.movieId===a);if(i===-1)return;const r=i>0,c=i<n.length-1;t&&(t.disabled=!r,t.style.opacity=r?"1":"0",t.style.pointerEvents=r?"auto":"none"),s&&(s.disabled=!c,s.style.opacity=c?"1":"0",s.style.pointerEvents=c?"auto":"none")}const w=(e,t)=>S("a",{textContent:e,href:"#",dataset:{[t==="director"?"directorName":"actorName"]:e}});function z(e,t){const s=e.querySelector("img");s&&(s.src=t.image_hq||"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=",s.alt=`PÃ³ster de ${t.title}`);const a=e.querySelector('[data-template="title"]');a.textContent=t.title,a.id="quick-view-title",a.className="",t.title.length>45?a.classList.add("title-xl-long"):t.title.length>25&&a.classList.add("title-long");const n=e.querySelector('[data-template="director"]');n.textContent="",t.directors&&t.directors.split(", ").forEach((r,c,l)=>{n.appendChild(w(r.trim(),"director")),c<l.length-1&&n.append(", ")}),e.querySelector('[data-template="year"]').textContent=t.year||"",D(e.querySelector('[data-template="country-container"]'),e.querySelector('[data-template="country-flag"]'),t.country_code,t.country);const i=e.querySelector(".card-icons-line");i&&(i.innerHTML="",[...t.studios_list?.split(",")||[],...t.selections_list?.split(",")||[]].forEach(c=>{const l=k[c];l&&i.appendChild(S("span",{className:`platform-icon ${l.class||""}`,title:l.title,innerHTML:`<svg width="${l.w||24}" height="${l.h||24}" fill="currentColor" viewBox="${l.vb||"0 0 24 24"}"><use href="${T}#${l.id}"></use></svg>`}))}))}function O(e,t){const s=e.querySelector(".back-original-title-wrapper");if(t.original_title&&t.original_title.trim()&&t.original_title.toLowerCase()!==t.title.toLowerCase()){const d=s.querySelector("span");d.textContent=t.original_title,d.className="",t.original_title.length>40?d.classList.add("title-xl-long"):t.original_title.length>20&&d.classList.add("title-long"),s.style.display="flex"}else s.style.display="none";const n=t.type?.toUpperCase().startsWith("S.");e.querySelector('[data-template="duration"]').textContent=B(t.minutes,n);const i=e.querySelector('[data-template="episodes"]'),r=n&&t.episodes?`${t.episodes} x`:"";i.textContent=r,i.style.display=r?"inline":"none";const c=(d,m)=>{const u=e.querySelector(`[data-template="${d}-link"]`);m?(u.href=m,u.classList.remove("disabled"),u.setAttribute("aria-label",`Ver en ${d}`),u.style.display="flex"):(u.removeAttribute("href"),u.classList.add("disabled"),u.removeAttribute("aria-label"),u.style.display="flex")};c("justwatch",t.justwatch),c("wikipedia",t.wikipedia),e.querySelector('[data-template="genre"]').textContent=t.genres||"N/A",e.querySelector('[data-template="synopsis"]').textContent=t.synopsis||"N/A";const l=e.querySelector('[data-template="critic-container"]');t.critic?.trim()?(l.querySelector('[data-template="critic"]').textContent=t.critic,l.style.display="block"):l.style.display="none";const f=e.querySelector('[data-template="actors"]');f.textContent="",t.actors?t.actors.split(",").forEach((d,m,u)=>{const h=d.trim();M.includes(h.toLowerCase())?f.append(h):f.appendChild(w(h,"actor")),m<u.length-1&&f.append(", ")}):f.textContent="N/A"}function P(e){const{template:t,content:s,modal:a}=p();if(!t)return;const n=e.querySelector("img"),i=n?n.dataset.src||n.src:null,r={...e.movieData,image_hq:i},c=t.cloneNode(!0);c.querySelector(".movie-card").classList.add("is-quick-view"),a.classList.contains("is-visible")||a.classList.remove("hide-arrows"),s.movieData=r,s.dataset.movieId=r.id;const f=c.querySelector(".flip-card-front"),d=c.querySelector(".flip-card-back");z(f,r),O(d,r),b(d,r),s.textContent="",s.appendChild(c),q(s),I(s),$(r.id)}function y(){const{modal:e,overlay:t}=p();e.classList.contains("is-visible")&&(e.classList.remove("is-visible"),t.classList.remove("is-visible"),document.body.classList.remove("modal-open"),setTimeout(()=>e.style.transform="",300),x(e,t),document.removeEventListener("click",v))}function R(e){if(!e)return;const{modal:t,overlay:s,content:a}=p();A(),P(e),document.body.classList.add("modal-open"),requestAnimationFrame(()=>{t.classList.add("is-visible"),s.classList.add("is-visible"),E(t,s,!0),a&&(a.scrollTop=0),setTimeout(()=>document.addEventListener("click",v),50)})}function G(){const{modal:e,content:t,prevBtn:s,nextBtn:a}=p();e&&(t&&t.addEventListener("click",n=>{N(n),window.innerWidth<=700&&n.target.closest(".poster-container")&&e.classList.toggle("hide-arrows")}),window.addEventListener("keydown",n=>{e.classList.contains("is-visible")&&(n.key==="Escape"?(n.stopPropagation(),y()):n.key==="ArrowLeft"?g(-1):n.key==="ArrowRight"&&g(1))},{capture:!0}),s?.addEventListener("click",n=>{n.stopPropagation(),g(-1)}),a?.addEventListener("click",n=>{n.stopPropagation(),g(1)}),navigator.maxTouchPoints>0&&(e.addEventListener("touchstart",Y,{passive:!0}),e.addEventListener("touchmove",X,{passive:!1}),e.addEventListener("touchend",L,{passive:!0}),e.addEventListener("touchcancel",L,{passive:!0})))}export{y as closeModal,G as initQuickView,R as openModal};
