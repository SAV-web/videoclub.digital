/* =================================================================
 *          COMPONENTE: Acciones de Tarjeta (Overlay)
 * =================================================================
 *  FICHERO: src/css/components/card-actions.css
 *  RESPONSABILIDAD: Gestionar el bloque flotante de acciones sobre
 *  el póster, incluyendo efectos visuales (aura) y estados activos.
 * ================================================================= */

/* --- 1. Layout y Posicionamiento --- */
.card-rating-block {
  position: absolute;
  bottom: 1px; /* Separación del borde inferior del póster */
  left: 0;
  right: 0;
  transform: translateY(66.66%); /* Efecto de solapamiento con el texto inferior */
  z-index: 5;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 var(--space-sm);
  pointer-events: none; /* Permite clic a través del contenedor */
}

/* --- 2. Efecto "Aura" (Contraste visual sobre el póster) --- */
.card-rating-block > * {
  pointer-events: auto; /* Reactivar clics en los iconos */
  /* 
     Aura Modo Claro: Usamos el color de la superficie (blanco/gris claro).
     Doble capa para mayor solidez.
  */
  filter: drop-shadow(0 0 2px var(--color-surface)) drop-shadow(0 0 4px var(--color-surface));
  transition: filter 0.3s ease, transform var(--duration-quick) var(--ease-spring);
}

html.dark-mode .card-rating-block > * {
  /* 
     Aura Modo Oscuro: Usamos NEGRO PURO (#000) para crear contraste real.
     Tres capas para simular un contorno sólido y denso.
  */
  filter: 
    drop-shadow(0 0 1px #000) 
    drop-shadow(0 0 2px #000) 
    drop-shadow(0 0 4px #000);
}

/* --- 3. Botón de Watchlist (Marcapáginas) --- */
.card-action-btn {
  width: 28px;
  height: 28px;
  padding: 0;
  border: none;
  border-radius: var(--radius-round);
  background-color: transparent;
  color: var(--color-accent);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all var(--duration-normal) var(--ease-smooth-out);
}

.card-action-btn:hover {
  transform: scale(1.15) rotate(10deg);
}

.card-action-btn svg {
  width: 20px; height: 20px;
  transition: all var(--duration-normal) var(--ease-smooth-out);
}

/* Estado Activo (Watchlist) */
.card-action-btn.is-active {
  animation: watchlist-pop var(--duration-normal) var(--ease-bounce-in);
}

.card-action-btn.is-active svg {
  color: #ffbd07; /* Amarillo */
  fill: #ffbd07;  /* Relleno sólido */
  /* NUEVO: Añadimos el destello luminoso al SVG interno */
  animation: watchlist-glow 0.6s ease-out;
}

.card-action-btn.is-active svg path {
  stroke: #ffbd07;
}

/* El signo "+" se vuelve del color de fondo para parecer un hueco */
.card-action-btn.is-active svg line {
  stroke: var(--color-surface);
}

@keyframes watchlist-pop {
  0% { transform: scale(1) rotate(0deg); }
  50% { transform: scale(1.3) rotate(-5deg); }
  100% { transform: scale(1); }
}
/* NUEVO: Destello amarillo que se expande y desvanece */
@keyframes watchlist-glow {
  0% { 
    filter: drop-shadow(0 0 0 rgba(255, 189, 7, 0)); 
  }
  50% { 
    /* Brillo intenso en el momento del impacto */
    filter: drop-shadow(0 0 10px rgba(255, 189, 7, 0.8)); 
  }
  100% { 
    filter: drop-shadow(0 0 0 rgba(255, 189, 7, 0)); 
  }
}

/* --- 4. Interactividad de Ratings (Estrellas y Suspenso) --- */
.star-rating-container.is-interactive,
.low-rating-circle.is-interactive {
  cursor: pointer;
}

/* Transición base con "rebote" para las estrellas */
.star-rating-container.is-interactive .star-icon {
  /* Curva de Bézier para efecto elástico (pop) */
  transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  transform-origin: center center;
}

/* Efecto Hover Individual (Magnetismo) */
.star-rating-container.is-interactive .star-icon:hover {
  /* Aumentamos escala y aseguramos que esté por encima de sus vecinas */
  transform: scale(1.35); 
  z-index: 10; 
  /* Añadimos un pequeño brillo amarillo al hacer hover */
  filter: drop-shadow(0 0 4px rgba(255, 189, 7, 0.6));
}

/* Efecto para el círculo de suspenso */
.low-rating-circle.is-interactive:hover {
  transform: scale(1.2);
  filter: drop-shadow(0 0 4px rgba(255, 189, 7, 0.6));
}

/* --- 5. Estados Activos de Ratings --- */

/* Estrellas Activas */
.star-rating-container.has-user-rating .star-icon-path {
  stroke: #ffbd07;
}
.star-rating-container.has-user-rating .star-icon-path--filled {
  fill: #ffbd07;
}

/* Suspenso Activo (Estrella Hueca Amarilla) */
.low-rating-circle.has-user-rating {
  stroke: #ffbd07; 
  color: #ffbd07; 
  fill: none; /* CRÍTICO: Se mantiene hueca */
  background-color: transparent;
  
  /* Filtro combinado: Aura Blanca + Brillo Amarillo */
  filter: drop-shadow(0 0 2px rgba(255, 193, 7, 0.6)) drop-shadow(0 0 4px var(--color-surface));
}

html.dark-mode .low-rating-circle.has-user-rating {
  fill: none; 
  /* Filtro combinado Dark: Brillo Amarillo + Sombra Negra */
  filter: 
    drop-shadow(0 0 2px rgba(255, 193, 7, 0.8)) 
    drop-shadow(0 0 4px #000);
}

/* --- 6. Utilidades de Scroll --- */
/* Ocultar barras en paneles específicos */
.flip-card-back .scrollable-content.full-view::-webkit-scrollbar { display: none; }
.flip-card-back .scrollable-content.full-view { scrollbar-width: none; -ms-overflow-style: none; }

/* --- 7. Accesibilidad Táctil --- */
@media (hover: none) and (pointer: coarse) {
  .card-action-btn {
    width: 48px; height: 48px; /* Área táctil mínima */
  }
  .card-action-btn svg {
    width: 24px; height: 24px;
  }
  
  /* Ajuste para el icono de suspenso */
  .low-rating-circle {
    width: 24px; height: 24px;
    padding: 0;
  }
  /* Eliminamos pseudo-elementos complejos previos */
  .low-rating-circle::before { display: none; }
}