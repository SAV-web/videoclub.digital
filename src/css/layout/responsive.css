/* ================================================================= */
/* Fichero de Layout: Responsive (Mobile-First)
/* -----------------------------------------------------------------
/* Contiene todas las media queries que adaptan la maquetación.
/* El enfoque es "Mobile-First": los estilos base son para móvil
/* y se añade complejidad progresivamente con `min-width`.
/* ================================================================= */

/* --- ESTILOS BASE (MÓVIL - hasta 768px) --- */

html {
  /* La gestión del tamaño de fuente base ahora se controla mediante
       la redefinición de variables CSS en los puntos de ruptura (ver al final del fichero). */
}

:root {
  --mobile-header-height: 57px;
}

/* --- VERSIÓN MÓVIL EQUILIBRADA: GRID 3 COLUMNAS --- */
@media (max-width: 768px) {

  /* 1. MÁRGENES DE PANTALLA (Aumentados ligeramente) */
  .content {
    /* Aumentamos de 2px a 6px para dar aire a los lados */
    padding-left: 120px;
    padding-right: 12px;
    padding-top: var(--space-md);
    padding-bottom: calc(var(--mobile-header-height) + var(--space-md));
  }

  /* 2. GRID CON SEPARACIÓN */
  .grid-container {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    /* ✨ CAMBIO: Aumentado de 2px a 6px para separar las fichas */
    gap: 12px; 
    padding: 0; 
    align-items: start;
  }

  /* 3. TARJETA (Ajuste automático) */
  .movie-card {
    height: auto;
    aspect-ratio: auto; 
    perspective: 1000px; 
    background: transparent;
    overflow: visible; 
  }

  .flip-card-inner {
    position: relative;
    width: 100%;
    height: auto;
    text-align: center;
    transform-style: preserve-3d; 
    transition: transform 0.6s cubic-bezier(0.4, 0.2, 0.2, 1);
    box-shadow: none; 
  }

  /* 4. CARA FRONTAL */
  .flip-card-front {
    position: relative;
    height: auto;
    border-radius: 4px; /* Radio un poco más suave */
    box-shadow: var(--shadow);
    background-color: var(--color-surface);
    -webkit-backface-visibility: hidden; 
    backface-visibility: hidden;
    z-index: 2;
  }

  /* 5. IMAGEN */
  .poster-container {
    width: 100%;
    height: auto;
    display: flex;
    flex-direction: column;
  }
  
  .poster-container img {
    order: 1;
    width: 100%;
    height: auto;       
    aspect-ratio: unset;
    object-fit: contain;
    border-radius: 4px 4px 0 0;
    border: none;
    display: block;
  }

  /* 6. FOOTER (Iconos) */
  .card-rating-block {
    order: 2;
    position: relative;
    transform: none;
    bottom: auto; left: auto; right: auto;
    width: 100%;
    height: 30px; 
    padding: 0 4px;
    background-color: var(--color-surface);
    border-top: 1px solid var(--color-border);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  /* Iconos */
  .card-action-btn { width: 24px; height: 24px; background: transparent; padding: 0; color: var(--color-text-secondary); }
  .card-action-btn svg { width: 16px; height: 16px; }
  .card-action-btn.is-active svg { color: #ffc107; }
  
  .star-rating-container { gap: 0px; }
  .star-icon { width: 12px; height: 12px; }
  .low-rating-circle { width: 14px; height: 14px; border-width: 2px; }

  /* 7. CARA TRASERA */
  .flip-card-back {
    display: flex; flex-direction: column; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    border-radius: 4px; background-color: var(--color-surface); transform: rotateY(180deg); 
    -webkit-backface-visibility: hidden; backface-visibility: hidden; z-index: 1;
    padding: 4px; overflow-y: auto; font-size: 10px;
  }
  .flip-card-back .back-original-title-wrapper { min-height: auto; margin-bottom: 4px; }
  .flip-card-back .ratings-container { gap: 4px; }
  .flip-card-back .details-list { margin: 4px 0; padding-top: 4px; }

  /* 8. SIDEBAR Y CONTROLES MÓVIL */
  .sidebar {
    position: fixed; left: 0; top: 0; width: 280px; height: 100dvh;
    transform: translateX(-280px); transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 1001; background-color: var(--color-surface); border-right: 2px solid var(--color-border);
  }
  body.sidebar-is-open .sidebar { transform: translateX(0); }
  
  .sidebar .sidebar-inner-wrapper { padding: var(--space-xs); align-items: flex-start; }
  
  .sidebar .logo-area, .sidebar .sidebar-static-filters, .sidebar .sidebar-scrollable-filters {
    opacity: 0; visibility: hidden; transition: opacity 0.2s ease-out, visibility 0s linear 0.2s;
  }
  body.sidebar-is-open .logo-area, body.sidebar-is-open .sidebar-static-filters, body.sidebar-is-open .sidebar-scrollable-filters {
    opacity: 1; visibility: visible; transition: opacity 0.3s ease-in-out 0.15s, visibility 0s linear 0s;
  }
  
  .sidebar .play-button-container { display: none; flex-direction: column; gap: var(--space-md); margin-top: var(--space-xs); }
  body.sidebar-is-open .play-button-container { display: flex; flex-direction: row; margin-top: 0; }
  
  .sidebar .sidebar-control-button { width: 44px; height: 44px; border: 1px solid var(--color-border); border-radius: var(--radius-round); background-color: var(--color-surface); box-shadow: var(--shadow); }
  body.sidebar-is-open .sidebar-control-button { border: none; background: none; box-shadow: none; }

  /* 9. INPUTS Y PAGINACIÓN */
  .search-form input { height: 44px; font-size: 16px; width: 100%; }
  .type-filter-toggle { width: 44px; height: 44px; padding: 0 var(--space-md); }
  .header-pagination-group { display: none; }
  .pagination-container > .btn, .pagination-container > .pagination-current { --btn-height: 36px; }
  
  /* Limpieza */
  .movie-summary { display: none; }
}

  /* Iconos ajustados al espacio reducido */
  .card-action-btn { width: 24px; height: 24px; background: transparent; padding: 0; color: var(--color-text-secondary); }
  .card-action-btn svg { width: 16px; height: 16px; }
  .card-action-btn.is-active svg { color: #ffc107; }
  
  .star-rating-container { gap: 0px; }
  .star-icon { width: 12px; height: 12px; }
  .low-rating-circle { width: 14px; height: 14px; border-width: 2px; }

  /* 7. CARA TRASERA */
  .flip-card-back {
    display: flex; flex-direction: column; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    border-radius: 2px; background-color: var(--color-surface); transform: rotateY(180deg); 
    -webkit-backface-visibility: hidden; backface-visibility: hidden; z-index: 1;
    padding: 4px; overflow-y: auto; font-size: 10px; /* Texto más pequeño */
  }
  .flip-card-back .back-original-title-wrapper { min-height: auto; margin-bottom: 4px; }
  .flip-card-back .ratings-container { gap: 4px; }
  .flip-card-back .details-list { margin: 4px 0; padding-top: 4px; }

  /* Limpieza y controles */
  .movie-summary { display: none; }
  .search-form input { height: 44px; font-size: 16px; width: 100%; }
  .sidebar .sidebar-control-button, .type-filter-toggle { width: 44px; height: 44px; }
  .header-pagination-group { display: none; }


.sidebar .sidebar-inner-wrapper {
  padding: var(--space-xs);
  align-items: flex-start;
}

/* ✨ MEJORA: Transición de opacidad en lugar de display:none */
.sidebar .logo-area,
.sidebar .sidebar-static-filters,
.sidebar .sidebar-scrollable-filters {
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.2s ease-out, visibility 0s linear 0.2s;
}
.sidebar .play-button-container {
  display: none; /* Oculto por defecto en móvil para evitar FOUC */
  flex-direction: column;
  gap: var(--space-md);
  margin-top: var(--space-xs);
}

.sidebar .sidebar-control-button {
  border: 1px solid var(--color-border);
  border-radius: var(--radius-round);
  background-color: var(--color-surface);
  box-shadow: var(--shadow);
}

/* Estilos del sidebar cuando se expande en móvil */
body.sidebar-is-open .sidebar {
  width: 280px; /* Más ancho para mejor legibilidad en móvil */
  font-size: 16px; /* Texto más grande */
  background-color: var(--color-surface);
  border-right: 2px solid var(--color-border);
}
body.sidebar-is-open .sidebar .sidebar-inner-wrapper {
  padding: var(--space-xl) var(--space-lg);
  align-items: initial;
}

/* ✨ MEJORA: Transición de opacidad en lugar de display:block */
body.sidebar-is-open .sidebar .logo-area,
body.sidebar-is-open .sidebar .sidebar-static-filters,
body.sidebar-is-open .sidebar .sidebar-scrollable-filters {
  opacity: 1;
  visibility: visible;
  transition: opacity 0.3s ease-in-out 0.15s, visibility 0s linear 0s; /* Retrasa el fade-in */
}
body.sidebar-is-open .sidebar .play-button-container {
  display: flex; /* Se muestra al abrir */
  flex-direction: row;
  gap: var(--space-md);
  margin-top: 0;
}
body.sidebar-is-open .sidebar .sidebar-control-button {
  width: auto;
  height: auto;
  border: none;
  background: none;
  box-shadow: none;
}
body.sidebar-is-open .sidebar .sidebar-control-button.theme-toggle {
  width: 24px;
  height: 24px;
}

/* Layout y grid base para móvil */
.content {
  padding: var(--space-md) var(--space-md)
    calc(var(--mobile-header-height) + var(--space-md));
}
.main-header {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  top: auto;
  z-index: var(--z-index-header);
  border-top: 1px solid var(--color-border);
  background-color: var(--color-bg);
  padding: var(--space-xs) var(--space-md);
  gap: var(--space-xs);
  flex-wrap: nowrap;
}

/* Ocultamos los botones de paginación de la cabecera en móvil */
.header-pagination-group {
  display: none;
}

/*
 * ▼▼▼ MEJORA: Reducir el tamaño de los botones de paginación en móvil ▼▼▼
 */
.pagination-container > .btn,
.pagination-container > .pagination-current {
  --btn-height: 36px; /* Nuevo tamaño para móvil */
}

#sort-select {
  padding: 0.4rem;
  height: 36px;
}
.search-form input {
  height: 44px; /* Antes 36px */
  font-size: 16px; /* Evita que iOS haga zoom al enfocar */
  width: 100%; /* Aprovechar espacio */
}

/* Caso especial para 1 resultado en móvil estrecho */
@media (max-width: 400px) and (orientation: portrait) {
  .grid-container:has(> .movie-card:only-child) {
    grid-template-columns: 1fr;
    max-width: 70%;
    margin: 0 auto;
  }
}

/* Caso especial para móvil en horizontal */
@media (max-height: 500px) and (orientation: landscape) {
  .grid-container {
    grid-template-columns: repeat(3, 1fr);
  }
}

/* --- Posicionamiento de botones flotantes en móvil --- */
.back-to-top {
  bottom: calc(var(--mobile-header-height) + var(--space-md));
  right: var(--space-md);
}

.profile-container {
  position: fixed;
  bottom: calc(var(--mobile-header-height) + var(--space-md));
  left: var(--space-md);
  z-index: var(--z-index-sidebar);
  margin-top: 0; /* Resetear el margen automático */
  padding-top: 0; /* Resetear el padding */
}

/* --- TABLET Y SUPERIOR (a partir de 769px) --- */
@media (min-width: 769px) {
  /* El sidebar vuelve a ser parte del layout principal */
  .sidebar {
    position: sticky;
    flex-basis: 200px; /* Ancho base del sidebar */
    width: 200px;
    transform: none; /* Reseteamos la transformación de móvil */
    background-color: var(--color-surface);
    border-right: 2px solid var(--color-border);
  }

  .sidebar .sidebar-inner-wrapper {
    padding: var(--space-xl) var(--space-lg);
    align-items: initial;
  }
  .sidebar .logo-area,
  .sidebar .sidebar-static-filters,
  .sidebar .sidebar-scrollable-filters {
    display: block;
    /* ✨ CORRECCIÓN: Restaurar opacidad y visibilidad para escritorio */
    opacity: 1;
    visibility: visible;
    transition: none;
  }
  .sidebar .play-button-container {
    display: flex; /* Restaurar visibilidad en escritorio */
    flex-direction: row;
    gap: var(--space-md);
    margin-top: 0;
    margin-bottom: var(--space-lg);
  }

  /* Los botones de control vuelven a ser transparentes y sin borde */
  .sidebar .sidebar-control-button {
    width: 48px;
    height: 48px;
    border: none;
    background: none;
    box-shadow: none;
  }
  .sidebar .sidebar-control-button.theme-toggle {
    width: 24px;
    height: 24px;
  }

  /* Comportamiento del sidebar colapsado en escritorio */
  body.sidebar-collapsed .sidebar {
    flex-basis: 65px;
  }
  body.sidebar-collapsed .sidebar-inner-wrapper {
    padding: var(--space-lg) var(--space-xs);
    align-items: center;
  }
  body.sidebar-collapsed .logo-area,
  body.sidebar-collapsed .sidebar-static-filters,
  body.sidebar-collapsed .sidebar-scrollable-filters {
    display: none;
  }
  body.sidebar-collapsed .play-button-container {
    flex-direction: column;
    gap: var(--space-lg);
    margin-top: var(--space-md);
  }

  /* --- Reset de botones flotantes para escritorio --- */
  .profile-container {
    position: static; /* Resetear posición fija */
    margin-top: auto; /* Restaurar margen original */
    padding-top: var(--space-md); /* Restaurar padding original */
  }
  .back-to-top {
    bottom: var(--space-md); /* Restaurar posición original */
    right: var(--space-xl);
  }

  /* Restauramos los estilos de layout y grid para escritorio */
  .content {
    padding: var(--space-md) var(--space-xxl) var(--space-xs);
  }
  .main-header {
    position: sticky;
    top: 0;
    bottom: auto; /* Resetear la posición inferior de móvil */
    border-top: none; /* Resetear el borde de móvil */
    padding: var(--space-lg) var(--space-xxl) var(--space-md);
    gap: var(--space-md) var(--space-lg);
    flex-wrap: wrap;
  }

  /* Restauramos la visibilidad de los botones de paginación en escritorio */
  .header-pagination-group {
    display: flex;
  }
  .grid-container {
    grid-template-columns: repeat(3, 1fr);
    gap: var(--space-lg) var(--space-md);
  }
  #sort-select {
    padding: var(--space-xs);
    height: 40px;
  }
  .search-form input {
    height: 40px;
    width: 115px;
  }
  /* Ajuste para el botón de filtros (Todo/Cine/TV) */
  .type-filter-toggle {
    height: 44px;
    padding: 0 var(--space-md);
  }
}

/* --- Puntos de ruptura para rejilla de películas en pantallas grandes --- */

@media (min-width: 62em) {
  /* aprox. 992px+ */
  .grid-container {
    grid-template-columns: repeat(4, 1fr);
    gap: var(--space-lg) var(--space-md);
  }
  body.sidebar-collapsed .grid-container {
    grid-template-columns: repeat(5, 1fr);
  }
}

@media (min-width: 73em) {
  /* aprox. 1168px+ */
  .grid-container {
    grid-template-columns: repeat(5, 1fr);
  }
  body.sidebar-collapsed .grid-container {
    grid-template-columns: repeat(6, 1fr);
  }
}

@media (min-width: 85em) {
  /* aprox. 1360px+ */
  .grid-container {
    grid-template-columns: repeat(6, 1fr);
  }
  body.sidebar-collapsed .grid-container {
    grid-template-columns: repeat(7, 1fr);
  }
}

/* ================================================================= */
/* Sistema de Tipografía Responsiva
/* ================================================================= */
/* Redefine las variables de tamaño de fuente en puntos de ruptura
   para mejorar la jerarquía y legibilidad en cada viewport. */

@media (min-width: 48em) {
  /* Tablet (768px+) */
  :root {
    --font-size-md: 1.25rem; /* 20px */
    --font-size-lg: 1.5rem; /* 24px */
    --font-size-xl: 1.75rem; /* 28px */
    --font-size-xxl: 2.25rem; /* 36px */
  }
}

@media (min-width: 62em) {
  /* Desktop (992px+) */
  :root {
    --font-size-md: 1.5rem; /* 24px */
    --font-size-lg: 1.75rem; /* 28px */
    --font-size-xl: 2.25rem; /* 36px */
    --font-size-xxl: 3rem; /* 48px */
  }
}
