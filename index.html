<!DOCTYPE html>
<html lang="es">
<head>
    <!-- ================================================================= -->
    <!-- 1. METADATOS ESENCIALES Y CONFIGURACIÓN DEL VIEWPORT
    <!-- ================================================================= -->
    <meta charset="UTF-8">
    <meta name="color-scheme" content="light dark">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>videoclub.digital - Tu brújula cinéfila y seriéfila inteligente</title>
    <meta name="description" content="Explora, filtra y descubre miles de películas y series. Tu brújula cinéfila y seriéfila inteligente para seguir tus gustos y encontrar tu próxima obra maestra.">

    <!-- ================================================================= -->
    <!-- 2. OPTIMIZACIÓN DE CARGA: RESOURCE HINTS
    <!-- ================================================================= -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://wibygecgfczcvaqewleq.supabase.co" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="preconnect" href="https://esm.sh">

    <link rel="modulepreload" href="js/main.js">
    <link rel="modulepreload" href="js/ui.js">
    <link rel="modulepreload" href="js/api.js">
    <link rel="modulepreload" href="js/state.js">
    <link rel="modulepreload" href="https://esm.sh/@supabase/supabase-js@2">

    <!-- ================================================================= -->
    <!-- 3. CSS CRÍTICO (INLINE)
    <!-- ================================================================= -->
    <style>
      /* --- INICIO DEL CSS CRÍTICO COMPLETADO --- */
      :root{--color-bg:#f5f5f5;--color-surface:#FFFFFF;--color-text-primary:#333333;--color-text-secondary:#666666;--color-accent:#3A86FF;--color-border:#E0E0E0;--font-title:'Roboto Slab',serif;--font-body:'Roboto',sans-serif;--radius-md:6px;--radius-round:50%;--shadow:0 5px 15px rgba(0,0,0,0.08);--z-index-header:900;--z-index-sidebar:1000}
      
      /* ✨ MEJORA: Se introduce la tipografía fluida. */
      /* El tamaño de fuente base ahora escala con el ancho de la pantalla. */
      html {
        /* font-size: clamp(MIN, PREFERRED, MAX); */
        /* Mínimo: 14px */
        /* Máximo: 16px */
        /* Preferido: 0.8rem + 0.5vw (una fórmula que escala suavemente) */
        font-size: clamp(0.875rem, 0.8rem + 0.5vw, 1rem);
      }

      body.dark-mode{--color-bg:#121212;--color-surface:#282828;--color-text-primary:#E0E0E0;--color-text-secondary:#AAAAAA;--color-accent:#4A90E2;--color-border:#333333;--shadow:0 5px 20px rgba(0,0,0,0.25)}
      *{box-sizing:border-box;margin:0;padding:0}
      body{background-color:var(--color-bg);color:var(--color-text-primary);font-family:var(--font-body); line-height: 1.4;} /* Añadimos un line-height base */      .main-layout{display:flex}
      .sidebar{width:200px;height:100vh;background-color:var(--color-surface);border-right:2px solid var(--color-border);position:sticky;top:0;z-index:var(--z-index-sidebar)}
      .main-content-wrapper {flex-grow: 1; display: flex; flex-direction: column; min-width: 0;}
      .content{flex-grow:1;padding:1rem 3rem 0.5rem;max-width:1920px;margin:0 auto;width: 100%;}
      .main-header{display:flex;align-items:center;flex-wrap:wrap;gap:1rem 1.5rem;position:sticky;top:0;z-index:var(--z-index-header);background-color:var(--color-bg);padding:1.5rem 3rem 1rem;margin-bottom:0;}
      .grid-container{display:grid;gap:1rem;grid-template-columns:repeat(auto-fit,minmax(165px,1fr));justify-content:start;}
      .main-header-primary-controls,.search-and-theme-group{display:flex;align-items:center;gap:1rem}
      .sort-control{display:flex;align-items:center;gap:.5rem}
      #sort-select{background-color:var(--color-surface);border:1px solid var(--color-border);border-radius:var(--radius-md);padding:.5rem}
      .type-filter-toggle{padding:0 .8rem;height:40px;border-radius:var(--radius-md);display:flex;align-items:center;justify-content:center}
      .header-pagination-group{display:flex}
      .header-pagination-btn{width:40px;height:40px;border-radius:0;display:flex;align-items:center;justify-content:center;padding:0}
      #header-prev-btn{border-radius:var(--radius-md) 0 0 var(--radius-md)}
      #header-next-btn{border-radius:0 var(--radius-md) var(--radius-md) 0;margin-left:-1px}
      .search-form{position:relative;display:flex;align-items:center}
      .search-form input{border:1px solid var(--color-border);padding:.6rem 2.5rem .6rem 1rem;border-radius:var(--radius-md);width:115px}
      .search-icon{position:absolute;right:.75rem;top:50%;transform:translateY(-50%);color:var(--color-text-secondary);pointer-events:none}
      .theme-toggle{width:40px;height:40px;border-radius:var(--radius-round);cursor:pointer;display:flex;justify-content:center;align-items:center;padding:0;position:relative}
      .theme-icon{position:absolute;width:20px;height:20px}
      .moon-icon{opacity:1}
      .sun-icon{opacity:0}
      body.dark-mode .moon-icon{opacity:0}
      body.dark-mode .sun-icon{opacity:1}
      .skeleton-card{height:380px;background-color:var(--color-surface);border-radius:8px;position:relative;overflow:hidden;box-shadow:var(--shadow)}
      .skeleton-card::after{content:'';position:absolute;top:0;left:0;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(0,0,0,.04),transparent);animation:skeleton-loading 1.5s infinite}
      body.dark-mode .skeleton-card::after{background:linear-gradient(90deg,transparent,rgba(255,255,255,.08),transparent)}
      @keyframes skeleton-loading{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}
      /* --- FIN DEL CSS CRÍTICO --- */
    </style>

    <!-- ================================================================= -->
    <!-- 4. CSS NO CRÍTICO Y DE TERCEROS (ASÍNCRONO)
    <!-- ================================================================= -->
    <link rel="stylesheet" href="non-critical.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@700&family=Roboto:wght@400;700&display=swap" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@6.6.6/css/flag-icons.min.css">
    
    <link rel="stylesheet" href="vendor/nouislider/nouislider.min.css" media="print" onload="this.media='all'"/>
    <noscript>
      <link rel="stylesheet" href="vendor/nouislider/nouislider.min.css"/>
    </noscript>
</head>

<body>
    <div class="main-layout">
        <button id="sidebar-toggle-btn" class="sidebar-toggle-btn" aria-label="Abrir menú de filtros" aria-controls="sidebar" aria-expanded="false">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
        </button>

        <aside id="sidebar" class="sidebar">
            <div class="sidebar-inner-wrapper">
                <div class="logo-area">
                    <h2 class="logo-title">
                        <span class="logo-line-1">videoclub</span>
                        <span class="logo-line-2">.digital</span>
                    </h2>
                </div>

                <div class="play-button-container">
                    <button id="play-button" class="sidebar-control-button" aria-label="Limpiar filtros">▶︎</button>
                    <button id="toggle-rotation-btn" class="sidebar-control-button" aria-label="Pausar rotación de tarjetas">⏸︎</button>
                    <button id="rewind-button" class="sidebar-control-button" aria-label="Contraer sidebar">⏮︎</button>
                </div>
                
                <div class="sidebar-static-filters">
                    <div id="active-filters-container"></div>
                    <div id="year-slider-container">
                        <div id="year-slider-wrapper">
                            <div id="year-slider"></div>
                        </div>
                        <div id="year-input-container">
                            <input type="number" id="year-start-input" class="year-input" aria-label="Año de inicio">
                            <span class="year-range-separator">-</span>
                            <input type="number" id="year-end-input" class="year-input" aria-label="Año de fin">
                        </div>
                    </div>
                </div>

                <div class="sidebar-scrollable-filters">
                    <div class="collapsible-section">
                        <button type="button" class="section-header" aria-expanded="false">
                            <span>Selección</span>
                            <svg class="chevron-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
                        </button>
                        <div class="section-content">
                            <button type="button" class="filter-link" data-filter-type="selection" data-filter-value="C">Criterion</button>
                            <button type="button" class="filter-link" data-filter-type="selection" data-filter-value="M">1001 Movies</button>
                            <button type="button" class="filter-link" data-filter-type="selection" data-filter-value="A">Arrow</button>
                            <button type="button" class="filter-link" data-filter-type="selection" data-filter-value="K">Kino Lorber</button>
                            <button type="button" class="filter-link" data-filter-type="selection" data-filter-value="E">Eureka</button>
                            <button type="button" class="filter-link" data-filter-type="selection" data-filter-value="H">Series HBO</button>
                            <button type="button" class="filter-link" data-filter-type="selection" data-filter-value="N">Netflix</button>
                        </div>
                    </div>
                    <div class="collapsible-section">
                        <button type="button" class="section-header" aria-expanded="false">
                            <span>Géneros</span>
                            <svg class="chevron-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
                        </button>
                        <div class="section-content" id="genres-list-container">
                            <button type="button" class="filter-link" data-filter-type="genre" data-filter-value="Drama">Drama</button>
                            <button type="button" class="filter-link" data-filter-type="genre" data-filter-value="Comedia">Comedia</button>
                            <button type="button" class="filter-link" data-filter-type="genre" data-filter-value="Thriller">Thriller</button>
                            <button type="button" class="filter-link" data-filter-type="genre" data-filter-value="Acción">Acción</button>
                            <button type="button" class="filter-link" data-filter-type="genre" data-filter-value="Animación">Animación</button>
                            <button type="button" class="filter-link" data-filter-type="genre" data-filter-value="Documental">Documental</button>
                            <form class="sidebar-filter-form" data-filter-type="genre"><input type="text" placeholder="Otro género..." class="sidebar-filter-input"></form>
                        </div>
                    </div>
                    <div class="collapsible-section" id="countries-section">
                        <button type="button" class="section-header" aria-expanded="false">
                            <span>Países</span>
                            <svg class="chevron-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
                        </button>
                        <div class="section-content" id="countries-list-container">
                            <button type="button" class="filter-link" data-filter-type="country" data-filter-value="EEUU">EEUU</button>
                            <button type="button" class="filter-link" data-filter-type="country" data-filter-value="España">España</button>
                            <button type="button" class="filter-link" data-filter-type="country" data-filter-value="UK">UK</button>
                            <button type="button" class="filter-link" data-filter-type="country" data-filter-value="Francia">Francia</button>
                            <button type="button" class="filter-link" data-filter-type="country" data-filter-value="Japón">Japón</button>
                            <button type="button" class="filter-link" data-filter-type="country" data-filter-value="Italia">Italia</button>
                            <form class="sidebar-filter-form" data-filter-type="country"><input type="text" placeholder="Otro país..." class="sidebar-filter-input"></form>
                        </div>
                    </div>
                    <div class="collapsible-section">
                        <button type="button" class="section-header" aria-expanded="false">
                            <span>Directores</span>
                            <svg class="chevron-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
                        </button>
                        <div class="section-content">
                            <button type="button" class="filter-link" data-filter-type="director" data-filter-value="Woody Allen">Woody Allen</button>
                            <button type="button" class="filter-link" data-filter-type="director" data-filter-value="Alfred Hitchcock">Hitchcock</button>
                            <button type="button" class="filter-link" data-filter-type="director" data-filter-value="Steven Spielberg">Spielberg</button>
                            <button type="button" class="filter-link" data-filter-type="director" data-filter-value="Martin Scorsese">Scorsese</button>
                            <button type="button" class="filter-link" data-filter-type="director" data-filter-value="Pedro Almodóvar">Almodóvar</button>
                            <form class="sidebar-filter-form" data-filter-type="director"><input type="text" placeholder="Otro director..." class="sidebar-filter-input"></form>
                        </div>
                    </div>
                    <div class="collapsible-section">
                        <button type="button" class="section-header" aria-expanded="false">
                            <span>Actores</span>
                            <svg class="chevron-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
                        </button>
                        <div class="section-content">
                            <button type="button" class="filter-link" data-filter-type="actor" data-filter-value="Tom Cruise">Tom Cruise</button>
                            <button type="button" class="filter-link" data-filter-type="actor" data-filter-value="Robert De Niro">De Niro</button>
                            <button type="button" class="filter-link" data-filter-type="actor" data-filter-value="Brad Pitt">Brad Pitt</button>
                            <button type="button" class="filter-link" data-filter-type="actor" data-filter-value="Helen Mirren">Helen Mirren</button>
                            <button type="button" class="filter-link" data-filter-type="actor" data-filter-value="Javier Bardem">Javier Bardem</button>
                            <form class="sidebar-filter-form" data-filter-type="actor"><input type="text" placeholder="Otro actor..." class="sidebar-filter-input"></form>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <div class="main-content-wrapper">
            <header class="main-header">
                <div class="main-header-primary-controls">
                    <div class="sort-control">
                        <label for="sort-select">Orden:</label>
                        <select id="sort-select">
                            <option value="relevance,asc">Relevancia</option>
                            <option value="year,desc">Recientes</option>
                            <option value="year,asc">Antiguas</option>
                            <option value="fa_rating,desc">Nota FA</option>
                            <option value="imdb_rating,desc">Nota IMDb</option>
                            <option value="fa_votes,desc">Votos FA</option>
                            <option value="imdb_votes,desc">Votos IMDb</option>
                        </select>
                    </div>

                    <button id="type-filter-toggle" class="type-filter-toggle" type="button" title="Filtrar por Cine o TV">Todo</button>
                    
                    <div class="header-pagination-group">
                        <button id="header-prev-btn" class="pagination-button" title="Página anterior" aria-label="Ir a la página anterior">&lt;</button>
                        <button id="header-next-btn" class="pagination-button" title="Página siguiente" aria-label="Ir a la página siguiente">&gt;</button>
                    </div>
                </div>

                <div class="search-and-theme-group">
                    <div class="search-container">
                        <form id="search-form" class="search-form" role="search">
                            <input id="search-input" type="search" placeholder="Título..." maxlength="15" aria-label="Buscar películas o series por título" autocomplete="off">
                            <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                        </form>
                    </div>

                    <div class="theme-toggle-container">
                        <button id="theme-toggle" class="theme-toggle" title="Cambiar tema" aria-label="Cambiar entre tema claro y oscuro">
                            <svg class="theme-icon moon-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
                            <svg class="theme-icon sun-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
                        </button>
                    </div>
                </div>
            </header>

            <main class="content">
                <div id="sidebar-overlay" class="sidebar-overlay"></div>
                <div id="grid-container" class="grid-container" aria-live="polite"></div>
                <nav id="pagination-container" class="pagination-container" aria-label="Navegación de páginas"></nav>
            </main>
        </div>
    </div>
    
    <button id="back-to-top" class="back-to-top" title="Volver al inicio">↑</button>

    <div id="toast-container" class="toast-container"></div>

    <template id="movie-card-template">
        <div class="movie-card">
            <div class="flip-card-inner">
                <div class="flip-card-front">
                    <img src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" alt="" class="lazy-image" width="500" height="750" decoding="async" loading="lazy">
                    <div class="movie-info">
                        <div class="title-director-block">
                            <h3 data-template="title"></h3>
                            <div class="front-director-info" data-template="director"></div>
                        </div>
                        <div class="movie-meta">
                            <div class="year-country-line">
                                <span data-template="year"></span>
                                <span class="country-info" data-template="country-container">
                                    <span class="fi" data-template="country-flag"></span>
                                    <span data-template="country-name"></span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="flip-card-back">
                    <div class="back-meta-header"><span class="duration-info" data-template="duration"></span></div>
                    <div class="ratings-container">

                        <!-- ✨ MEJORA: Nueva estructura para alinear nota y barra -->
                        <div class="rating-line">
                            <a href="#" target="_blank" rel="noopener noreferrer" class="rating-left" data-template="fa-link">
                                <img class="rating-icon" alt="FilmAffinity" width="24" height="24" loading="lazy" decoding="async">
                                <span data-template="fa-rating"></span>
                            </a>
                            <div class="rating-bar-container" data-template="fa-votes-bar-container">
                                <div class="rating-bar" data-template="fa-votes-bar"></div>
                            </div>
                        </div>

                        <!-- ✨ MEJORA: Nueva estructura para alinear nota y barra -->
                        <div class="rating-line">
                            <a href="#" target="_blank" rel="noopener noreferrer" class="rating-left" data-template="imdb-link">
                                <img class="rating-icon" alt="IMDb" width="24" height="24" loading="lazy" decoding="async">
                                <span data-template="imdb-rating"></span>
                            </a>
                            <div class="rating-bar-container" data-template="imdb-votes-bar-container">
                                <div class="rating-bar" data-template="imdb-votes-bar"></div>
                            </div>
                        </div>

                    </div>
                    <div class="details-list">

                        <div class="detail-item"><span class="detail-label">🎬</span><span class="detail-data" data-template="genre"></span></div>
                        <div class="detail-item"><span class="detail-label">✨</span><span class="detail-data" data-template="actors"></span></div>
                    </div>
                    <div class="scrollable-content">
                        <div class="plot-summary-final" title="Sinopsis"><span class="detail-label">🔹</span><span data-template="synopsis"></span></div>
                        <div class="critic-review" title="Crítica" data-template="critic-container"><span class="detail-label">🔸</span><span data-template="critic"></span></div>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <template id="sidebar-skeleton-template">
        <div class="collapsible-section">
            <div class="skeleton skeleton-sidebar-header"></div>
            <div class="section-content">
                <div class="skeleton skeleton-sidebar-line"></div>
                <div class="skeleton skeleton-sidebar-line"></div>
                <div class="skeleton skeleton-sidebar-line"></div>
            </div>
        </div>
    </template>

    <script src="vendor/nouislider/nouislider.min.js"></script>
    <script type="module" src="js/main.js"></script>
</body>
</html>